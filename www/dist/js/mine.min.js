function authService($window){var self=this;self.parseJwt=function(token){var base64Url=token.split(".")[1],base64=base64Url.replace("-","+").replace("_","/");return JSON.parse($window.atob(base64))},self.saveToken=function(token){localStorage.setItem("jwtToken",token)},self.getToken=function(){return localStorage.getItem("jwtToken")},self.saveUser=function(user){3==user.status?user.is_verified_lawyer=!0:user.is_verified_lawyer=!1,localStorage.setItem("currentUser",JSON.stringify(user))},self.getUser=function(){return JSON.parse(localStorage.getItem("currentUser"))},self.isAuthed=function(){var token=self.getToken(),user=self.getUser();return token&&user?!0:!1},self.logout=function(){localStorage.removeItem("jwtToken"),localStorage.removeItem("currentUser"),sessionStorage.removeItem("goback")}}function userService($http,HOST,authService,wxService,$ionicLoading){var self=this;self.register=function(username,password,phonecode,account_type,post_id){return $http.post("http://"+HOST+"/register",{username:username,password:password,phonecode:phonecode,account_type:account_type,post_id:post_id}).then(function(res){layer.show("注册成功！"),$scope.user={},$scope.params={};var user=res.data?res.data.data:null;user&&(authService.saveUser(user),console.log("user:",user));var token=res.data?res.data.token:null;token&&(authService.saveToken(token),console.log("token:",token));var goback=sessionStorage.getItem("goback");null==goback||""==goback||"undefined"==goback?location.href="#/index":location.href=goback,sessionStorage.removeItem("goback")})["catch"](function(response){if(400===response.status){var errMsg=JSON.stringify(data.error_messages.username);layer.show(errMsg),layer.show("注册失败，请重新登录。")}})},self.login=function(username,password,post_id){return $ionicLoading.show(),$http.post("http://"+HOST+"/login",{username:username,password:password,post_id:post_id}).then(function(res){var user=res.data?res.data.data:null;user&&(authService.saveUser(user),console.log("user:",user));var token=res.data?res.data.token:null;token&&(authService.saveToken(token),console.log("token:",token)),$ionicLoading.hide();var goback=sessionStorage.getItem("goback");null==goback||""==goback||"undefined"==goback?location.href="#/index":location.href=goback,sessionStorage.removeItem("goback")})["catch"](function(response){400===response.status&&layer.show("登录失败，账号或密码错误，请重新登录。")})},self.loginWithWx=function(code,state,post_id){return $ionicLoading.show(),$http.post("http://"+HOST+"/loginWithWx",{code:code,state:state,post_id:post_id}).then(function(res){var user=res.data?res.data.data:null;wxService.saveOpenId(user.wx_openid),user&&(authService.saveUser(user),console.log("user:",user));var token=res.data?res.data.token:null;token&&(authService.saveToken(token),console.log("token:",token)),$ionicLoading.hide();var goback=sessionStorage.getItem("goback");null==goback||""==goback||"undefined"==goback?location.href="#/index":(alert("微信登录"),location.href=goback),sessionStorage.removeItem(goback)})["catch"](function(response){console.error("Gists error",response.status,response.data),400===response.status&&layer.show("登录失败，账号或密码错误，请重新登录。")})}}function easemobService($ionicLoading){var conn,self=this,textSending=!1,talkInputId="talkInputId",curUserId=null,curChatUserId=null,msgCardDivId="chat01",groupFlagMark="group--";self.msgType=null,self.init=function(userId,msgType){curChatUserId=userId.toString(),self.handleConfig(),self.msgType=msgType,conn=new Easemob.im.Connection,conn.init({https:AppSettings.easemobHttps,url:AppSettings.easemobXmppURL,onOpened:function(){self.handleOpen(conn)},onClosed:function(){self.handleClosed()},onTextMessage:function(message){console.info("onTextMessage"),self.handleTextMessage(message)},onError:function(message){conn.stopHeartBeat(conn)}})},self.handleConfig=function(){Easemob.im.Helper.getIEVersion()<10&&(AppSettings.easemobHttps="https:"==location.protocol?!0:!1,AppSettings.easemobHttps?(0!=AppSettings.easemobXmppURL.indexOf("https")&&(AppSettings.easemobXmppURL=AppSettings.easemobXmppURL.replace(/^http/,"https")),0!=AppSettings.easemobApiURL.indexOf("https")&&(AppSettings.easemobApiURL=AppSettings.easemobApiURL.replace(/^http/,"https"))):(0==AppSettings.easemobXmppURL.indexOf("https")&&(AppSettings.easemobXmppURL=AppSettings.easemobXmppURL.replace(/^https/,"http")),0==AppSettings.easemobApiURL.indexOf("https")&&(AppSettings.easemobApiURL=AppSettings.easemobApiURL.replace(/^https/,"http"))))},self.login=function(user,pwd){conn.isOpened()||($ionicLoading.show(),conn.open({apiUrl:AppSettings.easemobApiURL,user:user,pwd:pwd,appKey:AppSettings.easemobAppKey}))},self.handleOpen=function(conn){curUserId=conn.context.userId,conn.setPresence(),conn.getRoster({success:function(roster){$ionicLoading.hide(),self.showChatUI()}}),conn.isOpened()&&conn.heartBeat(conn)},self.handleClosed=function(){curUserId=null,curChatUserId=null,curRoomId=null,bothRoster=[],toRoster=[];for(var i=0,l=audioDom.length;l>i;i++)audioDom[i].jPlayer&&audioDom[i].jPlayer("destroy");clearContactUI("contactlistUL","contactgrouplistUL","momogrouplistUL",msgCardDivId),groupQuering=!1,textSending=!1},self.handleTextMessage=function(message){console.info(message,self.msgType);var from=message.from,mestype=message.type,messageContent=message.data;if(self.msgType==mestype){message.to;if(from!=curUserId)if("groupchat"==mestype){messageContent.replace(/\n/g,"<br>");self.appendMsg(message.from,message.to,messageContent,mestype,message.ext.realname,message.ext.avatar)}else self.appendMsg(message.from,message.from,messageContent,mestype,message.ext.realname,message.ext.avatar)}},self.setCurrentContact=function(defaultUserId){self.showContactChatDiv(defaultUserId),curChatUserId=defaultUserId},self.getContactChatDiv=function(chatUserId){return document.getElementById(curUserId+"-"+chatUserId)},self.createContactChatDiv=function(chatUserId){var msgContentDivId=curUserId+"-"+chatUserId,newContent=document.createElement("div");return $(newContent).attr({id:msgContentDivId,"class":"chat01_content",className:"chat01_content",style:"display:block"}),$("#null-nouser").css({display:"none"}),newContent},self.showContactChatDiv=function(chatUserId){var contentDiv=self.getContactChatDiv(chatUserId);null==contentDiv&&(contentDiv=self.createContactChatDiv(chatUserId),document.getElementById(msgCardDivId).appendChild(contentDiv)),contentDiv.style.display="block";var contactLi=document.getElementById(chatUserId);if(null!=contactLi){contactLi.style.backgroundColor="#33CCFF";var dispalyTitle=null;chatUserId.indexOf(groupFlagMark)>=0?(dispalyTitle="群组"+$(contactLi).attr("displayname")+"聊天中",curRoomId=$(contactLi).attr("roomid"),$("#roomMemberImg").css("display","block")):(dispalyTitle="与"+chatUserId+"聊天中",$("#roomMemberImg").css("display","none")),document.getElementById(talkToDivId).children[0].innerHTML=dispalyTitle}},self.clearContactUI=function(contactlistUL,contactgrouplistUL,momogrouplistUL,contactChatDiv){$("#contactlistUL").empty(),$("#contactgrouplistUL").empty(),$("#momogrouplistUL").empty();for(var accordionChild=$("#accordionDiv").children(),i=1;i<=accordionChild.length;i++){var badgegroup=$("#accordion"+i).find(".badgegroup");badgegroup&&badgegroup.length>0&&$("#accordion"+i).children().remove()}document.getElementById(talkToDivId).children[0].innerHTML="";for(var chatRootDiv=document.getElementById(contactChatDiv),children=chatRootDiv.children,i=children.length-1;i>1;i--)chatRootDiv.removeChild(children[i]);$("#null-nouser").css({display:"block"})},self.showChatUI=function(){$("#content").css({display:"block"})},self.sendText=function(chattype){if(textSending)return!1;textSending=!0;var msgInput=document.getElementById(talkInputId),msg=msgInput.value;if(null==msg||0==msg.length)return textSending=!1,!1;var to=curChatUserId;if(null==to)return textSending=!1,!1;var currentUser=JSON.parse(localStorage.getItem("currentUser")),ext={realname:currentUser.realname,avatar:currentUser.avatar,associate_id:currentUser.associate_id},options={to:to,msg:msg,type:chattype,ext:ext};conn.sendTextMessage(options),console.info("sent text options",options);var msgtext=msg.replace(/\n/g,"<br>");return self.appendMsg(curUserId,to,msgtext,chattype,currentUser.realname,currentUser.avatar),msgInput.value="",msgInput.focus(),setTimeout(function(){textSending=!1},2e3),!0},self.appendMsg=function(who,contact,message,chattype,realname,avatar){var contactDivId=contact;chattype&&"groupchat"==chattype&&(contactDivId=groupFlagMark+contact);var localMsg=(document.getElementById(contactDivId),null);"string"==typeof message?(localMsg=Easemob.im.Helper.parseTextMessage(message),localMsg=localMsg.body):localMsg=message.data;for(var headstr=["<p1>"+self.getLoacalTimeString()+"   <span></span>   </p1>","<p2>"+realname+"<b></b><br/></p2><img src="+avatar+"><br>"],header=$(headstr.join("")),lineDiv=document.createElement("div"),i=0;i<header.length;i++){var ele=header[i];lineDiv.appendChild(ele)}for(var messageContent=localMsg,i=0;i<messageContent.length;i++){var msg=messageContent[i],data=(msg.type,msg.data),eletext="<p3 style='text-align: left'>"+data+"</p3>",ele=$(eletext);ele[0].setAttribute("class","chat-content-p3"),ele[0].setAttribute("className","chat-content-p3");for(var j=0;j<ele.length;j++)lineDiv.appendChild(ele[j])}null==curChatUserId&&null==chattype&&(self.setCurrentContact(contact),time<1&&($("#accordion3").click(),time++));var msgContentDiv=document.getElementById(curUserId+"-"+contactDivId);return curUserId==who?(lineDiv.style.textAlign="right",lineDiv.className="immediate-information easemobmain-record img-right"):(lineDiv.style.textAlign="left",lineDiv.className="immediate-information easemobmain-record img-left"),msgContentDiv.appendChild(lineDiv),msgContentDiv.scrollTop=msgContentDiv.scrollHeight,lineDiv},self.getLoacalTimeString=function(){var date=new Date,time=date.getHours()+":"+date.getMinutes()+":"+date.getSeconds();return time}}function locationService($http){var self=this;self.fetchLocation=function($scope){$scope.currentLocation=self.getDefaultLocation(),self.saveLocation($scope.currentLocation);var locations={};$http.get("http://"+AppSettings.baseApiUrl+"/common/wxconfig").success(function(data){data&&(data.debug=!1,wx.config(data))}),wx.ready(function(){wx.getLocation({success:function(res){$http.get("http://"+AppSettings.baseApiUrl+"/area/addresscode/"+res.latitude+"/"+res.longitude).success(function(data){data&&(locations=data),locations.latitude=res.latitude,locations.longitude=res.longitude,self.saveLocation(locations),$scope.currentLocation=locations})},cancel:function(res){lawyer.show("用户拒绝授权获取地理位置")}})})},self.saveLocation=function(location){localStorage.setItem("currentLocation",JSON.stringify(location))},self.getLocation=function(){return JSON.parse(localStorage.getItem("currentLocation"))},self.getDefaultLocation=function(){var locations={};return locations.city_id="440300",locations.city_name="深圳市",locations.district_id="440301",locations.district_name="福田区",locations.province_id="440000",locations.province_name="广东省",locations}}function wxService(){var self=this;self.getWxAuthUrl=function(path){var redirect_uri="http://"+AppSettings.baseMobileUrl+"/#"+path,str="https://open.weixin.qq.com/connect/oauth2/authorize?";return str+="appid="+AppSettings.appId+"&",str+="redirect_uri="+encodeURIComponent(redirect_uri)+"&",str+="response_type=code&",str+="scope=snsapi_base&",str+="state=1",str+="#wechat_redirect"},self.saveOpenId=function(openid){localStorage.setItem("wx_openid",openid)},self.getOpenId=function(){return localStorage.getItem("wx_openid")}}var lvtuanApp=angular.module("app",["ionic","ngSanitize","ngFileUpload","listModule","authModule","wxModule","locationModule","ngStorage","easemobModule","angular-jwt"]);lvtuanApp.constant("HOST",AppSettings.baseApiUrl),lvtuanApp.config(["$ionicConfigProvider",function($ionicConfigProvider){$ionicConfigProvider.views.maxCache(5),$ionicConfigProvider.tabs.position("top")}]),lvtuanApp.controller("MainController",["$rootScope","$scope","$state","$location","$ionicHistory","$http","userService","authService","locationService",function($rootScope,$scope,$state,$location,$ionicHistory,$http,userService,authService,locationService){var self=this;self.login=function(){userService.login(self.username,self.password)},self.register=function(){},self.logout=function(){authService.logout()},self.isAuthed=function(){return authService.isAuthed?authService.isAuthed():!1},$scope.$on("$ionicView.beforeEnter",function(){$scope.currentUser=authService.getUser(),currentLocation=locationService.getLocation(),currentLocation&&currentLocation.city_name?$scope.currentLocation=currentLocation:locationService.fetchLocation($scope)}),$scope.jump=function(url,id){id&&(location.href=url+$scope.id),location.href=url,window.location.reload()},$scope.jumpGo=function(url){location.href=url},$scope.jumpGoBack=function(){window.history.back()},$scope.jumpGoBack_rel=function(){window.history.go(-1)},window.history&&window.history.pushState&&$(window).on("popstate",function(){var current_State=history.state;if(console.info(current_State),current_State)if("order"==current_State.states)window.location.replace("#/center");else{if("areward"!=current_State.states)return!1;window.location.replace("#/questionslist")}})}]),lvtuanApp.directive("hideTabs",["$rootScope",function($rootScope){return{restrict:"A",link:function(scope,element,attributes){scope.$on("$ionicView.beforeEnter",function(){scope.$watch(attributes.hideTabs,function(value){void 0==$rootScope.hideTabs||void 0==value?$rootScope.hideTabs=!0:$rootScope.hideTabs=value})}),scope.$on("$ionicView.beforeLeave",function(){scope.$watch(attributes.hideTabs,function(value){$rootScope.hideTabs=!1})})}}}]),lvtuanApp.directive("star",function(){return{template:'<ul class="rating" ng-mouseleave="leave()"><li ng-repeat="star in stars" ng-class="star" ng-click="click($index + 1)" ng-mouseover="over($index + 1)"><i class="img"></i></li></ul>',scope:{ratingValue:"=",max:"=",readonly:"@",onHover:"=",onLeave:"="},controller:["$scope",function($scope){$scope.ratingValue=$scope.ratingValue||0,$scope.max=$scope.max||5,$scope.click=function(val){$scope.readonly&&"true"===$scope.readonly||($scope.ratingValue=val)},$scope.over=function(val){$scope.onHover(val)},$scope.leave=function(){$scope.onLeave()}}],link:function(scope,elem,attrs){var updateStars=function(){scope.stars=[];for(var i=0;i<scope.max;i++)scope.stars.push({filled:i<scope.ratingValue})};updateStars(),scope.$watch("ratingValue",function(oldVal,newVal){newVal&&updateStars()}),scope.$watch("max",function(oldVal,newVal){newVal&&updateStars()})}}}),lvtuanApp.constant("$ionicLoadingConfig",{content:'<ion-spinner icon="ios"></ion-spinner>',animation:"fade-in",showBackdrop:!0,maxWidth:200,showDelay:0}),lvtuanApp.controller("ionicNavBarDelegateCtrl",["$state","$timeout","$http","$location",function($state,$timeout,$http,$location){$timeout(function(){$location.path("/index")},3e3)}]),lvtuanApp.controller("indexCtrl",["$scope","$location","listHelper","locationService",function($scope,$location,listHelper,locationService){locationService.getLocation()?($scope.locations=locationService.getLocation(),$scope.city=$scope.locations.city_id,listHelper.bootstrap("/lawyer/list_lawyers?is_recommended=1&city_id="+$scope.city,$scope)):listHelper.bootstrap("/lawyer/list_lawyers?is_recommended=1",$scope),$scope.mylvteam=function(){$location.path("/mylvteam")}}]),lvtuanApp.controller("loginCtrl",["$state","$scope","$rootScope","$http","userService",function($state,$scope,$rootScope,$http,userService){function checkvaldata(user){if(""==user.username)return layer.show("请输入手机号码或者邮箱！"),!1;if(user.username.match(format_mobile)){if(null==user.username.match(format_mobile))return layer.show("请输入正确的手机号码!"),!1}else if(null==user.username.match(format_email))return layer.show("请输入正确邮箱账号!"),!1;return!0}var format_email=/^\w+([-+.']\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/,format_mobile=/^[1][0-9]{10}$/;$scope.submit=function(user){$scope.post_id=JSON.parse(localStorage.getItem("post_id")),$scope.post_id_status=JSON.parse(localStorage.getItem("post_id_status")),0==$scope.post_id_status&&($scope.post_id_status=!0,localStorage.setItem("post_id_status",JSON.stringify($scope.post_id_status))),checkvaldata(user)&&userService.login(user.username,user.password,$scope.post_id)}}]),lvtuanApp.controller("registerCtrl",["$scope","$rootScope","$http","$interval","$ionicLoading","$location","userService","authService",function($scope,$rootScope,$http,$interval,$ionicLoading,$location,userService,authService){$scope.phone_disabled=!0,$scope.phonecode=function(phone){$ionicLoading.show();var param="phone="+phone;$scope.phone_disabled=!1,$http.post("http://"+$rootScope.hostName+"/send-code?"+param).success(function(data){runTiming(),layer.show("验证码已发送到您的手机！"),$ionicLoading.hide()})};var timePromise;$scope.t=60;var runTiming=function(){return timePromise=$interval(function(){$scope.t-=1,0==$scope.t&&($scope.phone_disabled=!0,$interval.cancel(timePromise),timePromise=void 0)},1e3,60)};$scope.submit=function(user){$scope.params={},user.username&&($scope.params.username=user.username),user.phonecode&&($scope.params.phonecode=user.phonecode),user.password&&($scope.params.password=user.password),$ionicLoading.show(),$scope.post_id=JSON.parse(localStorage.getItem("post_id")),$scope.post_id_status=JSON.parse(localStorage.getItem("post_id_status")),0==$scope.post_id_status&&($scope.post_id_status=!0,localStorage.setItem("post_id_status",JSON.stringify($scope.post_id_status))),$http.post("http://"+$rootScope.hostName+"/register",{username:$scope.params.username,password:$scope.params.password,phonecode:$scope.params.phonecode,account_type:"phone",post_id:$scope.post_id}).success(function(data){layer.show("注册成功！"),$scope.user={},$scope.params={};var user_data=data?data.data:null;user_data&&(authService.saveUser(user_data),console.log("user:",user_data));var token=data?data.token:null;token&&(authService.saveToken(token),console.log("JWT:",token));var goback=sessionStorage.getItem("goback");null==goback||""==goback||"undefined"==goback?location.href="#/index":location.href=goback,sessionStorage.removeItem("goback"),$ionicLoading.hide()})}}]),lvtuanApp.controller("resetpwdCtrl",["$scope","$http","$rootScope","$ionicLoading","$location",function($scope,$http,$rootScope,$ionicLoading,$location){$scope.user={},$scope.save=function(user){return user.old_password==user.new_password&&user.old_password==user.new_password_retype&&user.new_password==user.new_password_retype?(layer.show("修改密码不能和初始密码一样！"),!1):user.new_password.length!=user.new_password_retype.length?(layer.show("重置密码的长度不一致！"),!1):user.new_password!=user.new_password_retype?(layer.show("两次输入的密码不一致！"),!1):($ionicLoading.show(),void $http.post("http://"+$rootScope.hostName+"/center/reset_pass",$scope.user).success(function(data){layer.show("修改成功！"),$scope.user={},$location.path("/login"),$ionicLoading.hide()}))}}]),lvtuanApp.controller("forgotpwdCtrl",["$scope","$http","$rootScope","$ionicLoading",function($scope,$http,$rootScope,$ionicLoading){$scope.user={},$scope.phonecode=function(phone){if(console.info(phone),void 0==phone)return layer.show("请输入手机号！"),!1;$ionicLoading.show();var param="phone="+phone;return $http.post("http://"+$rootScope.hostName+"/send-code?"+param).success(function(data){console.info(data),layer.show("验证码已发送到您的手机！"),$ionicLoading.hide()}),!0},$scope.submit=function(user){console.info(user),$scope.user=user,$ionicLoading.show(),$http.post("http://"+$rootScope.hostName+"/forgotpwd",$scope.user).success(function(data){$scope.user={},$scope.uid=data.data.uid,sessionStorage.setItem("uid",JSON.stringify($scope.uid)),$("#forgotForm").hide(),$("#upwdForm").show(),$ionicLoading.hide()})}}]),lvtuanApp.controller("upwdCtrl",["$scope","$http","$rootScope","$ionicLoading","$location",function($scope,$http,$rootScope,$ionicLoading,$location){$scope.user={},$scope.submit=function(user){return $scope.uid=JSON.parse(sessionStorage.getItem("uid")),$scope.user=user,$scope.user.password_1.length!=$scope.user.password_2.length?(layer.show("重置密码的长度不一致！"),!1):$scope.user.password_1!=$scope.user.password_2?(layer.show("两次输入的密码不一致！"),!1):($ionicLoading.show(),void $http.post("http://"+$rootScope.hostName+"/forgotpwd/resetpwd/"+$scope.uid,$scope.user).success(function(data){layer.show("修改成功！"),sessionStorage.removeItem("uid"),$scope.user={},$location.path("/login"),$ionicLoading.hide()}))}}]),lvtuanApp.controller("boundphoneCtrl",["$scope","$http","$rootScope","$ionicLoading",function($scope,$http,$rootScope,$ionicLoading){$scope.user={},$scope.phonecode=function(phone){if(console.info(phone),void 0==phone)return layer.show("请输入手机号！"),!1;$ionicLoading.show();var param="phone="+phone;return $http.post("http://"+$rootScope.hostName+"/send-code?"+param).success(function(data){console.info(data),layer.show("验证码已发送到您的手机！"),$ionicLoading.hide()}),!0},$scope.submit=function(user){console.info(user)}}]),lvtuanApp.controller("wxAuthCtrl",["$scope","$stateParams","wxService","userService",function($scope,$stateParams,wxService,userService){$scope.post_id=JSON.parse(localStorage.getItem("post_id")),null!=$scope.post_id&&($scope.post_id_status=!0,localStorage.setItem("post_id_status",JSON.stringify($scope.post_id_status))),userService.loginWithWx($stateParams.code,$stateParams.state,$scope.post_id)}]),lvtuanApp.controller("wxLoginCtrl",["$scope","$http","$rootScope","wxService",function($scope,$http,$rootScope,wxService){window.location.replace(wxService.getWxAuthUrl("/wxauth"))}]),lvtuanApp.controller("groupCtrl",["$scope","$http","$state","$rootScope","$location","$ionicPopup",function($scope,$http,$state,$rootScope,$location,$ionicPopup){$scope.jumplogin=function(){console.info($rootScope.is_lawyer),$location.path("/login")},$scope.showAlert=function(){var alertPopup=$ionicPopup.alert({title:"提示",template:"研发中..."});alertPopup.then(function(res){})}}]),lvtuanApp.controller("groupListCtrl",["$http","$scope","$rootScope","$ionicLoading","$filter","listHelper",function($http,$scope,$rootScope,$ionicLoading,$filter,listHelper){$rootScope.url="#/groupcreate",listHelper.bootstrap("/group/list/mine",$scope)}]),lvtuanApp.filter("formatdate",function(){var filterDate=function(thisdate){var date=new Date,syear=date.getFullYear().toString(),smonth=(date.getMonth()+1).toString(),sday=date.getDate().toString();1==smonth.length&&(smonth="0"+(date.getMonth()+1).toString()),1==sday.length&&(sday="0"+date.getDate().toString());var str=thisdate,arr=new Array;arr=str.split("-"),year=arr[0],month=arr[1],day=arr[2].substring(0,2),time=arr[2].substring(3,8);var reset="";return syear==year&&smonth==month&&sday==day?reset="今天 "+time:("0"==month.substring(0,1).toString()&&(month=month.substring(1)),"0"==day.substring(0,1).toString()&&(day=day.substring(1)),reset=month+"月"+day+"日 "+time),reset};return filterDate}),lvtuanApp.controller("groupTeleviseCtrl",["$scope","$http","$rootScope","$ionicPopup","listHelper",function($scope,$http,$rootScope,$ionicPopup,listHelper){$rootScope.url="#/televisecreate",listHelper.bootstrap("/microblog/list/all",$scope),$scope.likes=function(id,index){$http.post("http://"+$rootScope.hostName+"/like",{item_type:"post",item_id:id}).success(function(data){console.info(data);var itmes=data.data;$scope.televise[index].post_extra.likes_count=itmes.likes_count,layer.show("点赞成功！")})}}]),lvtuanApp.controller("groupAttentionCtrl",["$scope","$http","$state","$rootScope","$ionicLoading","listHelper",function($scope,$http,$state,$rootScope,$ionicLoading,listHelper){$rootScope.url="#/group/attention/search",listHelper.bootstrap("/group/recommend",$scope),$scope.groupjoin=function(id,index){$ionicLoading.show(),$http.post("http://"+$rootScope.hostName+"/group/"+id+"/join",{},{cache:!0,headers:{Accept:"application/json"}}).success(function(data){return data&&data.data?($scope.items.splice(index,1),layer.show("已关注 加入成功！"),$ionicLoading.hide(),void 0):(layer.show("暂无数据！"),$scope.moredata=!1,!1)})}}]),lvtuanApp.controller("groupAttentionSearchCtrl",["$http","$scope","$state","$rootScope","$ionicLoading",function($http,$scope,$state,$rootScope,$ionicLoading){angular.element(".search").trigger("focus");var page=1,rows_per_page=5;$scope.rows_per_page&&(rows_per_page=$scope.rows_per_page),$scope.moredata=!0,$scope.items=[],$scope.q="",$scope.$watch("q",function(newVal,oldVal){newVal!==oldVal&&(page=1,$scope.items=[],$scope.loadMore())}),$scope.doRefresh=function(){page=1,$scope.items=[],$scope.loadMore(),$scope.$broadcast("scroll.refreshComplete")},$scope.loadMore=function(){var params=layer.getParams("#searchForm"),url="";return""==params.q?($scope.moredata=!1,!1):(url="http://"+$rootScope.hostName+"/group/recommend?q="+params.q+"&rows_per_page="+rows_per_page+"&page="+page,console.info(url),$ionicLoading.show(),$http.get(url).success(function(data){data&&data.data&&data.data.length?($scope.items=$scope.items.concat(data.data),console.info($scope.items),data.data.length<rows_per_page?$scope.moredata=!1:$scope.moredata=!0):(1==page&&($scope.moredata=!1,$scope.nodata=!1),$scope.moredata=!1),page++,$scope.$broadcast("scroll.infiniteScrollComplete"),$ionicLoading.hide()}),void 0)},$scope.$on("$stateChangeSuccess",function(){$scope.loadMore()}),$scope.groupjoin=function(id,index){var page=1,id=id;$http.post("http://"+$rootScope.hostName+"/group/"+id+"/join?rows_per_page="+rows_per_page+"&page="+page++,{},{cache:!0,headers:{Accept:"application/json"}}).success(function(data){return data&&data.data?($scope.items.splice(index,1),void layer.show("已关注 加入成功！")):(layer.show("暂无数据！"),$scope.moredata=!1,!1)})["finally"](function(){$scope.$broadcast("scroll.refreshComplete"),$scope.$broadcast("scroll.infiniteScrollComplete")})}}]),lvtuanApp.controller("groupviewCtrl",["$scope","$http","$state","$rootScope","$stateParams","$ionicLoading","easemobService","authService",function($scope,$http,$state,$rootScope,$stateParams,$ionicLoading,easemobService,authService){$scope.$on("$locationChangeSuccess",function(newState,oldState){return newState==oldState?!1:void window.location.reload()});var currentUser=authService.getUser();currentUser.associate_id=$stateParams.id,localStorage.setItem("currentUser",JSON.stringify(currentUser)),$scope.$on("$ionicView.beforeEnter",function(){$ionicLoading.show();var timestamp=Math.round((new Date).getTime()/1e3);$http.get("http://"+$rootScope.hostName+"/group/"+$stateParams.id+"/chat?ts="+timestamp).success(function(data){if(data&&data.data){$scope.items=data.data,$scope.group_name=$scope.items.group_name.length>9?$scope.items.group_name.substring(0,9)+"...":$scope.items.group_name;var curRoomId=$scope.items.easemob_id;$scope.curChatUserId=curRoomId,$scope.curUserId=$scope.items.user_id,easemobService.init(curRoomId,"groupchat"),easemobService.login($scope.items.user_id.toString(),$scope.items.pwd),console.info("圈子",$scope.items)}$ionicLoading.hide()})}),$scope.site=function(id){location.href="#/group/site/"+id};var page=1,rows_per_page=10;$scope.loadMore=function(){var str="",url="http://"+$rootScope.hostName+"/group/"+$stateParams.id+"/records?page="+page+"&rows_per_page="+rows_per_page;$ionicLoading.show(),$http.get(url).success(function(data){obj=data.data,console.info(obj);for(var i=0;i<obj.length;i++)style="left",obj[i].from!=$scope.curUserId?(str+='<div class="easemobmain-record img-right" style="text-align:right;">',str+="<p1>"+obj[i].created_at+"<span></span></p1>",str+="<p2>"+obj[i].sender_realname+"<b></b></p2>"):(str+='<div class="easemobmain-record img-left" style="text-align:left;">',str+="<p1>"+obj[i].sender_realname+"<span></span></p1>",str+="<p2>"+obj[i].created_at+"<b></b></p2>"),str+="<img src="+obj[i].sender_avatar+"><br>",str+='<p3 class="chat-content-p3" className="chat-content-p3">'+obj[i].content+"</p3>",str+="</div>";obj.length<rows_per_page&&$("#comments-list").hide(),$("#page").after(str),$("#page").css("display","none"),page++,$ionicLoading.hide()}).error(function(data){console.info(data);var error=$.parseJSON(data.responseText);layer.show(error.error_messages),console.info(error)})},$scope.sendText=function(){var result=easemobService.sendText("groupchat");console.log(result)}}]),lvtuanApp.controller("groupsiteCtrl",["$scope","$http","$state","$rootScope","$stateParams","$timeout","$ionicPopup","$location","Upload","$ionicLoading",function($scope,$http,$state,$rootScope,$stateParams,$timeout,$ionicPopup,$location,Upload,$ionicLoading){console.info("律圈设置"),$ionicLoading.show(),$http.get("http://"+$rootScope.hostName+"/group/"+$stateParams.id+"/detail").success(function(data){data&&data.data&&($scope.items=data.data,console.info($scope.items),$scope.group_name=$scope.items.group_name,$scope.is_mine=$scope.items.is_mine,$scope.file=$scope.items.group_avatar),$ionicLoading.hide()}),$scope.logoutGroup=function(){var confirmPopup=$ionicPopup.confirm({title:"确定解散该群？",cancelText:"取消",okText:"确认"});confirmPopup.then(function(res){return res?void $http.get("http://"+$rootScope.hostName+"/group/"+$scope.id+"/dissolution",{cache:!0,headers:{"Content-Type":"application/json"}}).success(function(data){layer.show(data.data),$location.path("/group/list")}):!1})},$scope.edit=function(id){$ionicLoading.show();var params=layer.getParams("#myForm");""==params.group_name?layer.show("律圈名称不能为空！"):$http.post("http://"+$rootScope.hostName+"/group/"+$stateParams.id+"/edit",{group_name:params.group_name,group_avatar:params.group_avatar},{headers:{"Content-Type":"application/json"}}).success(function(data){layer.show("修改成功！"),$ionicLoading.hide()})},$scope.uploadFiles=function(group_avatar,errFiles){if($scope.errFiles=errFiles,$scope.errFiles.length>0){for(var i=0;i<$scope.errFiles.length;i++)if("maxSize"==$scope.errFiles[i].$error)return layer.show("图片大小不能超过2MB!"),!1}else group_avatar&&($ionicLoading.show(),$scope.upload(group_avatar))},$scope.upload=function(group_avatar){Upload.upload({url:"http://"+$rootScope.hostName+"/group/uploadImage",data:{group_avatar:group_avatar}}).then(function(response){$scope.file=response.data.data.file_url,$scope.file_path=response.data.data.file_path,$timeout(function(){$scope.result=response.data}),$ionicLoading.hide()},function(response){if(response.status>0){var errorMsg=response.status+": "+response.data;console.info("errorMsg",errorMsg),layer.show(errorMsg)}},function(evt){var progres=parseInt(100*evt.loaded/evt.total);$scope.progress=progres})},$scope.quitGroup=function(){var confirmPopup=$ionicPopup.confirm({title:"确定退出该群？",cancelText:"取消",okText:"确认"});confirmPopup.then(function(res){return res?void $http.get("http://"+$rootScope.hostName+"/group/"+$scope.id+"/quit").success(function(data){layer.show(data.data),$location.path("/group/list")}):!1})}}]),lvtuanApp.controller("groupaddCtrl",["$scope","$http","$location","$ionicLoading","$timeout","$stateParams","$rootScope","authService",function($scope,$http,$location,$ionicLoading,$timeout,$stateParams,$rootScope,authService){function get_Param(){var params=layer.getParams("#groupAddform"),param=[];params.q&&param.push("q="+params.q),console.info(param),geturl(param)}function geturl(param){var url;url=""!=param?"http://"+$rootScope.hostName+"/group/create?"+param+"&rows_per_page="+rows_per_page+"&page="+page+"&ts="+timestamp:"http://"+$rootScope.hostName+"/group/create?rows_per_page="+rows_per_page+"&page="+page+"&ts="+timestamp,$ionicLoading.show(),$http.get(url).success(function(data){console.info(data.data),data&&data.data&&data.data.length?($scope.items=$scope.items.concat(data.data),data.data.length<rows_per_page?$scope.moredata=!1:$scope.moredata=!0):(1==page&&($scope.moredata=!1,$scope.nodata=!1),$scope.moredata=!1),page++,$scope.$broadcast("scroll.infiniteScrollComplete"),$ionicLoading.hide()})}var currentUser=authService.getUser();$scope.currentUser=currentUser;var timestamp=Math.round((new Date).getTime()/1e3),page=1,rows_per_page=5;$scope.rows_per_page&&(rows_per_page=$scope.rows_per_page),
$scope.moredata=!0,$scope.items=[],$("#search").bind("input propertychange",function(){console.info($(this).val()),$timeout(function(){page=1,$scope.items=[],get_Param()},2e3)}),$scope.doRefresh=function(){page=1,$scope.items=[],$scope.loadMore(),$scope.$broadcast("scroll.refreshComplete")},$scope.loadMore=function(){get_Param()},$scope.selIds=[],$scope.checkItem=function(obj,id){console.info(obj,id),-1==$scope.selIds.indexOf(id)?$scope.selIds.push(id):$scope.selIds.splice($scope.selIds.indexOf(id),1),console.info($scope.selIds)},$scope.ischecked=function(id,selIds){return $.inArray(id,selIds)>=0},$scope.createSubmit=function(){$http.post("http://"+$rootScope.hostName+"/group/"+$stateParams.id+"/addmember",{members:$scope.selIds}).success(function(data){layer.show(data.data),location.href="#/group/site/"+$stateParams.id,window.location.reload()})},$scope.clearGoBack=function(){$scope.selIds=[],window.history.back()}}]),lvtuanApp.controller("groupdelCtrl",["$scope","$http","$location","$ionicLoading","$timeout","$stateParams","$ionicPopup","$rootScope","$timeout","authService",function($scope,$http,$location,$ionicLoading,$timeout,$stateParams,$ionicPopup,$rootScope,$timeout,authService){function get_Param(){var params=layer.getParams("#form"),param=[];params.q&&param.push("q="+params.q),console.info(param),geturl(param)}function geturl(param){var url;url=""!=param?"http://"+$rootScope.hostName+"/group/"+$stateParams.id+"/listmembers?"+param+"&rows_per_page="+rows_per_page+"&page="+page+"&ts="+timestamp:"http://"+$rootScope.hostName+"/group/"+$stateParams.id+"/listmembers?rows_per_page="+rows_per_page+"&page="+page+"&ts="+timestamp,$ionicLoading.show(),$http.get(url).success(function(data){console.info(data.data),data&&data.data&&data.data.length?($scope.items=$scope.items.concat(data.data),data.data.length<rows_per_page?$scope.moredata=!1:$scope.moredata=!0):(1==page&&($scope.moredata=!1,$scope.nodata=!1),$scope.moredata=!1),page++,$scope.$broadcast("scroll.infiniteScrollComplete"),$ionicLoading.hide()})}console.info("删除成员"),console.info($stateParams.id);var currentUser=authService.getUser();$scope.currentUser=currentUser,Array.prototype.remove=function(index){if(isNaN(index)||index>this.length)return!1;for(var i=0,n=0;i<this.length;i++)this[i]!=this[index]&&(this[n++]=this[i]);this.length-=1};var timestamp=Math.round((new Date).getTime()/1e3),page=1,rows_per_page=5;$scope.rows_per_page&&(rows_per_page=$scope.rows_per_page),$scope.moredata=!0,$scope.items=[],$("#search").bind("input propertychange",function(){console.info($(this).val()),$timeout(function(){page=1,$scope.items=[],get_Param()},2e3)}),$scope.doRefresh=function(){page=1,$scope.items=[],$scope.loadMore(),$scope.$broadcast("scroll.refreshComplete")},$scope.loadMore=function(){get_Param()},$scope.selIds=[],$scope.checkItem=function(obj,id){console.info(obj,id),-1==$scope.selIds.indexOf(id)?$scope.selIds.push(id):$scope.selIds.splice($scope.selIds.indexOf(id),1),console.info($scope.selIds)},$scope.ischecked=function(id,selIds){return $.inArray(id,selIds)>=0},$scope.delSubmit=function(items,selIds){var confirmPopup=$ionicPopup.confirm({title:"确定删除律圈成员？",cancelText:"取消",okText:"确认"});confirmPopup.then(function(res){return res?void $http.post("http://"+$rootScope.hostName+"/group/"+$stateParams.id+"/removemembers",{members:selIds}).success(function(data){console.info(data),layer.show(data.data),location.href="#/group/site/"+$stateParams.id,window.location.reload()}):!1})},$scope.clearGoBack=function(){$scope.selIds=[],window.history.back()}}]),lvtuanApp.controller("groupcreateCtrl",["$scope","$http","$state","$rootScope","$timeout","$ionicLoading","$location","Upload","listHelper",function($scope,$http,$state,$rootScope,$timeout,$ionicLoading,$location,Upload,listHelper){console.info("创建律圈"),listHelper.bootstrap("/group/create",$scope),Array.prototype.remove=function(index){if(isNaN(index)||index>this.length)return!1;for(var i=0,n=0;i<this.length;i++)this[i]!=this[index]&&(this[n++]=this[i]);this.length-=1},$scope.selIds=[],$scope.checkItem=function(obj,id){if(0==obj){var index;angular.forEach($scope.selIds,function(val,key){val==id&&(index=key)}),$scope.selIds.remove(index,index)}else $scope.selIds.push(id)},$scope.createSubmit=function(){var members=$scope.selIds,params=layer.getParams("#createGroup_form");return""==params.group_name?(layer.show("请输入律圈名称!"),!1):""==params.group_avatar?(layer.show("请上传律圈头像!"),!1):($ionicLoading.show(),$http.post("http://"+$rootScope.hostName+"/group/store",{group_name:params.group_name,group_avatar:params.group_avatar,members:members}).success(function(data){layer.show("创建成功！"),$scope.selIds={},$scope.file={},$(":input","#questions_form").not("textarea :submit, :reset, :hidden").val(""),$location.path("/group/list"),$ionicLoading.hide()}),!0)},$scope.uploadFiles=function(group_avatar,errFiles){if($scope.errFiles=errFiles,$scope.errFiles.length>0){for(var i=0;i<$scope.errFiles.length;i++)if("maxSize"==$scope.errFiles[i].$error)return layer.show("图片大小不能超过2MB!"),!1}else group_avatar&&($ionicLoading.show(),$scope.upload(group_avatar))},$scope.upload=function(group_avatar){Upload.upload({headers:{"Content-Type":"application/json"},url:"http://"+$rootScope.hostName+"/group/uploadImage",data:{group_avatar:group_avatar}}).then(function(response){$scope.file=response.data.data.file_url,$scope.group_path=response.data.data.file_path,$timeout(function(){$scope.result=response.data,$ionicLoading.hide()})},function(response){if(response.status>0){var errorMsg=response.status+": "+response.data;console.info("errorMsg",errorMsg),layer.show(errorMsg)}},function(evt){var progres=parseInt(100*evt.loaded/evt.total);$scope.progress=progres})}}]),lvtuanApp.controller("televisecreateCtrl",["$scope","$http","$state","$rootScope","$timeout","Upload",function($scope,$http,$state,$rootScope,$timeout,Upload){console.info("创建广播"),$scope.file=[],$scope.srcfile=[],$scope.uploadFiles=function(files,errFiles){if(console.info(files,errFiles),files){if(files.length>9)return layer.show("最多只能上传9张照片！"),!1;$scope.files=files,$scope.errFiles=errFiles;for(var i=0;i<$scope.errFiles.length;i++)if("maxSize"==$scope.errFiles[i].$error)return layer.show("图片大小不能超过2MB!"),!1;angular.forEach(files,function(file){file.upload=Upload.upload({headers:{"Content-Type":"application/json"},url:"http://"+$rootScope.hostName+"/microblog/uploadImage",data:{microBlogImage:file}}),file.upload.then(function(response){var src_url=response.data.data.src_url,src=response.data.data.src;src&&($scope.file.push(src_url),$scope.srcfile.push(src)),$timeout(function(){file.result=response.data})},function(response){response.status>0&&($scope.errorMsg=response.status+": "+response.data),layer.show($scope.errorMsg)},function(evt){file.progress=Math.min(100,parseInt(100*evt.loaded/evt.total))})})}},$scope.del=function(index){$scope.file.splice(index,1),$scope.srcfile.splice(index,1)},$scope.createSubmit=function(){var params=layer.getParams("#myForm");return""==params.content?(layer.show("请输入你的广播!"),!1):($http.post("http://"+$rootScope.hostName+"/microblog/create",{content:params.content,file_paths:$scope.srcfile}).success(function(data){console.log(data.data),layer.show("提交成功！"),$(":input","#myForm").not("textarea :submit, :reset, :hidden").val(""),$scope.file=[],$scope.srcfile=[],location.href="#/broadcast/view/"+data.data.id}),!0)}}]),lvtuanApp.controller("broadcastviewCtrl",["$scope","$http","$state","$rootScope","$stateParams","$ionicPopup",function($scope,$http,$state,$rootScope,$stateParams,$ionicPopup){$http.get("http://"+$rootScope.hostName+"/microblog/"+$stateParams.id+"/view").success(function(data){console.info("广播详情",data.data),$scope.items=data.data}),$scope.likes=function(id){$http.post("http://"+$rootScope.hostName+"/like",{item_type:"post",item_id:id}).success(function(data){var like=data.data;$scope.items.post_extra.likes_count=like.likes_count,layer.show("点赞成功！")})},$scope.share=function(id){$scope.id=id,$scope.data={};var myPopup=$ionicPopup.show({template:'<textarea ng-model="data.content" name="content" rows="5" placeholder="想说些什么呢？..."></textarea>',title:"分享",scope:$scope,buttons:[{text:"取消"},{text:"<b>确认</b>",type:"button-positive",onTap:function(e){return $scope.data.content}}]});myPopup.then(function(res){$scope.content=res,$http.post("http://"+$rootScope.hostName+"/microblog/forward",{content:$scope.content,parent_id:$scope.id}).success(function(data){console.info(data),layer.show("分享成功！")})})},$scope.comments=function(id){$scope.id=id,$scope.data={};var myPopup=$ionicPopup.show({template:'<textarea ng-model="data.comments" name="comments" rows="5" placeholder="想说些什么呢？..."></textarea>',title:"评论",scope:$scope,buttons:[{text:"取消"},{text:"<b>确认</b>",type:"button-positive",onTap:function(e){return $scope.data.comments}}]});myPopup.then(function(res){void 0!=res?($scope.comments=res,$http.post("http://"+$rootScope.hostName+"/microblog/"+id+"/comment/create",{content:$scope.comments,post_id:id}).success(function(data){console.info(data),layer.show("评论成功！")})):myPopup.close()})}}]),lvtuanApp.controller("knowledgesCtrl",["$scope","$http","$rootScope","listHelper",function($scope,$http,$rootScope,listHelper){listHelper.bootstrap("/news/list_news",$scope)}]),lvtuanApp.controller("documentsCtrl",["$scope","$http","$rootScope","listHelper",function($scope,$http,$rootScope,listHelper){listHelper.bootstrap("/knowledge/article/list_articles",$scope)}]),lvtuanApp.controller("casesCtrl",["$scope","$http","$rootScope","listHelper",function($scope,$http,$rootScope,listHelper){listHelper.bootstrap("/case/list_case",$scope)}]),lvtuanApp.controller("knowledgeViewCtrl",["$scope","$http","$rootScope","$stateParams","$ionicPopup","$ionicPopup","$ionicLoading",function($scope,$http,$rootScope,$stateParams,$ionicPopup,$ionicPopup,$ionicLoading){function init(){$ionicLoading.show();var url="http://"+$rootScope.hostName+"/knowledge/"+$stateParams.id+"/view";$http.get(url).success(function(data){console.info(data.data),$scope.items=data.data,sessionStorage.setItem("comments_count",JSON.stringify($scope.items.comments_count)),$ionicLoading.hide()})}init(),$scope.likes=function(id){$ionicLoading.show(),$http.post("http://"+$rootScope.hostName+"/like",{item_type:"article",item_id:id},{headers:{"Content-Type":"application/json"}}).success(function(data){var itmes=data.data;$scope.items.likes_count=itmes.likes_count,$scope.items.is_like=!0,layer.show("点赞成功！"),$ionicLoading.hide()})},$scope.collects=function(id){$ionicLoading.show(),$http.post("http://"+$rootScope.hostName+"/collect",{collect_type:3,item_id:id},{headers:{"Content-Type":"application/json"}}).success(function(data){$scope.items.collects_count=$scope.items.collects_count+1,$scope.items.is_collect=!0,layer.show("收藏成功！"),$ionicLoading.hide()})},$scope.collects_del=function(id){$ionicLoading.show(),$http.post("http://"+$rootScope.hostName+"/collect/delete",{collect_type:3,item_id:id},{headers:{"Content-Type":"application/json"}}).success(function(data){$scope.items.collects_count=$scope.items.collects_count-1,$scope.items.is_collect=!1,layer.show("取消成功！"),$ionicLoading.hide()})},$scope.comments=function(id){$scope.id=id,$scope.data={};var myPopup=$ionicPopup.show({template:'<textarea ng-model="data.evaluate_comment" name="evaluate_comment" rows="5" placeholder="想说些什么呢？..."></textarea>',title:"评论",scope:$scope,buttons:[{text:"取消"},{text:"<b>确认</b>",type:"button-positive",onTap:function(e){if($scope.data.evaluate_comment){if(!($scope.data.evaluate_comment.length>140))return $scope.data.evaluate_comment;layer.show("内容字数不能大于140字符！"),e.preventDefault()}else layer.show("内容不能为空！"),e.preventDefault()}}]});myPopup.then(function(res){void 0!=res?($scope.evaluate_comment=res,$http.post("http://"+$rootScope.hostName+"/article/"+id+"/comment",{evaluate_comment:$scope.evaluate_comment,item_id:id}).success(function(data,status,headers,config){$scope.comment=data.data,$scope.items.comments_count=$scope.comment.comments_count,sessionStorage.setItem("comments_count",JSON.stringify($scope.items.comments_count)),layer.show("评论成功！")})):myPopup.close()})}}]),lvtuanApp.controller("knowledgeAndroidViewCtrl",["$scope","$http","$rootScope","$stateParams","$ionicPopup","$ionicPopup","$ionicLoading",function($scope,$http,$rootScope,$stateParams,$ionicPopup,$ionicPopup,$ionicLoading){$ionicLoading.show({showBackdrop:!1}),$http.get("http://"+$rootScope.hostName+"/knowledge/"+$stateParams.id+"/view").success(function(data){console.info(data.data),$scope.items=data.data,$ionicLoading.hide()})}]),lvtuanApp.controller("commentsViewCtrl",["$scope","$http","$rootScope","$stateParams","$ionicPopup","$ionicPopup","listHelper",function($scope,$http,$rootScope,$stateParams,$ionicPopup,$ionicPopup,listHelper){$scope.comments_count=JSON.parse(sessionStorage.getItem("comments_count")),listHelper.bootstrap("/article/"+$stateParams.id+"/comment/list",$scope),console.info("/article/"+$stateParams.id+"/comment/list"),$scope.comments=function(){$scope.data={};var myPopup=$ionicPopup.show({template:'<textarea ng-model="data.evaluate_comment" name="evaluate_comment" rows="5" placeholder="想说些什么呢？..."></textarea>',title:"评论",scope:$scope,buttons:[{text:"取消"},{text:"<b>确认</b>",type:"button-positive",onTap:function(e){if($scope.data.evaluate_comment){if(!($scope.data.evaluate_comment.length>140))return $scope.data.evaluate_comment;layer.show("内容字数不能大于140字符！"),e.preventDefault()}else layer.show("内容不能为空！"),e.preventDefault()}}]});myPopup.then(function(res){void 0!=res?($scope.evaluate_comment=res,$http.post("http://"+$rootScope.hostName+"/article/"+$stateParams.id+"/comment",{evaluate_comment:$scope.evaluate_comment,item_id:$stateParams.id}).success(function(data,status,headers,config){$scope.comment=data.data,$scope.items=$scope.items.concat($scope.comment),$scope.comments_count=$scope.comment.comments_count,sessionStorage.setItem("comments_count",JSON.stringify($scope.comment.comments_count)),layer.show("评论成功！")})):myPopup.close()})}}]),lvtuanApp.controller("centerCtrl",["$scope","$http","$rootScope","$ionicPopup","$timeout","$ionicLoading","authService",function($scope,$http,$rootScope,$ionicPopup,$timeout,$ionicLoading,authService){$scope.$on("$ionicView.beforeEnter",function(){var currentUser=authService.getUser();$scope.currentUser=currentUser;var timestamp=Math.round((new Date).getTime()/1e3),url=null;return null==currentUser?!1:(url=currentUser.is_verified_lawyer?"http://"+$rootScope.hostName+"/center/lawyer/info?ts="+timestamp:"http://"+$rootScope.hostName+"/center/customer/info?ts="+timestamp,$ionicLoading.show(),$http.get(url).success(function(data){return data&&data.data?($scope.items=data.data,console.info($scope.items),void $ionicLoading.hide()):(layer.show("暂无数据！"),!1)}),void 0)}),$scope.jumplogin=function(){$rootScope.$broadcast("unauthenticated")},$scope.invitefriend=function(){$scope.data={};$ionicPopup.show({templateUrl:"popup-invitefriend-template.html",title:"邀请好友",scope:$scope,buttons:[{text:"Cancel"}]})}}]),lvtuanApp.controller("infoCtrl",["$scope","$http","$rootScope","$timeout","$ionicLoading","$stateParams","Upload","authService",function($scope,$http,$rootScope,$timeout,$ionicLoading,$stateParams,Upload,authService){$scope.$on("$ionicView.beforeEnter",function(){function getDate(url){$http.get(url).success(function(data){return data&&data.data?($scope.items=data.data,$scope.file=$scope.items.avatar,localStorage.setItem("userinfo",JSON.stringify($scope.items)),void $ionicLoading.hide()):(layer.show("暂无数据！"),!1)})}var currentUser=authService.getUser(),timestamp=Math.round((new Date).getTime()/1e3),url=null;$ionicLoading.show(),1==currentUser.status||2==currentUser.status?(url="http://"+$rootScope.hostName+"/center/customer/info?ts="+timestamp,getDate(url)):(url="http://"+$rootScope.hostName+"/center/lawyer/info?ts="+timestamp,getDate(url))}),$scope.uploadFiles=function(avatar,errFiles){if($scope.errFiles=errFiles,$scope.errFiles.length>0){for(var i=0;i<$scope.errFiles.length;i++)if("maxSize"==$scope.errFiles[i].$error)return layer.show("图片大小不能超过2MB!"),!1}else avatar&&($ionicLoading.show(),$scope.upload(avatar))},$scope.upload=function(avatar){Upload.upload({headers:{"Content-Type":"application/json"},url:"http://"+$rootScope.hostName+"/center/update_user_image",data:{upload_file:avatar,user_id:$stateParams.id}}).then(function(response){var file_path="http://"+$rootScope.hostName+"/file/show?path="+response.data.data.file_path;$scope.file=file_path,$timeout(function(){$scope.result=response.data}),$ionicLoading.hide()},function(response){if(response.status>0){var errorMsg=response.status+": "+response.data;console.info("errorMsg",errorMsg),layer.show(errorMsg)}},function(evt){})}}]),lvtuanApp.controller("valrealnameCtrl",["$scope","$http","$rootScope","$ionicLoading","$location","authService",function($scope,$http,$rootScope,$ionicLoading,$location,authService){var currentUser=authService.getUser(),timestamp=Math.round((new Date).getTime()/1e3);$scope.userinfo=JSON.parse(localStorage.getItem("userinfo")),console.info($scope.userinfo),$scope.user={nikname:$scope.userinfo.nikname},$scope.submit=function(){$ionicLoading.show();var params=layer.getParams("#niknameForm"),url=null;url=1==currentUser.status||2==currentUser.status?"http://"+$rootScope.hostName+"/center/customer/info?ts="+timestamp:"http://"+$rootScope.hostName+"/center/lawyer/info?ts="+timestamp,$http.post(url,params).success(function(data){layer.show("提交成功！"),$scope.user={nikname:""},$location.path("/info"),$ionicLoading.hide()})}}]),lvtuanApp.controller("valphoneCtrl",["$scope","$http","$rootScope","$ionicLoading","$interval","authService",function($scope,$http,$rootScope,$ionicLoading,$interval,authService){authService.getUser();$scope.userinfo=JSON.parse(localStorage.getItem("userinfo")),$scope.user={phone:$scope.userinfo.phone},$scope.phone_disabled=!0,$scope.phonecode=function(phone){var param="phone="+phone;$scope.phone_disabled=!1,$http.post("http://"+$rootScope.hostName+"/send-code?"+param).success(function(data){runTiming(),layer.show("验证码已发送到您的手机！")})};var timePromise;$scope.t=60;var runTiming=function(){return timePromise=$interval(function(){$scope.t-=1,console.info($scope.t),0==$scope.t&&($scope.phone_disabled=!0,$interval.cancel(timePromise),timePromise=void 0)},1e3,60)};$scope.submit=function(){$ionicLoading.show();var params=layer.getParams("#phoneForm");$http.post("http://"+$rootScope.hostName+"/center/update_phone",params).success(function(data){layer.show("提交成功！"),$scope.user={phone:"",phonecode:""},location.href="#/info",$ionicLoading.hide()})}}]),lvtuanApp.controller("valemailCtrl",["$scope","$http","$rootScope","$ionicLoading","$location","authService",function($scope,$http,$rootScope,$ionicLoading,$location,authService){authService.getUser();$scope.userinfo=JSON.parse(localStorage.getItem("userinfo")),$scope.user={email:$scope.userinfo.email},$scope.phone_disabled=!0,$scope.phonecode=function(phone){var param="phone="+phone;$scope.phone_disabled=!1,$http.post("http://"+$rootScope.hostName+"/send-code?"+param).success(function(data){runTiming(),layer.show("验证码已发送到您的邮箱！")})};var timePromise;$scope.t=60;var runTiming=function(){return timePromise=$interval(function(){$scope.t-=1,console.info($scope.t),0==$scope.t&&($scope.phone_disabled=!0,$interval.cancel(timePromise),timePromise=void 0)},1e3,60)};$scope.submit=function(){$ionicLoading.show();var params=layer.getParams("#emailForm");$http.post("http://"+$rootScope.hostName+"/center/update_email",params).success(function(data){layer.show("提交成功！"),$scope.user={email:"",phonecode:""},$location.path("/info"),$ionicLoading.hide()})}}]),lvtuanApp.controller("listscoresCtrl",["$scope","listHelper","authService",function($scope,listHelper,authService){var currentUser=authService.getUser();$scope.currentUser=currentUser,$scope.rows_per_page=20,listHelper.bootstrap("/center/score/list_scores",$scope),$scope.click=function(){layer.show("敬请期待!")}}]),lvtuanApp.controller("messagesCtrl",["$scope",function($scope){$scope.visible=!0,$scope.itemcheckbox="",$scope.toggle=function(){""==$scope.itemcheckbox?$scope.itemcheckbox="item-checkbox":$scope.itemcheckbox="",$scope.visible=!$scope.visible}}]),lvtuanApp.controller("mymesgCtrl",["$scope","$http","$rootScope","$ionicLoading","listHelper",function($scope,$http,$rootScope,$ionicLoading,listHelper){listHelper.bootstrap("/letter/users",$scope),$scope.messgs_del=function(id,index){$ionicLoading.show(),$http.post("http://"+$rootScope.hostName+"/letter/"+id+"/delete",{collect_type:3,item_id:id}).success(function(data){$scope.items.splice(index,1),$ionicLoading.hide(),layer.show("删除消息成功！")})}}]),lvtuanApp.controller("sysmesgCtrl",["$scope","$http","$rootScope","$ionicLoading","listHelper",function($scope,$http,$rootScope,$ionicLoading,listHelper){listHelper.bootstrap("/letter/sys",$scope),$scope.messgs_del=function(id,index){$ionicLoading.show(),$http.post("http://"+$rootScope.hostName+"/letter/"+id+"/delete",{collect_type:3,item_id:id}).success(function(data){$scope.items.splice(index,1),$ionicLoading.hide(),layer.show("删除系统消息成功！")})}}]),lvtuanApp.controller("viewMessageCtrl",["$scope","$http","$rootScope","$interval","$stateParams","$ionicLoading",function($scope,$http,$rootScope,$interval,$stateParams,$ionicLoading){$ionicLoading.show(),$http.get("http://"+$rootScope.hostName+"/letter/sys-letters/"+$stateParams.id).success(function(data){data&&data.data&&($scope.item=data.data,$ionicLoading.hide())})}]),lvtuanApp.controller("collectCtrl",["$scope","$http","$rootScope","listHelper",function($scope,$http,$rootScope,listHelper){$scope.visible=!0,$scope.itemcheckbox="",$scope.toggle=function(){""==$scope.itemcheckbox?$scope.itemcheckbox="item-checkbox":$scope.itemcheckbox="",$scope.visible=!$scope.visible},listHelper.bootstrap("/center/collect",$scope),$scope.collects_del=function(id,index){$http.post("http://"+$rootScope.hostName+"/collect/delete",{collect_type:3,item_id:id},{headers:{"Content-Type":"application/json"}}).success(function(data){$scope.items.splice(index,1),layer.show("已取消收藏！")})}}]),lvtuanApp.controller("commentCtrl",["$scope","listHelper",function($scope,listHelper){listHelper.bootstrap("/center/blog/reply",$scope)}]),lvtuanApp.controller("followedCtrl",["$scope","$rootScope","$http","listHelper",function($scope,$rootScope,$http,listHelper){listHelper.bootstrap("/center/mylawyer/followed",$scope),$scope.follow_del=function(id,index){$http.post("http://"+$rootScope.hostName+"/follow/remove",{follow_id:id},{headers:{"Content-Type":"application/json"}}).success(function(data){console.info(data),$scope.items.splice(index,1),layer.show("取消成功！")})}}]),lvtuanApp.controller("becomenavCtrl",["$scope","$http","$rootScope","$ionicPopup","$localStorage","$ionicLoading","$location","authService",function($scope,$http,$rootScope,$ionicPopup,$localStorage,$ionicLoading,$location,authService){var currentUser=authService.getUser();$scope.currentUser=currentUser,$ionicLoading.show(),$http.get("http://"+$rootScope.hostName+"/center/becomelawyer/infochecks").success(function(data){$scope.infochecks=data.data,console.info($scope.infochecks),$ionicLoading.hide()}),$scope.submit=function(){$http.post("http://"+$rootScope.hostName+"/center/becomelawyer/submit").success(function(data){delete $localStorage.addres,layer.show("提交成功！请等待审核..."),$location.path("/center")}).error(function(data){console.info(data)})}}]),lvtuanApp.controller("practitionersCtrl",["$scope","$http","$rootScope","$timeout","$stateParams","$localStorage","$location","$ionicLoading","Upload","authService",function($scope,$http,$rootScope,$timeout,$stateParams,$localStorage,$location,$ionicLoading,Upload,authService){function periods(param){$scope.periods=null,$http.get("http://"+$rootScope.hostName+"/lawyer/practiseperiods").success(function(data){if($scope.periods=data.data,param)for(var i=0;i<$scope.periods.length;i++)if(param==$scope.periods[i].key){$scope.practice_period=$scope.periods[i];break}})}function getDate(items){$scope.license=items.license,$scope.company_name=items.company_name,$scope.file=items.license_file,$scope.file_path=items.license_file;var param=items.practice_period;$scope.address=items.province+""+items.city+items.district,periods(param)}var timestamp=Math.round((new Date).getTime()/1e3),currentUser=authService.getUser();$scope.currentUser=currentUser,$ionicLoading.show(),$http.get("http://"+$rootScope.hostName+"/center/becomelawyer/work?ts="+timestamp).success(function(data){return data&&data.data?($scope.items=data.data,console.info($scope.items),getDate($scope.items),void $ionicLoading.hide()):(layer.show("暂无数据！"),!1)}),$scope.file="",$scope.address="",$scope.addres_param={},$scope.addres=$localStorage.addres||"",$scope.$watch("addres",function(newVal,oldVal){console.log("newVal: ",newVal),$localStorage.addres=$scope.addres,$scope.addres_param=$localStorage.addres,$scope.addres_param?($scope.address=$scope.addres_param.province.value+" "+$scope.addres_param.city.value+" "+$scope.addres_param.district.value,$scope.province=$scope.addres_param.province.key,$scope.city=$scope.addres_param.city.key,$scope.district=$scope.addres_param.district.key,console.info("address",$scope.address)):($scope.address="",$scope.province="",$scope.city="",$scope.district="")}),$scope.$watch(function(){return angular.toJson($localStorage)},function(){$scope.addres=$localStorage.addres,console.info($scope.addres)}),periods(),$scope.uploadFiles=function(license_file,errFiles){if($scope.errFiles=errFiles,$scope.errFiles.length>0){for(var i=0;i<$scope.errFiles.length;i++)if("maxSize"==$scope.errFiles[i].$error)return layer.show("图片大小不能超过2MB!"),!1}else license_file&&($ionicLoading.show(),$scope.upload(license_file))},$scope.upload=function(license_file){Upload.upload({headers:{"Content-Type":"application/json"},url:"http://"+$rootScope.hostName+"/file/upload/user",data:{upload_file:license_file,user_id:currentUser.id}}).then(function(response){$scope.file=response.data.data.file_url,$scope.file_path=response.data.data.file_path,$timeout(function(){$scope.result=response.data})},function(response){if(response.status>0){var errorMsg=response.status+": "+response.data;console.info("errorMsg",errorMsg),layer.show(errorMsg)}},function(evt){var progres=parseInt(100*evt.loaded/evt.total);$scope.progress=progres})},$scope.getAddress=function(){delete $localStorage.addres,localStorage.setItem("citypicke_goback",$location.path()),$location.path("/citypicke/all")},$scope.submit=function(){var param=layer.getParams("#practitionForm");return param.license_file.length<1?(layer.show("请上传执业证书！"),!1):(console.info(param),$ionicLoading.show(),void $http.post("http://"+$rootScope.hostName+"/center/becomelawyer/work",param).success(function(data){layer.show("添加成功！"),$location.path("/becomenav"),$ionicLoading.hide()}))}}]),lvtuanApp.controller("verifiedCtrl",["$scope","$http","$rootScope","$timeout","$stateParams","$localStorage","$ionicLoading","$location","Upload","authService",function($scope,$http,$rootScope,$timeout,$stateParams,$localStorage,$ionicLoading,$location,Upload,authService){var timestamp=Math.round((new Date).getTime()/1e3),currentUser=authService.getUser();$scope.currentUser=currentUser,$ionicLoading.show(),$http.get("http://"+$rootScope.hostName+"/center/becomelawyer/identity?ts="+timestamp).success(function(data){return data&&data.data?($scope.items=data.data,console.info($scope.items),$scope.items&&($scope.realname=$scope.items.realname,$scope.file=$scope.items.ID_img,$scope.file_path=$scope.items.ID_img),void $ionicLoading.hide()):(layer.show("暂无数据！"),!1)}),$scope.uploadFiles=function(license_file,errFiles){if($scope.errFiles=errFiles,$scope.errFiles.length>0){for(var i=0;i<$scope.errFiles.length;i++)if("maxSize"==$scope.errFiles[i].$error)return layer.show("图片大小不能超过2MB!"),!1}else license_file&&($ionicLoading.show(),$scope.upload(license_file))},$scope.upload=function(license_file){Upload.upload({headers:{"Content-Type":"application/json"},url:"http://"+$rootScope.hostName+"/file/upload/user",data:{upload_file:license_file,user_id:currentUser.id}}).then(function(response){$scope.file=response.data.data.file_url,$scope.file_path=response.data.data.file_path,$timeout(function(){$scope.result=response.data})},function(response){if(response.status>0){var errorMsg=response.status+": "+response.data;console.info("errorMsg",errorMsg),layer.show(errorMsg)}},function(evt){var progres=parseInt(100*evt.loaded/evt.total);$scope.progress=progres})},$scope.submit=function(){var param=layer.getParams("#verifiedForm");return param.ID_img.length<1?(layer.show("请上传执业证书！"),!1):(console.log(param),$ionicLoading.show(),void $http.post("http://"+$rootScope.hostName+"/center/becomelawyer/identity",param).success(function(data){layer.show("添加成功！"),$location.path("/becomenav"),$ionicLoading.hide()}))}}]),lvtuanApp.controller("tariffsetCtrl",["$scope","$http","$rootScope","$stateParams","$localStorage","$ionicLoading","$location","authService",function($scope,$http,$rootScope,$stateParams,$localStorage,$ionicLoading,$location,authService){var timestamp=Math.round((new Date).getTime()/1e3),currentUser=authService.getUser();$scope.currentUser=currentUser,$ionicLoading.show(),$http.get("http://"+$rootScope.hostName+"/center/becomelawyer/fee?ts="+timestamp).success(function(data){data&&data.data&&($scope.items=data.data,$scope.textreplyfee=$scope.items.text_reply_fee,$scope.phonereplyfee=$scope.items.phone_reply_fee),$ionicLoading.hide()}),$scope.submit=function(){var param=layer.getParams("#tariffsetForm");$ionicLoading.show(),$http.post("http://"+$rootScope.hostName+"/center/becomelawyer/fee",param).success(function(data){data.data&&($scope.textreplyfee=data.data.text_reply_fee,$scope.phonereplyfee=data.data.phone_reply_fee,layer.show("添加成功！"),$location.path("/becomenav"),$ionicLoading.hide())})}}]),lvtuanApp.controller("fieldCtrl",["$scope","$http","$rootScope","$stateParams","$localStorage","$ionicLoading","$location","authService",function($scope,$http,$rootScope,$stateParams,$localStorage,$ionicLoading,$location,authService){var timestamp=Math.round((new Date).getTime()/1e3),currentUser=authService.getUser();$scope.currentUser=currentUser,$ionicLoading.show(),$http.get("http://"+$rootScope.hostName+"/center/becomelawyer/workscope?ts="+timestamp).success(function(data){return data&&data.data?($scope.items=data.data,$scope.items.work_scope.length>0&&(console.info($scope.items.work_scope),$scope.showscopes=$scope.items.work_scope),void $ionicLoading.hide()):(layer.show("暂无数据！"),!1)}),Array.prototype.remove=function(index){if(isNaN(index)||index>this.length)return!1;for(var i=0,n=0;i<this.length;i++)this[i]!=this[index]&&(this[n++]=this[i]);this.length-=1},$scope.inShowscopes=function(workscope,showscopes){var value=!1;return angular.forEach(showscopes,function(item){item.key==workscope.key&&(value=!0)}),value},$ionicLoading.show(),$http.get("http://"+$rootScope.hostName+"/lawyer/workscopes").success(function(data){$scope.workscopes=data.data,console.info($scope.workscopes),$ionicLoading.hide()}),$scope.showscopes=[],$scope.click_workscope=function(key,value){var isvalue=!1;if($scope.showscopes.length<3){for(var i=0;i<$scope.showscopes.length;i++)if($scope.showscopes[i].key==key)return $scope.showscopes.remove(i),isvalue=!1,!1;if(value){var workscope={};workscope.key=key,workscope.value=value,$scope.showscopes.push(workscope),isvalue=!0}return isvalue}return angular.forEach($scope.showscopes,function(item,index){item.key==key&&($scope.showscopes.remove(index),console.info($scope.showscopes),isvalue=!1)}),isvalue},$scope.submit=function(){var param={},workscope=[];$scope.showscopes.length>0?(angular.forEach($scope.showscopes,function(item){workscope.push(item.key)}),param.work_scope=workscope):layer.show("请选择擅长领域！"),console.info(param),$ionicLoading.show(),$http.post("http://"+$rootScope.hostName+"/center/becomelawyer/workscope",param).success(function(data){
console.info(data),layer.show("添加成功！"),$location.path("/becomenav"),$ionicLoading.hide()})}}]),lvtuanApp.controller("caseCtrl",["$scope","$http","$rootScope","$stateParams","$localStorage","$ionicLoading","$location","authService",function($scope,$http,$rootScope,$stateParams,$localStorage,$ionicLoading,$location,authService){var timestamp=Math.round((new Date).getTime()/1e3),currentUser=authService.getUser();$scope.currentUser=currentUser,$ionicLoading.show(),$http.get("http://"+$rootScope.hostName+"/center/becomelawyer/experience?ts="+timestamp).success(function(data){return data&&data.data?($scope.items=data.data,console.info($scope.items),$scope.introduce=$scope.items.introduce,$scope.experience=$scope.items.experience,$scope.law_cases=$scope.items.law_cases,$ionicLoading.hide(),void 0):(layer.show("暂无数据！"),!1)}),$scope.submit=function(){var param=layer.getParams("#caseForm");$ionicLoading.show(),$http.post("http://"+$rootScope.hostName+"/center/becomelawyer/experience",param).success(function(data){layer.show("添加成功！"),$location.path("/becomenav"),$ionicLoading.hide()})}}]),lvtuanApp.controller("aboutCtrl",["$scope","$timeout","$ionicPopup",function($scope,$timeout,$ionicPopup){$scope.showPopup=function(){$scope.data={};var myPopup=$ionicPopup.show({template:'<input type="password" ng-model="data.wifi">',title:"Enter Wi-Fi Password",subTitle:"Please use normal things",scope:$scope,buttons:[{text:"Cancel"},{text:"<b>Save</b>",type:"button-positive",onTap:function(e){return $scope.data.wifi?$scope.data.wifi:void e.preventDefault()}}]});myPopup.then(function(res){console.log("Tapped!",res)}),$timeout(function(){myPopup.close()},3e3)},$scope.showAlert=function(){var alertPopup=$ionicPopup.alert({title:"温馨提示",template:"您的软件已经是最新版本！"});alertPopup.then(function(res){console.log("Thank you for not eating my delicious ice cream cone")})}}]),lvtuanApp.controller("userpactCtrl",["$scope","$http","$ionicLoading","$rootScope",function($scope,$http,$ionicLoading,$rootScope){console.info("用户协议"),$ionicLoading.show(),$http.get("http://"+$rootScope.hostName+"/siteinfo/list_siteinfo").success(function(data){data&&data.data&&data.data.length&&($scope.items=data.data),$ionicLoading.hide()})}]),lvtuanApp.controller("siteCtrl",["$scope","$http","$rootScope","$location","authService",function($scope,$http,$rootScope,$location,authService){console.info("设置"),$scope.logout=function(){authService.logout(),localStorage.removeItem("post_id_status"),localStorage.removeItem("post_id"),localStorage.clear(),$location.path("/login")}}]),lvtuanApp.controller("lawyerlistCtrl",["$scope","$state","$http","$rootScope","$location","$stateParams","$ionicLoading","locationService","listHelper",function($scope,$state,$http,$rootScope,$location,$stateParams,$ionicLoading,locationService,listHelper){function getDistrict(){$ionicLoading.show(),$http.get("http://"+$rootScope.hostPath+"/lawyer/city").success(function(data){$scope.citys=data.data,$scope.addCitys=[{city_code:"",city_name:"城市"}],$scope.citys=$scope.addCitys.concat($scope.citys),console.info($scope.citys),$scope.city_name=$scope.citys[0].city_name,$ionicLoading.hide()})}function getWorkscopes(){$ionicLoading.show(),$http.get("http://"+$rootScope.hostName+"/lawyer/workscopes").success(function(data){$scope.workscopes=data.data,$scope.addWorkscopes=[{key:"",value:"擅长领域"}],$scope.workscopes=$scope.addWorkscopes.concat($scope.workscopes),$scope.workscope_name=$scope.workscopes[0].value,$ionicLoading.hide()})}function getPractisePeriods(){$ionicLoading.show(),$http.get("http://"+$rootScope.hostName+"/lawyer/practiseperiods").success(function(data){$scope.periods=data.data,$scope.addPeriods=[{key:"",value:"执业年限"}],$scope.periods=$scope.addPeriods.concat($scope.periods),$scope.period_name=$scope.periods[0].value,$ionicLoading.hide()})}function get_Param(){var param=[];$scope.city_key&&param.push("city_id="+$scope.city_key),$scope.workscope_key&&param.push("cat_id="+$scope.workscope_key),$scope.period_key&&param.push("experience="+$scope.period_key),$scope.orders_key&&param.push("order_by="+$scope.orders_key),$stateParams.type&&param.push("type="+$stateParams.type),param=param.join("&"),console.info($scope.param),geturl(param)}function geturl(param){$scope.nodata=!0;var url;url=""!=param?"http://"+$rootScope.hostName+"/lawyer/list_lawyers?"+param+"&size="+size+"&page="+page:"http://"+$rootScope.hostName+"/lawyer/list_lawyers?size="+size+"&page="+page,console.info(url),$ionicLoading.show(),$http.get(url).success(function(data){console.info(data.data),data&&data.data&&data.data.length?($scope.items=$scope.items.concat(data.data),console.info($scope.items),data.data.length<size?$scope.moredata=!1:$scope.moredata=!0):(1==page&&($scope.moredata=!1,$scope.nodata=!1),$scope.moredata=!1),page++,$scope.$broadcast("scroll.infiniteScrollComplete"),$ionicLoading.hide()})}console.info($stateParams.type),$scope.type=$stateParams.type,$scope.masklayer=!0,getDistrict(),getWorkscopes(),getPractisePeriods(),$scope.city_cont=!0,$scope.city_key="",$scope.city_toggle=function(){$scope.city_cont=!$scope.city_cont,$scope.masklayer=!$scope.masklayer},$scope.inCity=function(key){var value=!1;return key==$scope.city_key&&(value=!0),value},$scope.getCitytVal=function(key,val){$scope.city_cont=!$scope.city_cont,$scope.masklayer=!$scope.masklayer,$scope.city_name=val,$scope.city_key=key,page=1,$scope.items=[],get_Param()},$scope.workscope_cont=!0,$scope.workscope_key="",$scope.workscope_toggle=function(){$scope.workscope_cont=!$scope.workscope_cont,$scope.masklayer=!$scope.masklayer},$scope.inWorkscope=function(key){var value=!1;return key==$scope.workscope_key&&(value=!0),value},$scope.getWorkscopeVal=function(key,val){$scope.workscope_cont=!$scope.workscope_cont,$scope.masklayer=!$scope.masklayer,$scope.workscope_name=val,$scope.workscope_key=key,page=1,$scope.items=[],get_Param()},$scope.period_cont=!0,$scope.period_key="",$scope.period_toggle=function(){$scope.period_cont=!$scope.period_cont,$scope.masklayer=!$scope.masklayer},$scope.inPeriods=function(key){var value=!1;return key==$scope.period_key&&(value=!0),value},$scope.getPeriodsVal=function(key,val){$scope.period_cont=!$scope.period_cont,$scope.masklayer=!$scope.masklayer,$scope.period_name=val,$scope.period_key=key,page=1,$scope.items=[],get_Param()},$scope.orders=[{key:"",value:"综合排序"},{key:"case_count",value:"接单数量"},{key:"best_evaluated",value:"评分最高"},{key:"price",value:"价格最低"}],$scope.order_cont=!0,$scope.orders_name=$scope.orders[0].value,$scope.orders_key="",$scope.orders_toggle=function(){$scope.order_cont=!$scope.order_cont,$scope.masklayer=!$scope.masklayer},$scope.inOrders=function(key){var value=!1;return key==$scope.orders_key&&(value=!0),value},$scope.getOrderVal=function(key,val){$scope.order_cont=!$scope.order_cont,$scope.masklayer=!$scope.masklayer,$scope.orders_name=val,$scope.orders_key=key,page=1,$scope.items=[],get_Param()};var page=1,size=5;$scope.size&&(size=$scope.size),$scope.moredata=!0,$scope.items=[],$scope.doRefresh=function(){page=1,$scope.items=[],$scope.loadMore(),$scope.$broadcast("scroll.refreshComplete")},$scope.loadMore=function(){get_Param()},$scope.jumppage=function(id){location.href="#/lawyer/"+id}}]),lvtuanApp.controller("lawyerOneQuestionsCtrl",["$http","$scope","$state","$rootScope","$ionicLoading",function($http,$scope,$state,$rootScope,$ionicLoading){$http.get("http://"+$rootScope.hostPath+"/evaluate?type=all").success(function(data){$scope.items=data.data.extras,console.info($scope.items)}),$scope.visible=!0,$scope.one_question_val=null,$scope.toggle=function(val){$scope.one_question_val=val,"pay_text"==val?$scope.visible=!0:$scope.visible=!1},$scope.jumpGoQuestionsList=function(){null==$scope.one_question_val?$scope.one_question_val="pay_text":$scope.one_question_val=$scope.one_question_val,location.href="#/lawyer/list/"+$scope.one_question_val}}]),lvtuanApp.controller("lawyerAllEvaluateCtrl",["$http","$scope","$state","$rootScope","$ionicLoading",function($http,$scope,$state,$rootScope,$ionicLoading){function get_Param(key){var param=[];switch(key){case"all":param.push("type="+key);break;case"high":param.push("type=score"),param.push("score="+key);break;case"intermediate":param.push("type=score"),param.push("score="+key);break;case"low":param.push("type=score"),param.push("score="+key);break;default:param.push("type=all")}param=param.join("&"),console.info(param),geturl(param)}function geturl(param){$scope.nodata=!0;var timestamp=Math.round((new Date).getTime()/1e3);$ionicLoading.show(),$http.get("http://"+$rootScope.hostPath+"/evaluate?"+param+"&size="+size+"&page="+page+"&ts="+timestamp).success(function(data){$scope.extras=data.data.extras,data&&data.data.list&&data.data.list.length?($scope.items=$scope.items.concat(data.data.list),console.info($scope.items),data.data.list.length<size?$scope.moredata=!1:$scope.moredata=!0):(1==page&&($scope.moredata=!1,$scope.nodata=!1),$scope.moredata=!1),page++,$scope.$broadcast("scroll.infiniteScrollComplete"),$ionicLoading.hide()})}console.info("律师的全部评价"),$scope.evaluate_key="all",$scope.inEvaluate=function(key){var value=!1;return key==$scope.evaluate_key&&(value=!0),value},$scope.click_evaluate=function(key){page=1,$scope.items=[],$scope.evaluate_key=key,get_Param(key)};var page=1,size=5;$scope.size&&(size=$scope.size),$scope.moredata=!0,$scope.items=[],$scope.doRefresh=function(){page=1,$scope.items=[],$scope.loadMore(),$scope.$broadcast("scroll.refreshComplete")},$scope.loadMore=function(){get_Param()}}]),lvtuanApp.controller("lawyerOneAllEvaluateCtrl",["$http","$scope","$state","$rootScope","$ionicLoading","$stateParams",function($http,$scope,$state,$rootScope,$ionicLoading,$stateParams){function get_Param(key){var param=[];switch(key){case"all":break;case"high":param.push("type=score"),param.push("score="+key);break;case"intermediate":param.push("type=score"),param.push("score="+key);break;case"low":param.push("type=score"),param.push("score="+key)}param=param.join("&"),console.info(param),geturl(param)}function geturl(param){$scope.nodata=!0;var timestamp=Math.round((new Date).getTime()/1e3);$ionicLoading.show();var url;url=""!=param?"http://"+$rootScope.hostPath+"/evaluate/"+$stateParams.id+"?"+param+"&size="+size+"&page="+page+"&ts="+timestamp:"http://"+$rootScope.hostPath+"/evaluate/"+$stateParams.id+"?size="+size+"&page="+page+"&ts="+timestamp,$http.get(url).success(function(data){$scope.extras=data.data.extras,data&&data.data.list&&data.data.list.length?($scope.items=$scope.items.concat(data.data.list),console.info($scope.items),data.data.list.length<size?$scope.moredata=!1:$scope.moredata=!0):(1==page&&($scope.moredata=!1,$scope.nodata=!1),$scope.moredata=!1),page++,$scope.$broadcast("scroll.infiniteScrollComplete"),$ionicLoading.hide()})}console.info("律师的全部评价"),$scope.evaluate_key="all",$scope.inEvaluate=function(key){var value=!1;return key==$scope.evaluate_key&&(value=!0),value},$scope.click_evaluate=function(key){page=1,$scope.items=[],$scope.evaluate_key=key,get_Param(key)};var page=1,size=5;$scope.size&&(size=$scope.size),$scope.moredata=!0,$scope.items=[],$scope.doRefresh=function(){page=1,$scope.items=[],$scope.loadMore(),$scope.$broadcast("scroll.refreshComplete")},$scope.loadMore=function(){get_Param()}}]),lvtuanApp.controller("lawyerlistsearchCtrl",["$http","$scope","$state","$rootScope","$stateParams","$ionicLoading",function($http,$scope,$state,$rootScope,$stateParams,$ionicLoading){angular.element(".search").trigger("focus"),$scope.type=$stateParams.type;var page=1,size=5;$scope.size&&(size=$scope.size),$scope.moredata=!0,$scope.items=[],$scope.q="",$scope.$watch("q",function(newVal,oldVal){newVal!==oldVal&&(page=1,$scope.items=[],$scope.loadMore())}),$scope.doRefresh=function(){page=1,$scope.items=[],$scope.loadMore(),$scope.$broadcast("scroll.refreshComplete")},$scope.loadMore=function(){var params=layer.getParams("#searchForm"),url="";return""==params.q?($scope.moredata=!1,!1):(url="http://"+$rootScope.hostName+"/lawyer/list_lawyers?type="+$scope.type+"&q="+params.q+"&size="+size+"&page="+page,$ionicLoading.show(),console.info(url),$http.get(url).success(function(data){data&&data.data&&data.data.length?($scope.items=$scope.items.concat(data.data),console.info($scope.items),data.data.length<size?$scope.moredata=!1:$scope.moredata=!0):(1==page&&($scope.moredata=!1,$scope.nodata=!1),$scope.moredata=!1),page++,$scope.$broadcast("scroll.infiniteScrollComplete"),$ionicLoading.hide()}),void 0)},$scope.$on("$stateChangeSuccess",function(){$scope.loadMore()})}]),lvtuanApp.controller("lawyerViewCtrl",["$scope","$http","$rootScope","$stateParams","$ionicLoading","$ionicPopup","httpWrapper","authService",function($scope,$http,$rootScope,$stateParams,$ionicLoading,$ionicPopup,httpWrapper,authService){var timestamp=Math.round((new Date).getTime()/1e3);$scope.isshow=!1,$scope.context_min100="",$scope.context_all="",$ionicLoading.show(),httpWrapper.get("http://"+$rootScope.hostName+"/lawyer/"+$stateParams.id,function(data){$scope.items=data.data,$scope.info=$scope.items.introduce+$scope.items.experience+$scope.items.signature,$scope.dian="...","null"==$scope.info?($scope.isshow=!1,$scope.context=!1):0!=$scope.info?($scope.context_min100=$scope.info.substr(0,90),$scope.context_all=$scope.info.substr(90),$scope.isshow=!0):$scope.context=!1,sessionStorage.setItem("lawyer_id",JSON.stringify($scope.items.id)),console.info($scope.items),$ionicLoading.hide()}),$http.get("http://"+$rootScope.hostName+"/lawyer/"+$stateParams.id+"/articles?order=latest&rows_per_page=1&ts="+timestamp).success(function(data){$scope.articles=data.data[0]}),$http.get("http://"+$rootScope.hostPath+"/evaluate/"+$stateParams.id+"?size=1&ts="+timestamp).success(function(data){$scope.extras=data.data.extras}),$scope.context=!0,$scope.context_toggle=function(){$scope.context=!$scope.context,$(".context").slideToggle(1500)},$scope.follow=function(id){$http.post("http://"+$rootScope.hostName+"/follow",{follow_id:id},{headers:{"Content-Type":"application/json"}}).success(function(data){console.info(data),$scope.items.follower_count++,$scope.items.is_following=!0,layer.show("关注成功！")})},$scope.follow_del=function(id){$http.post("http://"+$rootScope.hostName+"/follow/remove",{follow_id:id},{headers:{"Content-Type":"application/json"}}).success(function(data){console.info(data),$scope.items.follower_count--,$scope.items.is_following=!1,layer.show("取消成功！")})},$scope.active=!0,$scope.question_type="pay_text",$scope.toggle=function(val){"pay_text"==val?$scope.active=!0:$scope.active=!1,$scope.question_type=val},$scope.showIonicPopup=function(){var currentUser=authService.getUser();if(console.info(currentUser),null==currentUser)$rootScope.$broadcast("unauthenticated");else{var myPopup=$ionicPopup.show({templateUrl:"my-reservationNow.html",scope:$scope,buttons:[{text:"取消",type:"button-light"},{text:"确认",type:"button-cff2f5f",onTap:function(e){location.href="#/graphic/"+$scope.question_type+"?id="+$scope.items.id,myPopup.close()}}]});myPopup.then(function(res){})}}}]),lvtuanApp.controller("graphicCtrl",["$scope","$http","$rootScope","$timeout","$stateParams","$ionicLoading","listHelper","httpWrapper","authService",function($scope,$http,$rootScope,$timeout,$stateParams,$ionicLoading,listHelper,httpWrapper,authService){$scope.type=$stateParams.type,$scope.id=$stateParams.id,$scope.content;var limit_content=300;$scope.$watch("content",function(newVal,oldVal){newVal&&newVal!=oldVal&&newVal.length>=limit_content&&($scope.content=newVal.substr(0,limit_content))}),$scope.submit=function(){var currentUser=authService.getUser();if(1==currentUser.status||2==currentUser.status){var param={};$scope.id&&(param.lawyer_id=$scope.id),$scope.content&&(param.content=$scope.content),console.info(param),$ionicLoading.show(),httpWrapper.request("http://"+$rootScope.hostName+"/center/question/create/"+$scope.type,"post",param,function(data){layer.show("提交成功！"),location.href="#/questions/order/pay/"+data.data.data,$ionicLoading.hide()},function(data){console.info(data)})}else layer.show("您是律师用户，无此服务!")}}]),lvtuanApp.controller("lawyerArticleLikeMostCtrl",["$scope","$http","$rootScope","$stateParams","listHelper",function($scope,$http,$rootScope,$stateParams,listHelper){var id=JSON.parse(sessionStorage.getItem("lawyer_id"));listHelper.bootstrap("/lawyer/"+id+"/articles?order=like",$scope)}]),lvtuanApp.controller("lawyerArticleLatelyEditingCtrl",["$scope","$http","$rootScope","$stateParams","listHelper",function($scope,$http,$rootScope,$stateParams,listHelper){var id=JSON.parse(sessionStorage.getItem("lawyer_id"));listHelper.bootstrap("/lawyer/"+id+"/articles?order=latest",$scope)}]),lvtuanApp.controller("advisoryCtrl",["$scope","$http","$rootScope","$stateParams","listHelper",function($scope,$http,$rootScope,$stateParams,listHelper){listHelper.bootstrap("/lawyer/"+$stateParams.id+"/questions",$scope)}]),lvtuanApp.controller("dealrecordCtrl",["$scope","$http","$rootScope","$stateParams","listHelper",function($scope,$http,$rootScope,$stateParams,listHelper){listHelper.bootstrap("/lawyer/"+$stateParams.id+"/deals",$scope)}]),lvtuanApp.controller("viewteleviseCtrl",["$scope","$http","$rootScope","listHelper",function($scope,$http,$rootScope,listHelper){listHelper.bootstrap("/microblog/list/mine",$scope),$scope.likes=function(id,index){$http.post("http://"+$rootScope.hostName+"/like",{item_type:"post",item_id:id},{headers:{"Content-Type":"application/json"}}).success(function(data){console.info(data);var itmes=data.data;$scope.items[index].post_extra.likes_count=itmes.likes_count,layer.show("点赞成功！")})}}]),lvtuanApp.controller("questionsCtrl",["$scope","$http","$rootScope","$timeout","$stateParams","$state","$ionicLoading","$location","httpWrapper","authService",function($scope,$http,$rootScope,$timeout,$stateParams,$state,$ionicLoading,$location,httpWrapper,authService){$scope.post_id_status=JSON.parse(localStorage.getItem("post_id_status"));var timeoutHandler=null;1==$scope.post_id_status&&(layer.show("提交成功！"),timeoutHandler&&clearTimeout(timeoutHandler),timeoutHandler=setTimeout(function(){location.href="#/questionslist",localStorage.removeItem("post_id_status"),localStorage.removeItem("post_id")},2e3));var currentUser=authService.getUser();$ionicLoading.show(),$http.get("http://"+$rootScope.hostName+"/lawyer/workscopes").success(function(data){data.data?($scope.workscopes=data.data,$scope.addArry=[{key:"",value:"选择咨询类别"}],$scope.workscopes=$scope.addArry.concat($scope.workscopes),$scope.name=$scope.workscopes[0].value):layer.show("暂无数据！"),$ionicLoading.hide()}),$scope.visible=!0,$scope.rgba=!0,$scope.key="",$scope.toggle=function(){$scope.visible=!$scope.visible,$scope.rgba=!$scope.rgba},$scope.inShowscopes=function(key){var value=!1;return key==$scope.key&&(value=!0),value},$scope.getval=function(key,val){$scope.visible=!$scope.visible,$scope.rgba=!$scope.rgba,$scope.name=val,$scope.key=key},$scope.title;var limit_title=100;$scope.$watch("title",function(newVal,oldVal){newVal&&newVal!=oldVal&&newVal.length>=limit_title&&($scope.title=newVal.substr(0,limit_title))}),$scope.content;var limit_content=1e3;$scope.$watch("content",function(newVal,oldVal){newVal&&newVal!=oldVal&&newVal.length>=limit_content&&($scope.content=newVal.substr(0,limit_content))}),$scope.question_Submit=function(){var param=layer.getParams("#questions_form");return $scope.key.length<1?(layer.show("请选择咨询类别！"),!1):(param.cat_id=$scope.key,console.info(param),$ionicLoading.show(),void httpWrapper.request("http://"+$rootScope.hostName+"/center/question/insert/question","post",param,function(data){console.info(data);var post_id=data.data.data.post_id;if(localStorage.setItem("post_id",JSON.stringify(post_id)),null==currentUser)$scope.post_id_status=!1,localStorage.setItem("post_id_status",JSON.stringify($scope.post_id_status)),sessionStorage.setItem("goback",$location.absUrl()),layer.show("请先登录！"),location.href="#/login";else{if(3==currentUser.status)return layer.show("律师不能提交问题！"),!1;layer.show("提交成功！"),$ionicLoading.hide(),location.href="#/questionslist"}},function(data){if(console.info(data.error_messages),void 0!=data.error_messages){var errMsg=JSON.stringify(data.error_messages.content[0]);layer.show(errMsg)}}))}}]),lvtuanApp.controller("questionslistCtrl",["$http","$scope","$state","$rootScope","$ionicLoading","authService",function($http,$scope,$state,$rootScope,$ionicLoading,authService){function getWorkscopes(){$ionicLoading.show(),$http.get("http://"+$rootScope.hostPath+"/workscope").success(function(data){$scope.workscopes=data.data,$scope.workscopes.length>0&&($scope.showscopes=$scope.workscopes,$scope.workscopes=data.data,$scope.addArry=[{key:"",value:"咨询类别"}],$scope.workscopes=$scope.addArry.concat($scope.workscopes),$scope.workscope=$scope.workscopes[0].value),$ionicLoading.hide()})}function get_Param(){var param=[];$scope.scopes_key&&param.push("post_category="+$scope.scopes_key),$scope.orders_key&&param.push("order="+$scope.orders_key),param=param.join("&"),console.info($scope.param),geturl(param)}function geturl(param){$scope.nodata=!0;var url;url=""!=param?"http://"+$rootScope.hostPath+"/question?type=question&"+param+"&size="+size+"&page="+page+"&ts="+timestamp:"http://"+$rootScope.hostPath+"/question?type=question&size="+size+"&page="+page+"&ts="+timestamp,$ionicLoading.show(),$http.get(url).success(function(data){console.info(data.data),data&&data.data&&data.data.length?($scope.items=$scope.items.concat(data.data),console.info($scope.items),data.data.length<size?$scope.moredata=!1:$scope.moredata=!0):(1==page&&($scope.moredata=!1,$scope.nodata=!1),$scope.moredata=!1),page++,$scope.$broadcast("scroll.infiniteScrollComplete"),$ionicLoading.hide()})}$scope.orders=[{key:"",value:"筛选"},{key:"collect",value:"收藏最多"},{key:"comment",value:"回答最多"}],getWorkscopes(),$scope.visible=!0,$scope.visible1=!0,$scope.masklayer=!0,$scope.order=$scope.orders[0].value,$scope.scopes_key="",$scope.orders_key="",$scope.toggle=function(){$scope.visible=!$scope.visible,$scope.masklayer=!$scope.masklayer},$scope.toggle1=function(){$scope.visible1=!$scope.visible1,$scope.masklayer=!$scope.masklayer},$scope.inShowscopes=function(key){var value=!1;return $scope.key=$scope.scopes_key,key==$scope.key&&(value=!0),value},$scope.inorders=function(key){var value=!1;return $scope.key=$scope.orders_key,key==$scope.key&&(value=!0),value},$scope.getWorkscopeVal=function(key,val){$scope.visible=!$scope.visible,$scope.masklayer=!$scope.masklayer,$scope.workscope=val,$scope.scopes_key=key,page=1,$scope.items=[],get_Param()},$scope.getOrderVal=function(key,val){$scope.visible1=!$scope.visible1,$scope.masklayer=!$scope.masklayer,$scope.order=val,$scope.orders_key=key,page=1,$scope.items=[],get_Param()};var page=1,size=5;$scope.size&&(size=$scope.size),$scope.moredata=!0,$scope.items=[];var timestamp=Math.round((new Date).getTime()/1e3);$scope.doRefresh=function(){page=1,$scope.items=[],$scope.loadMore(),$scope.$broadcast("scroll.refreshComplete")},$scope.loadMore=function(){get_Param()},$scope.jumpGoQuestions=function(){var currentUser=authService.getUser();return null==currentUser?(location.href="#/questions",!1):void(1==currentUser.status||2==currentUser.status?location.href="#/questions":layer.show("您是律师用户，无此服务!"))}}]),lvtuanApp.controller("questionslistsearchCtrl",["$http","$scope","$state","$rootScope","$ionicLoading",function($http,$scope,$state,$rootScope,$ionicLoading){angular.element(".search").trigger("focus");var page=1,size=5;$scope.size&&(size=$scope.size),$scope.moredata=!0,$scope.items=[],$scope.q="",$scope.$watch("q",function(newVal,oldVal){newVal!==oldVal&&(page=1,$scope.items=[],$scope.loadMore())}),$scope.doRefresh=function(){page=1,$scope.items=[],$scope.loadMore(),$scope.$broadcast("scroll.refreshComplete")},$scope.loadMore=function(){var params=layer.getParams("#searchForm"),timestamp=Math.round((new Date).getTime()/1e3),url="";return""==params.q?($scope.moredata=!1,!1):(url="http://"+$rootScope.hostPath+"/question?type=question&q="+params.q+"&size="+size+"&page="+page+"&ts="+timestamp,$ionicLoading.show(),$http.get(url).success(function(data){data&&data.data&&data.data.length?($scope.items=$scope.items.concat(data.data),console.info($scope.items),data.data.length<size?$scope.moredata=!1:$scope.moredata=!0):(1==page&&($scope.moredata=!1,$scope.nodata=!1),$scope.moredata=!1),page++,$scope.$broadcast("scroll.infiniteScrollComplete"),$ionicLoading.hide()}),void 0)},$scope.$on("$stateChangeSuccess",function(){$scope.loadMore()})}]),lvtuanApp.controller("questionsviewsCtrl",["$http","$scope","$rootScope","$stateParams","$ionicLoading","authService",function($http,$scope,$rootScope,$stateParams,$ionicLoading,authService){var timestamp=Math.round((new Date).getTime()/1e3);$ionicLoading.show(),$http.get("http://"+$rootScope.hostName+"/question/"+$stateParams.id+"?ts="+timestamp).success(function(data){console.info(data.data),$scope.items=data.data,$ionicLoading.hide()});var currentUser=authService.getUser();$scope.isUser=function(id){null==currentUser?$rootScope.$broadcast("unauthenticated"):1==currentUser.status||2==currentUser.status?layer.show("普通用户无法回答问题"):location.href="#/questions/comment/"+id},$scope.collects=function(id){$ionicLoading.show(),$http.post("http://"+$rootScope.hostName+"/collect",{collect_type:1,item_id:id},{headers:{"Content-Type":"application/json"}}).success(function(data){$scope.items.post_extra.collects_count=data.data,$scope.items.is_collect=!0,$ionicLoading.hide(),layer.show("收藏成功！")})},$scope.collects_del=function(id){$ionicLoading.show(),$http.post("http://"+$rootScope.hostName+"/collect/delete",{collect_type:1,item_id:id},{headers:{"Content-Type":"application/json"}}).success(function(data){$scope.items.post_extra.collects_count-=1,$scope.items.is_collect=!1,$ionicLoading.hide(),layer.show("成功取消收藏！")})},$scope.likes=function(id,index){$http.post("http://"+$rootScope.hostName+"/like",{item_type:"comment",item_id:id}).success(function(data){var likes_count=data.data.likes_count;$scope.items.comments[index].like_count=likes_count,$scope.items.comments[index].is_liked=!0,layer.show("点赞成功！")})},$scope.likes_del=function(){layer.show("你已经点赞啦！")},$scope.areward=function(id){return localStorage.setItem("questions_back_id",JSON.stringify($stateParams.id)),null==currentUser?(location.href="#/login",!1):void(1==currentUser.status||2==currentUser.status?location.href="#/questions/areward/"+id:layer.show("您是律师用户，无此服务!"))}}]),lvtuanApp.controller("questionsCommentCtrl",["$http","$scope","$rootScope","$stateParams","$ionicLoading","authService",function($http,$scope,$rootScope,$stateParams,$ionicLoading,authService){console.info($stateParams.id),$scope.currentUser=authService.getUser(),$scope.submit=function(){console.info($scope.comment),$ionicLoading.show(),$http.post("http://"+$rootScope.hostName+"/question/"+$stateParams.id+"/comment",{comment:$scope.comment,creator_id:$scope.currentUser.id}).success(function(data){console.info(data),location.href="#/questionsview/"+$stateParams.id,layer.show("回答成功！"),$ionicLoading.hide()})}}]),lvtuanApp.controller("questionsArewardCtrl",["$scope","$http","$rootScope","$stateParams","$ionicPopup","$location","$ionicLoading","authService","wxService",function($scope,$http,$rootScope,$stateParams,$ionicPopup,$location,$ionicLoading,authService,wxService){var num_arr=[1,2,3,4,5,6,7,8,9],index=parseInt(Math.random()*num_arr.length);$scope.money=num_arr[index],$scope.mathRandom=function(){var index=parseInt(Math.random()*num_arr.length);$scope.money=num_arr[index],console.info(num_arr[index])},$scope.rewardsPlay=function(){$ionicLoading.show(),$scope.freeQuestion="areward",localStorage.setItem("lawyer_id",JSON.stringify($stateParams.id)),localStorage.setItem("freeQuestion",JSON.stringify($scope.freeQuestion)),localStorage.setItem("lawyer_order_moeny",JSON.stringify($scope.money)),$http.post("http://"+$rootScope.hostName+"/order/reward",{lawyer_id:$stateParams.id,money:$scope.money}).success(function(data){location.href="#/questions/areward/pay/"+data.data.order_id+"?lawyer_id="+$stateParams.id,$ionicLoading.hide()})}}]),lvtuanApp.controller("questionsArewardPayCtrl",["$scope","$http","$rootScope","$stateParams","$location","$ionicLoading","authService","wxService",function($scope,$http,$rootScope,$stateParams,$location,$ionicLoading,authService,wxService){console.info($stateParams.id),$scope.user={radioval:"wx_pub"},$scope.questions_back_id=JSON.parse(localStorage.getItem("questions_back_id")),$scope.lawyer_order_moeny=JSON.parse(localStorage.getItem("lawyer_order_moeny")),console.info($scope.mymoney),$ionicLoading.show();var timestamp=Math.round((new Date).getTime()/1e3);$http.get("http://"+$rootScope.hostName+"/center/pay/question/"+$stateParams.id+"/view?type=1&ts="+timestamp).success(function(data){$scope.items=data.data,console.info($scope.items),$ionicLoading.hide()}),$scope.wap_pay=function(user){function main(openid,money){var currentUser=authService.getUser(),param={};param.device="wechat",param.channel=user.radioval,param.amount=100*money,param.subject="免费咨询",param.body="送心意",param.open_id=openid,param.current_user_id=currentUser.id,param.metadata={},param.metadata.pay_type="wallet_reward",param.metadata.user_id=$stateParams.id,param.metadata.from_user_id=currentUser.id,console.info(param),$ionicLoading.show(),$http.post("http://"+$rootScope.hostName+"/payment_gateway/charge",param).success(function(data){console.log(data),pingpp.createPayment(data,function(result,error){"success"==result?(location.href="#/questionsview/"+$scope.questions_back_id,layer.show("送心意成功！"),localStorage.removeItem("questions_back_id"),localStorage.removeItem("lawyer_order_moeny"),$ionicLoading.hide()):"fail"==result?(layer.show("支付失败，请稍候再试。"),$ionicLoading.hide()):"cancel"==result&&(layer.show("您已取消支付。"),$ionicLoading.hide())})})}console.info(user),"qianbao"==user.radioval?($ionicLoading.show(),$http.post("http://"+$rootScope.hostName+"/wallet/reward",{user_id:$stateParams.lawyer_id,money:$scope.items.price,order_id:$scope.items.id}).success(function(data){console.info(data);var stateObj={states:"areward"};history.replaceState(stateObj,"areward",$location.absUrl()),location.href="#/questionsview/"+$scope.questions_back_id,layer.show("送心意成功！"),localStorage.removeItem("questions_back_id"),localStorage.removeItem("lawyer_order_moeny"),$ionicLoading.hide()})):wxService.getOpenId()?main(wxService.getOpenId(),$scope.lawyer_order_moeny):(window.location.replace(wxService.getWxAuthUrl("/wxauthpayment")),main(wxService.getOpenId(),$scope.lawyer_order_moeny))}}]),lvtuanApp.controller("questionsOrderPpayCtrl",["$scope","$http","$rootScope","$stateParams","$ionicPopup","$location","$ionicLoading","authService","wxService","listHelper","httpWrapper",function($scope,$http,$rootScope,$stateParams,$ionicPopup,$location,$ionicLoading,authService,wxService,listHelper,httpWrapper){console.info($stateParams.id),$scope.user={radioval:"wx_pub"},$ionicLoading.show();var timestamp=Math.round((new Date).getTime()/1e3);$http.get("http://"+$rootScope.hostName+"/center/pay/question/"+$stateParams.id+"/view?ts="+timestamp).success(function(data){$scope.items=data.data,console.info($scope.items),$ionicLoading.hide()}),$scope.wap_pay=function(user){function main(openid){var currentUser=authService.getUser(),param={};param.order_no=$scope.item.order_no,param.device="wechat",param.channel=user.radioval,param.amount=100*$scope.item.price,param.subject=$scope.item.type,param.body=$scope.item.title,param.open_id=openid,param.current_user_id=currentUser.id,param.metadata={},param.metadata.pay_type=$stateParams.type,null!=$stateParams.type&&("order"==$stateParams.type&&(param.metadata.question_id=$scope.item.post_id),"wallet_recharge"==$stateParams.type&&(param.metadata.user_id=currentUser.id)),console.info(param),$ionicLoading.show(),$http.post("http://"+$rootScope.hostName+"/payment_gateway/charge",param).success(function(data){console.log(data),pingpp.createPayment(data,function(result,error){
"success"==result?(location.href="#/user/order/list",layer.show("付款成功！"),$ionicLoading.hide()):"fail"==result?(layer.show("支付失败，请稍候再试。"),$ionicLoading.hide()):"cancel"==result&&(layer.show("您已取消支付。"),$ionicLoading.hide())})})}"qianbao"==user.radioval?($ionicLoading.show(),httpWrapper.request("http://"+$rootScope.hostName+"/center/question/"+$stateParams.id+"/pay/wallet","post",null,function(data){$scope.items=data.data;var stateObj={states:"order"};history.replaceState(stateObj,"order",$location.absUrl()),location.href="#/user/order/list",layer.show("付款成功！"),$ionicLoading.hide()},function(data){console.info(data)})):wxService.getOpenId()?main(wxService.getOpenId()):(window.location.replace(wxService.getWxAuthUrl("/wxauthpayment")),main(wxService.getOpenId()))}}]),lvtuanApp.controller("lawlectureCtrl",["$http","$scope","$state","$rootScope",function($http,$scope,$state,$rootScope){console.info("法律讲堂")}]),lvtuanApp.controller("casescommCtrl",["$http","$scope","$state","$rootScope",function($http,$scope,$state,$rootScope){console.info("案件委托")}]),lvtuanApp.controller("lvtuanallianceCtrl",["$http","$scope","$state","$rootScope",function($http,$scope,$state,$rootScope){function init(){var url="http://"+$rootScope.hostName+"/union/list_partners";$http.get(url).success(function(data){$scope.unions=data.data})}init()}]),lvtuanApp.controller("lvtuanallianceviewCtrl",["$http","$scope","$state","$rootScope","$stateParams",function($http,$scope,$state,$rootScope,$stateParams){function init(){var url="http://"+$rootScope.hostName+"/union/list_partners";$http.get(url).success(function(data){for(var itmes=data.data,i=0;i<itmes.length;i++)if(id==itmes[i].id){$scope.union=itmes[i];break}})}var id=$stateParams.id;init()}]),lvtuanApp.controller("talentCtrl",["$http","$scope","$state","$rootScope",function($http,$scope,$state,$rootScope){function init(){var url="http://"+$rootScope.hostName+"/hr/list_positions";$http.get(url).success(function(data){$scope.positions=data.data,console.info($scope.positions)})}init()}]),lvtuanApp.controller("talentviewCtrl",["$http","$scope","$state","$rootScope","$stateParams",function($http,$scope,$state,$rootScope,$stateParams){function init(){var url="http://"+$rootScope.hostName+"/hr/"+$stateParams.id+"/view";$http.get(url).success(function(data){$scope.positions=data.data,console.info($scope.positions)})}init()}]),lvtuanApp.controller("easemobmainCtrl",["$scope","$http","$state","$rootScope","$stateParams","$timeout","$ionicLoading","easemobService","httpWrapper","authService",function($scope,$http,$state,$rootScope,$stateParams,$timeout,$ionicLoading,easemobService,httpWrapper,authService){$scope.$on("$locationChangeSuccess",function(newState,oldState){return newState==oldState?!1:void window.location.reload()});var currentUser=authService.getUser();currentUser.associate_id=$stateParams.id,localStorage.setItem("currentUser",JSON.stringify(currentUser)),$ionicLoading.show(),$http.get("http://"+$rootScope.hostName+"/center/question/"+$stateParams.id+"/ask").success(function(data){data&&data.data&&($scope.items=data.data,console.info($scope.items),$scope.curChatUserId=$scope.items.user_id,$scope.curUserId=$scope.items.easemob_id,easemobService.init($scope.items.user_id,"chat"),easemobService.login($scope.items.easemob_id.toString(),$scope.items.easemob_pwd))}),$scope.visible=!0,$scope.toggle=function(){$scope.visible=!$scope.visible},$scope.arry=[];var page=1,rows_per_page=10;$scope.loadMore=function(){var str="",url="http://"+$rootScope.hostName+"/question/"+$stateParams.id+"/comment_list?page="+page+"&rows_per_page="+rows_per_page;$ionicLoading.show(),$http.get(url).success(function(data){if(obj=data.data.comments,console.info(obj),console.info($scope.arry),$scope.arry.length>0)for(var i=0;i<obj.length;i++)for(var j=0;j<$scope.arry.length;j++)obj[i].id!=$scope.arry[j]?(console.info(obj[i].id),style="left",str+=obj[i].creator_id==$scope.curUserId?'<div class="easemobmain-record img-right" style="text-align:right;">':'<div class="easemobmain-record img-left" style="text-align:left;">',str+="<p1>"+obj[i].created_at+"<span></span></p1>",str+="<p2>"+obj[i].creator_name+"<b></b></p2>",str+="<img src="+obj[i].creator_avatar+"><br>",str+='<p3 class="chat-content-p3" className="chat-content-p3">'+obj[i].content+"</p3>",str+="</div>"):console.info(obj[i].id,$scope.arry[j]);else for(var i=0;i<obj.length;i++)style="left",str+=obj[i].creator_id==$scope.curUserId?'<div class="easemobmain-record img-right" style="text-align:right;">':'<div class="easemobmain-record img-left" style="text-align:left;">',str+="<p1>"+obj[i].created_at+"<span></span></p1>",str+="<p2>"+obj[i].creator_name+"<b></b></p2>",str+="<img src="+obj[i].creator_avatar+"><br>",str+='<p3 class="chat-content-p3" className="chat-content-p3">'+obj[i].content+"</p3>",str+="</div>";obj.length<rows_per_page&&$("#comments-list").hide(),$("#page").after(str),$("#page").css("display","none"),page++,$ionicLoading.hide()}).error(function(data){console.info(data);var error=$.parseJSON(data.responseText);layer.show(error.error_messages),console.info(error)})},$scope.sendText=function(){var comment=$("#talkInputId").val(),result=easemobService.sendText("chat");result&&$scope.saveComment(comment)},$scope.saveComment=function(comment){var comment=comment,creator_id=$scope.curUserId,url="http://"+$rootScope.hostName+"/question/"+$stateParams.id+"/comment";$http.post(url,{comment:comment,creator_id:creator_id}).success(function(data){console.info(data),$scope.arry.push(data.data.id),console.info($scope.arry)}).error(function(data){console.info(data)})}}]),lvtuanApp.controller("userQuestionListCtrl",["$scope","$rootScope","$ionicLoading","listHelper_hostPath",function($scope,$rootScope,$ionicLoading,listHelper_hostPath){listHelper_hostPath.bootstrap("/user/question?type=creator",$scope)}]),lvtuanApp.controller("userOrderListCtrl",["$scope","$rootScope","$ionicLoading","listHelper","listHelper_hostPath","httpWrapper",function($scope,$rootScope,$ionicLoading,listHelper,listHelper_hostPath,httpWrapper){listHelper.bootstrap("/center/question/list",$scope)}]),lvtuanApp.controller("userOrderViewCtrl",["$scope","$rootScope","$ionicLoading","$stateParams","$ionicPopup","httpWrapper",function($scope,$rootScope,$ionicLoading,$stateParams,$ionicPopup,httpWrapper){console.info("咨询详情"),$ionicLoading.show(),httpWrapper.get("http://"+$rootScope.hostName+"/center/question/"+$stateParams.id+"/view",function(data){$scope.items=data.data,console.info($scope.items),$ionicLoading.hide()}),$scope.to_complete=function(url){var confirmPopup=$ionicPopup.confirm({template:'<p style="text-align: center;">律师已经解答您的问题？</p>',cancelText:"取消",cancelType:"button-light",okText:"确认",okType:"button-positive"});confirmPopup.then(function(res){return res?($ionicLoading.show(),void httpWrapper.request(url,"post",null,function(data){$ionicLoading.hide(),layer.show("确认成功！"),window.location.reload()},function(data){console.info(data)})):!1})},$scope.to_lawyer=function(){var alertPopup=$ionicPopup.alert({title:'<div class="popup-head1">正在与您连接律师，请稍后...</div>',template:'<div style="text-align: center;padding-top:20px;"><img ng-src="../img/phone.gif" style="width: 80%;"></div>',okText:"返回",okType:"button-cff2f5f"});alertPopup.then(function(res){})},$scope.to_evaluate=function(id){location.href="#/confirmCompletion/"+id},$scope.to_ask=function(id){location.href="#/easemobmain/"+id}}]),lvtuanApp.controller("confirmCompletionCtrl",["$scope","$http","$rootScope","$stateParams","$ionicLoading","httpWrapper",function($scope,$http,$rootScope,$stateParams,$ionicLoading,httpWrapper){Array.prototype.remove=function(index){if(isNaN(index)||index>this.length)return!1;for(var i=0,n=0;i<this.length;i++)this[i]!=this[index]&&(this[n++]=this[i]);this.length-=1},$scope.tags={tags_1_2:["服务态度差","专业能力差","办事效率低","回复速度慢"],tags_3:["服务态度一般","专业能力一般","办事效率一般","回复速度一般"],tags_4_5:["服务态度好","回复速度快","专业程度高","主动热情","解答详细"]},$scope.max=5,$scope.ratingVal=5,$scope.readonly=!1,$scope.evaluates=$scope.tags.tags_4_5,$scope.onHover=function(val){$scope.hoverVal=val},$scope.onLeave=function(){$scope.hoverVal=null},$scope.onChange=function(val){console.info(val),$scope.ratingVal=val,1==val||2==val?$scope.evaluates=$scope.tags.tags_1_2:3==val?$scope.evaluates=$scope.tags.tags_3:$scope.evaluates=$scope.tags.tags_4_5},$scope.type=JSON.parse(localStorage.getItem("type")),$scope.inShowtags=function(key){for(var value=!1,i=0;i<$scope.tag_arry.length;i++)$scope.tag_arry[i]==key&&(value=!0);return value},$scope.tag_arry=[],$scope.click_tag=function(key,val){if(!($scope.tag_arry.length<1)){for(var i=0;i<$scope.tag_arry.length;i++)if($scope.tag_arry[i]==key)return $scope.tag_arry.remove(i),console.info("01",$scope.tag_arry),!1;return $scope.tag_arry.push(key),console.info("1",$scope.tag_arry),!1}$scope.tag_arry.push(key)},$scope.submit=function(){var evaluate_comment=$(".evaluate_comment").val(),params={};return $scope.ratingVal&&(params.evaluate_score=$scope.ratingVal),evaluate_comment.length>0?(params.evaluate_comment=evaluate_comment,$scope.tag_arry.length>0?(params.evaluate_tags=$scope.tag_arry,void httpWrapper.request("http://"+$rootScope.hostName+"/center/question/"+$stateParams.id+"/evaluate","post",params,function(data){layer.show("评价成功！"),$scope.tag_arry=[],$scope.evaluates=$scope.tags.tags_4_5,location.href="#/user/order/list",window.location.reload()},function(data){console.info(data)})):(layer.show("请评价律师的服务！"),!1)):(layer.show("请评价律师的服务！"),!1)}}]),lvtuanApp.controller("userEasemobViewCtrl",["$http","$scope","$rootScope","$ionicLoading","$stateParams","listHelper_hostPath","httpWrapper","authService",function($http,$scope,$rootScope,$ionicLoading,$stateParams,listHelper_hostPath,httpWrapper,authService){console.info("聊天记录");var timestamp=Math.round((new Date).getTime()/1e3);$scope.currentUser=authService.getUser();var page=1,rows_per_page=10;$scope.rows_per_page&&(rows_per_page=$scope.rows_per_page),$scope.moredata=!0,$scope.items=[],$scope.doRefresh=function(){page=1,$scope.items=[],$scope.loadMore(),$scope.$broadcast("scroll.refreshComplete")},$scope.loadMore=function(){$ionicLoading.show(),$http.get("http://"+$rootScope.hostName+"/question/"+$stateParams.id+"/comment_list?page="+page+"&rows_per_page="+rows_per_page+"&ts="+timestamp).success(function(data){data&&data.data.comments&&data.data.comments.length?($scope.items=$scope.items.concat(data.data.comments),console.info($scope.items),data.data.length<rows_per_page?$scope.moredata=!1:$scope.moredata=!0):(1==page&&($scope.moredata=!1,$scope.nodata=!1),$scope.moredata=!1),page++,$scope.$broadcast("scroll.infiniteScrollComplete"),$ionicLoading.hide()})}}]),lvtuanApp.controller("lawyerQuestionNotCtrl",["$scope","$rootScope","$ionicLoading","listHelper_hostPath","httpWrapper",function($scope,$rootScope,$ionicLoading,listHelper_hostPath,httpWrapper){console.info("未参与"),listHelper_hostPath.bootstrap("/user/question?type=not_reply",$scope)}]),lvtuanApp.controller("lawyerQuestionAlreadyCtrl",["$scope","$rootScope","$ionicLoading","listHelper_hostPath","httpWrapper",function($scope,$rootScope,$ionicLoading,listHelper_hostPath,httpWrapper){console.info("已参与"),listHelper_hostPath.bootstrap("/user/question?type=reply",$scope)}]),lvtuanApp.controller("lawyerOrderListCtrl",["$scope","$rootScope","$ionicLoading","listHelper","listHelper_hostPath","httpWrapper",function($scope,$rootScope,$ionicLoading,listHelper,listHelper_hostPath,httpWrapper){listHelper.bootstrap("/center/question/list",$scope)}]),lvtuanApp.controller("lawyerOrderViewCtrl",["$scope","$rootScope","$ionicLoading","$stateParams","$ionicPopup","httpWrapper",function($scope,$rootScope,$ionicLoading,$stateParams,$ionicPopup,httpWrapper){$ionicLoading.show(),httpWrapper.get("http://"+$rootScope.hostName+"/center/question/"+$stateParams.id+"/view",function(data){$scope.items=data.data,$scope.items.transitions.length>0?$scope.isHastabs="has-tabs":$scope.isHastabs="not",console.info($scope.items),$ionicLoading.hide()}),$scope.to_accept=function(url){$ionicLoading.show(),httpWrapper.request(url,"post",null,function(data){$ionicLoading.hide(),layer.show("受理成功！"),window.location.reload()},function(data){console.info(data)})},$scope.to_evaluate=function(id){location.href="#/lawyer/comment/"+id},$scope.to_ask=function(id){location.href="#/easemobmain/"+id}}]),lvtuanApp.controller("lawyerCommentCtrl",["$http","$scope","$stateParams","$rootScope","$ionicLoading","httpWrapper",function($http,$scope,$stateParams,$rootScope,$ionicLoading,httpWrapper){$ionicLoading.show(),httpWrapper.get("http://"+$rootScope.hostName+"/center/lawyer/question/"+$stateParams.id+"/evaluate/view",function(data){$scope.items=data.data,console.info($scope.items),$ionicLoading.hide()})}]),lvtuanApp.controller("questionPaycompanyNewCtrl",["$scope","$rootScope","listHelper","httpWrapper",function($scope,$rootScope,listHelper,httpWrapper){console.info("待受理"),listHelper.bootstrap("/center/question/list?type=pay_company&status=new",$scope),$scope.to_cancel=function(url,item){httpWrapper.request(url,"post",null,function(data){$scope.items.splice($scope.items.indexOf(item),1),layer.show("取消成功！")},function(data){console.info(data)})},$scope.to_take=function(url,item){httpWrapper.request(url,"post",null,function(data){layer.show("抢单成功！"),$scope.items.splice($scope.items.indexOf(item),1),location.href="#/question/paycompany/waitforconfirmation"},function(data){console.info(data)})}}]),lvtuanApp.controller("questionPaycompanyWaitforconfirmationCtrl",["$scope","$rootScope","$ionicPopup","listHelper","httpWrapper",function($scope,$rootScope,$ionicPopup,listHelper,httpWrapper){console.info("待确认"),listHelper.bootstrap("/center/question/list?type=pay_company&status=replied",$scope),$scope.to_complete=function(url,item){var confirmPopup=$ionicPopup.confirm({title:"律师已经与您签署《法律顾问协议》？",cancelText:"取消",okText:"确认"});confirmPopup.then(function(res){return res?void httpWrapper.request(url,"post",null,function(data){$scope.items.splice($scope.items.indexOf(item),1),layer.show("确认成功！"),location.href="#/question/paycompany/waitforevaluation"},function(data){console.info(data)}):!1})}}]),lvtuanApp.controller("questionPaycompanyWaitforevaluationCtrl",["$scope","$rootScope","listHelper","httpWrapper",function($scope,$rootScope,listHelper,httpWrapper){console.info("待评价"),listHelper.bootstrap("/center/question/list?type=pay_company&status=wait_for_evaluation",$scope),$scope.to_evaluate=function(id,type){localStorage.setItem("type",JSON.stringify(type)),location.href="#/confirmCompletion/"+id}}]),lvtuanApp.controller("questionPaycompanyCompleteCtrl",["$scope","$rootScope","listHelper","httpWrapper",function($scope,$rootScope,listHelper,httpWrapper){console.info("已完成"),listHelper.bootstrap("/center/question/list?type=pay_company&status=complete",$scope),$scope.to_remove=function(url,item){httpWrapper.request(url,"post",null,function(data){$scope.items.splice($scope.items.indexOf(item),1),layer.show("删除成功！")},function(data){console.info(data)})}}]),lvtuanApp.controller("questionPaycompanyCancelledCtrl",["$scope","$rootScope","listHelper","httpWrapper",function($scope,$rootScope,listHelper,httpWrapper){console.info("已取消"),listHelper.bootstrap("/center/question/list?type=pay_company&status=cancelled",$scope),$scope.to_remove=function(url,item){httpWrapper.request(url,"post",null,function(data){$scope.items.splice($scope.items.indexOf(item),1),layer.show("删除成功！")},function(data){console.info(data)})}}]),lvtuanApp.controller("questionPaycompanyViewCtrl",["$scope","$rootScope","$ionicLoading","$stateParams","$ionicPopup","httpWrapper",function($scope,$rootScope,$ionicLoading,$stateParams,$ionicPopup,httpWrapper){console.info("咨询详情"),$ionicLoading.show(),httpWrapper.get("http://"+$rootScope.hostName+"/center/question/"+$stateParams.id+"/view",function(data){$scope.items=data.data,console.info($scope.items),$ionicLoading.hide()}),$scope.to_cancel=function(url,item){httpWrapper.request(url,"post",null,function(data){$scope.items.splice($scope.items.indexOf(item),1),layer.show("取消成功！")},function(data){console.info(data)})},$scope.to_take=function(url,item){httpWrapper.request(url,"post",null,function(data){layer.show("抢单成功！"),$scope.items.splice($scope.items.indexOf(item),1),location.href="#/question/paycompany/waitforconfirmation"},function(data){console.info(data)})},$scope.to_complete=function(url){var confirmPopup=$ionicPopup.confirm({title:"律师已经与您签署《法律顾问协议》？",cancelText:"取消",okText:"确认"});confirmPopup.then(function(res){return res?void httpWrapper.request(url,"post",null,function(data){layer.show("确认成功！"),location.href="#/question/paycompany/waitforevaluation"},function(data){console.info(data)}):!1})},$scope.to_evaluate=function(id,type){localStorage.setItem("type",JSON.stringify(type)),location.href="#/confirmCompletion/"+id},$scope.to_remove=function(url,item){httpWrapper.request(url,"post",null,function(data){$scope.items.splice($scope.items.indexOf(item),1),layer.show("删除成功！")},function(data){console.info(data)})}}]),lvtuanApp.controller("commodityListCtrl",["$scope","$rootScope","listHelper","httpWrapper",function($scope,$rootScope,listHelper,httpWrapper){console.info("我的商品"),listHelper.bootstrap("/center/order/list",$scope),$scope.to_cancel=function(id,item){httpWrapper.request("http://"+$rootScope.hostName+"/center/question/"+id+"/cancel","post",null,function(data){$scope.items.splice($scope.items.indexOf(item),1),layer.show("取消成功！")},function(data){console.info(data)})},$scope.to_payorder=function(id,type){localStorage.setItem("type",JSON.stringify(type)),location.href="#/questions/order/pay/"+id}}]),lvtuanApp.controller("documentlistCtrl",["$http","$scope","$state","$rootScope","$ionicLoading","locationService",function($http,$scope,$state,$rootScope,$ionicLoading,locationService){function getWorkscopes(){$ionicLoading.show(),$http.get("http://"+$rootScope.hostName+"/knowledge/document/categories").success(function(data){$scope.workscopes=data.data,$scope.workscopes.length>0&&($scope.addArry=[{key:"",value:"文书类别"}],$scope.workscopes=$scope.addArry.concat($scope.workscopes),$scope.workscope=$scope.workscopes[0].value),$ionicLoading.hide()})}function get_Param(){var param=[];$scope.scopes_key&&param.push("cat_id="+$scope.scopes_key),$scope.orders_key&&param.push("order="+$scope.orders_key),param=param.join("&"),console.info(param),geturl(param)}function geturl(param){$scope.nodata=!0;var url;url=""!=param?"http://"+$rootScope.hostName+"/knowledge/document/list_documents?"+param+"&rows_per_page="+rows_per_page+"&page="+page+"&ts="+timestamp:"http://"+$rootScope.hostName+"/knowledge/document/list_documents?rows_per_page="+rows_per_page+"&page="+page,$ionicLoading.show(),$http.get(url).success(function(data){data&&data.data&&data.data.length?($scope.items=$scope.items.concat(data.data),console.info($scope.items),data.data.length<rows_per_page?$scope.moredata=!1:$scope.moredata=!0):(1==page&&($scope.moredata=!1,$scope.nodata=!1),$scope.moredata=!1),page++,$scope.$broadcast("scroll.infiniteScrollComplete"),$ionicLoading.hide()})}$scope.orders=[{key:"",value:"筛选"},{key:"downs",value:"下载最多"},{key:"views",value:"浏览最多"}],getWorkscopes(),$scope.visible=!0,$scope.visible1=!0,$scope.masklayer=!0,$scope.order=$scope.orders[0].value,$scope.scopes_key="",$scope.orders_key="",$scope.toggle=function(){$scope.visible=!$scope.visible,$scope.masklayer=!$scope.masklayer},$scope.toggle1=function(){$scope.visible1=!$scope.visible1,$scope.masklayer=!$scope.masklayer},$scope.inShowscopes=function(key){var value=!1;return $scope.key=$scope.scopes_key,key==$scope.key&&(value=!0),value},$scope.inorders=function(key){var value=!1;return $scope.key=$scope.orders_key,key==$scope.key&&(value=!0),value},$scope.getWorkscopeVal=function(key,val){$scope.visible=!$scope.visible,$scope.masklayer=!$scope.masklayer,$scope.workscope=val,$scope.scopes_key=key,page=1,$scope.items=[],get_Param()},$scope.getOrderVal=function(key,val){$scope.visible1=!$scope.visible1,$scope.masklayer=!$scope.masklayer,$scope.order=val,$scope.orders_key=key,page=1,$scope.items=[],get_Param()};var page=1,rows_per_page=5;$scope.rows_per_page&&(rows_per_page=$scope.rows_per_page),$scope.moredata=!0,$scope.items=[];var timestamp=Math.round((new Date).getTime()/1e3);$scope.doRefresh=function(){page=1,$scope.items=[],$scope.loadMore(),$scope.$broadcast("scroll.refreshComplete")},$scope.loadMore=function(){get_Param()}}]),lvtuanApp.controller("documentlistsearchCtrl",["$http","$scope","$state","$rootScope","$ionicLoading",function($http,$scope,$state,$rootScope,$ionicLoading){angular.element(".search").trigger("focus");var page=1,rows_per_page=5;$scope.rows_per_page&&(rows_per_page=$scope.rows_per_page),$scope.moredata=!0,$scope.items=[],$scope.q="",$scope.$watch("q",function(newVal,oldVal){newVal!==oldVal&&(page=1,$scope.items=[],$scope.loadMore())}),$scope.doRefresh=function(){page=1,$scope.items=[],$scope.loadMore(),$scope.$broadcast("scroll.refreshComplete")},$scope.loadMore=function(){$ionicLoading.show();var params=layer.getParams("#searchForm"),url="";return""==params.q?($scope.moredata=!1,!1):(url="http://"+$rootScope.hostName+"/knowledge/document/list_documents?q="+params.q+"&rows_per_page="+rows_per_page+"&page="+page,$ionicLoading.show(),$http.get(url).success(function(data){data&&data.data&&data.data.length?($scope.items=$scope.items.concat(data.data),console.info($scope.items),$ionicLoading.hide(),data.data.length<=rows_per_page?$scope.moredata=!1:$scope.moredata=!0):(1==page&&($scope.moredata=!1,$scope.nodata=!1),$scope.moredata=!1),page++,$scope.$broadcast("scroll.infiniteScrollComplete"),$ionicLoading.hide()}),void 0)},$scope.$on("$stateChangeSuccess",function(){$scope.loadMore()})}]),lvtuanApp.controller("documentownloadlistCtrl",["$http","$scope","$state","$rootScope","$stateParams","$ionicLoading",function($http,$scope,$state,$rootScope,$stateParams,$ionicLoading){$ionicLoading.show(),$http.get("http://"+$rootScope.hostName+"/knowledge/document/"+$stateParams.id+"/view").success(function(data){console.info("法律文书详情",data.data),$scope.itmes=data.data,$ionicLoading.hide()})}]),lvtuanApp.controller("corporateservicesCtrl",["$http","$scope","$state","$rootScope","$stateParams",function($http,$scope,$state,$rootScope,$stateParams){$scope.counsels=[{img:"01.png",title:"防范合同风险",content:"商务合同、法律文书一审再审，专业填坑我最强"},{img:"02.png",title:"避免劳资纠纷",content:"从员工入职到离职，全流程风险预警与控制，有效避免劳资纠纷"},{img:"03.png",title:"维护企业权益",content:"一旦企业权益受损，务必全力维权，将损失降至最低"},{img:"04.png",title:"法律风险评估",content:"定期进行专业的企业法律风险评估，并提供靠谱的整改意见"},{img:"05.png",title:"节约时间成本",content:"专业的事交给专业的律师来做，您可以专心管理和经营企业"},{img:"06.png",title:"案件委托优惠",content:"个案委托八五折起，您可以省下大笔律师费，用于企业发展"}]}]),lvtuanApp.controller("corporatelistCtrl",["$scope","$state","$http","$rootScope","$stateParams","$ionicPopup","$ionicLoading","authService",function($scope,$state,$http,$rootScope,$stateParams,$ionicPopup,$ionicLoading,authService){var currentUser=authService.getUser();switch($scope.buynow_btn=function(id){1==currentUser.status||2==currentUser.status?location.href="#/corporate/buynow/"+id:layer.show("您是律师用户，无此服务!")},$scope.counsels={counsels_8800:{id:"1",title:"企业法律顾问银卡提供的服务",money:"8800元/年(两年起签)",banner_img:"banner_1.png",counsels_arry:[{title:"电话咨询",content:"不限次，无论您遇到什么问题，一个电话随时连线律师。找律师，从未如此简单。"},{title:"风险诊断",content:"不限次，企业经营、决策过程中有任何不确定的风险、困惑，我们负责帮您诊断。"},{title:"文件下载",content:"不限次，由专业律师团队精心整理、审阅过的海量实用文书，您可免费任意下载。"},{title:"免费律师函",content:"2份，一旦企业权益受损，我们将帮您发出律师函，以及时制止不法的侵权行为。"},{title:"法律文书制作、修改",content:"5份，企业经营过程中涉及的各类法律文书的制作、修改及审核，包您高枕无忧。"},{title:"企业管理制度全面规划化",content:"1次，对企业的管理规章制度进行全方位的合法性审查，并给出专业的规划建议。"},{title:"律师在所会面",content:"2次，在律团的办公场所为您面对面地提供直接、高效的法律服务。服务内容任选。"},{title:"网上法律实务培训",content:"2次，我们将在网上为您公司的全体员工进行法律实务的专业培训，包括训后咨询。"},{title:"企业风险评估及整改意见",content:"1份，对您的企业进行专业、全面的法律风险评估，并且提供靠谱的整改意见。"},{title:"年终企业法律顾问服务总结报告",content:"1份，我们将给出服务期内（一年）法律顾问服务的总结性报告，以供分析、参考。"},{title:"个案委托",content:"八五折，在法律顾问服务期间，您公司的案件委托一律八五折，不限案件性质及范围。"}]},counsels_18800:{id:"2",title:"企业法律顾问金卡提供的服务",money:"18800元/年(一年起签)",banner_img:"banner_2.png",counsels_arry:[{title:"电话咨询",content:"不限次，无论您遇到什么问题，一个电话随时连线律师。找律师，从未如此简单。"},{title:"风险诊断",content:"不限次，企业经营、决策过程中有任何不确定的风险、困惑，我们负责帮您诊断。"},{title:"免费律师函",content:"4份，一旦企业权益受损，我们将帮您发出律师函，以及时制止不法的侵权行为。"},{title:"法律文书制作、修改",content:"10份，企业经营过程中涉及的各类法律文书的制作、修改及审核，包您高枕无忧。"},{title:"企业管理制度全面规划化",content:"1次，对企业的管理规章制度进行全方位的合法性审查，并给出专业的规划建议。"},{title:"律师在所会面",content:"4次，在律团的办公场所为您面对面地提供直接、高效的法律服务。服务内容任选。"},{title:"上门法律实务培训",content:"1次，我们将拜访您的公司并为全体员工进行法律实务的专业培训，包括训后咨询。"},{title:"企业风险评估及整改意见",content:"1份，对您的企业进行专业、全面的法律风险评估，并且提供靠谱的整改意见。"},{title:"年终企业法律顾问服务总结报告",content:"1份，我们将给出服务期内（一年）法律顾问服务的总结性报告，以供分析、参考。"},{title:"个案委托",content:"八五折，在法律顾问服务期间，您公司的案件委托一律八五折，不限案件性质及范围。"}]},counsels_28800:{id:"3",title:"企业法律顾问金卡提供的服务",money:"28800元/年(一年起签)",banner_img:"banner_3.png",counsels_arry:[{title:"电话咨",content:"不限次，无论您遇到什么问题，一个电话随时连线律师。找律师，从未如此简单。"},{title:"风险诊断",content:"不限次，企业经营、决策过程中有任何不确定的风险、困惑，我们负责帮您诊断。"},{title:"免费律师函",content:"8份，一旦企业权益受损，我们将帮您发出律师函，以及时制止不法的侵权行为。"},{title:"法律文书制作、修改",content:"15份，企业经营过程中涉及的各类法律文书的制作、修改及审核，包您高枕无忧。"},{title:"企业管理制度全面规划化",content:"1次，对企业的管理规章制度进行全方位的合法性审查，并给出专业的规划建议。"},{title:"律师在所会面",content:"6次，在律团的办公场所为您面对面地提供直接、高效的法律服务。服务内容任选。"},{title:"上门法律实务培训",content:"2次，我们将拜访您的公司并为全体员工进行法律实务的专业培训，包括训后咨询。"},{title:"企业风险评估及整改意见",content:"1份，对您的企业进行专业、全面的法律风险评估，并且提供靠谱的整改意见。"},{title:"年终企业法律顾问服务总结报告",content:"1份，我们将给出服务期内（一年）法律顾问服务的总结性报告，以供分析、参考。"},{title:"个案委托",content:"八五折，在法律顾问服务期间，您公司的案件委托一律八五折，不限案件性质及范围。"}]}},$scope.items=null,$stateParams.id){case"1":$scope.items=$scope.counsels.counsels_8800;break;case"2":$scope.items=$scope.counsels.counsels_18800;break;case"3":$scope.items=$scope.counsels.counsels_28800}}]),lvtuanApp.controller("corporatebuynowCtrl",["$scope","$http","$rootScope","$timeout","$stateParams","$ionicLoading","$localStorage","$location",function($scope,$http,$rootScope,$timeout,$stateParams,$ionicLoading,$localStorage,$location){delete $localStorage.addres,$scope.address="",$scope.addres_param={},$scope.addres=$localStorage.addres||"",$scope.$watch("addres",function(newVal,oldVal){console.log("newVal: ",newVal),$localStorage.addres=$scope.addres,$scope.addres_param=$localStorage.addres,$scope.addres_param?($scope.address=$scope.addres_param.province.value+" "+$scope.addres_param.city.value+" "+$scope.addres_param.district.value,console.info("address",$scope.address)):$scope.address=""}),$scope.$watch(function(){return angular.toJson($localStorage)},function(){$scope.addres=$localStorage.addres,console.info($scope.addres)}),$scope.getAddress=function(){delete $localStorage.addres,localStorage.setItem("citypicke_goback",$location.path()),location.href="#/citypicke/all"},console.log($stateParams.id),$scope.submit=function(){$ionicLoading.show();var param=layer.getParams("#buynowForm"),province=$scope.addres_param.province.key,city=$scope.addres_param.city.key,district=$scope.addres_param.district.key;province&&(param.province=province),city&&(param.city=city),district&&(param.district=district),1==$scope.invoice?param.invoice="Y":param.invoice="N",$stateParams.id&&(param.product_id=$stateParams.id),console.info(param),$ionicLoading.show(),$http.post("http://"+$rootScope.hostName+"/center/question/create/pay_company",param).success(function(data){$ionicLoading.hide(),console.log(data.data),localStorage.setItem("type",JSON.stringify("pay_company")),location.href="#/pay/"+data.data+"?type=order"})}}]),lvtuanApp.controller("userwalletCtrl",["$scope","$http","$rootScope","$ionicLoading","authService","listHelper",function($scope,$http,$rootScope,$ionicLoading,authService,listHelper){$scope.$on("$ionicView.beforeEnter",function(){var currentUser=authService.getUser(),timestamp=Math.round((new Date).getTime()/1e3);$scope.items={},$ionicLoading.show(),1==currentUser.status||2==currentUser.status?$http.get("http://"+$rootScope.hostName+"/center/customer/wallet?ts="+timestamp).success(function(data){data&&data.data&&($scope.items=data.data,sessionStorage.setItem("summoney",$scope.items.money)),$ionicLoading.hide()}):$http.get("http://"+$rootScope.hostName+"/center/lawyer/wallet?ts="+timestamp).success(function(data){data&&data.data&&($scope.items=data.data,sessionStorage.setItem("summoney",$scope.items.money)),$ionicLoading.hide()})}),$scope.tabs=[{title:"最新交易记录",url:"latest_record.tpl.html"},{title:"充值记录",url:"recharge_record.tpl.html"},{title:"提现记录",url:"withdraw_record.tpl.html"}],$scope.currentTab="latest_record.tpl.html",$scope.onClickTab=function(tab){$scope.currentTab=tab.url},$scope.isActiveTab=function(tabUrl){return tabUrl==$scope.currentTab}}]),lvtuanApp.controller("wxCheckOpenIdCtrl",["$scope","$http","$rootScope","$stateParams","$ionicHistory","authService","wxService",function($scope,$http,$rootScope,$stateParams,$ionicHistory,authService,wxService){$scope.$on("$ionicView.beforeEnter",function(){wxService.getOpenId()||window.location.replace(wxService.getWxAuthUrl("/wxauthpayment"))})}]),lvtuanApp.controller("wxAuthPaymentCtrl",["$scope","$http","$rootScope","$stateParams","authService","wxService","$ionicLoading",function($scope,$http,$rootScope,$stateParams,authService,wxService,$ionicLoading){var code=$stateParams.code,state=$stateParams.state;$ionicLoading.show(),$http.get("http://"+AppSettings.baseApiUrl+"/openid?code="+code+"&state="+state).then(function(res){var authData=res.data?res.data.data:null;wxService.saveOpenId(authData.openid),$ionicLoading.hide(),location.href="#/user/moneyin"})["catch"](function(response){console.error("Gists error",response.status,response.data),400===response.status})}]),lvtuanApp.controller("usermoneyinCtrl",["$scope","$http","$rootScope","$stateParams","$ionicPopup","$location","$ionicLoading","authService","wxService",function($scope,$http,$rootScope,$stateParams,$ionicPopup,$location,$ionicLoading,authService,wxService){$scope.summoney=sessionStorage.getItem("summoney"),$scope.user={radioval:"wx_pub"},$scope.$on("$ionicView.beforeEnter",function(){console.info(sessionStorage.getItem("summoney")),$scope.summoney=sessionStorage.getItem("summoney")}),$scope.wap_pay=function(user){function main(openid,money){var currentUser=authService.getUser(),param={};param.device="wechat",param.channel=user.radioval,param.amount=100*money,param.subject="充值",param.body="充值到钱包",param.open_id=openid,param.current_user_id=currentUser.id,param.metadata={},param.metadata.pay_type="wallet_recharge",param.metadata.user_id=currentUser.id,console.info(param),$ionicLoading.show(),$http.post("http://"+$rootScope.hostName+"/payment_gateway/charge",param).success(function(data){console.log(data),pingpp.createPayment(data,function(result,error){"success"==result?(location.href="#/user/wallet",sessionStorage.setItem("summoney",sessionStorage.getItem("summoney")+user.money),layer.show("充值成功。"),$ionicLoading.hide()):"fail"==result?(layer.show("支付失败，请稍候再试。"),$ionicLoading.hide()):"cancel"==result&&(layer.show("您已取消支付。"),$state.go("user/wallet"),$ionicLoading.hide())})})}wxService.getOpenId()?main(wxService.getOpenId(),user.money):(window.location.replace(wxService.getWxAuthUrl("/wxauthpayment")),main(wxService.getOpenId(),user.money))}}]),lvtuanApp.directive("money",["$filter","$locale",function($filter,$locale){return{restrict:"A",require:"ngModel",link:function(scope,el,attr,ctrl){function formatMoney(){var value=ctrl.$modelValue,groupsep=$locale.NUMBER_FORMATS.GROUP_SEP,re=new RegExp(groupsep,"g");value=String(value).replace(re,"");var currencyFilter=$filter("currency"),value=currencyFilter(value,""),decimalsep=$locale.NUMBER_FORMATS.DECIMAL_SEP;value=value.split(decimalsep)[0],ctrl.$viewValue=value,ctrl.$render()}formatMoney(),scope.$watch(attr.ngModel,function(){formatMoney()})}}}]),lvtuanApp.controller("userrecordCtrl",["$scope","$http","$rootScope","$ionicLoading","listHelper",function($scope,$http,$rootScope,$ionicLoading,listHelper){listHelper.bootstrap("/wallet/record?type=recharge",$scope)}]),lvtuanApp.controller("usermoneyoutCtrl",["$scope","$http","$rootScope",function($scope,$http,$rootScope){
$scope.summoney=sessionStorage.getItem("summoney"),$scope.submit=function(user){$http.post("http://"+$rootScope.hostName+"/wallet/withdraw",user).success(function(data){$scope.items=data.data,console.info($scope.items),sessionStorage.setItem("summoney",$scope.items.money),$scope.summoney=$scope.items.money,layer.show("提交成功！"),$scope.user={},console.info($scope.user)})}}]),lvtuanApp.controller("userwithdrawCtrl",["$scope","$http","$rootScope","listHelper",function($scope,$http,$rootScope,listHelper){listHelper.bootstrap("/wallet/record?type=withdraw",$scope)}]),lvtuanApp.controller("userpayallCtrl",["$scope","$http","$rootScope","$ionicLoading","listHelper",function($scope,$http,$rootScope,$ionicLoading,listHelper){listHelper.bootstrap("/wallet/record",$scope)}]),lvtuanApp.controller("citypickerCtrl",["$http","$location","$scope","$rootScope","$anchorScroll","$ionicHistory","$stateParams","$ionicLoading","$ionicScrollDelegate","locationService",function($http,$location,$scope,$rootScope,$anchorScroll,$ionicHistory,$stateParams,$ionicLoading,$ionicScrollDelegate,locationService){function getCityParm(province){$ionicLoading.show(),$http.get("http://"+$rootScope.hostName+"/area/"+province+"/city").success(function(data){data&&data.data&&data.data.length?$scope.citys=data.data:($scope.items={city_id:angular.toJson($scope.province_city_id,!0),city_name:$scope.province_city_name},locationServices($scope.items)),$ionicLoading.hide()})}function locationServices(obj){var locations=locationService.getLocation();locations.city_id=obj.city_id,locations.city_name=obj.city_name,locationService.saveLocation(locations),"index"==$stateParams.id?(location.href="#/index",location.href="#"+$scope.url):location.href="#/lawyerlist"}$ionicLoading.show(),$http.get("http://"+$rootScope.hostName+"/area/province/letters").success(function(data){$scope.provinces=data.data,$ionicLoading.hide()}),$scope.str=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],$scope["goto"]=function(id){var newHash=id;$location.hash()!==newHash?$location.hash(id):$anchorScroll()},$scope.province_city_id=null,$scope.province_city_name=null,$scope.province=function(val){$scope.province_city_id=val.key,$scope.province_city_name=val.value,$(".citypicker .province,.navbar").hide(),$scope.province=val.key,$(".citypicker .cities").show(),getCityParm($scope.province),$ionicScrollDelegate.$getByHandle("mainScroll").scrollTop()},$scope.citie=function(val){$(".citypicker .province,.citypicker .cities").hide(),$scope.items={city_id:angular.toJson(val.key,!0),city_name:val.value},locationServices($scope.items)},$scope.jump_citypicke_GoBack=function(){$ionicHistory.goBack()}}]),lvtuanApp.controller("citypickeAllCtrl",["$http","$state","$location","$scope","$rootScope","$anchorScroll","$ionicHistory","$stateParams","$ionicLoading","$ionicScrollDelegate","$localStorage",function($http,$state,$location,$scope,$rootScope,$anchorScroll,$ionicHistory,$stateParams,$ionicLoading,$ionicScrollDelegate,$localStorage){function getCityParm(province){$ionicLoading.show(),$http.get("http://"+$rootScope.hostName+"/area/"+province+"/city").success(function(data){data&&data.data&&data.data.length&&($scope.citys=data.data),$ionicLoading.hide()})}function getDistrictsParm(city){$ionicLoading.show(),$http.get("http://"+$rootScope.hostName+"/area/"+city+"/district").success(function(data){data&&data.data&&data.data.length&&($scope.districts=data.data),$ionicLoading.hide()})}$ionicLoading.show(),$http.get("http://"+$rootScope.hostName+"/area/province/letters").success(function(data){$scope.provinces=data.data,$ionicLoading.hide()}),$scope.str=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],$scope["goto"]=function(id){var newHash=id;$location.hash()!==newHash?$location.hash(id):$anchorScroll()},$scope.province=null,$scope.city=null,$scope.district=null,$scope.province=function(province){$scope.province=province,$(".citypicker .province,.navbar").hide(),$(".citypicker .cities").show(),getCityParm($scope.province.key),$ionicScrollDelegate.$getByHandle("mainScroll").scrollTop()},$scope.citie=function(city){$ionicLoading.show(),$scope.city=city,$(".citypicker .province,.citypicker .cities").hide(),$(".citypicker .districts").show(),getDistrictsParm($scope.city.key),$ionicScrollDelegate.$getByHandle("mainScroll").scrollTop()},$scope.district=function(district){$scope.addres={province:$scope.province,city:$scope.city,district:district},$scope.$storage=$localStorage.$default({addres:$scope.addres}),$scope.url=localStorage.getItem("citypicke_goback"),console.info("#"+$scope.url),location.href="#"+$scope.url},$scope.jump_citypicke_GoBack=function(){$ionicHistory.goBack()}}]),$(function(){function infinite(){var htmlWidth=$("html").width();htmlWidth>=1080?$("html").css({"font-size":"42px"}):$("html").css({"font-size":42/1080*htmlWidth+"px"})}$(window).resize(infinite),infinite()}),angular.module("lvtuanApp",["ionic","app","templates","angular-jwt"]).run(["$ionicPlatform",function($ionicPlatform){$ionicPlatform.ready(function(){window.cordova&&window.cordova.plugins.Keyboard&&cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),window.StatusBar&&StatusBar.styleDefault()})}]).run(["$rootScope","$timeout","$location","$ionicLoading",function($rootScope,$timeout,$location,$ionicLoading,$ionicHistory,$window){$rootScope.show=function(){$ionicLoading.show({template:'<ion-spinner icon="circles"></ion-spinner>',noBackdrop:!1})},$rootScope.hide=function(){$ionicLoading.hide()};var hostName=AppSettings.baseApiUrl;localStorage.setItem("hostName",JSON.stringify(hostName)),$rootScope.hostName=JSON.parse(localStorage.getItem("hostName"));var hostPath=AppSettings.baseNewApiUrl;localStorage.setItem("hostPath",JSON.stringify(hostPath)),$rootScope.hostPath=JSON.parse(localStorage.getItem("hostPath")),$rootScope.goHome=function(){layer.goHome()}}]).run(function($rootScope,$location,$state,authService,locationService){$rootScope.$on("$stateChangeStart",function(event,toState,toParams,fromState,fromParams){toState.authn&&(authService.isAuthed()?(currentUser=authService.getUser(),toState.authz&&"lawyer"==toState.authz&&!currentUser.is_verified_lawyer&&($rootScope.$broadcast("unauthorized"),event.preventDefault())):($rootScope.$broadcast("unauthenticated"),event.preventDefault())),$rootScope.path=$location.path()}),$rootScope.$on("unauthorized",function(){console.info("unauthorized"),sessionStorage.setItem("goback",$location.absUrl()),layer.show("您没有权限访问这个链接！"),$location.path("/login"),$state.transitionTo("login")}),$rootScope.$on("unauthenticated",function(){console.info("unauthenticated"),sessionStorage.setItem("goback",$location.absUrl()),layer.show("请先登录！"),$state.transitionTo("login"),localStorage.removeItem("currentUser")})}).config(function($httpProvider,jwtInterceptorProvider){jwtInterceptorProvider.tokenGetter=["jwtHelper","authService","$http","config","$rootScope",function(jwtHelper,authService,$http,config,$rootScope){if(".html"==config.url.substr(config.url.length-5))return null;var token=authService.getToken();return token?jwtHelper.isTokenExpired(token)?(console.info("refreshing the token : "+token),$http({url:"http://"+AppSettings.baseApiUrl+"/refresh_token",skipAuthorization:!0,method:"POST",headers:{Authorization:"bearer "+token}}).then(function(response){console.info("2 response: ",response);var token=response.data.data.token;return authService.saveToken(token),token},function(reason){$rootScope.$broadcast("unauthenticated")})):(console.info("returning the token : "+token),token):void 0}],$httpProvider.interceptors.push("jwtInterceptor"),$httpProvider.interceptors.push("APIInterceptor")}).config(function($stateProvider,$urlRouterProvider){$stateProvider.state("home",{url:"/home",cache:"true",templateUrl:"template/home.html",controller:"ionicNavBarDelegateCtrl"}).state("index",{url:"/index",cache:"true",templateUrl:"template/index_tpl.html",controller:"indexCtrl"}).state("login",{url:"/login",cache:"true",templateUrl:"template/home/login.html"}).state("register",{url:"/register",cache:"true",templateUrl:"template/home/register.html"}).state("resetpwd",{url:"/resetpwd",cache:"true",templateUrl:"template/home/resetpwd.html"}).state("forgotpwd",{url:"/forgotpwd",cache:"true",templateUrl:"template/home/forgotpwd.html"}).state("boundphone",{url:"/boundphone",cache:"true",templateUrl:"template/home/boundphone.html"}).state("wxauth",{url:"/wxauth?code&state",cache:"true",controller:"wxAuthCtrl"}).state("wxcheckopenid",{url:"/wxcheckopenid",cache:"true",controller:"wxCheckOpenIdCtrl"}).state("wxauthpayment",{url:"/wxauthpayment?code&state",cache:"true",controller:"wxAuthPaymentCtrl"}).state("wxlogin",{url:"/wxlogin",cache:"true",controller:"wxLoginCtrl"}).state("group",{url:"/group",cache:"true",templateUrl:"template/group/group.html",controller:"groupCtrl",authn:!0,authz:"lawyer"}).state("group.list",{url:"/list",cache:"true",views:{"group-list":{templateUrl:"template/group/group-list.html",controller:"groupListCtrl"}},authn:!0,authz:"lawyer"}).state("group.televise",{url:"/televise",cache:"true",views:{"group-televise":{templateUrl:"template/group/group-televise.html",controller:"groupTeleviseCtrl"}},authn:!0,authz:"lawyer"}).state("group.attention",{url:"/attention",cache:"true",views:{"group-attention":{templateUrl:"template/group/group-attention.html",controller:"groupAttentionCtrl"}},authn:!0,authz:"lawyer"}).state("group/attention/search",{url:"/group/attention/search",templateUrl:"template/group/attention-search.html",authn:!0,authz:"lawyer"}).state("groupviewinit",{url:"/group/viewinit/:id",controller:"groupviewinitCtrl",authn:!0,authz:"lawyer"}).state("groupview",{url:"/group/view/:id",templateUrl:"template/group/group_view.html",controller:"groupviewCtrl",authn:!0,authz:"lawyer"}).state("broadcast/view",{url:"/broadcast/view/:id",templateUrl:"template/group/broadcast_view.html",controller:"broadcastviewCtrl",authn:!0,authz:"lawyer"}).state("groupcreate",{url:"/groupcreate",templateUrl:"template/group/create.html",controller:"groupcreateCtrl",authn:!0,authz:"lawyer"}).state("televisecreate",{url:"/televisecreate",templateUrl:"template/group/televisecreate.html",controller:"televisecreateCtrl",authn:!0,authz:"lawyer"}).state("group/site",{url:"/group/site/:id",templateUrl:"template/group/group-site.html",controller:"groupsiteCtrl",authn:!0,authz:"lawyer"}).state("group/add",{url:"/group/add/:id",templateUrl:"template/group/group-add.html",authn:!0,authz:"lawyer"}).state("group/del",{url:"/group/del/:id",templateUrl:"template/group/group-del.html",authn:!0,authz:"lawyer"}).state("knowledge",{url:"/knowledge",templateUrl:"template/knowledge/knowledge.html"}).state("knowledge.knowledges",{url:"/knowledges",cache:"true",views:{"knowledge-knowledges":{templateUrl:"template/knowledge/knowledge-knowledges.html",controller:"knowledgesCtrl"}}}).state("knowledge.documents",{url:"/documents",cache:"true",views:{"knowledge-documents":{templateUrl:"template/knowledge/knowledge-documents.html",controller:"documentsCtrl"}}}).state("knowledge.cases",{url:"/cases",cache:"true",views:{"knowledge-cases":{templateUrl:"template/knowledge/knowledge-cases.html",controller:"casesCtrl"}}}).state("knowledgeview",{url:"/knowledgeview/:id",cache:"true",templateUrl:"template/knowledge/knowledges-view.html",controller:"knowledgeViewCtrl"}).state("knowledge/view",{url:"/knowledge/view/:id",cache:"true",templateUrl:"template/knowledge/knowledges-android-view.html",controller:"knowledgeAndroidViewCtrl"}).state("comments/view",{url:"/comments/view/:id",cache:"true",templateUrl:"template/knowledge/comments-view.html",controller:"commentsViewCtrl"}).state("center",{url:"/center",cache:"true",templateUrl:"template/center/center.html",controller:"centerCtrl"}).state("info",{url:"/info/:id",cache:"true",templateUrl:"template/center/info.html",controller:"infoCtrl",authn:!0}).state("becomenav",{url:"/becomenav",cache:"true",templateUrl:"template/center/become/become_nav.html",controller:"becomenavCtrl",authn:!0}).state("practitioners",{url:"/practitioners",cache:"true",templateUrl:"template/center/become/practitioners.html",authn:!0}).state("verified",{url:"/verified",cache:"true",templateUrl:"template/center/become/verified.html",authn:!0}).state("tariffset",{url:"/tariffset",cache:"true",templateUrl:"template/center/become/tariffset.html",authn:!0}).state("field",{url:"/field",cache:"true",templateUrl:"template/center/become/field.html",controller:"fieldCtrl",authn:!0}).state("case",{url:"/case",cache:"true",templateUrl:"template/center/become/case.html",authn:!0}).state("citypicke/all",{url:"/citypicke/all",cache:"true",templateUrl:"template/citypicker-all.html",controller:"citypickeAllCtrl",authn:!0}).state("valrealname",{url:"/valrealname",cache:"true",templateUrl:"template/center/become/valrealname.html",controller:"valrealnameCtrl",authn:!0}).state("valphone",{url:"/valphone",cache:"true",templateUrl:"template/center/become/valphone.html",controller:"valphoneCtrl",authn:!0}).state("valemail",{url:"/valemail",cache:"true",templateUrl:"template/center/become/valemail.html",controller:"valemailCtrl",authn:!0}).state("comment",{url:"/comment",cache:"true",templateUrl:"template/center/comment.html",controller:"commentCtrl",authn:!0}).state("followed",{url:"/followed",cache:"true",templateUrl:"template/center/followed.html",controller:"followedCtrl",authn:!0}).state("about",{url:"/about",cache:"true",templateUrl:"template/center/about.html",controller:"aboutCtrl",authn:!1}).state("applicationsintro",{url:"/applicationsintro",cache:"true",templateUrl:"template/center/applicationsintro.html",authn:!1}).state("userpact",{url:"/userpact",cache:"true",templateUrl:"template/center/userpact.html",controller:"userpactCtrl",authn:!1}).state("site",{url:"/site",cache:"true",templateUrl:"template/center/site.html",controller:"siteCtrl",authn:!0}).state("collect",{url:"/collect",cache:"true",templateUrl:"template/center/collect.html",controller:"collectCtrl",authn:!0}).state("messages",{url:"/messages",cache:"true",templateUrl:"template/center/messages.html",controller:"messagesCtrl",authn:!0}).state("messages.mymesg",{url:"/mymesg",cache:"true",views:{"messages-mymesg":{templateUrl:"template/center/mymesg.html",controller:"mymesgCtrl"}},authn:!0}).state("messages.sysmesg",{url:"/sysmesg",cache:"true",views:{"messages-sysmesg":{templateUrl:"template/center/sysmesg.html",controller:"sysmesgCtrl"}},authn:!0}).state("message_details",{url:"/message/:id",cache:"true",templateUrl:"template/center/message_view.html",controller:"viewMessageCtrl",authn:!0}).state("one-questions",{url:"/one-questions",cache:"true",templateUrl:"template/lawyer/one_questions.html",controller:"lawyerOneQuestionsCtrl"}).state("all-evaluate",{url:"/all-evaluate",cache:"true",templateUrl:"template/lawyer/all_evaluate.html",controller:"lawyerAllEvaluateCtrl"}).state("lawyer-all-evaluate",{url:"/lawyer-all-evaluate/:id",cache:"true",templateUrl:"template/lawyer/lawyer_all_evaluate.html",controller:"lawyerOneAllEvaluateCtrl"}).state("lawyer/list",{url:"/lawyer/list/:type",cache:"true",templateUrl:"template/lawyer/lawyer_list.html",controller:"lawyerlistCtrl"}).state("lawyer-list/search",{url:"/lawyer-list/search/:type",cache:"true",templateUrl:"template/lawyer/lawyer_list_search.html"}).state("lawyer/view",{url:"/lawyer/view/:id",cache:"true",templateUrl:"template/lawyer/view.html",controller:"lawyerViewCtrl"}).state("graphic",{url:"/graphic/:type?id",cache:"true",templateUrl:"template/lawyer/graphic.html"}).state("lawyer/article",{url:"/lawyer/article",templateUrl:"template/lawyer/article.html"}).state("lawyer/article.like",{url:"/like",views:{"article-like-most":{templateUrl:"template/lawyer/article_like_most.html",controller:"lawyerArticleLikeMostCtrl"}}}).state("lawyer/article.lately",{url:"/lately",views:{"article-lately-editing":{templateUrl:"template/lawyer/article_lately_editing.html",controller:"lawyerArticleLatelyEditingCtrl"}}}).state("questions",{url:"/questions",cache:"false",templateUrl:"template/questions/questions.html",authn:!1}).state("questionslist",{url:"/questionslist",templateUrl:"template/questions/questions_list.html",controller:"questionslistCtrl",authn:!1}).state("question/list/search",{cache:"true",url:"/question/list/search",templateUrl:"template/questions/questions_list_search.html",authn:!1}).state("questionsview",{cache:"true",url:"/questionsview/:id",templateUrl:"template/questions/view.html",controller:"questionsviewsCtrl",authn:!1}).state("questions/comment",{cache:"true",url:"/questions/comment/:id",templateUrl:"template/questions/comment.html",authn:!1}).state("questions/areward",{url:"/questions/areward/:id",templateUrl:"template/questions/areward.html",controller:"questionsArewardCtrl",authn:!0}).state("questions/order/pay",{url:"/questions/order/pay/:id",templateUrl:"template/questions/order_pay.html",controller:"questionsOrderPpayCtrl",authn:!0}).state("questions/areward/pay",{url:"/questions/areward/pay/:id?lawyer_id",templateUrl:"template/questions/areward_pay.html",controller:"questionsArewardPayCtrl",authn:!0}).state("easemobmain",{url:"/easemobmain/:id",templateUrl:"template/mylvtuan/easemobmain.html",controller:"easemobmainCtrl",authn:!0}).state("easemobinit",{url:"/easemobinit/:id",controller:"easemobinitCtrl",authn:!0}).state("userlvtuan",{url:"/userlvtuan",templateUrl:"template/mylvtuan/user/userlvtuan.html",controller:"userlvtuanCtrl",authn:!0}).state("user/question/list",{url:"/user/question/list",templateUrl:"template/mylvtuan/user/question_list.html",controller:"userQuestionListCtrl",authn:!0}).state("user/order/list",{url:"/user/order/list",templateUrl:"template/mylvtuan/user/order_list.html",controller:"userOrderListCtrl",authn:!0}).state("user/order/view",{url:"/user/order/view/:id",templateUrl:"template/mylvtuan/user/order_view.html",controller:"userOrderViewCtrl",authn:!0}).state("easemob/view",{url:"/easemob/view/:id",templateUrl:"template/mylvtuan/user/easemob_view.html",controller:"userEasemobViewCtrl",authn:!0}).state("confirmCompletion",{url:"/confirmCompletion/:id",templateUrl:"template/mylvtuan/user/confirm-completion.html",authn:!0}).state("lawyer/question",{url:"/lawyer/question",templateUrl:"template/mylvtuan/lawyer/question.html",authn:!0}).state("lawyer/question.not",{url:"/not",views:{"lawyer-question-not":{templateUrl:"template/mylvtuan/lawyer/not.html",controller:"lawyerQuestionNotCtrl"}},authn:!0}).state("lawyer/question.already",{url:"/already",views:{"lawyer-question-already":{templateUrl:"template/mylvtuan/lawyer/already.html",controller:"lawyerQuestionAlreadyCtrl"}},authn:!0}).state("lawyer/order/list",{url:"/lawyer/order/list",templateUrl:"template/mylvtuan/lawyer/order_list.html",controller:"lawyerOrderListCtrl",authn:!0}).state("lawyer/order/view",{url:"/lawyer/order/view/:id",templateUrl:"template/mylvtuan/lawyer/order_view.html",controller:"lawyerOrderViewCtrl",authn:!0}).state("/lawyer/comment/",{url:"/lawyer/comment/:id",templateUrl:"template/mylvtuan/lawyer/comment.html",controller:"lawyerCommentCtrl",authn:!0}).state("question/paycompany",{url:"/question/paycompany",templateUrl:"template/mylvtuan/question/paycompany/question.html",authn:!0}).state("question/paycompany.new",{url:"/new",views:{"question-paycompany-new":{templateUrl:"template/mylvtuan/question/paycompany/new.html",controller:"questionPaycompanyNewCtrl"}},authn:!0}).state("question/paycompany.waitforconfirmation",{url:"/waitforconfirmation",views:{"question-paycompany-waitforconfirmation":{templateUrl:"template/mylvtuan/question/paycompany/waitforconfirmation.html",controller:"questionPaycompanyWaitforconfirmationCtrl"}},authn:!0}).state("question/paycompany.waitforevaluation",{url:"/waitforevaluation",views:{"question-paycompany-waitforevaluation":{templateUrl:"template/mylvtuan/question/paycompany/waitforevaluation.html",controller:"questionPaycompanyWaitforevaluationCtrl"}},authn:!0}).state("question/paycompany.complete",{url:"/complete",views:{"question-paycompany-complete":{templateUrl:"template/mylvtuan/question/paycompany/complete.html",controller:"questionPaycompanyCompleteCtrl"}},authn:!0}).state("question/paycompany.cancelled",{url:"/cancelled",views:{"question-paycompany-cancelled":{templateUrl:"template/mylvtuan/question/paycompany/cancelled.html",controller:"questionPaycompanyCancelledCtrl"}},authn:!0}).state("question/pay_company/view",{url:"/question/pay_company/view/:id",templateUrl:"template/mylvtuan/question/paycompany/view.html",controller:"questionPaycompanyViewCtrl",authn:!0}).state("commodity",{url:"/commodity",templateUrl:"template/mylvtuan/commodity/commodity.html",controller:"commodityListCtrl",authn:!0}).state("wallet",{url:"/wallet",templateUrl:"template/mylvtuan/wallet/wallet.html",controller:"userwalletCtrl",authn:!0}).state("moneyin",{url:"/pay/moneyin",templateUrl:"template/mylvtuan/wallet/moneyin.html",controller:"usermoneyinCtrl",authn:!0}).state("moneyout",{url:"/pay/moneyout",templateUrl:"template/mylvtuan/wallet/moneyout.html",authn:!0}).state("lawlecture",{url:"/lawlecture",templateUrl:"template/lecture/lawlecture.html",controller:"lawlectureCtrl"}).state("casescomm",{url:"/casescomm",templateUrl:"template/casescomm.html",controller:"casescommCtrl"}).state("lvtuanalliance",{url:"/lvtuanalliance",templateUrl:"template/lvtuanalliance.html",controller:"lvtuanallianceCtrl"}).state("lvtuanallianceview",{url:"/lvtuanallianceview/:id",templateUrl:"template/lvtuanalliance_view.html",controller:"lvtuanallianceviewCtrl"}).state("talent",{url:"/talent",templateUrl:"template/talent.html",controller:"talentCtrl"}).state("talentview",{url:"/talentview/:id",templateUrl:"template/talentview.html",controller:"talentviewCtrl"}).state("document/list",{url:"/document/list",templateUrl:"template/document/list.html",controller:"documentlistCtrl"}).state("document/download_list",{url:"/document/download_list/:id",templateUrl:"template/document/download_list.html",controller:"documentownloadlistCtrl"}).state("document/list/search",{url:"/document/list/search",templateUrl:"template/document/download_list_search.html"}).state("corporate",{url:"/corporate",templateUrl:"template/corporate/corporateservices.html",controller:"corporateservicesCtrl"}).state("corporate/list",{url:"/corporate/list/:id",templateUrl:"template/corporate/list.html",controller:"corporatelistCtrl"}).state("corporate/buynow",{url:"/corporate/buynow/:id",templateUrl:"template/corporate/buynow.html",authn:!0}).state("pay",{url:"/pay/:id?type",templateUrl:"template/pay.html",authn:!0}).state("citypicker",{url:"/citypicker/:id",templateUrl:"template/citypicker.html",controller:"citypickerCtrl"}).state("error",{url:"/error",templateUrl:"template/error.html"}),$urlRouterProvider.otherwise("/index")});var authModule=angular.module("authModule",[]);authModule.constant("HOST",AppSettings.baseApiUrl).service("userService",userService).service("authService",authService);var easemobModule=angular.module("easemobModule",["ionic"]);easemobModule.service("easemobService",easemobService);var httpModule=angular.module("httpModule",["authModule"]);httpModule.factory("httpWrapper",["$http","$rootScope",function($http,$rootScope){var httpRequest={};return httpRequest.get=function(url,successCallback){$http.get(url,{cache:!0,headers:{"Content-Type":"application/json"}}).success(successCallback?successCallback:function(data){}).error(function(data,status){layer.msg(status),console.info(JSON.stringify(data))})},httpRequest.request=function(url,method,data,successCallback,failureCallback){$http({method:method,url:url,data:data,cache:!0,headers:{"Content-Type":"application/json"}}).then(successCallback?successCallback:function(response){},failureCallback?failureCallback:function(response){console.info(JSON.stringify(response.data)),console.info(JSON.stringify(response.status))})},httpRequest}]),httpModule.factory("APIInterceptor",["$log","$q","$rootScope","authService","HOST",function($log,$q,$rootScope,authService,HOST){$log.debug("$log is here to show you that this is a regular factory with injection");var myInterceptor={request:function(config){if(config.url.indexOf(HOST)>-1){if(config.headers.Accept="application/json",config.cache=!0,config.url.indexOf(HOST+"/center/question/insert/question")>-1)return config;if(config.url.indexOf(HOST+"/center")>-1||config.url.indexOf(HOST+"/group")>-1||config.url.indexOf(HOST+"/microblog")>-1){var canceller=$q.defer();authService.isAuthed()?(config.url.indexOf(HOST+"/group")>-1||config.url.indexOf(HOST+"/microblog")>-1)&&(user=authService.getUser(),user.is_verified_lawyer||$rootScope.$broadcast("unauthorized")):($rootScope.$broadcast("unauthenticated"),config.timeout=canceller.promise,canceller.resolve())}}return config},requestError:function(rejection){return canRecover(rejection)?responseOrNewPromise:$q.reject(rejection)},response:function(response){return response.config.url.indexOf(HOST)>-1&&$rootScope.hide(),response},responseError:function(response){switch(console.info(response),response.status){case 0:break;case 401:$rootScope.$broadcast("unauthenticated");break;case 403:$rootScope.$broadcast("unauthorized");break;case 400:"object"==typeof response.data.error_messages?angular.forEach(response.data.error_messages,function(val,key){angular.isArray(val)?layer.show(val.join(", ")):layer.show(val)}):layer.show(response.data.error_messages);break;case 405:layer.show("提交数据的方法错误");break;case 503:case 500:layer.show("暂时无法处理您的请求，请稍后再试。")}return $rootScope.hide(),$q.reject(response)}};return myInterceptor}]),httpModule.constant("HOST",AppSettings.baseApiUrl);var listModule=angular.module("listModule",["ionic","ngSanitize","ngFileUpload","httpModule"]);listModule.factory("listHelper",["$http","$rootScope","httpWrapper",function($http,$rootScope,httpWrapper){var listHelper={};return listHelper.bootstrap=function(url,$scope){var page=1,rows_per_page=10;$scope.moredata=!0,$scope.url=url,$scope.rows_per_page&&(rows_per_page=$scope.rows_per_page),$scope.items=[],$scope.doRefresh=function(){page=1,$scope.items=[],$scope.loadMore(),$scope.$broadcast("scroll.refreshComplete")},$scope.loadMore=function(){var timestamp=Math.round((new Date).getTime()/1e3);console.info($scope.url);var urls=$scope.url.split("?"),params="rows_per_page="+rows_per_page+"&page="+page+"&ts="+timestamp;2==urls.length&&(url=urls[0],params=urls[1]+"&"+params),console.info("http://"+$rootScope.hostName+url+"?"+params),httpWrapper.get("http://"+$rootScope.hostName+url+"?"+params,function(data){data&&data.data&&data.data.length?($scope.items=$scope.items.concat(data.data),console.info($scope.items),data.data.length<rows_per_page?$scope.moredata=!1:$scope.moredata=!0):(1==page&&($scope.moredata=!1,$scope.nodata=!1),$scope.moredata=!1),page++,$scope.$broadcast("scroll.infiniteScrollComplete")})}},listHelper}]),listModule.factory("listHelper_hostPath",["$http","$rootScope","httpWrapper",function($http,$rootScope,httpWrapper){var listHelper_hostPath={};return listHelper_hostPath.bootstrap=function(url,$scope){var page=1,size=10;$scope.moredata=!0,$scope.url=url,$scope.size&&(size=$scope.size),$scope.items=[],$scope.doRefresh=function(){page=1,$scope.items=[],$scope.loadMore(),$scope.$broadcast("scroll.refreshComplete")},$scope.loadMore=function(){var timestamp=Math.round((new Date).getTime()/1e3);console.info($scope.url);var urls=$scope.url.split("?"),params="size="+size+"&page="+page+"&ts="+timestamp;2==urls.length&&(url=urls[0],params=urls[1]+"&"+params),console.info("http://"+$rootScope.hostPath+url+"?"+params),httpWrapper.get("http://"+$rootScope.hostPath+url+"?"+params,function(data){data&&data.data&&data.data.length?($scope.items=$scope.items.concat(data.data),console.info($scope.items),data.data.length<size?$scope.moredata=!1:$scope.moredata=!0):(1==page&&($=!1,$scope.nodata=!1),$scope.moredata=!1),page++,$scope.$broadcast("scroll.infiniteScrollComplete")})}},listHelper_hostPath}]);var locationModule=angular.module("locationModule",[]);locationModule.constant("HOST",AppSettings.baseApiUrl).service("locationService",locationService);var wxModule=angular.module("wxModule",[]);wxModule.service("wxService",wxService);var layer=function(){function strUnicode2Ansi(asContents){for(var len1=asContents.length,temp="",i=0;len1>i;i++){var varasc=asContents.charCodeAt(i);if(0>varasc&&(varasc+=65536),varasc>127&&(varasc=UnicodeToAnsi(varasc)),varasc>255){var varlow=65280&varasc;varlow>>=8;var varhigh=255&varasc;temp+=String.fromCharCode(varlow)+String.fromCharCode(varhigh)}else temp+=String.fromCharCode(varasc)}return temp}return this.show=function(data){if(angular.isObject(data)&&(data=msg(data)),!angular.isUndefined($("#hintShow").html()))return!1;var div=$("<div id='hintShow' style='width:100%;text-align:center;padding:12px 0px;background:#ff2f5f;opacity:1;color:#fff;position: fixed;top:0;left:0;display:none;z-index:9999;'>"+data+"</div>");div.appendTo($("body")).fadeIn("slow"),time=setInterval(function(){clearInterval(time),div.fadeOut("slow",function(){div.remove()})},2500),$("#hintShow").bind("click",function(){div.remove()})},this.getUrlParam=function(name){var reg=new RegExp("(^|&)"+name+"=([^&]*)(&|$)"),r=window.location.search.substr(1).match(reg);return null!=r?decodeURI(r[2]):null},this.getParameters=function(locationUrl){var str,url=decodeURI(locationUrl),obj=new Object,index=url.lastIndexOf("?");if(-1!=index)if(url=url.slice(index+1,url.length),-1!=url.indexOf("&")){str=url.split("&");for(var i=0;i<str.length;i++){var str1=str[i].split("=");2==str1.length&&""!=str1[0]&&(obj[str1[0]]=str1[1])}}else str=url.split("="),2==str.length&&""!=str[0]&&(obj[str[0]]=str[1]);return obj},this.getParams=function(form){var params={};return $(form).find("input").each(function(obj){if("disabled"==$(this).attr("disabled"))return!0;if("disabled"==$(this).attr("data-disabled"))return!0;var name="",value="";return"radio"==$(this).attr("type")?(name=$(this).attr("name"),value=$(':radio[name="'+name+'"]:checked').val(),params[name]=value,!0):(name=$(this).attr("name"),value=$.trim($(this).val()),void(name&&(params[name]=value)))}),$(form).find("select").each(function(obj){if("disabled"==$(this).attr("disabled"))return!1;if("disabled"==$(this).attr("data-disabled"))return!0;if(""==$(this).val())return!0;var name=$(this).attr("name"),value=$(this).val();params[name]=value}),$(form).find("textarea").each(function(obj){if("disabled"==$.trim($(this).attr("data-disabled")))return!0;var name=$(this).attr("name"),value=$.trim($(this).val());params[name]=value}),params},this.stopDefault=function(e){return e&&e.preventDefault?e.preventDefault():window.event.returnValue=!1,!1},this.base64code=function(input){var keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";input=strUnicode2Ansi(input);var chr1,chr2,enc1,enc2,enc3,output="",chr3="",enc4="",i=0;do chr1=input.charCodeAt(i++),chr2=input.charCodeAt(i++),chr3=input.charCodeAt(i++),enc1=chr1>>2,enc2=(3&chr1)<<4|chr2>>4,enc3=(15&chr2)<<2|chr3>>6,enc4=63&chr3,isNaN(chr2)?enc3=enc4=64:isNaN(chr3)&&(enc4=64),output=output+keyStr.charAt(enc1)+keyStr.charAt(enc2)+keyStr.charAt(enc3)+keyStr.charAt(enc4),chr1=chr2=chr3="",enc1=enc2=enc3=enc4="";while(i<input.length);return output},this.goBack=function(){window.history.back(),window.location.reload()},this.refresh=function(){window.location.reload()},this.msg=function(data){if(angular.isUndefined(data))return"服务器故障，请与管理员联系!";var _msg="";switch(data){case 401:_msg="账号过期，请重新登录。";break;default:_msg="错误代码: "+data}return layer.show(_msg)},this}();!function(){function form_submit(url,method,params){var form=document.createElement("form");form.setAttribute("method",method),form.setAttribute("action",url);for(var key in params)if(hasOwn.call(params,key)){var hiddenField=document.createElement("input");hiddenField.setAttribute("type","hidden"),hiddenField.setAttribute("name",key),
hiddenField.setAttribute("value",params[key]),form.appendChild(hiddenField)}document.body.appendChild(form),form.submit()}function stringify_data(data,channel,urlencode){"undefined"==typeof urlencode&&(urlencode=!1);var output=[];for(var i in data)("bfb_wap"!=channel||"url"!=i)&&("yeepay_wap"!=channel||"mode"!=i)&&output.push(i+"="+(urlencode?encodeURIComponent(data[i]):data[i]));return output.join("&")}var version="2.0.7",hasOwn={}.hasOwnProperty,PingppSDK=function(){},cfg={PINGPP_NOTIFY_URL:"https://api.pingxx.com/notify/charges/",UPACP_WAP_URL:"https://gateway.95516.com/gateway/api/frontTransReq.do",ALIPAY_WAP_URL:"http://wappaygw.alipay.com/service/rest.htm",UPMP_WAP_URL:"uppay://uppayservice/?style=token&paydata=",JDPAY_WAP_URL:"https://m.jdpay.com/wepay/web/pay",YEEPAY_WAP_URL:"https://ok.yeepay.com/paymobile/api/pay/request",YEEPAY_WAP_TEST_URL:"http://mobiletest.yeepay.com/paymobile/api/pay/request",PINGPP_MOCK_URL:"http://sissi.pingxx.com/mock.php"},channels={alipay_wap:"alipay_wap",upmp_wap:"upmp_wap",upacp_wap:"upacp_wap",bfb_wap:"bfb_wap",wx_pub:"wx_pub",yeepay_wap:"yeepay_wap",jdpay_wap:"jdpay_wap"};PingppSDK.prototype={version:version,_resultCallback:void 0,_jsApiParameters:{},_debug:!1,_signature:void 0,createPayment:function(charge_json,callback,signature,debug){"function"==typeof callback&&(this._resultCallback=callback),"undefined"!=typeof signature&&(this._signature=signature),"boolean"==typeof debug&&(this._debug=debug);var charge;if("string"==typeof charge_json)try{charge=JSON.parse(charge_json)}catch(err){return void this._innerCallback("fail",this._error("json_decode_fail"))}else charge=charge_json;if("undefined"==typeof charge)return void this._innerCallback("fail",this._error("json_decode_fail"));if(!hasOwn.call(charge,"id"))return void this._innerCallback("fail",this._error("invalid_charge","no_charge_id"));if(!hasOwn.call(charge,"channel"))return void this._innerCallback("fail",this._error("invalid_charge","no_channel"));var channel=charge.channel;if(!hasOwn.call(charge,"credential"))return void this._innerCallback("fail",this._error("invalid_charge","no_credential"));if(!charge.credential)return void this._innerCallback("fail",this._error("invalid_credential","credential_is_undefined"));if(!hasOwn.call(channels,channel))return void this._innerCallback("fail",this._error("invalid_charge","no_such_channel:"+channel));if(!hasOwn.call(charge.credential,channel))return void this._innerCallback("fail",this._error("invalid_credential","no_valid_channel_credential"));if(!hasOwn.call(charge,"livemode"))return void this._innerCallback("fail",this._error("invalid_charge","no_livemode"));if(0==charge.livemode)return void this._testModeNotify(charge);var credential=charge.credential[channel];if(channel==channels.upmp_wap)location.href=cfg.UPMP_WAP_URL+credential.paydata;else if(channel==channels.upacp_wap)form_submit(cfg.UPACP_WAP_URL,"post",credential);else if(channel==channels.alipay_wap)if(credential._input_charset="utf-8","undefined"!=typeof _AP){var query=stringify_data(credential,channel,!0);_AP.pay(cfg.ALIPAY_WAP_URL+"?"+query)}else form_submit(cfg.ALIPAY_WAP_URL,"get",credential);else if(channel==channels.bfb_wap){if(!hasOwn.call(credential,"url"))return void this._innerCallback("fail",this._error("invalid_credential","missing_field:url"));location.href=credential.url+"?"+stringify_data(credential,channel)}else if(channel==channels.yeepay_wap){for(var fields=["merchantaccount","encryptkey","data"],k=0;k<fields.length;k++)if(!hasOwn.call(credential,fields[k]))return void this._innerCallback("fail",this._error("invalid_credential","missing_field_"+fields[k]));hasOwn.call(credential,"mode")&&"test"==credential.mode?location.href=cfg.YEEPAY_WAP_TEST_URL+"?"+stringify_data(credential,channel,!0):location.href=cfg.YEEPAY_WAP_URL+"?"+stringify_data(credential,channel,!0)}else if(channel==channels.wx_pub){for(var fields=["appId","timeStamp","nonceStr","package","signType","paySign"],k=0;k<fields.length;k++)if(!hasOwn.call(credential,fields[k]))return void this._innerCallback("fail",this._error("invalid_credential","missing_field_"+fields[k]));this._jsApiParameters=credential,this._callpay()}else channel==channels.jdpay_wap&&form_submit(cfg.JDPAY_WAP_URL,"post",credential)},_jsApiCall:function(){var self=this;self._jsApiParameters!={}&&WeixinJSBridge.invoke("getBrandWCPayRequest",self._jsApiParameters,function(res){"get_brand_wcpay_request:ok"==res.err_msg?self._innerCallback("success"):"get_brand_wcpay_request:cancel"==res.err_msg?self._innerCallback("cancel"):self._innerCallback("fail",self._error("wx_result_fail",res.err_msg))})},_callpay:function(){function eventCallback(){self._jsApiCall()}var self=this;if("undefined"!=typeof wx&&"undefined"!=typeof self._signature){var wxConfigFailed=!1;wx.config({debug:self._debug,appId:self._jsApiParameters.appId,timestamp:self._jsApiParameters.timeStamp,nonceStr:self._jsApiParameters.nonceStr,signature:self._signature,jsApiList:["chooseWXPay"]}),wx.ready(function(){wxConfigFailed||wx.chooseWXPay({timestamp:self._jsApiParameters.timeStamp,nonceStr:self._jsApiParameters.nonceStr,"package":self._jsApiParameters["package"],signType:self._jsApiParameters.signType,paySign:self._jsApiParameters.paySign,success:function(res){"chooseWXPay:ok"==res.errMsg?self._innerCallback("success"):self._innerCallback("fail",self._error("wx_result_fail",res.errMsg))},cancel:function(res){self._innerCallback("cancel")},fail:function(res){self._innerCallback("fail",self._error("wx_result_fail",res.errMsg))}})}),wx.error(function(res){wxConfigFailed=!0,self._innerCallback("fail",self._error("wx_config_error",res.errMsg))})}else"undefined"==typeof WeixinJSBridge?document.addEventListener?document.addEventListener("WeixinJSBridgeReady",eventCallback,!1):document.attachEvent&&(document.attachEvent("WeixinJSBridgeReady",eventCallback),document.attachEvent("onWeixinJSBridgeReady",eventCallback)):this._jsApiCall()},_error:function(msg,extra){return msg="undefined"==typeof msg?"":msg,extra="undefined"==typeof extra?"":extra,{msg:msg,extra:extra}},_innerCallback:function(result,err){"function"==typeof this._resultCallback&&("undefined"==typeof err&&(err=this._error()),this._resultCallback(result,err))},_testModeNotify:function(charge){var self=this;if(charge.channel==channels.wx_pub){var dopay=confirm("模拟付款？");if(dopay){var request=new XMLHttpRequest;request.open("GET",cfg.PINGPP_NOTIFY_URL+charge.id+"?livemode=false",!0),request.onload=function(){if(request.status>=200&&request.status<400&&"success"==request.responseText)self._innerCallback("success");else{var extra="http_code:"+request.status+";response:"+request.responseText;self._innerCallback("fail",self._error("testmode_notify_fail",extra))}},request.onerror=function(){self._innerCallback("fail",self._error("network_err"))},request.send()}else self._innerCallback("cancel")}else{var params={ch_id:charge.id,scheme:"http",channel:charge.channel};hasOwn.call(charge,"order_no")?params.order_no=charge.order_no:hasOwn.call(charge,"orderNo")&&(params.order_no=charge.orderNo),hasOwn.call(charge,"time_expire")?params.time_expire=charge.time_expire:hasOwn.call(charge,"timeExpire")&&(params.time_expire=charge.timeExpire),hasOwn.call(charge,"extra")&&(params.extra=encodeURIComponent(JSON.stringify(charge.extra))),location.href=cfg.PINGPP_MOCK_URL+"?"+stringify_data(params)}}},PingppSDK.prototype.payment=PingppSDK.prototype.createPayment,window.pingpp=new PingppSDK,window.PINGPP_PAY_SDK=window.PINGPP_WX_PUB=window.pingpp}();