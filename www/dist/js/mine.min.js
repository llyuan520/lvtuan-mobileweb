function authService($window){var self=this;self.parseJwt=function(token){var base64Url=token.split(".")[1],base64=base64Url.replace("-","+").replace("_","/");return JSON.parse($window.atob(base64))},self.saveToken=function(token){localStorage.setItem("jwtToken",token)},self.getToken=function(){return localStorage.getItem("jwtToken")},self.saveUser=function(user){2==user.user_group_id&&1==user.is_verified?user.is_verified_lawyer=!0:user.is_verified_lawyer=!1,localStorage.setItem("currentUser",JSON.stringify(user))},self.getUser=function(){return JSON.parse(localStorage.getItem("currentUser"))},self.isAuthed=function(){var token=self.getToken(),user=self.getUser();if(token&&user){var params=self.parseJwt(token);return Math.round((new Date).getTime()/1e3)<=params.exp}return!1},self.logout=function(){localStorage.removeItem("jwtToken"),localStorage.removeItem("currentUser"),sessionStorage.removeItem("goback")}}function userService($http,HOST,authService,wxService,$ionicLoading){var self=this;self.register=function(username,password,phonecode,account_type){return $http.post("http://"+HOST+"/register",{username:username,password:password,phonecode:phonecode,account_type:account_type}).then(function(res){layer.show("注册成功！"),$scope.user={},$scope.params={};var user=res.data?res.data.data:null;user&&(authService.saveUser(user),console.log("user:",user));var token=res.data?res.data.token:null;token&&(authService.saveToken(token),console.log("token:",token)),location.href="#/index"})["catch"](function(response){if(400===response.status){var errMsg=JSON.stringify(data.error_messages.username);layer.show(errMsg),layer.show("注册失败，请重新登录。")}})},self.login=function(username,password){return $ionicLoading.show(),$http.post("http://"+HOST+"/login",{username:username,password:password}).then(function(res){var user=res.data?res.data.data:null;user&&(authService.saveUser(user),console.log("user:",user));var token=res.data?res.data.token:null;token&&(authService.saveToken(token),console.log("token:",token)),$ionicLoading.hide();var goback=sessionStorage.getItem("goback");location.href="#"+goback,sessionStorage.removeItem("goback")})["catch"](function(response){400===response.status&&layer.show("登录失败，账号或密码错误，请重新登录。")})},self.loginWithWx=function(code,state){return $ionicLoading.show(),$http.post("http://"+HOST+"/loginWithWx",{code:code,state:state}).then(function(res){var user=res.data?res.data.data:null;wxService.saveOpenId(user.wx_openid),user&&(authService.saveUser(user),console.log("user:",user));var token=res.data?res.data.token:null;token&&(authService.saveToken(token),console.log("token:",token)),$ionicLoading.hide();var goback=sessionStorage.getItem("goback");location.href="#"+goback,sessionStorage.removeItem(goback)})["catch"](function(response){console.error("Gists error",response.status,response.data),400===response.status&&layer.show("登录失败，账号或密码错误，请重新登录。")})}}function easemobService($ionicLoading){var conn,self=this,textSending=!1,talkInputId="talkInputId",curUserId=null,curChatUserId=null,msgCardDivId="chat01",groupFlagMark="group--";self.msgType=null,self.init=function(userId,msgType){curChatUserId=userId.toString(),self.handleConfig(),self.msgType=msgType,conn=new Easemob.im.Connection,conn.init({https:AppSettings.easemobHttps,url:AppSettings.easemobXmppURL,onOpened:function(){self.handleOpen(conn)},onClosed:function(){self.handleClosed()},onTextMessage:function(message){console.info("onTextMessage"),self.handleTextMessage(message)},onError:function(message){conn.stopHeartBeat(conn)}})},self.handleConfig=function(){Easemob.im.Helper.getIEVersion()<10&&(AppSettings.easemobHttps="https:"==location.protocol?!0:!1,AppSettings.easemobHttps?(0!=AppSettings.easemobXmppURL.indexOf("https")&&(AppSettings.easemobXmppURL=AppSettings.easemobXmppURL.replace(/^http/,"https")),0!=AppSettings.easemobApiURL.indexOf("https")&&(AppSettings.easemobApiURL=AppSettings.easemobApiURL.replace(/^http/,"https"))):(0==AppSettings.easemobXmppURL.indexOf("https")&&(AppSettings.easemobXmppURL=AppSettings.easemobXmppURL.replace(/^https/,"http")),0==AppSettings.easemobApiURL.indexOf("https")&&(AppSettings.easemobApiURL=AppSettings.easemobApiURL.replace(/^https/,"http"))))},self.login=function(user,pwd){conn.isOpened()||($ionicLoading.show(),conn.open({apiUrl:AppSettings.easemobApiURL,user:user,pwd:pwd,appKey:AppSettings.easemobAppKey}))},self.handleOpen=function(conn){curUserId=conn.context.userId,conn.setPresence(),conn.getRoster({success:function(roster){self.showChatUI(),$ionicLoading.hide()}}),conn.isOpened()&&conn.heartBeat(conn)},self.handleClosed=function(){curUserId=null,curChatUserId=null,curRoomId=null,bothRoster=[],toRoster=[];for(var i=0,l=audioDom.length;l>i;i++)audioDom[i].jPlayer&&audioDom[i].jPlayer("destroy");clearContactUI("contactlistUL","contactgrouplistUL","momogrouplistUL",msgCardDivId),groupQuering=!1,textSending=!1},self.handleTextMessage=function(message){console.info(message,self.msgType);var from=message.from,mestype=message.type,messageContent=message.data;if(self.msgType==mestype){message.to;if(from!=curUserId)if("groupchat"==mestype){messageContent.replace(/\n/g,"<br>");self.appendMsg(message.from,message.to,messageContent,mestype,message.ext.realname,message.ext.avatar)}else self.appendMsg(message.from,message.from,messageContent,mestype,message.ext.realname,message.ext.avatar)}},self.setCurrentContact=function(defaultUserId){self.showContactChatDiv(defaultUserId),curChatUserId=defaultUserId},self.getContactChatDiv=function(chatUserId){return document.getElementById(curUserId+"-"+chatUserId)},self.createContactChatDiv=function(chatUserId){var msgContentDivId=curUserId+"-"+chatUserId,newContent=document.createElement("div");return $(newContent).attr({id:msgContentDivId,"class":"chat01_content",className:"chat01_content",style:"display:block"}),$("#null-nouser").css({display:"none"}),newContent},self.showContactChatDiv=function(chatUserId){var contentDiv=self.getContactChatDiv(chatUserId);null==contentDiv&&(contentDiv=self.createContactChatDiv(chatUserId),document.getElementById(msgCardDivId).appendChild(contentDiv)),contentDiv.style.display="block";var contactLi=document.getElementById(chatUserId);if(null!=contactLi){contactLi.style.backgroundColor="#33CCFF";var dispalyTitle=null;chatUserId.indexOf(groupFlagMark)>=0?(dispalyTitle="群组"+$(contactLi).attr("displayname")+"聊天中",curRoomId=$(contactLi).attr("roomid"),$("#roomMemberImg").css("display","block")):(dispalyTitle="与"+chatUserId+"聊天中",$("#roomMemberImg").css("display","none")),document.getElementById(talkToDivId).children[0].innerHTML=dispalyTitle}},self.clearContactUI=function(contactlistUL,contactgrouplistUL,momogrouplistUL,contactChatDiv){$("#contactlistUL").empty(),$("#contactgrouplistUL").empty(),$("#momogrouplistUL").empty();for(var accordionChild=$("#accordionDiv").children(),i=1;i<=accordionChild.length;i++){var badgegroup=$("#accordion"+i).find(".badgegroup");badgegroup&&badgegroup.length>0&&$("#accordion"+i).children().remove()}document.getElementById(talkToDivId).children[0].innerHTML="";for(var chatRootDiv=document.getElementById(contactChatDiv),children=chatRootDiv.children,i=children.length-1;i>1;i--)chatRootDiv.removeChild(children[i]);$("#null-nouser").css({display:"block"})},self.showChatUI=function(){$("#content").css({display:"block"})},self.sendText=function(chattype){if(textSending)return!1;textSending=!0;var msgInput=document.getElementById(talkInputId),msg=msgInput.value;if(null==msg||0==msg.length)return textSending=!1,!1;var to=curChatUserId;if(null==to)return textSending=!1,!1;var ext={realname:currentUser.realname,avatar:currentUser.avatar},options={to:to,msg:msg,type:chattype,ext:ext};conn.sendTextMessage(options),console.info("sent text options",options);var msgtext=msg.replace(/\n/g,"<br>");return self.appendMsg(curUserId,to,msgtext,chattype,currentUser.realname,currentUser.avatar),msgInput.value="",msgInput.focus(),setTimeout(function(){textSending=!1},2e3),!0},self.appendMsg=function(who,contact,message,chattype,realname,avatar){var contactDivId=contact;chattype&&"groupchat"==chattype&&(contactDivId=groupFlagMark+contact);var localMsg=(document.getElementById(contactDivId),null);"string"==typeof message?(localMsg=Easemob.im.Helper.parseTextMessage(message),localMsg=localMsg.body):localMsg=message.data;for(var headstr=["<p1>"+self.getLoacalTimeString()+"   <span></span>   </p1>","<p2>"+realname+"<b></b><br/></p2><img src="+avatar+"><br>"],header=$(headstr.join("")),lineDiv=document.createElement("div"),i=0;i<header.length;i++){var ele=header[i];lineDiv.appendChild(ele)}for(var messageContent=localMsg,i=0;i<messageContent.length;i++){var msg=messageContent[i],type=msg.type,data=msg.data,eletext="<p3>"+data+"</p3>",ele=$(eletext);ele[0].setAttribute("class","chat-content-p3"),ele[0].setAttribute("className","chat-content-p3");for(var j=0;j<ele.length;j++)lineDiv.appendChild(ele[j])}null==curChatUserId&&null==chattype&&(self.setCurrentContact(contact),time<1&&($("#accordion3").click(),time++));var msgContentDiv=document.getElementById(curUserId+"-"+contactDivId);curUserId==who?(lineDiv.style.textAlign="right",lineDiv.className="immediate-information easemobmain-record img-right"):(lineDiv.style.textAlign="left",lineDiv.className="immediate-information easemobmain-record img-left");var create=!1;return null==msgContentDiv&&(msgContentDiv=self.createContactChatDiv(contactDivId),create=!0),msgContentDiv.appendChild(lineDiv),create&&document.getElementById(msgCardDivId).appendChild(msgContentDiv),"audio"==type&&msg.audioShim&&setTimeout(function(){playAudioShim(d.find("."+t),data.currentSrc,t)},0),msgContentDiv.scrollTop=msgContentDiv.scrollHeight,lineDiv},self.getLoacalTimeString=function(){var date=new Date,time=date.getHours()+":"+date.getMinutes()+":"+date.getSeconds();return time},self.createContactChatDiv=function(chatUserId){var msgContentDivId=curUserId+"-"+chatUserId,newContent=document.createElement("div");return $(newContent).attr({id:msgContentDivId,"class":"chat01_content",className:"chat01_content",style:"display:block"}),$("#null-nouser").css({display:"none"}),newContent}}function locationService($http){var self=this;self.fetchLocation=function($scope){$scope.currentLocation=self.getDefaultLocation(),self.saveLocation($scope.currentLocation);var locations={};$http.get("http://"+AppSettings.baseApiUrl+"/common/wxconfig").success(function(data){data&&(data.debug=!1,wx.config(data))}),wx.ready(function(){wx.getLocation({success:function(res){$http.get("http://"+AppSettings.baseApiUrl+"/common/addressCode/"+res.latitude+","+res.longitude).success(function(data){data&&(locations=data),locations.latitude=res.latitude,locations.longitude=res.longitude,self.saveLocation(locations),$scope.currentLocation=locations})},cancel:function(res){lawyer.show("用户拒绝授权获取地理位置")}})})},self.saveLocation=function(location){localStorage.setItem("currentLocation",JSON.stringify(location))},self.getLocation=function(){return JSON.parse(localStorage.getItem("currentLocation"))},self.getDefaultLocation=function(){var locations={};return locations.city_id="440300",locations.city_name="深圳市",locations.district_id="440301",locations.district_name="福田区",locations.province_id="440000",locations.province_name="广东省",locations}}function wxService(){var self=this;self.getWxAuthUrl=function(path){var redirect_uri="http://"+AppSettings.baseApiUrl+"/#"+path,str="https://open.weixin.qq.com/connect/oauth2/authorize?";return str+="appid="+AppSettings.appId+"&",str+="redirect_uri="+encodeURIComponent(redirect_uri)+"&",str+="response_type=code&",str+="scope=snsapi_base&",str+="state=1",str+="#wechat_redirect"},self.saveOpenId=function(openid){localStorage.setItem("wx_openid",openid)},self.getOpenId=function(){return localStorage.getItem("wx_openid")}}var lvtuanApp=angular.module("lvtuanApp.Ctrl",["ionic","ngSanitize","ngFileUpload","listModule","authModule","wxModule","locationModule","ngStorage","easemobModule"]);lvtuanApp.constant("HOST",AppSettings.baseApiUrl),lvtuanApp.controller("MainController",["$rootScope","$scope","$state","$location","$ionicHistory","$http","userService","authService","locationService",function($rootScope,$scope,$state,$location,$ionicHistory,$http,userService,authService,locationService){var self=this;self.login=function(){userService.login(self.username,self.password)},self.register=function(){},self.logout=function(){authService.logout()},self.isAuthed=function(){return authService.isAuthed?authService.isAuthed():!1},$scope.$on("$ionicView.beforeEnter",function(){$scope.currentUser=authService.getUser(),currentLocation=locationService.getLocation(),currentLocation&&currentLocation.city_name?$scope.currentLocation=currentLocation:locationService.fetchLocation($scope)}),$scope.jump=function(url,id){id&&(location.href=url+$scope.id),location.href=url,window.location.reload()},$scope.jumpGo=function(url){location.href=url},$scope.jumpGoBack=function(){window.history.back()};var $body=$("body");document.title="律团";var $iframe=$('<iframe src="/favicon.ico"></iframe>').on("load",function(){setTimeout(function(){$iframe.off("load").remove()},0)}).appendTo($body)}]),lvtuanApp.directive("hideTabs",["$rootScope",function($rootScope){return{restrict:"A",link:function(scope,element,attributes){scope.$on("$ionicView.beforeEnter",function(){scope.$watch(attributes.hideTabs,function(value){void 0==$rootScope.hideTabs||void 0==value?$rootScope.hideTabs=!0:$rootScope.hideTabs=value})}),scope.$on("$ionicView.beforeLeave",function(){scope.$watch(attributes.hideTabs,function(value){$rootScope.hideTabs=!1})})}}}]),lvtuanApp.directive("star",function(){return{template:'<ul class="rating" ng-mouseleave="leave()"><li ng-repeat="star in stars" ng-class="star" ng-click="click($index + 1)" ng-mouseover="over($index + 1)">★</li></ul>',scope:{ratingValue:"=",max:"=",readonly:"@",onHover:"=",onLeave:"="},controller:["$scope",function($scope){$scope.ratingValue=$scope.ratingValue||0,$scope.max=$scope.max||5,$scope.click=function(val){$scope.readonly&&"true"===$scope.readonly||($scope.ratingValue=val)},$scope.over=function(val){$scope.onHover(val)},$scope.leave=function(){$scope.onLeave()}}],link:function(scope,elem,attrs){var updateStars=function(){scope.stars=[];for(var i=0;i<scope.max;i++)scope.stars.push({filled:i<scope.ratingValue})};updateStars(),scope.$watch("ratingValue",function(oldVal,newVal){newVal&&updateStars()}),scope.$watch("max",function(oldVal,newVal){newVal&&updateStars()})}}}),lvtuanApp.constant("$ionicLoadingConfig",{content:'<ion-spinner icon="ios"></ion-spinner>',animation:"fade-in",showBackdrop:!0,maxWidth:200,showDelay:0}),lvtuanApp.controller("ionicNavBarDelegateCtrl",["$state","$timeout","$http","$location",function($state,$timeout,$http,$location){$timeout(function(){location.href="#/index"},3e3)}]),lvtuanApp.controller("indexCtrl",["$scope","listHelper","locationService",function($scope,listHelper,locationService){locationService.getLocation()?($scope.locations=locationService.getLocation(),$scope.city=$scope.locations.city_id,listHelper.bootstrap("/lawyer/list_lawyers?is_recommended=1&city_id="+$scope.city,$scope)):listHelper.bootstrap("/lawyer/list_lawyers?is_recommended=1",$scope),$scope.mylvteam=function(){location.href="#/mylvteam"}}]),lvtuanApp.controller("loginCtrl",["$state","$scope","$rootScope","$http","userService",function($state,$scope,$rootScope,$http,userService){function checkvaldata(user){if(""==user.username)return layer.show("请输入手机号码或者邮箱！"),!1;if(user.username.match(format_mobile)){if(null==user.username.match(format_mobile))return layer.show("请输入正确的手机号码!"),!1}else if(null==user.username.match(format_email))return layer.show("请输入正确邮箱账号!"),!1;return!0}var format_email=/^(([0-9a-zA-Z]+)|([0-9a-zA-Z]+[_.0-9a-zA-Z-]*[0-9a-zA-Z]+))@([a-zA-Z0-9-]+[.])+([a-zA-Z]{2} |net|NET|com|COM|gov|GOV|mil|MIL|org|ORG|edu|EDU|int|INT|cn|CN)$/,format_mobile=/^(0|86|17951)?(13[0-9]|15[012356789]|17[678]|18[0-9]|14[57])[0-9]{8}$/;$scope.submit=function(user){checkvaldata(user)&&userService.login(user.username,user.password)}}]),lvtuanApp.controller("registerCtrl",["$scope","$rootScope","$http","userService","authService",function($scope,$rootScope,$http,userService,authService){$scope.phonecode=function(phone){var param="phone="+phone;$http.post("http://"+$rootScope.hostName+"/send-code?"+param).success(function(data){layer.show("验证码已发送到您的手机！")})},$scope.submit=function(user){$scope.params={},user.username&&($scope.params.username=user.username),user.phonecode&&($scope.params.phonecode=user.phonecode),user.password&&($scope.params.password=user.password),$http.post("http://"+$rootScope.hostName+"/register",{username:$scope.params.username,password:$scope.params.password,phonecode:$scope.params.phonecode,account_type:"phone"}).success(function(data){layer.show("注册成功！"),$scope.user={},$scope.params={};var user_data=data?data.data:null;user_data&&(authService.saveUser(user_data),console.log("user:",user_data));var token=data?data.token:null;token&&(authService.saveToken(token),console.log("JWT:",token)),1==user.isCheck?location.href="#/becomelawyer":location.href="#/center"})}}]),lvtuanApp.controller("resetpwdCtrl",["$scope","$http","$rootScope",function($scope,$http,$rootScope){$scope.user={},$scope.save=function(user){return user.old_password==user.new_password&&user.old_password==user.new_password_retype&&user.new_password==user.new_password_retype?(layer.show("修改密码不能和初始密码一样！"),!1):user.new_password.length!=user.new_password_retype.length?(layer.show("重置密码的长度不一致！"),!1):user.new_password!=user.new_password_retype?(layer.show("两次输入的密码不一致！"),!1):void $http.post("http://"+$rootScope.hostName+"/center/reset_pass",$scope.user).success(function(data){layer.show("修改成功！"),$scope.user={},location.href="#/login"})}}]),lvtuanApp.controller("forgotpwdCtrl",["$scope","$http","$rootScope",function($scope,$http,$rootScope){$scope.user={},$scope.phonecode=function(phone){if(console.info(phone),void 0==phone)return layer.show("请输入手机号！"),!1;var param="phone="+phone;return $http.post("http://"+$rootScope.hostName+"/send-code?"+param).success(function(data){console.info(data),layer.show("验证码已发送到您的手机！")}),!0},$scope.submit=function(user){console.info(user),$scope.user=user,$http.post("http://"+$rootScope.hostName+"/forgotpwd",$scope.user).success(function(data){$scope.user={},$scope.uid=data.data.uid,sessionStorage.setItem("uid",JSON.stringify($scope.uid)),$("#forgotForm").hide(),$("#upwdForm").show()})}}]),lvtuanApp.controller("upwdCtrl",["$scope","$http","$rootScope",function($scope,$http,$rootScope){$scope.user={},$scope.submit=function(user){return $scope.uid=JSON.parse(sessionStorage.getItem("uid")),$scope.user=user,$scope.user.password_1.length!=$scope.user.password_2.length?(layer.show("重置密码的长度不一致！"),!1):$scope.user.password_1!=$scope.user.password_2?(layer.show("两次输入的密码不一致！"),!1):void $http.post("http://"+$rootScope.hostName+"/forgotpwd/resetpwd/"+$scope.uid,$scope.user).success(function(data){layer.show("修改成功！"),sessionStorage.removeItem("uid"),$scope.user={},location.href="#/login"})}}]),lvtuanApp.controller("wxAuthCtrl",["$scope","$stateParams","wxService","userService",function($scope,$stateParams,wxService,userService){userService.loginWithWx($stateParams.code,$stateParams.state)}]),lvtuanApp.controller("wxLoginCtrl",["$scope","$http","$rootScope","wxService",function($scope,$http,$rootScope,wxService){window.location.replace(wxService.getWxAuthUrl("/wxauth"))}]),lvtuanApp.controller("groupCtrl",["$scope","$http","$state","$rootScope",function($scope,$http,$state,$rootScope){$scope.jumplogin=function(){console.info($rootScope.is_lawyer),location.href="#/login"}}]),lvtuanApp.controller("groupListCtrl",["$scope","listHelper",function($scope,listHelper){listHelper.bootstrap("/group/list/mine",$scope)}]),lvtuanApp.controller("groupTeleviseCtrl",["$scope","$http","$rootScope","listHelper",function($scope,$http,$rootScope,listHelper){listHelper.bootstrap("/microblog/list/all",$scope),$scope.likes=function(id,index){$http.post("http://"+$rootScope.hostName+"/like",{item_type:"post",item_id:id}).success(function(data){console.info(data);var itmes=data.data;$scope.televise[index].post_extra.likes_count=itmes.likes_count,layer.show("点赞成功！")})}}]),lvtuanApp.controller("groupAttentionCtrl",["$scope","$http","$state","$rootScope","$ionicLoading",function($scope,$http,$state,$rootScope,$ionicLoading){function getParams(){var param=layer.getParams("#search_form");geturl(param)}function geturl(param){var url;url=param.q?"http://"+$rootScope.hostName+"/group/recommend?q="+param.q+"&rows_per_page="+rows_per_page+"&page="+page:"http://"+$rootScope.hostName+"/group/recommend?rows_per_page="+rows_per_page+"&page="+page,$ionicLoading.show(),$http.get(url).success(function(data){console.info(data.data),data&&data.data&&data.data.length?($scope.items=$scope.items.concat(data.data),console.info($scope.items),data.data.length<rows_per_page?$scope.moredata=!1:$scope.moredata=!0):(1==page&&layer.show("暂无数据！"),$scope.moredata=!1),page++,$scope.$broadcast("scroll.infiniteScrollComplete"),$ionicLoading.hide()})}var page=1,rows_per_page=5;$scope.rows_per_page&&(rows_per_page=$scope.rows_per_page),$scope.moredata=!0,$scope.items=[],$scope.q="",$scope.$watch("q",function(newVal,oldVal){newVal!==oldVal&&(page=1,$scope.items=[],getParams())}),$scope.doRefresh=function(){page=1,$scope.items=[],$scope.loadMore(),$scope.$broadcast("scroll.refreshComplete")},$scope.loadMore=function(){getParams()},$scope.groupjoin=function(id,index){page=1;var id=id;$http.post("http://"+$rootScope.hostName+"/group/"+id+"/join?rows_per_page="+rows_per_page+"&page="+page++,{},{cache:!0,headers:{Accept:"application/json",Authorization:"bearer "+$rootScope.token}}).success(function(data){return data&&data.data?($scope.items.splice(index,1),void layer.show("已关注 加入成功！")):(layer.show("暂无数据！"),$scope.moredata=!1,!1)})["finally"](function(){$scope.$broadcast("scroll.refreshComplete"),$scope.$broadcast("scroll.infiniteScrollComplete")})}}]),lvtuanApp.controller("groupviewCtrl",["$scope","$http","$state","$rootScope","$stateParams","easemobService","$ionicLoading",function($scope,$http,$state,$rootScope,$stateParams,easemobService,$ionicLoading){$http.get("http://"+$rootScope.hostName+"/group/"+$stateParams.id+"/chat").success(function(data){if(data&&data.data){var items=data.data,curRoomId=items.easemob_id;easemobService.init(curRoomId,"groupchat"),easemobService.login(items.user_id.toString(),items.pwd),console.info("圈子",items)}}),$scope.site=function(id){var easemobParam=JSON.parse(localStorage.getItem("easemobParam"));location.href="#/group/site/"+easemobParam.id,$state.go("group/site",{id:easemobParam.id})},$scope.sendText=function(){easemobService.sendText("groupchat")},$scope.textKeyDown=function($event){13==$event.keyCode&&($event.altKey?(e=$event.target.value,$(this).val(e+"\n")):($scope.sendText(),$event.preventDefault()))}}]),lvtuanApp.controller("groupsiteCtrl",["$scope","$http","$state","$rootScope","$stateParams","$timeout","$ionicPopup","Upload",function($scope,$http,$state,$rootScope,$stateParams,$timeout,$ionicPopup,Upload){console.info("圈子设置");var easemobParam=JSON.parse(localStorage.getItem("easemobParam"));$http.get("http://"+$rootScope.hostName+"/group/"+easemobParam.id+"/detail").success(function(data){data&&data.data&&($scope.group=data.data,$scope.group_name=$scope.group.group_name,$scope.is_mine=$scope.group.is_mine,$scope.file=$scope.group.group_avatar)}),$scope.del=function(id,index){$http.get("http://"+$rootScope.hostName+"/group/"+$scope.id+"/removemember/"+id,{cache:!0,headers:{"Content-Type":"application/json",Authorization:"bearer "+$rootScope.token}}).success(function(data){layer.show(data.data),$scope.group.members.splice(index,1)})},$scope.logoutGroup=function(){var confirmPopup=$ionicPopup.confirm({title:"确定解散该群？",cancelText:"取消",okText:"确认"});confirmPopup.then(function(res){return res?void $http.get("http://"+$rootScope.hostName+"/group/"+$scope.id+"/dissolution",{cache:!0,headers:{"Content-Type":"application/json",Authorization:"bearer "+$rootScope.token}}).success(function(data){layer.show(data.data),location.href="#/group/list"}):!1})},$scope.edit=function(id){var params=layer.getParams("#myForm");""==params.group_name?layer.show("圈子名称不能为空！"):$http.post("http://"+$rootScope.hostName+"/group/"+$stateParams.id+"/edit",{group_name:params.group_name,group_avatar:params.group_avatar},{headers:{"Content-Type":"application/json",Authorization:"bearer "+$rootScope.token}}).success(function(data){layer.show("修改成功！")})},$scope.uploadFiles=function(group_avatar){group_avatar&&$scope.upload(group_avatar)},$scope.upload=function(group_avatar){Upload.upload({url:"http://"+$rootScope.hostName+"/group/uploadImage",data:{group_avatar:group_avatar}}).then(function(response){$scope.file=response.data.data.file_url,$scope.file_path=response.data.data.file_path,$timeout(function(){$scope.result=response.data})},function(response){if(response.status>0){var errorMsg=response.status+": "+response.data;console.info("errorMsg",errorMsg),layer.show(errorMsg)}},function(evt){var progres=parseInt(100*evt.loaded/evt.total);$scope.progress=progres})},$scope.quitGroup=function(){var confirmPopup=$ionicPopup.confirm({title:"确定退出该群？",cancelText:"取消",okText:"确认"});confirmPopup.then(function(res){return res?void $http.get("http://"+$rootScope.hostName+"/group/"+$scope.id+"/quit").success(function(data){layer.show(data.data),location.href="#/group/list"}):!1})}}]),lvtuanApp.controller("groupaddCtrl",["$scope","$http","$state","$rootScope","$stateParams",function($scope,$http,$state,$rootScope,$stateParams){console.info("添加成员"),console.info($stateParams.id);var page=1;$scope.moredata=!0,$scope.items=[],$scope.doRefresh=function(){page=1,$scope.items=[],$scope.loadMore()},$scope.loadMore=function(){$http.get("http://"+$rootScope.hostName+"/group/"+$stateParams.id+"/addmember").success(function(data){return data.data.length>0?(data.data.length>9?$scope.moredata=!0:$scope.moredata=!1,void($scope.items=$scope.items.concat(data.data))):(layer.show("暂无数据！"),$scope.moredata=!1,!1)})["finally"](function(){$scope.$broadcast("scroll.refreshComplete"),$scope.$broadcast("scroll.infiniteScrollComplete")})},Array.prototype.remove=function(index){if(isNaN(index)||index>this.length)return!1;for(var i=0,n=0;i<this.length;i++)this[i]!=this[index]&&(this[n++]=this[i]);this.length-=1},$scope.selIds=[],$scope.checkItem=function(obj,id){if(0==obj){var index;angular.forEach($scope.selIds,function(val,key){val==id&&(index=key)}),$scope.selIds.remove(index,index)}else $scope.selIds.push(id)},$scope.createSubmit=function(){$http.post("http://"+$rootScope.hostName+"/group/"+$stateParams.id+"/addmember",{members:$scope.selIds}).success(function(data){location.href="#/group/site/"+$stateParams.id})}}]),lvtuanApp.controller("groupcreateCtrl",["$scope","$http","$state","$rootScope","$timeout","Upload",function($scope,$http,$state,$rootScope,$timeout,Upload){console.info("创建圈子");var page=1;$scope.moredata=!0,$scope.items=[],$scope.doRefresh=function(){page=1,$scope.items=[],$scope.loadMore()},$scope.loadMore=function(){$http.get("http://"+$rootScope.hostName+"/group/create?page="+page++,{cache:!0,headers:{"Content-Type":"application/json",Authorization:"bearer "+$rootScope.token}}).success(function(data){return data.data.length>0?(data.data.length>9?$scope.moredata=!0:$scope.moredata=!1,void($scope.items=$scope.items.concat(data.data))):(layer.show("暂无数据！"),$scope.moredata=!1,!1)})["finally"](function(){$scope.$broadcast("scroll.refreshComplete"),$scope.$broadcast("scroll.infiniteScrollComplete")})},Array.prototype.remove=function(index){if(isNaN(index)||index>this.length)return!1;for(var i=0,n=0;i<this.length;i++)this[i]!=this[index]&&(this[n++]=this[i]);this.length-=1},$scope.selIds=[],$scope.checkItem=function(obj,id){if(0==obj){var index;angular.forEach($scope.selIds,function(val,key){val==id&&(index=key)}),$scope.selIds.remove(index,index)}else $scope.selIds.push(id)},$scope.createSubmit=function(){var members=$scope.selIds,params=getParams("#createGroup_form");return""==params.group_name?(layer.show("请输入圈子名称!"),!1):""==params.group_avatar?(layer.show("请上传圈子头像!"),!1):($http.post("http://"+$rootScope.hostName+"/group/store",{group_name:params.group_name,group_avatar:params.group_avatar,members:members}).success(function(data){layer.show("创建成功！"),$scope.selIds={},$scope.file={},$(":input","#questions_form").not("textarea :submit, :reset, :hidden").val(""),location.href="#/group/list"}),!0)},$scope.uploadFiles=function(group_avatar){group_avatar&&$scope.upload(group_avatar)},$scope.upload=function(group_avatar){Upload.upload({headers:{"Content-Type":"application/json",Authorization:"bearer "+$rootScope.token},url:"http://"+$rootScope.hostName+"/group/uploadImage",data:{group_avatar:group_avatar}}).then(function(response){$scope.file=response.data.data.file_url,$scope.group_path=response.data.data.file_path,$timeout(function(){$scope.result=response.data})},function(response){if(response.status>0){var errorMsg=response.status+": "+response.data;console.info("errorMsg",errorMsg),layer.show(errorMsg)}},function(evt){var progres=parseInt(100*evt.loaded/evt.total);$scope.progress=progres})}}]),lvtuanApp.controller("televisecreateCtrl",["$scope","$http","$state","$rootScope","$timeout","Upload",function($scope,$http,$state,$rootScope,$timeout,Upload){console.info("创建广播"),$scope.file=[],$scope.srcfile=[],$scope.uploadFiles=function(files,errFiles){if(console.info(files,errFiles),files){if(files.length>9)return layer.show("最多只能上传9张照片！"),!1;$scope.files=files,$scope.errFiles=errFiles,angular.forEach(files,function(file){file.upload=Upload.upload({headers:{"Content-Type":"application/json",Authorization:"bearer "+$rootScope.token},url:"http://"+$rootScope.hostName+"/microblog/uploadImage",data:{microBlogImage:file}}),file.upload.then(function(response){var src_url=response.data.data.src_url,src=response.data.data.src;src&&($scope.file.push(src_url),$scope.srcfile.push(src)),$timeout(function(){file.result=response.data})},function(response){response.status>0&&($scope.errorMsg=response.status+": "+response.data),layer.show($scope.errorMsg)},function(evt){file.progress=Math.min(100,parseInt(100*evt.loaded/evt.total))})})}},$scope.del=function(index){$scope.file.splice(index,1),$scope.srcfile.splice(index,1)},$scope.createSubmit=function(){var params=getParams("#myForm");return""==params.content?(layer.show("请输入你的广播!"),!1):($http.post("http://"+$rootScope.hostName+"/microblog/create",{content:params.content,file_paths:$scope.srcfile}).success(function(data){console.log(data.data),layer.show("提交成功！"),$(":input","#myForm").not("textarea :submit, :reset, :hidden").val(""),$scope.file=[],$scope.srcfile=[],location.href="#/broadcast/view/"+data.data.id}),!0)}}]),lvtuanApp.controller("broadcastviewCtrl",["$scope","$http","$state","$rootScope","$stateParams","$ionicPopup",function($scope,$http,$state,$rootScope,$stateParams,$ionicPopup){$http.get("http://"+$rootScope.hostName+"/microblog/"+$stateParams.id+"/view").success(function(data){console.info("广播详情",data.data),$scope.items=data.data}),$scope.likes=function(id){$http.post("http://"+$rootScope.hostName+"/like",{item_type:"post",item_id:id}).success(function(data){var like=data.data;$scope.items.post_extra.likes_count=like.likes_count,layer.show("点赞成功！")})},$scope.share=function(id){$scope.id=id,$scope.data={};var myPopup=$ionicPopup.show({template:'<textarea ng-model="data.content" name="content" rows="5" placeholder="想说些什么呢？..."></textarea>',title:"分享",scope:$scope,buttons:[{text:"取消"},{text:"<b>确认</b>",type:"button-positive",onTap:function(e){return $scope.data.content}}]});myPopup.then(function(res){$scope.content=res,$http.post("http://"+$rootScope.hostName+"/microblog/forward",{content:$scope.content,parent_id:$scope.id}).success(function(data){console.info(data),layer.show("分享成功！")})})},
$scope.comments=function(id){$scope.id=id,$scope.data={};var myPopup=$ionicPopup.show({template:'<textarea ng-model="data.comments" name="comments" rows="5" placeholder="想说些什么呢？..."></textarea>',title:"评论",scope:$scope,buttons:[{text:"取消"},{text:"<b>确认</b>",type:"button-positive",onTap:function(e){return $scope.data.comments}}]});myPopup.then(function(res){void 0!=res?($scope.comments=res,$http.post("http://"+$rootScope.hostName+"/microblog/"+id+"/comment/create",{content:$scope.comments,post_id:id}).success(function(data){console.info(data),layer.show("评论成功！")})):myPopup.close()})}}]),lvtuanApp.controller("knowledgesCtrl",["$scope","$http","$rootScope","listHelper",function($scope,$http,$rootScope,listHelper){listHelper.bootstrap("/news/list_news",$scope)}]),lvtuanApp.controller("documentsCtrl",["$scope","$http","$rootScope","listHelper",function($scope,$http,$rootScope,listHelper){listHelper.bootstrap("/knowledge/article/list_articles",$scope)}]),lvtuanApp.controller("casesCtrl",["$scope","$http","$rootScope","listHelper",function($scope,$http,$rootScope,listHelper){listHelper.bootstrap("/case/list_case",$scope)}]),lvtuanApp.controller("knowledgeViewCtrl",["$scope","$http","$rootScope","$stateParams","$ionicPopup","$ionicPopup","$timeout","$ionicLoading",function($scope,$http,$rootScope,$stateParams,$ionicPopup,$ionicPopup,$timeout,$ionicLoading){function init(){$ionicLoading.show();var url="http://"+$rootScope.hostName+"/knowledge/"+$stateParams.id+"/view";$http.get(url).success(function(data){console.info(data.data),$scope.items=data.data,sessionStorage.setItem("comments_count",JSON.stringify($scope.items.comments_count)),$ionicLoading.hide()})}init(),$scope.likes=function(id){$http.post("http://"+$rootScope.hostName+"/like",{item_type:"article",item_id:id},{headers:{"Content-Type":"application/json",Authorization:"bearer "+$rootScope.token}}).success(function(data){var itmes=data.data;$scope.items.likes_count=itmes.likes_count,$scope.items.is_like=!0,layer.show("点赞成功！")})},$scope.collects=function(id){$http.post("http://"+$rootScope.hostName+"/collect",{collect_type:3,item_id:id},{headers:{"Content-Type":"application/json",Authorization:"bearer "+$rootScope.token}}).success(function(data){$scope.items.collects_count=$scope.items.collects_count+1,$scope.items.is_collect=!0,layer.show("收藏成功！")})},$scope.collects_del=function(id){$http.post("http://"+$rootScope.hostName+"/collect/delete",{collect_type:3,item_id:id},{headers:{"Content-Type":"application/json",Authorization:"bearer "+$rootScope.token}}).success(function(data){$scope.items.collects_count=$scope.items.collects_count-1,$scope.items.is_collect=!1,layer.show("取消成功！")})},$scope.comments=function(id){$scope.id=id,$scope.data={};var myPopup=$ionicPopup.show({template:'<textarea ng-model="data.evaluate_comment" name="evaluate_comment" rows="5" placeholder="想说些什么呢？..."></textarea>',title:"评论",scope:$scope,buttons:[{text:"取消"},{text:"<b>确认</b>",type:"button-positive",onTap:function(e){if($scope.data.evaluate_comment){if(!($scope.data.evaluate_comment.length>140))return $scope.data.evaluate_comment;layer.show("内容字数不能大于140字符！"),e.preventDefault()}else layer.show("内容不能为空！"),e.preventDefault()}}]});myPopup.then(function(res){void 0!=res?($scope.evaluate_comment=res,$http.post("http://"+$rootScope.hostName+"/article/"+id+"/comment",{evaluate_comment:$scope.evaluate_comment,item_id:id}).success(function(data,status,headers,config){$scope.comment=data.data,$scope.items.comments_count=$scope.comment.comments_count,sessionStorage.setItem("comments_count",JSON.stringify($scope.items.comments_count)),layer.show("评论成功！")})):myPopup.close()})}}]),lvtuanApp.controller("commentsViewCtrl",["$scope","$http","$rootScope","$stateParams","$ionicPopup","$ionicPopup","listHelper",function($scope,$http,$rootScope,$stateParams,$ionicPopup,$ionicPopup,listHelper){$scope.comments_count=JSON.parse(sessionStorage.getItem("comments_count")),listHelper.bootstrap("/article/"+$stateParams.id+"/comment/list",$scope),console.info("/article/"+$stateParams.id+"/comment/list"),$scope.comments=function(){$scope.data={};var myPopup=$ionicPopup.show({template:'<textarea ng-model="data.evaluate_comment" name="evaluate_comment" rows="5" placeholder="想说些什么呢？..."></textarea>',title:"评论",scope:$scope,buttons:[{text:"取消"},{text:"<b>确认</b>",type:"button-positive",onTap:function(e){if($scope.data.evaluate_comment){if(!($scope.data.evaluate_comment.length>140))return $scope.data.evaluate_comment;layer.show("内容字数不能大于140字符！"),e.preventDefault()}else layer.show("内容不能为空！"),e.preventDefault()}}]});myPopup.then(function(res){void 0!=res?($scope.evaluate_comment=res,$http.post("http://"+$rootScope.hostName+"/article/"+$stateParams.id+"/comment",{evaluate_comment:$scope.evaluate_comment,item_id:$stateParams.id}).success(function(data,status,headers,config){$scope.comment=data.data,$scope.items=$scope.items.concat($scope.comment),$scope.comments_count=$scope.comment.comments_count,sessionStorage.setItem("comments_count",JSON.stringify($scope.comment.comments_count)),layer.show("评论成功！")})):myPopup.close()})}}]),lvtuanApp.controller("centerCtrl",["$scope","$http","$rootScope","$ionicPopup","$timeout","$ionicLoading","authService",function($scope,$http,$rootScope,$ionicPopup,$timeout,$ionicLoading,authService){$scope.$on("$ionicView.beforeEnter",function(){var currentUser=authService.getUser();$scope.currentUser=currentUser;var timestamp=Math.round((new Date).getTime()/1e3),url=null;$ionicLoading.show(),url=currentUser.is_verified_lawyer?"http://"+$rootScope.hostName+"/center/lawyer/info?ts="+timestamp:"http://"+$rootScope.hostName+"/center/customer/info?ts="+timestamp,$http.get(url).success(function(data){return data&&data.data?($scope.items=data.data,console.info($scope.items),void $ionicLoading.hide()):(layer.show("暂无数据！"),!1)})}),$scope.invitefriend=function(){$scope.data={};$ionicPopup.show({templateUrl:"popup-invitefriend-template.html",title:"邀请好友",scope:$scope,buttons:[{text:"Cancel"}]})}}]),lvtuanApp.controller("infoCtrl",["$scope","$http","$rootScope","$timeout","$ionicLoading","Upload","authService",function($scope,$http,$rootScope,$timeout,$ionicLoading,Upload,authService){$scope.$on("$ionicView.beforeEnter",function(){function getDate(url){$http.get(url).success(function(data){return data&&data.data?($scope.items=data.data,$scope.file=$scope.items.user.avatar,localStorage.setItem("userinfo",JSON.stringify($scope.items)),void $ionicLoading.hide()):(layer.show("暂无数据！"),!1)})}var currentUser=authService.getUser(),timestamp=Math.round((new Date).getTime()/1e3),url=null;$ionicLoading.show(),1==currentUser.status||2==currentUser.status?(url="http://"+$rootScope.hostName+"/center/customer/info?ts="+timestamp,getDate(url)):(url="http://"+$rootScope.hostName+"/center/lawyer/info?ts="+timestamp,getDate(url))}),$scope.uploadFiles=function(avatar,id){$ionicLoading.show(),avatar&&$scope.upload(avatar,id)},$scope.upload=function(avatar,id){Upload.upload({headers:{"Content-Type":"application/json",Authorization:"bearer "+$rootScope.token},url:"http://"+$rootScope.hostName+"/center/customer/update_user_image",data:{upload_file:avatar,user_id:id}}).then(function(response){var file_path="http://"+$rootScope.hostName+"/file/show?path="+response.data.data.file_path;$scope.file=file_path,$timeout(function(){$scope.result=response.data}),$ionicLoading.hide()},function(response){if(response.status>0){var errorMsg=response.status+": "+response.data;console.info("errorMsg",errorMsg),layer.show(errorMsg)}},function(evt){})}}]),lvtuanApp.controller("valrealnameCtrl",["$scope","$http","$rootScope","$ionicLoading","authService",function($scope,$http,$rootScope,$ionicLoading,authService){var currentUser=authService.getUser(),timestamp=Math.round((new Date).getTime()/1e3);$scope.userinfo=JSON.parse(localStorage.getItem("userinfo")),console.info($scope.userinfo),$scope.user={nikname:$scope.userinfo.user.nikname},$scope.submit=function(){$ionicLoading.show();var params=layer.getParams("#niknameForm"),url=null;url=1==currentUser.status||2==currentUser.status?"http://"+$rootScope.hostName+"/center/customer/info?ts="+timestamp:"http://"+$rootScope.hostName+"/center/lawyer/info?ts="+timestamp,$http.post(url,params).success(function(data){layer.show("提交成功！"),$scope.user={nikname:""},location.href="#/info",$ionicLoading.hide()})}}]),lvtuanApp.controller("valphoneCtrl",["$scope","$http","$rootScope","$ionicLoading","authService",function($scope,$http,$rootScope,$ionicLoading,authService){authService.getUser();$scope.userinfo=JSON.parse(localStorage.getItem("userinfo")),$scope.user={phone:$scope.userinfo.user.phone},$scope.phonecode=function(phone){var param="phone="+phone;$http.post("http://"+$rootScope.hostName+"/send-code?"+param).success(function(data){layer.show("验证码已发送到您的手机！")})},$scope.submit=function(){$ionicLoading.show();var params=layer.getParams("#phoneForm");$http.post("http://"+$rootScope.hostName+"/center/update_phone",params).success(function(data){layer.show("提交成功！"),$scope.user={phone:"",phonecode:""},location.href="#/info",$ionicLoading.hide()})}}]),lvtuanApp.controller("valemailCtrl",["$scope","$http","$rootScope","$ionicLoading","authService",function($scope,$http,$rootScope,$ionicLoading,authService){authService.getUser();$scope.userinfo=JSON.parse(localStorage.getItem("userinfo")),$scope.user={email:$scope.userinfo.user.email},$scope.phonecode=function(phone){var param="phone="+phone;$http.post("http://"+$rootScope.hostName+"/send-code?"+param).success(function(data){layer.show("验证码已发送到您的邮箱！")})},$scope.submit=function(){$ionicLoading.show();var params=layer.getParams("#emailForm");$http.post("http://"+$rootScope.hostName+"/center/update_email",params).success(function(data){layer.show("提交成功！"),$scope.user={email:"",phonecode:""},location.href="#/info",$ionicLoading.hide()})}}]),lvtuanApp.controller("listscoresCtrl",["$scope","listHelper",function($scope,listHelper){$scope.rows_per_page=20,listHelper.bootstrap("/center/score/list_scores",$scope)}]),lvtuanApp.controller("messagesCtrl",["$scope","listHelper",function($scope,listHelper){listHelper.bootstrap("/letter/sys",$scope)}]),lvtuanApp.controller("viewMessageCtrl",["$scope","$http","$rootScope","$interval","$stateParams","$ionicLoading",function($scope,$http,$rootScope,$interval,$stateParams,$ionicLoading){var id=$stateParams.id,url="http://"+$rootScope.hostName+"/letter/sys-letters/"+id;$ionicLoading.show(),$http.get(url).success(function(data){data&&data.data&&($scope.item=data.data,$ionicLoading.hide())})}]),lvtuanApp.controller("collectCtrl",["$scope","listHelper",function($scope,listHelper){listHelper.bootstrap("/center/collect",$scope)}]),lvtuanApp.controller("commentCtrl",["$scope","listHelper",function($scope,listHelper){listHelper.bootstrap("/center/blog/reply",$scope)}]),lvtuanApp.controller("followedCtrl",["$scope","listHelper",function($scope,listHelper){listHelper.bootstrap("/center/mylawyer/followed",$scope)}]),lvtuanApp.controller("becomenavCtrl",["$scope","$http","$rootScope","$ionicPopup","$timeout","$localStorage","$ionicLoading","authService",function($scope,$http,$rootScope,$ionicPopup,$timeout,$localStorage,$ionicLoading,authService){$ionicLoading.show(),$http.get("http://"+$rootScope.hostName+"/center/becomelawyer/infochecks").success(function(data){$scope.infochecks=data.data,console.info($scope.infochecks),$ionicLoading.hide()});var currentUser=authService.getUser();$scope.currentUser=currentUser,currentUser.is_verified_lawyer?$http.get("http://"+$rootScope.hostName+"/center/lawyer/info").success(function(data){return data&&data.data?($scope.items=data.data,console.info($scope.items),localStorage.setItem("lvinfo",JSON.stringify($scope.items)),void 0):(layer.show("暂无数据！"),!1)}):$scope.submit=function(){$http.post("http://"+$rootScope.hostName+"/center/becomelawyer/submit").success(function(data){delete $localStorage.addres,layer.show("提交成功！请等待审核..."),location.href="#/center"}).error(function(data){console.info(data)})}}]),lvtuanApp.controller("practitionersCtrl",["$scope","$http","$rootScope","$timeout","$stateParams","$localStorage","$location","Upload","authService",function($scope,$http,$rootScope,$timeout,$stateParams,$localStorage,$location,Upload,authService){function periods(){$scope.periods=null,$http.get("http://"+$rootScope.hostName+"/lawyer/practiseperiods").success(function(data){if($scope.periods=data.data,param)for(var i=0;i<$scope.periods.length;i++)if(param==$scope.periods[i].key){$scope.practice_period=$scope.periods[i];break}})}var currentUser=authService.getUser();if($scope.currentUser=currentUser,currentUser.is_verified_lawyer){if($scope.lvinfo=JSON.parse(localStorage.getItem("lvinfo")),console.info($scope.lvinfo),$scope.lvinfo){$scope.license=$scope.lvinfo.user.lawyer.license,$scope.company_name=$scope.lvinfo.user.lawyer.company_name,$scope.file=$scope.lvinfo.user.lawyer.license_file;var param=$scope.lvinfo.user.lawyer.practice_period;$scope.address=$scope.lvinfo.user.province_name+" "+$scope.lvinfo.user.city_name+" "+$scope.lvinfo.user.district_name,periods()}}else $scope.address="",$scope.addres_param={},$scope.addres=$localStorage.addres||"",$scope.$watch("addres",function(newVal,oldVal){console.log("newVal: ",newVal),$localStorage.addres=$scope.addres,$scope.addres_param=$localStorage.addres,$scope.addres_param?($scope.address=$scope.addres_param.province.value+" "+$scope.addres_param.city.value+" "+$scope.addres_param.district.value,console.info("address",$scope.address)):$scope.address=""}),$scope.$watch(function(){return angular.toJson($localStorage)},function(){$scope.addres=$localStorage.addres,console.info($scope.addres)}),periods();$scope.uploadFiles=function(license_file){Upload.upload({headers:{"Content-Type":"application/json",Authorization:"bearer "+$rootScope.token},url:"http://"+$rootScope.hostName+"/file/upload/user",data:{upload_file:license_file,user_id:currentUser.id}}).then(function(response){$scope.file=response.data.data.file_url,$scope.file_path=response.data.data.file_path,$timeout(function(){$scope.result=response.data})},function(response){if(response.status>0){var errorMsg=response.status+": "+response.data;console.info("errorMsg",errorMsg),layer.show(errorMsg)}},function(evt){var progres=parseInt(100*evt.loaded/evt.total);$scope.progress=progres})},$scope.getAddress=function(){delete $localStorage.addres,localStorage.setItem("citypicke_goback",$location.path()),location.href="#/citypicke/all"},$scope.submit=function(){var param=layer.getParams("#practitionForm"),province=$scope.addres_param.province.key,city=$scope.addres_param.city.key,district=$scope.addres_param.district.key;return province&&(param.province=province),city&&(param.city=city),district&&(param.district=district),!currentUser.is_verified_lawyer&&param.license_file.length<1?(layer.show("请上传执业证书！"),!1):(console.info(param),void $http.post("http://"+$rootScope.hostName+"/center/becomelawyer/work",param).success(function(data){layer.show("添加成功！"),location.href="#/becomenav"}))}}]),lvtuanApp.controller("verifiedCtrl",["$scope","$http","$rootScope","$timeout","$stateParams","$localStorage","Upload",function($scope,$http,$rootScope,$timeout,$stateParams,$localStorage,Upload){$scope.uploadFiles=function(license_file){Upload.upload({headers:{"Content-Type":"application/json",Authorization:"bearer "+$rootScope.token},url:"http://"+$rootScope.hostName+"/file/upload/user",data:{upload_file:license_file,user_id:currentUser.id}}).then(function(response){$scope.file=response.data.data.file_url,$scope.file_path=response.data.data.file_path,$timeout(function(){$scope.result=response.data})},function(response){if(response.status>0){var errorMsg=response.status+": "+response.data;console.info("errorMsg",errorMsg),layer.show(errorMsg)}},function(evt){var progres=parseInt(100*evt.loaded/evt.total);$scope.progress=progres})},$scope.lvinfo=JSON.parse(localStorage.getItem("lvinfo")),console.info($scope.lvinfo),$scope.lvinfo&&($scope.file=$scope.lvinfo.user.lawyer.ID_img),$scope.submit=function(){var param=layer.getParams("#verifiedForm");return param.ID_img.length<1?(layer.show("请上传执业证书！"),!1):void $http.post("http://"+$rootScope.hostName+"/center/becomelawyer/identity",param).success(function(data){layer.show("添加成功！"),location.href="#/becomenav"})}}]),lvtuanApp.controller("tariffsetCtrl",["$scope","$http","$rootScope","$timeout","$stateParams","$localStorage",function($scope,$http,$rootScope,$timeout,$stateParams,$localStorage){$scope.lvinfo=JSON.parse(localStorage.getItem("lvinfo")),console.info($scope.lvinfo),$scope.lvinfo&&($scope.textreplyfee=parseInt($scope.lvinfo.user.lawyer.text_reply_fee),$scope.phonereplyfee=parseInt($scope.lvinfo.user.lawyer.phone_reply_fee)),$scope.submit=function(){var param=layer.getParams("#tariffsetForm");$http.post("http://"+$rootScope.hostName+"/center/becomelawyer/fee",param).success(function(data){layer.show("添加成功！"),location.href="#/becomenav"})}}]),lvtuanApp.controller("fieldCtrl",["$scope","$http","$rootScope","$timeout","$stateParams","$localStorage","Upload",function($scope,$http,$rootScope,$timeout,$stateParams,$localStorage,Upload){Array.prototype.remove=function(index){if(isNaN(index)||index>this.length)return!1;for(var i=0,n=0;i<this.length;i++)this[i]!=this[index]&&(this[n++]=this[i]);this.length-=1},$scope.inShowscopes=function(workscope,showscopes){var value=!1;return angular.forEach(showscopes,function(item){item.key==workscope.key&&(value=!0)}),value},$http.get("http://"+$rootScope.hostName+"/lawyer/workscopes").success(function(data){return $scope.workscopes=data.data,console.info($scope.workscopes),$scope.lvinfo=JSON.parse(localStorage.getItem("lvinfo")),console.info($scope.lvinfo),$scope.lvinfo&&$scope.lvinfo.user.lawyer.work_scope.length>0?(console.info($scope.lvinfo.user.lawyer.work_scope),void($scope.showscopes=$scope.lvinfo.user.lawyer.work_scope)):!1}),$scope.showscopes=[],$scope.click_workscope=function(key,value){var isvalue=!1;if($scope.showscopes.length<3){for(var i=0;i<$scope.showscopes.length;i++)if($scope.showscopes[i].key==key)return $scope.showscopes.remove(i),isvalue=!1,!1;if(value){var workscope={};workscope.key=key,workscope.value=value,$scope.showscopes.push(workscope),isvalue=!0}return isvalue}return angular.forEach($scope.showscopes,function(item,index){item.key==key&&($scope.showscopes.remove(index),console.info($scope.showscopes),isvalue=!1)}),isvalue},$scope.submit=function(){var param={},workscope=[];$scope.showscopes.length>0?(angular.forEach($scope.showscopes,function(item){workscope.push(item.key)}),param.work_scope=workscope):layer.show("请选择擅长领域！"),console.info(param),$http.post("http://"+$rootScope.hostName+"/center/becomelawyer/workscope",param).success(function(data){console.info(data),layer.show("添加成功！"),location.href="#/becomenav"})}}]),lvtuanApp.controller("caseCtrl",["$scope","$http","$rootScope","$timeout","$stateParams","$localStorage","Upload",function($scope,$http,$rootScope,$timeout,$stateParams,$localStorage,Upload){$scope.lvinfo=JSON.parse(localStorage.getItem("lvinfo")),console.info($scope.lvinfo),$scope.lvinfo&&($scope.introduce=$scope.lvinfo.user.lawyer.introduce,$scope.experience=$scope.lvinfo.user.lawyer.experience,$scope.law_cases=$scope.lvinfo.user.lawyer.law_cases),$scope.submit=function(){var param=layer.getParams("#caseForm");$http.post("http://"+$rootScope.hostName+"/center/becomelawyer/experience",param).success(function(data){layer.show("添加成功！"),location.href="#/becomenav"})}}]),lvtuanApp.controller("followedlaywerCtrl",["$scope","listHelper",function($scope,listHelper){listHelper.bootstrap("/center/lawyer/customer/followed",$scope)}]),lvtuanApp.controller("commentlaywerCtrl",["$scope","$http","$rootScope","$stateParams","listHelper",function($scope,$http,$rootScope,$stateParams,listHelper){listHelper.bootstrap("/center/blog/reply",$scope)}]),lvtuanApp.controller("caselaywerCtrl",["$scope","listHelper","$stateParams",function($scope,listHelper,$stateParams){listHelper.bootstrap("/center/lawyer/blog/list?class="+$stateParams["class"],$scope)}]),lvtuanApp.controller("viewarticlelawyerCtrl",["$scope","$http","$rootScope","$stateParams","$ionicLoading","$timeout","$ionicPopup",function($scope,$http,$rootScope,$stateParams,$ionicLoading,$timeout,$ionicPopup){function init(){$ionicLoading.show(),$http.get("http://"+$rootScope.hostName+"/lawyer/article/"+$stateParams.id+"/view").success(function(data){return console.info(data.data),data.data?($timeout(function(){$ionicLoading.hide(),$scope.items=data.data}),!0):(layer.show("暂无数据！"),!1)})}init()}]),lvtuanApp.controller("aboutCtrl",["$scope","$timeout","$ionicPopup",function($scope,$timeout,$ionicPopup){$scope.showPopup=function(){$scope.data={};var myPopup=$ionicPopup.show({template:'<input type="password" ng-model="data.wifi">',title:"Enter Wi-Fi Password",subTitle:"Please use normal things",scope:$scope,buttons:[{text:"Cancel"},{text:"<b>Save</b>",type:"button-positive",onTap:function(e){return $scope.data.wifi?$scope.data.wifi:void e.preventDefault()}}]});myPopup.then(function(res){console.log("Tapped!",res)}),$timeout(function(){myPopup.close()},3e3)},$scope.showConfirm=function(){var confirmPopup=$ionicPopup.confirm({title:"温馨提示",template:"系统检测到有最新版本，点击确定进行下载。"});confirmPopup.then(function(res){res?console.log("You are sure"):console.log("You are not sure")})},$scope.showAlert=function(){var alertPopup=$ionicPopup.alert({title:"温馨提示",template:"您的软件已经是最新版本！"});alertPopup.then(function(res){console.log("Thank you for not eating my delicious ice cream cone")})}}]),lvtuanApp.controller("siteCtrl",["$scope","$http","$rootScope","authService",function($scope,$http,$rootScope,authService){console.info("设置"),$scope.logout=function(){authService.logout(),location.href="#/login"}}]),lvtuanApp.controller("lawyerlistCtrl",["$scope","$state","$http","$rootScope","$location","$timeout","$ionicLoading","locationService",function($scope,$state,$http,$rootScope,$location,$timeout,$ionicLoading,locationService){function getDistrict(){$ionicLoading.show(),$http.get("http://"+$rootScope.hostName+"/area/"+$scope.city+"/district").success(function(data){$scope.districts=data.data,$ionicLoading.hide()})}function getWorkscopes(){$ionicLoading.show(),$http.get("http://"+$rootScope.hostName+"/lawyer/workscopes").success(function(data){$scope.workscopes=data.data,$ionicLoading.hide()})}function getPractisePeriods(){$ionicLoading.show(),$http.get("http://"+$rootScope.hostName+"/lawyer/practiseperiods").success(function(data){$scope.periods=data.data,$ionicLoading.hide()})}function getParams(){var params=layer.getParams("#searchForm"),param=[];params.q&&param.push("q="+params.q),params.district_id&&param.push("district_id="+params.district_id),params.cat_id&&param.push("cat_id="+params.cat_id),params.experience&&param.push("experience="+params.experience),params.order_by&&param.push("order_by="+params.order_by),$scope.city&&param.push("city_id="+$scope.city),param=param.join("&"),console.info(param),geturl(param)}function geturl(param){var url;url=""!=param?"http://"+$rootScope.hostName+"/lawyer/list_lawyers?"+param+"&rows_per_page="+rows_per_page+"&page="+page:"http://"+$rootScope.hostName+"/lawyer/list_lawyers?rows_per_page="+rows_per_page+"&page="+page,$ionicLoading.show(),$http.get(url).success(function(data){console.info(data.data),data&&data.data&&data.data.length?($scope.items=$scope.items.concat(data.data),console.info($scope.items),data.data.length<rows_per_page?$scope.moredata=!1:$scope.moredata=!0):(1==page&&layer.show("暂无数据！"),$scope.moredata=!1),page++,$scope.$broadcast("scroll.infiniteScrollComplete"),$ionicLoading.hide()})}$scope.locations=locationService.getLocation(),$scope.city=$scope.locations.city_id,$scope.orders=[{key:"most_popular",value:"人气最高"},{key:"best_evaluated",value:"评分最好"},{key:"experience",value:"执业年限"},{key:"pay_reply_count",value:"接单数"}],getDistrict(),getWorkscopes(),getPractisePeriods();var page=1,rows_per_page=5;$scope.rows_per_page&&(rows_per_page=$scope.rows_per_page),$scope.moredata=!0,$scope.items=[],$scope.searchCity=function(){page=1,$scope.items=[],getParams()},$scope.q="",$scope.$watch("q",function(newVal,oldVal){newVal!==oldVal&&(page=1,$scope.items=[],getParams())}),$scope.doRefresh=function(){page=1,$scope.items=[],$scope.loadMore(),$scope.$broadcast("scroll.refreshComplete")},$scope.loadMore=function(){getParams()},$scope.jumppage=function(id){location.href="#/lawyer/"+id}}]),lvtuanApp.controller("viewCtrl",["$scope","$http","$rootScope","$stateParams","httpWrapper","authService","$ionicLoading",function($scope,$http,$rootScope,$stateParams,httpWrapper,authService,$ionicLoading){$scope.max=5,$scope.ratingVal=5,$scope.readonly=!0,$scope.onHover=function(val){$scope.hoverVal=val},$scope.onLeave=function(){$scope.hoverVal=null},$scope.tabs=[{title:"个人介绍",url:"selfintro.tpl.html"},{title:"文章分享",url:"article.tpl.html"},{title:"咨询回复",url:"advisory.tpl.html"},{title:"用户评价",url:"evaluate.tpl.html"},{title:"成交记录",url:"dealrecord.tpl.html"}],$scope.currentTab="selfintro.tpl.html",$scope.onClickTab=function(tab){$scope.currentTab=tab.url},$scope.isActiveTab=function(tabUrl){return tabUrl==$scope.currentTab},$ionicLoading.show(),httpWrapper.get("http://"+$rootScope.hostName+"/lawyer/"+$stateParams.id,function(data){$scope.items=data.data,$scope.ratingVal=$scope.items.average_evaluate_score,console.info($scope.items),$ionicLoading.hide()}),$scope.text_question=function(id){layer.show("对不起，这个功能还在kai f")},$scope.phone_question=function(id){if(sessionStorage.setItem("lawyerId",id),sessionStorage.setItem("index",index),5==index&&0==$scope.items.text_reply_fee)return void layer.show("对不起，这个律师还没有开始提供这个服务!");if(6==index&&0==$scope.items.phone_reply_fee)return void layer.show("对不起，这个律师还没有开始提供这个服务!");if(5==index&&0==$scope.items.text_reply_fee)return void layer.show("对不起，这个律师还没有开始提供这个服务!");if(6==index&&0==$scope.items.phone_reply_fee)return void layer.show("对不起，这个律师还没有开始提供这个服务!");var currentUser=authService.getUser();return null==currentUser?(location.href="#/login",!1):void(1==currentUser.status||2==currentUser.status?location.href="#/graphic":layer.show("这项服务现在没有对律师用户开通。律师用户不能发起资讯。"))},$scope.follow=function(id){$http.post("http://"+$rootScope.hostName+"/follow",{follow_id:id},{headers:{"Content-Type":"application/json",Authorization:"bearer "+$rootScope.token}}).success(function(data){console.info(data),$scope.items.follower_count++,$scope.items.is_following=!0,layer.show("关注成功！")})},$scope.follow_del=function(id){$http.post("http://"+$rootScope.hostName+"/follow/remove",{follow_id:id},{headers:{"Content-Type":"application/json",Authorization:"bearer "+$rootScope.token}}).success(function(data){console.info(data),$scope.items.follower_count--,$scope.items.is_following=!1,layer.show("取消成功！")})}}]),lvtuanApp.controller("viewarticleCtrl",["$scope","$http","$rootScope","$stateParams","listHelper",function($scope,$http,$rootScope,$stateParams,listHelper){listHelper.bootstrap("/lawyer/"+$stateParams.id+"/articles",$scope)}]),lvtuanApp.controller("advisoryCtrl",["$scope","$http","$rootScope","$stateParams","listHelper",function($scope,$http,$rootScope,$stateParams,listHelper){listHelper.bootstrap("/lawyer/"+$stateParams.id+"/questions",$scope)}]),lvtuanApp.controller("evaluateCtrl",["$scope","$http","$rootScope","$stateParams","httpWrapper",function($scope,$http,$rootScope,$stateParams,httpWrapper){function getEvaluation(){var url="http://"+$rootScope.hostName+"/lawyer/"+$stateParams.id+"/evaluations?page="+page;$http.get(url).success(function(data){if(!(data.data.length>0))return layer.show("暂无数据！"),$scope.moredata=!1,!1;$scope.moredata=!0,$scope.items=$scope.items.concat(data.data),$scope.ratingVal=[];for(var i=0;i<$scope.items.length;i++)$scope.ratingVal.push($scope.items[i].evaluate_score);page++})["finally"](function(){$scope.$broadcast("scroll.refreshComplete"),$scope.$broadcast("scroll.infiniteScrollComplete")})}$scope.max=5,$scope.readonly=!0,$scope.onHover=function(val){$scope.hoverVal=val},$scope.onLeave=function(){$scope.hoverVal=null},$scope.onChange=function(val){$scope.ratingVal=val},console.info("律师评价");var page=1;$scope.moredata=!0,$scope.items=[],$scope.doRefresh=function(){page=1,$scope.item=[],$scope.loadMore()},$scope.loadMore=function(){getEvaluation()},$scope.$on("$stateChangeSuccess",function(){$scope.loadMore()})}]),lvtuanApp.controller("dealrecordCtrl",["$scope","$http","$rootScope","$stateParams","listHelper",function($scope,$http,$rootScope,$stateParams,listHelper){listHelper.bootstrap("/lawyer/"+$stateParams.id+"/evaluations",$scope)}]),lvtuanApp.controller("viewteleviseCtrl",["$scope","$http","$rootScope","listHelper",function($scope,$http,$rootScope,listHelper){listHelper.bootstrap("/microblog/list/mine",$scope),$scope.likes=function(id,index){$http.post("http://"+$rootScope.hostName+"/like",{item_type:"post",item_id:id},{headers:{"Content-Type":"application/json",Authorization:"bearer "+$rootScope.token}}).success(function(data){console.info(data);var itmes=data.data;$scope.items[index].post_extra.likes_count=itmes.likes_count,layer.show("点赞成功！")})}}]),lvtuanApp.controller("graphicCtrl",["$scope","$http","$rootScope","$timeout","$stateParams","$ionicLoading","listHelper","httpWrapper","Upload",function($scope,$http,$rootScope,$timeout,$stateParams,$ionicLoading,listHelper,httpWrapper,Upload){$ionicLoading.show(),$http.get("http://"+$rootScope.hostName+"/lawyer/workscopes").success(function(data){data.data?$scope.workscopes=data.data:layer.show("暂无数据！"),$ionicLoading.hide()}),$scope.file=[],$scope.uploadFiles=function(files,errFiles){return files&&files.length>2?(layer.show("最多只能上传2个文件或者图片！"),!1):($scope.files=files,$scope.errFiles=errFiles,angular.forEach(files,function(file){file.upload=Upload.upload({headers:{"Content-Type":"application/json",Authorization:"bearer "+$rootScope.token},url:"http://"+$rootScope.hostName+"/question/upfiles",data:{files:file}}),file.upload.then(function(response){var file_name="http://"+$rootScope.hostName+"/"+response.data.data.file_name;$scope.file.push(file_name),$scope.file=$scope.file,$timeout(function(){file.result=response.data})},function(response){response.status;response.status>0&&($scope.errorMsg=response.status+": "+response.data)},function(evt){file.progress=Math.min(100,parseInt(100*evt.loaded/evt.total)),$scope.progress=file.progress})}),void 0)},$scope.type=$stateParams.id;var lawyerId=sessionStorage.getItem("lawyerId"),index=sessionStorage.getItem("index");$scope.user={},$scope.submit=function(user){$scope.user=user,$scope.file.length>0&&($scope.user.file_paths=$scope.file),index&&($scope.user.type=index),lawyerId&&($scope.user.lawyer_id=lawyerId),$ionicLoading.show(),httpWrapper.request("http://"+$rootScope.hostName+"/center/pay/question/create","post",$scope.user,function(data){layer.show("提交成功！"),$scope.user={},$scope.files={},$scope.errFiles={},location.href="#/pay/"+data.data.data.id+"?type=question",$ionicLoading.hide()},function(data){console.info(data)})}}]),lvtuanApp.controller("specialCtrl",["$scope","$http","$rootScope",function($scope,$http,$rootScope){console.info("专业咨询")}]),lvtuanApp.controller("questionsCtrl",["$scope","$http","$rootScope","$timeout","$stateParams","$state","$ionicLoading","httpWrapper","Upload",function($scope,$http,$rootScope,$timeout,$stateParams,$state,$ionicLoading,httpWrapper,Upload){$ionicLoading.show(),$http.get("http://"+$rootScope.hostName+"/lawyer/workscopes").success(function(data){data.data?$scope.workscopes=data.data:layer.show("暂无数据！"),$ionicLoading.hide()}),$scope.file=[],$scope.uploadFiles=function(files,errFiles){return null==files&&null!=$scope.file?($scope.file=$scope.file,$scope.files=$scope.files,!1):files&&files.length>2?(layer.show("最多只能上传2个文件或者图片！"),!1):($ionicLoading.show(),$scope.files=files,$scope.errFiles=errFiles,angular.forEach(files,function(file){file.upload=Upload.upload({headers:{"Content-Type":"application/json",Authorization:"bearer "+$rootScope.token
},url:"http://"+$rootScope.hostName+"/question/upfiles",data:{files:file}}),file.upload.then(function(response){var file_name="http://"+$rootScope.hostName+"/"+response.data.data.file_name;$scope.file.push(file_name),$scope.file=$scope.file,$timeout(function(){file.result=response.data}),$ionicLoading.hide()},function(response){response.status;response.status>0&&($scope.errorMsg=response.status+": "+response.data)},function(evt){file.progress=Math.min(100,parseInt(100*evt.loaded/evt.total)),$scope.progress=file.progress})}),void 0)},$scope.user={},$scope.submit=function(user){$scope.user=user,$scope.file.length>0&&($scope.user.file_paths=$scope.file),$ionicLoading.show(),httpWrapper.request("http://"+$rootScope.hostName+"/question/create","post",$scope.user,function(data){layer.show("提交成功！"),$scope.user={},$scope.files={},$scope.errFiles={},$ionicLoading.hide()},function(data){console.info(data.error_messages);var errMsg=JSON.stringify(data.error_messages.content[0]);layer.show(errMsg)})}}]),lvtuanApp.controller("questionslistCtrl",["$http","$scope","$state","$rootScope","$timeout","listHelper",function($http,$scope,$state,$rootScope,$timeout,listHelper){listHelper.bootstrap("/question/list_questions",$scope)}]),lvtuanApp.controller("questionslistsearchCtrl",["$http","$scope","$state","$rootScope","$timeout","$ionicLoading",function($http,$scope,$state,$rootScope,$timeout,$ionicLoading){var page=1,rows_per_page=5;$scope.rows_per_page&&(rows_per_page=$scope.rows_per_page),$scope.moredata=!0,$scope.items=[],$scope.q="",$scope.$watch("q",function(newVal,oldVal){newVal!==oldVal&&(page=1,$scope.items=[],$scope.loadMore())}),$scope.doRefresh=function(){page=1,$scope.items=[],$scope.loadMore(),$scope.$broadcast("scroll.refreshComplete")},$scope.loadMore=function(){var params=layer.getParams("#searchForm"),url="";return""==params.q?($scope.moredata=!1,!1):(url="http://"+$rootScope.hostName+"/question/list_questions?q="+params.q+"&rows_per_page="+rows_per_page+"&page="+page,$ionicLoading.show(),$http.get(url).success(function(data){data&&data.data&&data.data.length?($scope.items=$scope.items.concat(data.data),console.info($scope.items),data.data.length<rows_per_page?$scope.moredata=!1:$scope.moredata=!0):(1==page&&layer.show("暂无数据！"),$scope.moredata=!1),page++,$scope.$broadcast("scroll.infiniteScrollComplete"),$ionicLoading.hide()}),void 0)},$scope.$on("$stateChangeSuccess",function(){$scope.loadMore()})}]),lvtuanApp.controller("questionsviewsCtrl",["$http","$scope","$state","$rootScope","$stateParams","$ionicLoading",function($http,$scope,$state,$rootScope,$stateParams,$ionicLoading){function init(){var url="http://"+$rootScope.hostName+"/question/"+$stateParams.id;$ionicLoading.show(),$http.get(url).success(function(data){console.info(data.data),$scope.items=data.data})["finally"](function(data){$ionicLoading.hide()})}init(),$scope.collects=function(id){$http.post("http://"+$rootScope.hostName+"/collect",{collect_type:1,item_id:id},{headers:{"Content-Type":"application/json",Authorization:"bearer "+$rootScope.token}}).success(function(data){$scope.items.is_collect=!0,layer.show("收藏成功！")})},$scope.collects_del=function(id){$http.post("http://"+$rootScope.hostName+"/collect/delete",{collect_type:1,item_id:id},{headers:{"Content-Type":"application/json",Authorization:"bearer "+$rootScope.token}}).success(function(data){$scope.items.is_collect=!1,layer.show("取消成功！")})}}]),lvtuanApp.controller("legaladviceCtrl",["$http","$scope","$rootScope",function($http,$scope,$rootScope){function getparamq(){var param=layer.getParams("#search_form");getUrlq(param)}function getUrlq(param){var url="";url+=param.q?"http://"+$rootScope.hostName+"/knowledge/article/list_articles?q="+param.q+"&page="+page++:"http://"+$rootScope.hostName+"/knowledge/article/list_articles?page="+page++,$http.get(url).success(function(data){return console.info("法规",data.data),data.data.length>0?(data.data.length>9?$scope.moredata=!0:$scope.moredata=!1,void($scope.knowledges=$scope.knowledges.concat(data.data))):(layer.show("暂无数据！"),$scope.moredata=!1,!1)})["finally"](function(){$scope.$broadcast("scroll.refreshComplete"),$scope.$broadcast("scroll.infiniteScrollComplete")})}var page=1;$scope.moredata=!0,$scope.knowledges=[],$scope.search=function(){page=1,$scope.knowledges=[],getparamq()},$scope.doRefresh=function(){page=1,$scope.knowledges=[],getparamq()},$scope.loadMore=function(){getparamq()}}]),lvtuanApp.controller("lawlectureCtrl",["$http","$scope","$state","$rootScope",function($http,$scope,$state,$rootScope){console.info("法律讲堂")}]),lvtuanApp.controller("casescommCtrl",["$http","$scope","$state","$rootScope",function($http,$scope,$state,$rootScope){console.info("案件委托")}]),lvtuanApp.controller("lvtuanallianceCtrl",["$http","$scope","$state","$rootScope",function($http,$scope,$state,$rootScope){function init(){var url="http://"+$rootScope.hostName+"/union/list_partners";$http.get(url).success(function(data){$scope.unions=data.data})}init()}]),lvtuanApp.controller("lvtuanallianceviewCtrl",["$http","$scope","$state","$rootScope","$stateParams",function($http,$scope,$state,$rootScope,$stateParams){function init(){var url="http://"+$rootScope.hostName+"/union/list_partners";$http.get(url).success(function(data){for(var itmes=data.data,i=0;i<itmes.length;i++)if(id==itmes[i].id){$scope.union=itmes[i];break}})}var id=$stateParams.id;init()}]),lvtuanApp.controller("talentCtrl",["$http","$scope","$state","$rootScope",function($http,$scope,$state,$rootScope){function init(){var url="http://"+$rootScope.hostName+"/hr/list_positions";$http.get(url).success(function(data){$scope.positions=data.data,console.info($scope.positions)})}init()}]),lvtuanApp.controller("talentviewCtrl",["$http","$scope","$state","$rootScope","$stateParams",function($http,$scope,$state,$rootScope,$stateParams){function init(){var url="http://"+$rootScope.hostName+"/hr/"+$stateParams.id+"/view";$http.get(url).success(function(data){$scope.positions=data.data,console.info($scope.positions)})}init()}]),lvtuanApp.controller("workbenchLawyerCtrl",["$http","$scope","$state","$rootScope",function($http,$scope,$state,$rootScope){$http.get("http://"+$rootScope.hostName+"/center/lawyer/info").success(function(data){return data&&data.data?void($scope.items=data.data):(layer.show("暂无数据！"),!1)})}]),lvtuanApp.controller("orderAllCtrl",["$http","$scope","$rootScope","listHelper","httpWrapper",function($http,$scope,$rootScope,listHelper,httpWrapper){listHelper.bootstrap("/center/pay/lawyer/question/all",$scope),$scope.remove=function(id,index){httpWrapper.request("http://"+$rootScope.hostName+"/center/lawyer/question/"+id+"/remove","post",null,function(data){$scope.items.splice(index,1),layer.show("删除成功！")},function(data){console.info(data)})},$scope.accept=function(id,index){httpWrapper.request("http://"+$rootScope.hostName+"/center/pay/lawyer/question/"+id+"/accept","post",null,function(data){$scope.items.splice(index,1),layer.show("受理成功！")},function(data){console.info(data)})},$scope.refuse=function(id,index){httpWrapper.request("http://"+$rootScope.hostName+"/center/pay/lawyer/question/"+id+"/refuse","post",null,function(data){$scope.items.splice(index,1),layer.show("拒绝成功！")},function(data){console.info(data)})},$scope.comment=function(id){location.href="#/lawyer/order/comment/"+id},$scope.ask=function(id){location.href="#/easemobmain/"+id}}]),lvtuanApp.controller("orderNewCtrl",["$scope","$rootScope","listHelper","httpWrapper",function($scope,$rootScope,listHelper,httpWrapper){listHelper.bootstrap("/center/pay/lawyer/question/new",$scope),$scope.accept=function(id,index){httpWrapper.request("http://"+$rootScope.hostName+"/center/pay/lawyer/question/"+id+"/accept","post",null,function(data){$scope.items.splice(index,1),layer.show("受理成功！")},function(data){console.info(data)})},$scope.refuse=function(id,index){httpWrapper.request("http://"+$rootScope.hostName+"/center/pay/lawyer/question/"+id+"/refuse","post",null,function(data){$scope.items.splice(index,1),layer.show("拒绝成功！")},function(data){console.info(data)})}}]),lvtuanApp.controller("orderRepliedCtrl",["$http","$rootScope","$scope","listHelper",function($http,$rootScope,$scope,listHelper){listHelper.bootstrap("/center/pay/lawyer/question/replied",$scope),$scope.ask=function(id){location.href="#/easemobmain/"+id}}]),lvtuanApp.controller("orderCompleteCtrl",["$http","$scope","$rootScope","listHelper","httpWrapper",function($http,$scope,$rootScope,listHelper,httpWrapper){listHelper.bootstrap("/center/pay/lawyer/question/complete",$scope),$scope.comment=function(id){location.href="#/lawyer/order/comment/"+id},$scope.remove=function(id,index){httpWrapper.request("http://"+$rootScope.hostName+"/center/lawyer/question/"+id+"/remove","post",null,function(data){$scope.items.splice(index,1),layer.show("删除成功！")},function(data){console.info(data)})}}]),lvtuanApp.controller("orderlawyerDetailCtrl",["$http","$scope","$stateParams","$rootScope","httpWrapper",function($http,$scope,$stateParams,$rootScope,httpWrapper){httpWrapper.get("http://"+$rootScope.hostName+"/center/pay/lawyer/question/"+$stateParams.id+"/view",function(data){$scope.item=data.data,console.info($scope.item)}),$scope.remove=function(id){httpWrapper.request("http://"+$rootScope.hostName+"/center/lawyer/question/"+id+"/remove","post",null,function(data){layer.show("删除成功！")},function(data){console.info(data)})},$scope.accept=function(id){httpWrapper.request("http://"+$rootScope.hostName+"/center/pay/lawyer/question/"+id+"/accept","post",null,function(data){layer.show("受理成功！")},function(data){console.info(data)})},$scope.refuse=function(id){httpWrapper.request("http://"+$rootScope.hostName+"/center/pay/lawyer/question/"+id+"/refuse","post",null,function(data){layer.show("拒绝成功！")},function(data){console.info(data)})},$scope.comment=function(id){location.href="#/lawyer/order/comment/"+id},$scope.ask=function(id){location.href="#/easemobmain/"+id}}]),lvtuanApp.controller("commentorderlawyerCtrl",["$http","$scope","$stateParams","$rootScope","$timeout","httpWrapper",function($http,$scope,$stateParams,$rootScope,$timeout,httpWrapper){$scope.max=5,$scope.ratingVal=5,$scope.readonly=!0,$scope.onHover=function(val){$scope.hoverVal=val},$scope.onLeave=function(){$scope.hoverVal=null},httpWrapper.get("http://"+$rootScope.hostName+"/center/lawyer/question/"+$stateParams.id+"/evaluate/view",function(data){$scope.item=data.data,console.info($scope.item),$scope.ratingVal=$scope.item.evaluate_score})}]),lvtuanApp.controller("lawyerquestionNewCtrl",["$scope","$rootScope","listHelper","httpWrapper",function($scope,$rootScope,listHelper,httpWrapper){listHelper.bootstrap("/center/lawyer/question/new",$scope),$scope.to_take=function(id){httpWrapper.request("http://"+$rootScope.hostName+"/question/"+id+"/to_take","post",null,function(data){layer.show("抢单成功！"),location.href="#/lawyerquestion/replied"},function(data){console.info(data)})}}]),lvtuanApp.controller("lawyerquestionRepliedCtrl",["$scope","$rootScope","$http","listHelper","httpWrapper",function($scope,$rootScope,$http,listHelper,httpWrapper){listHelper.bootstrap("/center/lawyer/question/replied",$scope),$scope.ask=function(id){location.href="#/easemobmain/"+id}}]),lvtuanApp.controller("lawyerquestionCompleteCtrl",["$scope","$rootScope","listHelper","httpWrapper",function($scope,$rootScope,listHelper,httpWrapper){listHelper.bootstrap("/center/lawyer/question/complete",$scope),$scope.comment=function(id){location.href="#/lawyer/order/comment/"+id},$scope.remove=function(id,index){httpWrapper.request("http://"+$rootScope.hostName+"/center/lawyer/question/"+id+"/remove","post",null,function(data){$scope.items.splice(index,1),layer.show("删除成功！")},function(data){console.info(data)})}}]),lvtuanApp.controller("lawyerquestionsviewCtrl",["$http","$scope","$stateParams","$rootScope","httpWrapper",function($http,$scope,$stateParams,$rootScope,httpWrapper){httpWrapper.get("http://"+$rootScope.hostName+"/center/lawyer/question/"+$stateParams.id+"/view",function(data){$scope.items=data.data,console.info($scope.items)}),$scope.to_take=function(id){httpWrapper.request("http://"+$rootScope.hostName+"/question/"+id+"/to_take","post",null,function(data){layer.show("抢单成功！"),location.href="#/lawyerquestion/replied"},function(data){console.info(data)})},$scope.ask=function(id){location.href="#/easemobmain/"+id},$scope.remove=function(id,index){httpWrapper.request("http://"+$rootScope.hostName+"/center/lawyer/question/"+id+"/remove","post",null,function(data){$scope.items.splice(index,1),layer.show("删除成功！")},function(data){console.info(data)})}}]),lvtuanApp.controller("easemobmainCtrl",["$scope","$http","$state","$rootScope","$stateParams","easemobService","$ionicLoading",function($scope,$http,$state,$rootScope,$stateParams,easemobService,$ionicLoading){$http.get("http://"+$rootScope.hostName+"/center/question/"+$stateParams.id+"/ask").success(function(data){if(data&&data.data){var items=data.data;$scope.curChatUserId=items.user_id,$scope.curUserId=items.easemob_id,easemobService.init(items.user_id,"chat"),easemobService.login(items.easemob_id.toString(),items.easemob_pwd)}});var page=1,rows_per_page=10;$scope.loadMore=function(){var str="",url="http://"+$rootScope.hostName+"/question/"+$stateParams.id+"/comment_list?page="+page+"&rows_per_page="+rows_per_page;$ionicLoading.show(),$http.get(url).success(function(data){obj=data.data.comments;for(var i=0;i<obj.length;i++)style="left",str+=obj[i].creator_id==$scope.curUserId?'<div class="easemobmain-record img-right" style="text-align:right;">':'<div class="easemobmain-record img-left" style="text-align:left;">',str+="<p1>"+obj[i].created_at+"<span></span></p1>",str+="<p2>"+obj[i].creator_name+"<b></b></p2>",str+="<img src="+obj[i].creator_avatar+"><br>",str+='<p3 class="chat-content-p3" className="chat-content-p3">'+obj[i].content+"</p3>",str+="</div>";obj.length<rows_per_page&&$("#comments-list").hide(),$("#page").after(str),$("#page").css("display","none"),page++,$ionicLoading.hide()}).error(function(data){console.info(data);var error=$.parseJSON(data.responseText);layer.show(error.error_messages),console.info(error)})},$scope.sendText=function(){var comment=$("#talkInputId").val(),result=easemobService.sendText("chat");result&&$scope.saveComment(comment)},$scope.textKeyDown=function($event){13==$event.keyCode&&($event.altKey?(e=$event.target.value,$(this).val(e+"\n")):($scope.sendText(),$event.preventDefault()))},$scope.saveComment=function(comment){var comment=comment,creator_id=$scope.curUserId,url="http://"+$rootScope.hostName+"/question/"+$stateParams.id+"/comment";$http.post(url,{comment:comment,creator_id:creator_id}).success(function(data){console.info(data)}).error(function(data){console.info(data)})}}]),lvtuanApp.controller("userlvtuanCtrl",["$scope","$rootScope",function($scope,$rootScope){console.info("律师的律团")}]),lvtuanApp.controller("questionAllCtrl",["$http","$scope","$rootScope","listHelper","httpWrapper",function($http,$scope,$rootScope,listHelper,httpWrapper){listHelper.bootstrap("/center/question/all",$scope),$scope.remove=function(id,index){httpWrapper.request("http://"+$rootScope.hostName+"/center/question/"+id+"/remove","post",null,function(data){$scope.items.splice(index,1),layer.show("删除成功！")},function(data){console.info(data)})},$scope.cancel=function(id,index){httpWrapper.request("http://"+$rootScope.hostName+"/center/question/"+id+"/cancel","post",null,function(data){$scope.items[index]=data.data.data,layer.show("取消成功！")},function(data){console.info(data)})},$scope.complete=function(id,index){httpWrapper.request("http://"+$rootScope.hostName+"/center/question/"+id+"/to_complete","post",null,function(data){layer.show("确认成功！"),$scope.items.splice(index,1)},function(data){console.info(data)})},$scope.ask=function(id){location.href="#/easemobmain/"+id},$scope.send=function(id){location.href="#/send/mind/"+id},$scope.evaluate=function(id,index){$scope.items.splice(index,1),location.href="#/confirmCompletion/"+id}}]),lvtuanApp.controller("questionNewCtrl",["$scope","$rootScope","$http","listHelper","httpWrapper",function($scope,$rootScope,$http,listHelper,httpWrapper){listHelper.bootstrap("/center/question/new",$scope),$scope.cancel=function(id,index){httpWrapper.request("http://"+$rootScope.hostName+"/center/question/"+id+"/cancel","post",null,function(data){$scope.items.splice(index,1),layer.show("取消成功！")},function(data){console.info(data)})}}]),lvtuanApp.controller("questionRepliedCtrl",["$http","$scope","$rootScope","listHelper","httpWrapper",function($http,$scope,$rootScope,listHelper,httpWrapper){listHelper.bootstrap("/center/question/replied",$scope),$scope.complete=function(id,index){httpWrapper.request("http://"+$rootScope.hostName+"/center/question/"+id+"/to_complete","post",null,function(data){layer.show("确认成功！"),$scope.items.splice(index,1),location.href="#/userquestion/waitforconfirmation"},function(data){console.info(data)})},$scope.ask=function(id){location.href="#/easemobmain/"+id}}]),lvtuanApp.controller("questionWaitforconfirmationCtrl",["$scope","$rootScope","listHelper","httpWrapper",function($scope,$rootScope,listHelper,httpWrapper){listHelper.bootstrap("/center/question/waitforevaluation",$scope),$scope.evaluate=function(id,index){$scope.items.splice(index,1),location.href="#/confirmCompletion/"+id}}]),lvtuanApp.controller("confirmCompletionCtrl",["$scope","$http","$rootScope","$stateParams","listHelper","httpWrapper",function($scope,$http,$rootScope,$stateParams,listHelper,httpWrapper){listHelper.bootstrap("/center/question/waitforevaluation",$scope),$scope.max=5,$scope.ratingVal=5,$scope.readonly=!1,$scope.onHover=function(val){$scope.hoverVal=val},$scope.onLeave=function(){$scope.hoverVal=null},$scope.onChange=function(val){$scope.ratingVal=val,console.info(val)},$scope.user={evaluate_comment:""},$scope.submit=function(){var data={};$scope.ratingVal&&(data.evaluate_score=$scope.ratingVal),$scope.user.evaluate_comment&&(data.evaluate_comment=$scope.user.evaluate_comment),data=data,httpWrapper.request("http://"+$rootScope.hostName+"/center/question/"+$stateParams.id+"/to_evaluate","post",data,function(data){layer.show("评价成功！"),$scope.user={},location.href="#/userquestion/waitforconfirmation"},function(data){console.info(data)})},$scope.cancel=function(){$scope.ratingVal=5,$scope.user={evaluate_comment:""}}}]),lvtuanApp.controller("userquestionviewCtrl",["$http","$scope","$stateParams","$rootScope","httpWrapper",function($http,$scope,$stateParams,$rootScope,httpWrapper){httpWrapper.get("http://"+$rootScope.hostName+"/center/question/"+$stateParams.id+"/view",function(data){$scope.items=data.data}),$scope.remove=function(id){httpWrapper.request("http://"+$rootScope.hostName+"/center/question/"+id+"/remove","post",null,function(data){$scope.items.splice(index,1),layer.show("删除成功！")},function(data){console.info(data)})},$scope.cancel=function(id){httpWrapper.request("http://"+$rootScope.hostName+"/center/question/"+id+"/cancel","post",null,function(data){$scope.items[index]=data.data.data,layer.show("取消成功！")},function(data){console.info(data)})},$scope.to_complete=function(id){httpWrapper.request("http://"+$rootScope.hostName+"/center/question/"+id+"/to_complete","post",null,function(data){layer.show("确认成功！"),location.href="#/userquestion/waitforconfirmation"},function(data){console.info(data)})},$scope.ask=function(id){location.href="#/easemobmain/"+id},$scope.send=function(id){location.href="#/send/mind/"+id},$scope.evaluate=function(id,index){$scope.items.splice(index,1),location.href="#/confirmCompletion/"+id}}]),lvtuanApp.controller("sendmindCtrl",["$http","$scope","$rootScope","$stateParams",function($http,$scope,$rootScope,$stateParams){$scope.submit=function(){var money=$scope.user.money;return 0>=money?(layer.show("金额不能小于0！"),!1):money>1e6?(layer.show("金额不能大于1000000！"),!1):void $http.post("http://"+$rootScope.hostName+"/wallet/reward",{user_id:$stateParams.id,money:money}).success(function(data){layer.show("送心意成功。"),$scope.user={}})}}]),lvtuanApp.controller("userorderAllCtrl",["$http","$scope","$rootScope","listHelper","httpWrapper",function($http,$scope,$rootScope,listHelper,httpWrapper){listHelper.bootstrap("/center/pay/question/all",$scope),$scope.remove=function(id,index){httpWrapper.request("http://"+$rootScope.hostName+"/center/question/"+id+"/remove","post",null,function(data){$scope.items.splice(index,1),layer.show("删除成功！")},function(data){console.info(data)})},$scope.cancel=function(id,index){httpWrapper.request("http://"+$rootScope.hostName+"/center/question/"+id+"/cancel","post",null,function(data){$scope.items[index]=data.data.data,layer.show("取消成功！")},function(data){console.info(data)})},$scope.complete=function(id,index){httpWrapper.request("http://"+$rootScope.hostName+"/center/question/"+id+"/to_complete","post",null,function(data){layer.show("确认成功！"),$scope.items.splice(index,1)},function(data){console.info(data)})},$scope.ask=function(id){location.href="#/easemobmain/"+id},$scope.pay=function(id){location.href="#/pay/"+id+"?type=question"},$scope.evaluate=function(id,index){$scope.items.splice(index,1),location.href="#/confirmCompletion/"+id}}]),lvtuanApp.controller("userorderPendingCtrl",["$http","$scope","$rootScope","listHelper","httpWrapper",function($http,$scope,$rootScope,listHelper,httpWrapper){listHelper.bootstrap("/center/pay/question/waitpay",$scope),$scope.remove=function(id,index){httpWrapper.request("http://"+$rootScope.hostName+"/center/question/"+id+"/remove","post",null,function(data){$scope.items.splice(index,1),layer.show("删除成功！")},function(data){console.info(data)})},$scope.pay=function(id){location.href="#/pay/"+id+"?type=question"}}]),lvtuanApp.controller("userorderNewCtrl",["$scope","$rootScope","listHelper","httpWrapper",function($scope,$rootScope,listHelper,httpWrapper){listHelper.bootstrap("/center/pay/question/new",$scope),$scope.cancel=function(id,index){httpWrapper.request("http://"+$rootScope.hostName+"/center/question/"+id+"/cancel","post",null,function(data){$scope.items[index]=data.data.data,layer.show("取消成功！")},function(data){console.info(data)})}}]),lvtuanApp.controller("userorderRepliedCtrl",["$http","$scope","$rootScope","listHelper","httpWrapper",function($http,$scope,$rootScope,listHelper,httpWrapper){listHelper.bootstrap("/center/pay/question/replied",$scope),$scope.complete=function(id,index){httpWrapper.request("http://"+$rootScope.hostName+"/center/question/"+id+"/to_complete","post",null,function(data){layer.show("确认成功！"),$scope.items.splice(index,1)},function(data){console.info(data)})},$scope.ask=function(id){location.href="#/easemobmain/"+id}}]),lvtuanApp.controller("userorderWaitforevaluationCtrl",["$scope","listHelper",function($scope,listHelper){listHelper.bootstrap("/center/pay/question/waitforevaluation",$scope),$scope.evaluate=function(id,index){$scope.items.splice(index,1),location.href="#/confirmCompletion/"+id}}]),lvtuanApp.controller("userOrderDetailCtrl",["$http","$scope","$state","$rootScope","$stateParams",function($http,$scope,$state,$rootScope,$stateParams){$http.get("http://"+$rootScope.hostName+"/center/pay/question/"+$stateParams.id+"/view").success(function(data){return data&&data.data?($scope.item=data.data,!0):(layer.show("暂无数据！"),!1)}),$scope.remove=function(id){httpWrapper.request("http://"+$rootScope.hostName+"/center/question/"+id+"/remove","post",null,function(data){layer.show("删除成功！"),location.href="#/orderuser/pending"},function(data){console.info(data)})},$scope.pay=function(id){location.href="#/pay/"+id+"?type=question"},$scope.cancel=function(id){httpWrapper.request("http://"+$rootScope.hostName+"/center/question/"+id+"/cancel","post",null,function(data){layer.show("取消成功！"),location.href="#/orderuser/new"},function(data){console.info(data)})}}]),lvtuanApp.controller("documentlistCtrl",["$http","$scope","$state","$rootScope","$timeout","$ionicLoading",function($http,$scope,$state,$rootScope,$timeout,$ionicLoading){function getParams(key){$ionicLoading.show();var url="http://"+$rootScope.hostName+"/knowledge/document/list_documents?cat_id="+key+"&rows_per_page="+rows_per_page+"&page="+page;$http.get(url).success(function(data){console.info(data.data),data&&data.data&&data.data.length?($scope.items=$scope.items.concat(data.data),console.info($scope.items),data.data.length<rows_per_page?$scope.moredata=!1:$scope.moredata=!0):(1==page&&layer.show("暂无数据！"),$scope.moredata=!1),page++,$scope.$broadcast("scroll.infiniteScrollComplete"),$ionicLoading.hide()})}$ionicLoading.show(),$http.get("http://"+$rootScope.hostName+"/lawyer/workscopes").success(function(data){data.data?($scope.workscopes=data.data,sessionStorage.setItem("key",JSON.stringify($scope.workscopes[0].key)),getParams($scope.workscopes[0].key),$ionicLoading.hide()):layer.show("暂无数据！")}),$scope.inShowscopes=function(key){var value=!1;return $scope.key=JSON.parse(sessionStorage.getItem("key")),key==$scope.key&&(value=!0),value};var page=1,rows_per_page=5;$scope.rows_per_page&&(rows_per_page=$scope.rows_per_page),$scope.moredata=!0,$scope.items=[],$scope.doRefresh=function(){page=1,$scope.items=[],$scope.loadMore(),$scope.$broadcast("scroll.refreshComplete")},$scope.loadMore=function(){$scope.key=JSON.parse(sessionStorage.getItem("key")),getParams($scope.key)},$scope.ngClick_list=function(key){page=1,$scope.items=[],sessionStorage.setItem("key",JSON.stringify(key)),getParams(key)}}]),lvtuanApp.controller("documentlistsearchCtrl",["$http","$scope","$state","$rootScope","$timeout","$ionicLoading",function($http,$scope,$state,$rootScope,$timeout,$ionicLoading){var page=1,rows_per_page=5;$scope.rows_per_page&&(rows_per_page=$scope.rows_per_page),$scope.moredata=!0,$scope.items=[],$scope.q="",$scope.$watch("q",function(newVal,oldVal){newVal!==oldVal&&(page=1,$scope.items=[],$scope.loadMore())}),$scope.doRefresh=function(){page=1,$scope.items=[],$scope.loadMore(),$scope.$broadcast("scroll.refreshComplete")},$scope.loadMore=function(){var params=layer.getParams("#searchForm"),url="";return""==params.q?($scope.moredata=!1,!1):(url="http://"+$rootScope.hostName+"/knowledge/document/list_documents?q="+params.q+"&rows_per_page="+rows_per_page+"&page="+page,$ionicLoading.show(),$http.get(url).success(function(data){data&&data.data&&data.data.length?($scope.items=$scope.items.concat(data.data),console.info($scope.items),data.data.length<rows_per_page?$scope.moredata=!1:$scope.moredata=!0):(1==page&&layer.show("暂无数据！"),$scope.moredata=!1),page++,$scope.$broadcast("scroll.infiniteScrollComplete"),$ionicLoading.hide()}),void 0)},$scope.$on("$stateChangeSuccess",function(){$scope.loadMore()})}]),lvtuanApp.controller("documentownloadlistCtrl",["$http","$scope","$state","$rootScope","$stateParams",function($http,$scope,$state,$rootScope,$stateParams){$http.get("http://"+$rootScope.hostName+"/knowledge/document/"+$stateParams.id+"/view").success(function(data){console.info("法律文书详情",data.data),$scope.itmes=data.data})}]),lvtuanApp.controller("corporateservicesCtrl",["$http","$scope","$state","$rootScope","$stateParams",function($http,$scope,$state,$rootScope,$stateParams){$scope.counsels=[{img:"01.png",title:"防范合同风险",content:"商务合同、法律文书一审再审，专业填坑我最强"},{img:"02.png",title:"避免劳资纠纷",content:"从员工入职到离职，全流程风险预警与控制，有效避免劳资纠纷"},{img:"03.png",title:"维护企业权益",content:"一旦企业权益受损，务必全力维权，将损失降至最低"},{img:"04.png",title:"法律风险评估",content:"定期进行专业的企业法律风险评估，并提供靠谱的整改意见"},{img:"05.png",title:"节约时间成本",content:"专业的事交给专业的律师来做，您可以专心管理和经营企业"},{img:"06.png",title:"案件委托优惠",content:"个案委托八五折起，您可以省下大笔律师费，用于企业发展"}];var page=1;$scope.moredata=!0,$scope.items=[],$scope.doRefresh=function(){page=1,$scope.items=[],$scope.loadMore()},$scope.loadMore=function(){$http.get("http://"+$rootScope.hostName+"/company/product/list?page="+page++).success(function(data){return console.info("待确认",data.data),data.data.length>0?(data.data.length>9?$scope.moredata=!0:$scope.moredata=!1,$scope.items=data.data,!0):($scope.moredata=!1,layer.show("暂无数据！"),!1)})}}]),lvtuanApp.controller("corporatelistCtrl",["$scope","$state","$http","$rootScope","$stateParams","$ionicPopup","$timeout","$ionicLoading",function($scope,$state,$http,$rootScope,$stateParams,$ionicPopup,$timeout,$ionicLoading){switch($scope.counsels={counsels_8800:{id:"1",title:"企业法律顾问银卡提供的服务",money:"8800元/年(两年起签)",banner_img:"banner_1.png",counsels_arry:[{title:"电话咨询",content:"不限次，无论您遇到什么问题，一个电话随时连线律师。找律师，从未如此简单。"},{title:"风险诊断",content:"不限次，企业经营、决策过程中有任何不确定的风险、困惑，我们负责帮您诊断。"},{title:"文件下载",content:"不限次，由专业律师团队精心整理、审阅过的海量实用文书，您可免费任意下载。"},{title:"免费律师函",content:"2份，一旦企业权益受损，我们将帮您发出律师函，以及时制止不法的侵权行为。"},{title:"法律文书制作、修改",content:"5份，企业经营过程中涉及的各类法律文书的制作、修改及审核，包您高枕无忧。"},{title:"企业管理制度全面规划化",content:"1次，对企业的管理规章制度进行全方位的合法性审查，并给出专业的规划建议。"},{title:"律师在所会面",content:"2次，在律团的办公场所为您面对面地提供直接、高效的法律服务。服务内容任选。"},{title:"网上法律实务培训",content:"2次，我们将在网上为您公司的全体员工进行法律实务的专业培训，包括训后咨询。"},{title:"企业风险评估及整改意见",content:"1份，对您的企业进行专业、全面的法律风险评估，并且提供靠谱的整改意见。"},{title:"年终企业法律顾问服务总结报告",content:"1份，我们将给出服务期内（一年）法律顾问服务的总结性报告，以供分析、参考。"},{title:"个案委托",content:"八五折，在法律顾问服务期间，您公司的案件委托一律八五折，不限案件性质及范围。"}]},counsels_18800:{id:"2",title:"企业法律顾问金卡提供的服务",money:"18800元/年(一年起签)",banner_img:"banner_2.png",counsels_arry:[{title:"电话咨询",content:"不限次，无论您遇到什么问题，一个电话随时连线律师。找律师，从未如此简单。"},{title:"风险诊断",content:"不限次，企业经营、决策过程中有任何不确定的风险、困惑，我们负责帮您诊断。"},{title:"免费律师函",content:"4份，一旦企业权益受损，我们将帮您发出律师函，以及时制止不法的侵权行为。"},{title:"法律文书制作、修改",content:"10份，企业经营过程中涉及的各类法律文书的制作、修改及审核，包您高枕无忧。"},{title:"企业管理制度全面规划化",content:"1次，对企业的管理规章制度进行全方位的合法性审查，并给出专业的规划建议。"},{title:"律师在所会面",content:"4次，在律团的办公场所为您面对面地提供直接、高效的法律服务。服务内容任选。"},{title:"上门法律实务培训",content:"1次，我们将拜访您的公司并为全体员工进行法律实务的专业培训，包括训后咨询。"},{title:"企业风险评估及整改意见",content:"1份，对您的企业进行专业、全面的法律风险评估，并且提供靠谱的整改意见。"},{title:"年终企业法律顾问服务总结报告",content:"1份，我们将给出服务期内（一年）法律顾问服务的总结性报告，以供分析、参考。"},{title:"个案委托",content:"八五折，在法律顾问服务期间，您公司的案件委托一律八五折，不限案件性质及范围。"}]},counsels_28800:{id:"3",title:"企业法律顾问金卡提供的服务",money:"28800元/年(一年起签)",banner_img:"banner_3.png",counsels_arry:[{title:"电话咨",content:"不限次，无论您遇到什么问题，一个电话随时连线律师。找律师，从未如此简单。"},{title:"风险诊断",content:"不限次，企业经营、决策过程中有任何不确定的风险、困惑，我们负责帮您诊断。"},{title:"免费律师函",content:"8份，一旦企业权益受损，我们将帮您发出律师函，以及时制止不法的侵权行为。"},{title:"法律文书制作、修改",content:"15份，企业经营过程中涉及的各类法律文书的制作、修改及审核，包您高枕无忧。"},{title:"企业管理制度全面规划化",content:"1次，对企业的管理规章制度进行全方位的合法性审查，并给出专业的规划建议。"},{title:"律师在所会面",content:"6次，在律团的办公场所为您面对面地提供直接、高效的法律服务。服务内容任选。"},{title:"上门法律实务培训",content:"2次，我们将拜访您的公司并为全体员工进行法律实务的专业培训，包括训后咨询。"},{title:"企业风险评估及整改意见",content:"1份，对您的企业进行专业、全面的法律风险评估，并且提供靠谱的整改意见。"},{title:"年终企业法律顾问服务总结报告",content:"1份，我们将给出服务期内（一年）法律顾问服务的总结性报告，以供分析、参考。"},{title:"个案委托",content:"八五折，在法律顾问服务期间，您公司的案件委托一律八五折，不限案件性质及范围。"}]}},$scope.items=null,$stateParams.id){case"1":$scope.items=$scope.counsels.counsels_8800;break;case"2":$scope.items=$scope.counsels.counsels_18800;break;case"3":$scope.items=$scope.counsels.counsels_28800}}]),lvtuanApp.controller("corporatebuynowCtrl",["$scope","$http","$rootScope","$stateParams","$ionicLoading","$localStorage","$location",function($scope,$http,$rootScope,$stateParams,$ionicLoading,$localStorage,$location){$scope.user={},$scope.addres_param={},$scope.addres=$localStorage.addres||"",$scope.$watch("addres",function(newVal,oldVal){console.log("newVal: ",newVal),$localStorage.addres=$scope.addres,$scope.addres_param=$localStorage.addres,$scope.addres_param?($scope.user={address:$scope.addres_param.province.value+" "+$scope.addres_param.city.value+" "+$scope.addres_param.district.value},console.info("address",$scope.address)):$scope.user={address:""}}),$scope.$watch(function(){return angular.toJson($localStorage)},function(){$scope.addres=$localStorage.addres,console.info($scope.addres)}),$scope.getAddress=function(){delete $localStorage.addres,localStorage.setItem("citypicke_goback",$location.path()),location.href="#/citypicke/all"},console.log($stateParams.id),$scope.submit=function(user){$ionicLoading.show();var param={},province=$scope.addres_param.province.key,city=$scope.addres_param.city.key,district=$scope.addres_param.district.key;user.email&&(param.email=user.email),
user.company_name&&(param.company_name=user.company_name),user.memo&&(param.memo=user.memo),province&&(param.province=province),city&&(param.city=city),district&&(param.district=district),1==user.invoice?param.invoice="Y":param.invoice="N",$stateParams.id&&(param.product_id=$stateParams.id),console.info(param),$ionicLoading.show(),$http.post("http://"+$rootScope.hostName+"/company/order/submit",param).success(function(data){$ionicLoading.hide(),console.log(data.data),$scope.user={},delete $localStorage.addres,location.href="#/pay/"+data.data.post.id+"?type=order"})}}]),lvtuanApp.controller("userwalletCtrl",["$scope","$http","$rootScope","authService","$ionicLoading",function($scope,$http,$rootScope,authService,$ionicLoading){$scope.$on("$ionicView.beforeEnter",function(){var currentUser=authService.getUser(),timestamp=Math.round((new Date).getTime()/1e3);$scope.items={},$ionicLoading.show(),1==currentUser.status||2==currentUser.status?$http.get("http://"+$rootScope.hostName+"/center/customer/wallet?ts="+timestamp).success(function(data){data&&data.data&&($scope.items=data.data,sessionStorage.setItem("summoney",$scope.items.money)),$ionicLoading.hide()}):$http.get("http://"+$rootScope.hostName+"/center/lawyer/wallet?ts="+timestamp).success(function(data){data&&data.data&&($scope.items=data.data,localStorage.setItem("summoney",$scope.items.money)),$ionicLoading.hide()})})}]),lvtuanApp.controller("wxCheckOpenIdCtrl",["$scope","$http","$rootScope","$stateParams","authService","wxService",function($scope,$http,$rootScope,$stateParams,authService,wxService){$scope.$on("$ionicView.beforeEnter",function(){wxService.getOpenId()?location.href="#/user/moneyin":window.location.replace(wxService.getWxAuthUrl("/wxauthpayment"))})}]),lvtuanApp.controller("wxAuthPaymentCtrl",["$scope","$http","$rootScope","$stateParams","authService","wxService","$ionicLoading",function($scope,$http,$rootScope,$stateParams,authService,wxService,$ionicLoading){var code=$stateParams.code,state=$stateParams.state;$ionicLoading.show(),$http.get("http://"+AppSettings.baseApiUrl+"/openid?code="+code+"&state="+state).then(function(res){var authData=res.data?res.data.data:null;wxService.saveOpenId(authData.openid),$ionicLoading.hide(),location.href="#/user/moneyin"})["catch"](function(response){console.error("Gists error",response.status,response.data),400===response.status})}]),lvtuanApp.controller("usermoneyinCtrl",["$scope","$http","$rootScope","$stateParams","authService","wxService","$ionicLoading",function($scope,$http,$rootScope,$stateParams,authService,wxService,$ionicLoading){var self=this,currentUser=authService.getUser();$scope.summoney=sessionStorage.getItem("summoney");$scope.$on("$ionicView.beforeEnter",function(){console.info(sessionStorage.getItem("summoney")),$scope.summoney=sessionStorage.getItem("summoney")}),self.jsApiCall=function(user){if(wxService.getOpenId()){var attach_params={};attach_params.platform="wechat",attach_params.type="wallet",attach_params.user_id=currentUser.id,attach_params.money=user.money,attach_str=JSON.stringify(attach_params);var timestamp=Math.round((new Date).getTime()/1e3);$ionicLoading.show(),$http.get("http://"+$rootScope.hostName+"/payment/jsapiparams/"+wxService.getOpenId()+"/"+attach_str+"?ts="+timestamp,{}).success(function(data){$ionicLoading.hide(),console.info(data),data&&data.data&&data.data.params&&(self.params=data.data.params,WeixinJSBridge.invoke("getBrandWCPayRequest",self.params,function(res){switch(WeixinJSBridge.log(res.err_msg),res.err_msg){case"get_brand_wcpay_request:ok":location.href="#/user/wallet",sessionStorage.setItem("summoney",sessionStorage.getItem("summoney")+user.money),layer.show("充值成功。");break;case"get_brand_wcpay_request:fail":layer.show("充值失败，请稍候再试。");break;case"get_brand_wcpay_request:cancel":layer.show("您已取消充值。"),$state.go("user/wallet")}}))})}else layer.show("用户需要先通过微信登录才可以使用这个功能")},self.callpay=function(user){"undefined"==typeof WeixinJSBridge?document.addEventListener?document.addEventListener("WeixinJSBridgeReady",self.jsApiCall(user),!1):document.attachEvent&&(document.attachEvent("WeixinJSBridgeReady",self.jsApiCall(user)),document.attachEvent("onWeixinJSBridgeReady",self.jsApiCall(user))):self.jsApiCall(user)},$scope.submit=function(user){self.callpay(user)}}]),lvtuanApp.controller("userrecordCtrl",["$scope","$http","$rootScope","listHelper",function($scope,$http,$rootScope,listHelper){listHelper.bootstrap("/wallet/record?type=recharge",$scope)}]),lvtuanApp.controller("usermoneyoutCtrl",["$scope","$http","$rootScope",function($scope,$http,$rootScope){$scope.summoney=sessionStorage.getItem("summoney"),$scope.submit=function(user){$http.post("http://"+$rootScope.hostName+"/wallet/withdraw",user).success(function(data){$scope.items=data.data,console.info($scope.items),sessionStorage.setItem("summoney",$scope.items.money),$scope.summoney=$scope.items.money,layer.show("提交成功！"),$scope.user={},console.info($scope.user)})}}]),lvtuanApp.controller("userwithdrawCtrl",["$scope","$http","$rootScope","listHelper",function($scope,$http,$rootScope,listHelper){listHelper.bootstrap("/wallet/record?type=withdraw",$scope)}]),lvtuanApp.controller("userpayallCtrl",["$scope","$http","$rootScope","listHelper",function($scope,$http,$rootScope,listHelper){$scope.rows_per_page=15,listHelper.bootstrap("/wallet/record",$scope)}]),lvtuanApp.controller("payCtrl",["$scope","$http","$rootScope","$stateParams","$ionicPopup","listHelper","authService","wxService","$ionicLoading",function($scope,$http,$rootScope,$stateParams,$ionicPopup,listHelper,authService,wxService,$ionicLoading){$scope.user={},$ionicLoading.show(),$http.get("http://"+$rootScope.hostName+"/center/pay/question/"+$stateParams.id+"/view").success(function(data){return $ionicLoading.hide(),data&&data.data?($scope.item=data.data,console.info($scope.item),!0):(layer.show("暂无数据！"),!1)}),$scope.obj="",$scope.change=function(val){$scope.obj=val},$scope.pay=function(user){var currentUser=authService.getUser();if(console.info($scope.obj),"weixin"==user.radioval){var attach_params={};attach_params.platform="wechat",attach_params.type=$stateParams.type,attach_params.item_id=$stateParams.id,attach_params.user_id=currentUser.id,attach_params.money=$scope.item.price,attach_str=JSON.stringify(attach_params);var timestamp=Math.round((new Date).getTime()/1e3);$ionicLoading.show(),$http.get("http://"+$rootScope.hostName+"/payment/jsapiparams/"+wxService.getOpenId()+"/"+attach_str+"?ts="+timestamp,{}).success(function(data){$ionicLoading.hide(),console.info(data),data&&data.data&&data.data.params&&(self.params=data.data.params,WeixinJSBridge.invoke("getBrandWCPayRequest",self.params,function(res){switch(WeixinJSBridge.log(res.err_msg),res.err_msg){case"get_brand_wcpay_request:ok":$ionicLoading.show(),location.href="#/orderuser/new";break;case"get_brand_wcpay_request:fail":layer.show("支付失败，请稍候再试。");break;case"get_brand_wcpay_request:cancel":layer.show("您已取消支付。")}}))})}else if("qianbao"==user.radioval){var confirmPopup=$ionicPopup.confirm({title:"是否立即付款？",cancelText:"取消",okText:"确认"});confirmPopup.then(function(res){return res?void $http.post("http://"+$rootScope.hostName+"/center/question/"+$stateParams.id+"/wallet/pay",{},{headers:{"Content-Type":"application/json",Authorization:"bearer "+$rootScope.token}}).success(function(data){$scope.items=data.data,layer.show("付款成功！"),location.href="#/orderuser/new"}):!1})}else layer.show("请先选择支付方式")}}]),lvtuanApp.controller("citypickerCtrl",["$http","$location","$scope","$rootScope","$anchorScroll","$ionicHistory","$stateParams","$ionicLoading","$ionicScrollDelegate","locationService",function($http,$location,$scope,$rootScope,$anchorScroll,$ionicHistory,$stateParams,$ionicLoading,$ionicScrollDelegate,locationService){function getCityParm(province){$ionicLoading.show(),$http.get("http://"+$rootScope.hostName+"/area/"+province+"/city").success(function(data){data&&data.data&&data.data.length?$scope.citys=data.data:($scope.items={city_id:angular.toJson($scope.province_city_id,!0),city_name:$scope.province_city_name},locationServices($scope.items)),$ionicLoading.hide()})}function locationServices(obj){var locations=locationService.getLocation();locations.city_id=obj.city_id,locations.city_name=obj.city_name,locationService.saveLocation(locations),"index"==$stateParams.id?location.href="#/index":location.href="#/lawyerlist"}$ionicLoading.show(),$http.get("http://"+$rootScope.hostName+"/area/province/letters").success(function(data){$scope.provinces=data.data,$ionicLoading.hide()}),$scope.str=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],$scope["goto"]=function(id){$location.hash(id),$anchorScroll()},$scope.province_city_id=null,$scope.province_city_name=null,$scope.province=function(val){$scope.province_city_id=val.key,$scope.province_city_name=val.value,$(".citypicker .province,.navbar").hide(),$scope.province=val.key,$(".citypicker .cities").show(),getCityParm($scope.province),$ionicScrollDelegate.$getByHandle("mainScroll").scrollTop()},$scope.citie=function(val){$(".citypicker .province,.citypicker .cities").hide(),$scope.items={city_id:angular.toJson(val.key,!0),city_name:val.value},locationServices($scope.items)},$scope.jump_citypicke_GoBack=function(){$ionicHistory.goBack()}}]),lvtuanApp.controller("citypickeAllCtrl",["$http","$state","$location","$scope","$rootScope","$anchorScroll","$ionicHistory","$stateParams","$ionicLoading","$ionicScrollDelegate","$localStorage",function($http,$state,$location,$scope,$rootScope,$anchorScroll,$ionicHistory,$stateParams,$ionicLoading,$ionicScrollDelegate,$localStorage){function getCityParm(province){$ionicLoading.show(),$http.get("http://"+$rootScope.hostName+"/area/"+province+"/city").success(function(data){data&&data.data&&data.data.length&&($scope.citys=data.data),$ionicLoading.hide()})}function getDistrictsParm(city){$ionicLoading.show(),$http.get("http://"+$rootScope.hostName+"/area/"+city+"/district").success(function(data){data&&data.data&&data.data.length&&($scope.districts=data.data),$ionicLoading.hide()})}$ionicLoading.show(),$http.get("http://"+$rootScope.hostName+"/area/province/letters").success(function(data){$scope.provinces=data.data,$ionicLoading.hide()}),$scope.str=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],$scope["goto"]=function(id){$location.hash(id),$anchorScroll()},$scope.province=null,$scope.city=null,$scope.district=null,$scope.province=function(province){$scope.province=province,$(".citypicker .province,.navbar").hide(),$(".citypicker .cities").show(),getCityParm($scope.province.key),$ionicScrollDelegate.$getByHandle("mainScroll").scrollTop()},$scope.citie=function(city){$ionicLoading.show(),$scope.city=city,$(".citypicker .province,.citypicker .cities").hide(),$(".citypicker .districts").show(),getDistrictsParm($scope.city.key),$ionicScrollDelegate.$getByHandle("mainScroll").scrollTop()},$scope.district=function(district){$scope.addres={province:$scope.province,city:$scope.city,district:district},$scope.$storage=$localStorage.$default({addres:$scope.addres}),$scope.url=localStorage.getItem("citypicke_goback"),console.info("#"+$scope.url),location.href="#"+$scope.url},$scope.jump_citypicke_GoBack=function(){$ionicHistory.goBack()}}]),$(function(){function infinite(){var htmlWidth=$("html").width();htmlWidth>=1080?$("html").css({"font-size":"42px"}):$("html").css({"font-size":42/1080*htmlWidth+"px"})}$(window).resize(infinite),infinite()}),angular.module("lvtuanApp",["ionic","lvtuanApp.Ctrl","templates"]).run(["$ionicPlatform",function($ionicPlatform){$ionicPlatform.ready(function(){window.cordova&&window.cordova.plugins.Keyboard&&cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),window.StatusBar&&StatusBar.styleDefault()})}]).run(["$rootScope","$timeout","$location","$ionicLoading",function($rootScope,$timeout,$location,$ionicLoading,$ionicHistory,$window){$rootScope.show=function(){$ionicLoading.show({template:'<ion-spinner icon="circles"></ion-spinner>',noBackdrop:!1})},$rootScope.hide=function(){$ionicLoading.hide()};var hostName=AppSettings.baseApiUrl;localStorage.setItem("hostName",JSON.stringify(hostName)),$rootScope.hostName=JSON.parse(localStorage.getItem("hostName")),$rootScope.goHome=function(){layer.goHome()}}]).run(function($rootScope,$location,$state,authService,locationService){$rootScope.$on("$stateChangeStart",function(event,toState,toParams,fromState,fromParams){toState.authn&&(authService.isAuthed()?(sessionStorage.setItem("goback",$location.path()),currentUser=authService.getUser(),toState.authz&&"lawyer"==toState.authz&&!currentUser.is_verified_lawyer&&($rootScope.$broadcast("unauthorized"),event.preventDefault())):(sessionStorage.setItem("goback",$location.path()),$rootScope.$broadcast("unauthenticated"),event.preventDefault())),$rootScope.path=$location.path()}),$rootScope.$on("unauthorized",function(){layer.show("您没有权限访问这个链接！"),$location.path("/login"),$state.transitionTo("login")}),$rootScope.$on("unauthenticated",function(){layer.show("请先登录！"),$state.transitionTo("login")})}).config(function($httpProvider){$httpProvider.interceptors.push("APIInterceptor")}).config(function($stateProvider,$urlRouterProvider){$stateProvider.state("home",{url:"/home",cache:"true",templateUrl:"template/home.html",controller:"ionicNavBarDelegateCtrl"}).state("index",{url:"/index",cache:"true",templateUrl:"template/index_tpl.html",controller:"indexCtrl"}).state("mylvteam",{url:"/mylvteam",cache:"true",templateUrl:"template/mylvteam.html"}).state("login",{url:"/login",cache:"true",templateUrl:"template/home/login.html"}).state("register",{url:"/register",cache:"true",templateUrl:"template/home/register.html"}).state("resetpwd",{url:"/resetpwd",cache:"true",templateUrl:"template/home/resetpwd.html"}).state("forgotpwd",{url:"/forgotpwd",cache:"true",templateUrl:"template/home/forgotpwd.html"}).state("wxauth",{url:"/wxauth?code&state",cache:"true",controller:"wxAuthCtrl"}).state("wxcheckopenid",{url:"/wxcheckopenid",cache:"true",controller:"wxCheckOpenIdCtrl"}).state("wxauthpayment",{url:"/wxauthpayment?code&state",cache:"true",controller:"wxAuthPaymentCtrl"}).state("wxlogin",{url:"/wxlogin",cache:"true",controller:"wxLoginCtrl"}).state("group",{url:"/group",cache:"true",templateUrl:"template/group/group.html",controller:"groupCtrl",authn:!0,authz:"lawyer"}).state("group.list",{url:"/list",cache:"true",views:{"group-list":{templateUrl:"template/group/group-list.html",controller:"groupListCtrl"}},authn:!0,authz:"lawyer"}).state("group.televise",{url:"/televise",cache:"true",views:{"group-televise":{templateUrl:"template/group/group-televise.html",controller:"groupTeleviseCtrl"}},authn:!0,authz:"lawyer"}).state("group.attention",{url:"/attention",cache:"true",views:{"group-attention":{templateUrl:"template/group/group-attention.html"}},authn:!0,authz:"lawyer"}).state("groupviewinit",{url:"/group/viewinit/:id",controller:"groupviewinitCtrl",authn:!0,authz:"lawyer"}).state("groupview",{url:"/group/view/:id",templateUrl:"template/group/group_view.html",controller:"groupviewCtrl",authn:!0,authz:"lawyer"}).state("broadcast/view",{url:"/broadcast/view/:id",templateUrl:"template/group/broadcast_view.html",controller:"broadcastviewCtrl",authn:!0,authz:"lawyer"}).state("groupcreate",{url:"/groupcreate",templateUrl:"template/group/create.html",controller:"groupcreateCtrl",authn:!0,authz:"lawyer"}).state("televisecreate",{url:"/televisecreate",templateUrl:"template/group/televisecreate.html",controller:"televisecreateCtrl",authn:!0,authz:"lawyer"}).state("group/site",{url:"/group/site/:id",templateUrl:"template/group/group-site.html",controller:"groupsiteCtrl",authn:!0,authz:"lawyer"}).state("group/add",{url:"/group/add/:id",templateUrl:"template/group/group-add.html",controller:"groupaddCtrl",authn:!0,authz:"lawyer"}).state("knowledge",{url:"/knowledge",templateUrl:"template/knowledge/knowledge.html"}).state("knowledge.knowledges",{url:"/knowledges",cache:"true",views:{"knowledge-knowledges":{templateUrl:"template/knowledge/knowledge-knowledges.html",controller:"knowledgesCtrl"}}}).state("knowledge.documents",{url:"/documents",cache:"true",views:{"knowledge-documents":{templateUrl:"template/knowledge/knowledge-documents.html",controller:"documentsCtrl"}}}).state("knowledge.cases",{url:"/cases",cache:"true",views:{"knowledge-cases":{templateUrl:"template/knowledge/knowledge-cases.html",controller:"casesCtrl"}}}).state("knowledgeview",{url:"/knowledgeview/:id",cache:"true",templateUrl:"template/knowledge/knowledges-view.html",controller:"knowledgeViewCtrl"}).state("comments/view",{url:"/comments/view/:id",cache:"true",templateUrl:"template/knowledge/comments-view.html",controller:"commentsViewCtrl"}).state("center",{url:"/center",cache:"true",templateUrl:"template/center/center.html",controller:"centerCtrl",authn:!0}).state("info",{url:"/info",cache:"true",templateUrl:"template/center/info.html",controller:"infoCtrl",authn:!0}).state("comment",{url:"/comment",cache:"true",templateUrl:"template/center/comment.html",controller:"commentCtrl",authn:!0}).state("followed",{url:"/followed",cache:"true",templateUrl:"template/center/followed.html",controller:"followedCtrl",authn:!0}).state("becomenav",{url:"/becomenav",cache:"true",templateUrl:"template/center/become/become_nav.html",controller:"becomenavCtrl",authn:!0}).state("practitioners",{url:"/practitioners",cache:"true",templateUrl:"template/center/become/practitioners.html",authn:!0}).state("verified",{url:"/verified",cache:"true",templateUrl:"template/center/become/verified.html",authn:!0}).state("tariffset",{url:"/tariffset",cache:"true",templateUrl:"template/center/become/tariffset.html",authn:!0}).state("field",{url:"/field",cache:"true",templateUrl:"template/center/become/field.html",controller:"fieldCtrl",authn:!0}).state("case",{url:"/case",cache:"true",templateUrl:"template/center/become/case.html",authn:!0}).state("citypicke/all",{url:"/citypicke/all",cache:"true",templateUrl:"template/citypicker-all.html",controller:"citypickeAllCtrl",authn:!0}).state("valrealname",{url:"/valrealname",cache:"true",templateUrl:"template/center/become/valrealname.html",controller:"valrealnameCtrl",authn:!0}).state("valphone",{url:"/valphone",cache:"true",templateUrl:"template/center/become/valphone.html",controller:"valphoneCtrl",authn:!0}).state("valemail",{url:"/valemail",cache:"true",templateUrl:"template/center/become/valemail.html",controller:"valemailCtrl",authn:!0}).state("followed_lawyer",{url:"/followed_lawyer",cache:"true",templateUrl:"template/center/lawyer/followed.html",controller:"followedlaywerCtrl",authn:!0}).state("comment_lawyer",{url:"/comment_lawyer/:id",cache:"false",templateUrl:"template/center/lawyer/comment.html",controller:"commentlaywerCtrl",authn:!0}).state("article_lawyer",{url:"/article_lawyer",templateUrl:"template/center/lawyer/article.html",authn:!0}).state("article_lawyer.case",{url:"/case/:class",views:{"article-case":{templateUrl:"template/center/lawyer/article-case.html",controller:"caselaywerCtrl"}},authn:!0}).state("article_lawyer.advisory",{url:"/advisory/:class",views:{"article-advisory":{templateUrl:"template/center/lawyer/article-advisory.html",controller:"caselaywerCtrl"}},authn:!0}).state("article_lawyer.lknowledge",{url:"/lknowledge/:class",views:{"article-lknowledge":{templateUrl:"template/center/lawyer/article-lknowledge.html",controller:"caselaywerCtrl"}},authn:!0}).state("/lawyer/article/view",{url:"/lawyer/article/view/:id",templateUrl:"template/center/lawyer/view.html",controller:"viewarticlelawyerCtrl",authn:!0}).state("about",{url:"/about",cache:"true",templateUrl:"template/center/about.html",controller:"aboutCtrl",authn:!0}).state("site",{url:"/site",cache:"true",templateUrl:"template/center/site.html",controller:"siteCtrl",authn:!0}).state("listscores",{url:"/listscores",cache:"true",templateUrl:"template/center/list_scores.html",controller:"listscoresCtrl",authn:!0}).state("collect",{url:"/collect",cache:"true",templateUrl:"template/center/collect.html",controller:"collectCtrl",authn:!0}).state("messages",{url:"/messages",cache:"true",templateUrl:"template/center/messages.html",controller:"messagesCtrl",authn:!0}).state("message_details",{url:"/message/:id",cache:"true",templateUrl:"template/center/message_view.html",controller:"viewMessageCtrl",authn:!0}).state("lawyerlist",{url:"/lawyerlist",cache:"true",templateUrl:"template/lawyer/lawyer_list.html"}).state("lawyer",{url:"/lawyer/:id",cache:"true",templateUrl:"template/lawyer/view.html",controller:"viewCtrl"}).state("graphic",{url:"/graphic",cache:"true",templateUrl:"template/lawyer/graphic.html",authn:!0}).state("special",{url:"/special",cache:"true",templateUrl:"template/lawyer/special.html",controller:"specialCtrl",authn:!0}).state("questions",{url:"/questions",cache:"true",templateUrl:"template/questions/questions.html",controller:"questionsCtrl",authn:!0}).state("questionslist",{cache:"true",url:"/questionslist",templateUrl:"template/questions/questions_list.html",controller:"questionslistCtrl",authn:!1}).state("question/list/search",{cache:"true",url:"/question/list/search",templateUrl:"template/questions/questions_list_search.html"}).state("questionsview",{cache:"true",url:"/questionsview/:id",templateUrl:"template/questions/view.html",controller:"questionsviewsCtrl",authn:!1}).state("questions/help",{cache:"true",url:"/questions/help",templateUrl:"template/questions/questions_help.html",authn:!0}).state("legaladvice",{url:"/legaladvice",templateUrl:"template/legaladvice.html",controller:"legaladviceCtrl"}).state("workbenchlawyer",{url:"/workbenchlawyer",templateUrl:"template/mylvtuan/lawyer/workbench-lawyer.html",controller:"workbenchLawyerCtrl",authn:!0}).state("orderlawyer",{url:"/orderlawyer",templateUrl:"template/mylvtuan/lawyer/order/order-lawyer.html",authn:!0}).state("orderlawyer.all",{url:"/all",cache:"true",views:{"order-all":{templateUrl:"template/mylvtuan/lawyer/order/order-all.html",controller:"orderAllCtrl"}},authn:!0}).state("orderlawyer.new",{url:"/new",cache:"true",views:{"order-new":{templateUrl:"template/mylvtuan/lawyer/order/order-new.html",controller:"orderNewCtrl"}},authn:!0}).state("orderlawyer.replied",{url:"/replied",cache:"true",views:{"order-replied":{templateUrl:"template/mylvtuan/lawyer/order/order-replied.html",controller:"orderRepliedCtrl"}},authn:!0}).state("orderlawyer.complete",{url:"/complete",cache:"true",views:{"order-complete":{templateUrl:"template/mylvtuan/lawyer/order/order-complete.html",controller:"orderCompleteCtrl"}},authn:!0}).state("orderlawyerdetail",{url:"/orderlawyerdetail/:id",templateUrl:"template/mylvtuan/lawyer/order/order-detail.html",controller:"orderlawyerDetailCtrl",authn:!0}).state("/lawyer/order/comment",{url:"/lawyer/order/comment/:id",templateUrl:"template/mylvtuan/lawyer/order/comment.html",controller:"commentorderlawyerCtrl",authn:!0}).state("lawyerquestion",{url:"/lawyerquestion",templateUrl:"template/mylvtuan/lawyer/question/question.html",authn:!0}).state("lawyerquestion.new",{url:"/new",cache:"true",views:{"question-new":{templateUrl:"template/mylvtuan/lawyer/question/new.html",controller:"lawyerquestionNewCtrl"}},authn:!0}).state("lawyerquestion.replied",{url:"/replied",cache:"true",views:{"question-replied":{templateUrl:"template/mylvtuan/lawyer/question/replied.html",controller:"lawyerquestionRepliedCtrl"}},authn:!0}).state("lawyerquestion.complete",{url:"/complete",cache:"true",views:{"question-complete":{templateUrl:"template/mylvtuan/lawyer/question/complete.html",controller:"lawyerquestionCompleteCtrl"}},authn:!0}).state("lawyer/questions/view",{url:"/lawyer/questions/view/:id",cache:"true",templateUrl:"template/mylvtuan/lawyer/question/view.html",controller:"lawyerquestionsviewCtrl",authn:!0}).state("queryrefer",{url:"/queryrefer",cache:"true",templateUrl:"template/mylvtuan/lawyer/queryrefer.html",authn:!0}).state("queryreferdetail",{url:"/queryreferdetail",cache:"true",templateUrl:"template/mylvtuan/lawyer/queryrefer-detail.html",authn:!0}).state("easemobmain",{url:"/easemobmain/:id",templateUrl:"template/mylvtuan/easemobmain.html",controller:"easemobmainCtrl",authn:!0}).state("easemobinit",{url:"/easemobinit/:id",controller:"easemobinitCtrl",authn:!0}).state("userlvtuan",{url:"/userlvtuan",cache:"true",templateUrl:"template/mylvtuan/user/userlvtuan.html",controller:"userlvtuanCtrl",authn:!0}).state("userquestion",{url:"/userquestion",templateUrl:"template/mylvtuan/user/question/question.html",authn:!0}).state("userquestion.new",{url:"/new",cache:"true",views:{"question-new":{templateUrl:"template/mylvtuan/user/question/new.html",controller:"questionNewCtrl"}},authn:!0}).state("userquestion.all",{url:"/all",cache:"true",views:{"question-all":{templateUrl:"template/mylvtuan/user/question/all.html",controller:"questionAllCtrl"}},authn:!0}).state("userquestion.replied",{url:"/replied",cache:"true",views:{"question-replied":{templateUrl:"template/mylvtuan/user/question/replied.html",controller:"questionRepliedCtrl"}},authn:!0}).state("userquestion.waitforconfirmation",{url:"/waitforconfirmation",cache:"true",views:{"question-waitforconfirmation":{templateUrl:"template/mylvtuan/user/question/waitforconfirmation.html",controller:"questionWaitforconfirmationCtrl"}},authn:!0}).state("user/question/view",{url:"/user/question/view/:id",templateUrl:"template/mylvtuan/user/question/view.html",controller:"userquestionviewCtrl",authn:!0}).state("confirmCompletion",{url:"/confirmCompletion/:id",templateUrl:"template/mylvtuan/user/question/confirm-completion.html",authn:!0}).state("orderuser",{url:"/orderuser",templateUrl:"template/mylvtuan/user/order/order-user.html",authn:!0}).state("orderuser.all",{url:"/all",cache:"true",views:{"order-all":{templateUrl:"template/mylvtuan/user/order/order-all.html",controller:"userorderAllCtrl"}},authn:!0}).state("orderuser.pending",{url:"/pending",cache:"true",views:{"order-pending":{templateUrl:"template/mylvtuan/user/order/order-pending.html",controller:"userorderPendingCtrl"}},authn:!0}).state("orderuser.new",{url:"/new",cache:"true",views:{"order-new":{templateUrl:"template/mylvtuan/user/order/order-new.html",controller:"userorderNewCtrl"}},authn:!0}).state("orderuser.replied",{url:"/replied",cache:"true",views:{"order-replied":{templateUrl:"template/mylvtuan/user/order/order-replied.html",controller:"userorderRepliedCtrl"}},authn:!0}).state("orderuser.waitforevaluation",{url:"/waitforevaluation",cache:"true",views:{"order-waitforevaluation":{templateUrl:"template/mylvtuan/user/order/order-waitforevaluation.html",controller:"userorderWaitforevaluationCtrl"}},authn:!0}).state("orderuser.complete",{url:"/complete",cache:"true",views:{"order-complete":{templateUrl:"template/mylvtuan/user/order/order-complete.html",controller:"userorderCompleteCtrl"}},authn:!0}).state("send/mind",{url:"/send/mind/:id",templateUrl:"template/mylvtuan/user/question/send-mind.html",authn:!0}).state("userorderdetail",{url:"/userorderdetail/:id",templateUrl:"template/mylvtuan/user/order/order-detail.html",controller:"userOrderDetailCtrl",authn:!0}).state("user/wallet",{url:"/user/wallet",templateUrl:"template/mylvtuan/user/wallet/wallet.html",controller:"userwalletCtrl",authn:!0}).state("user/moneyin",{url:"/user/moneyin",templateUrl:"template/mylvtuan/user/wallet/moneyin.html",controller:"usermoneyinCtrl",authn:!0}).state("user/record",{url:"/user/record",templateUrl:"template/mylvtuan/user/wallet/record.html",controller:"userrecordCtrl",authn:!0}).state("user/moneyout",{url:"/user/moneyout",templateUrl:"template/mylvtuan/user/wallet/moneyout.html",authn:!0}).state("user/withdraw",{url:"/user/withdraw",templateUrl:"template/mylvtuan/user/wallet/withdraw.html",controller:"userwithdrawCtrl",authn:!0}).state("user/payall",{url:"/user/payall",templateUrl:"template/mylvtuan/user/wallet/payall.html",controller:"userpayallCtrl",authn:!0}).state("lawlecture",{url:"/lawlecture",templateUrl:"template/lecture/lawlecture.html",controller:"lawlectureCtrl"}).state("casescomm",{url:"/casescomm",templateUrl:"template/casescomm.html",controller:"casescommCtrl"}).state("lvtuanalliance",{url:"/lvtuanalliance",templateUrl:"template/lvtuanalliance.html",controller:"lvtuanallianceCtrl"}).state("lvtuanallianceview",{url:"/lvtuanallianceview/:id",templateUrl:"template/lvtuanalliance_view.html",controller:"lvtuanallianceviewCtrl"}).state("talent",{url:"/talent",templateUrl:"template/talent.html",controller:"talentCtrl"}).state("talentview",{url:"/talentview/:id",templateUrl:"template/talentview.html",controller:"talentviewCtrl"}).state("document/list",{url:"/document/list",templateUrl:"template/document/list.html",controller:"documentlistCtrl"}).state("document/download_list",{url:"/document/download_list/:id",templateUrl:"template/document/download_list.html",controller:"documentownloadlistCtrl"}).state("document/list/search",{url:"/document/list/search",templateUrl:"template/document/download_list_search.html"}).state("corporate",{url:"/corporate",templateUrl:"template/corporate/corporateservices.html",controller:"corporateservicesCtrl"}).state("corporate/list",{url:"/corporate/list/:id",templateUrl:"template/corporate/list.html",controller:"corporatelistCtrl"}).state("corporate/buynow",{url:"/corporate/buynow/:id",templateUrl:"template/corporate/buynow.html",controller:"corporatebuynowCtrl",authn:!0}).state("pay",{url:"/pay/:id?type",templateUrl:"template/pay.html",authn:!0}).state("citypicker",{url:"/citypicker/:id",templateUrl:"template/citypicker.html",controller:"citypickerCtrl"}).state("error",{url:"/error",templateUrl:"template/error.html"}),$urlRouterProvider.otherwise("/index")});var authModule=angular.module("authModule",[]);authModule.constant("HOST",AppSettings.baseApiUrl).service("userService",userService).service("authService",authService);var easemobModule=angular.module("easemobModule",["ionic"]);easemobModule.service("easemobService",easemobService);var httpModule=angular.module("httpModule",["authModule"]);httpModule.factory("httpWrapper",["$http","$rootScope",function($http,$rootScope){var httpRequest={};return httpRequest.get=function(url,successCallback){$http.get(url,{cache:!0,headers:{"Content-Type":"application/json",Authorization:"bearer "+$rootScope.token}}).success(successCallback?successCallback:function(data){}).error(function(data,status){layer.msg(status),console.info(JSON.stringify(data))})},httpRequest.request=function(url,method,data,successCallback,failureCallback){$http({method:method,url:url,data:data,cache:!0,headers:{"Content-Type":"application/json",Authorization:"bearer "+$rootScope.token}}).then(successCallback?successCallback:function(response){},failureCallback?failureCallback:function(response){console.info(JSON.stringify(response.data)),console.info(JSON.stringify(response.status))})},httpRequest}]),httpModule.factory("APIInterceptor",["$log","$q","$rootScope","authService","HOST",function($log,$q,$rootScope,authService,HOST){$log.debug("$log is here to show you that this is a regular factory with injection");var myInterceptor={request:function(config){if(config.url.indexOf(HOST)>-1){var token=authService.getToken();if(token&&(config.headers.Authorization="Bearer "+token),config.headers.Accept="application/json",config.cache=!0,config.url.indexOf(HOST+"/center")>-1||config.url.indexOf(HOST+"/group")>-1||config.url.indexOf(HOST+"/microblog")>-1){var canceller=$q.defer();authService.isAuthed()?(config.url.indexOf(HOST+"/group")>-1||config.url.indexOf(HOST+"/microblog")>-1)&&(user=authService.getUser(),user.is_verified_lawyer||$rootScope.$broadcast("unauthorized")):($rootScope.$broadcast("unauthenticated"),config.timeout=canceller.promise,canceller.resolve())}}return config},requestError:function(rejection){return canRecover(rejection)?responseOrNewPromise:$q.reject(rejection)},response:function(response){return response.config.url.indexOf(HOST)>-1&&$rootScope.hide(),
response},responseError:function(response){switch(response.status){case 401:case 403:$rootScope.$broadcast("unauthorized");break;case 400:angular.forEach(response.data.error_messages,function(val,key){angular.isArray(val)?layer.show(val.join(", ")):layer.show(val)});break;case 405:layer.show("提交数据的方法错误");break;case 503:case 500:layer.show("暂时无法处理您的请求，请稍后再试。")}return $rootScope.hide(),$q.reject(response)}};return myInterceptor}]),httpModule.constant("HOST",AppSettings.baseApiUrl);var listModule=angular.module("listModule",["ionic","ngSanitize","ngFileUpload","httpModule"]);listModule.factory("listHelper",["$http","$rootScope","httpWrapper",function($http,$rootScope,httpWrapper){var listHelper={};return listHelper.bootstrap=function(url,$scope){var page=1,rows_per_page=5;$scope.rows_per_page&&(rows_per_page=$scope.rows_per_page),$scope.moredata=!0,$scope.items=[],$scope.doRefresh=function(){page=1,$scope.items=[],$scope.loadMore(),$scope.$broadcast("scroll.refreshComplete")},$scope.loadMore=function(){var timestamp=Math.round((new Date).getTime()/1e3),urls=url.split("?"),params="rows_per_page="+rows_per_page+"&page="+page+"&ts="+timestamp;2==urls.length&&(url=urls[0],params=urls[1]+"&"+params),httpWrapper.get("http://"+$rootScope.hostName+url+"?"+params,function(data){data&&data.data&&data.data.length?($scope.items=$scope.items.concat(data.data),console.info($scope.items),data.data.length<rows_per_page?$scope.moredata=!1:$scope.moredata=!0):(1==page&&layer.show("暂无数据！"),$scope.moredata=!1),page++,$scope.$broadcast("scroll.infiniteScrollComplete")})}},listHelper}]);var locationModule=angular.module("locationModule",[]);locationModule.constant("HOST",AppSettings.baseApiUrl).service("locationService",locationService);var wxModule=angular.module("wxModule",[]);wxModule.service("wxService",wxService);var layer=function(){function strUnicode2Ansi(asContents){for(var len1=asContents.length,temp="",i=0;len1>i;i++){var varasc=asContents.charCodeAt(i);if(0>varasc&&(varasc+=65536),varasc>127&&(varasc=UnicodeToAnsi(varasc)),varasc>255){var varlow=65280&varasc;varlow>>=8;var varhigh=255&varasc;temp+=String.fromCharCode(varlow)+String.fromCharCode(varhigh)}else temp+=String.fromCharCode(varasc)}return temp}return this.show=function(data){if(angular.isObject(data)&&(data=msg(data)),angular.isUndefined($("#hintShow").html())){var div=$("<div id='hintShow' style='width:100%;text-align:center;padding:12px 0px;background:black;opacity:0.7;color:#fff;position: fixed;top:0;left:0;display:none;z-index:9999;'>"+data+"</div>");div.appendTo($("body")).fadeIn("slow"),time=setInterval(function(){clearInterval(time),div.fadeOut("slow",function(){div.remove()})},2500),$("#hintShow").bind("click",function(){div.remove()})}},this.getUrlParam=function(name){var reg=new RegExp("(^|&)"+name+"=([^&]*)(&|$)"),r=window.location.search.substr(1).match(reg);return null!=r?decodeURI(r[2]):null},this.getParameters=function(locationUrl){var str,url=decodeURI(locationUrl),obj=new Object,index=url.lastIndexOf("?");if(-1!=index)if(url=url.slice(index+1,url.length),-1!=url.indexOf("&")){str=url.split("&");for(var i=0;i<str.length;i++){var str1=str[i].split("=");2==str1.length&&""!=str1[0]&&(obj[str1[0]]=str1[1])}}else str=url.split("="),2==str.length&&""!=str[0]&&(obj[str[0]]=str[1]);return obj},this.getParams=function(form){var params={};return $(form).find("input").each(function(obj){if("disabled"==$(this).attr("disabled"))return!0;if("disabled"==$(this).attr("data-disabled"))return!0;var name="",value="";return"radio"==$(this).attr("type")?(name=$(this).attr("name"),value=$(':radio[name="'+name+'"]:checked').val(),params[name]=value,!0):(name=$(this).attr("name"),value=$.trim($(this).val()),void(name&&(params[name]=value)))}),$(form).find("select").each(function(obj){if("disabled"==$(this).attr("disabled"))return!1;if("disabled"==$(this).attr("data-disabled"))return!0;if(""==$(this).val())return!0;var name=$(this).attr("name"),value=$(this).val();params[name]=value}),$(form).find("textarea").each(function(obj){if("disabled"==$.trim($(this).attr("data-disabled")))return!0;var name=$(this).attr("name"),value=$.trim($(this).val());params[name]=value}),params},this.stopDefault=function(e){return e&&e.preventDefault?e.preventDefault():window.event.returnValue=!1,!1},this.base64code=function(input){var keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";input=strUnicode2Ansi(input);var chr1,chr2,enc1,enc2,enc3,output="",chr3="",enc4="",i=0;do chr1=input.charCodeAt(i++),chr2=input.charCodeAt(i++),chr3=input.charCodeAt(i++),enc1=chr1>>2,enc2=(3&chr1)<<4|chr2>>4,enc3=(15&chr2)<<2|chr3>>6,enc4=63&chr3,isNaN(chr2)?enc3=enc4=64:isNaN(chr3)&&(enc4=64),output=output+keyStr.charAt(enc1)+keyStr.charAt(enc2)+keyStr.charAt(enc3)+keyStr.charAt(enc4),chr1=chr2=chr3="",enc1=enc2=enc3=enc4="";while(i<input.length);return output},this.goBack=function(){window.history.back(),window.location.reload()},this.refresh=function(){window.location.reload()},this.msg=function(data){if(angular.isUndefined(data))return"服务器故障，请与管理员联系!";var _msg="";switch(data){case 401:_msg="账号过期，请重新登录。";break;default:_msg="错误代码: "+data}return layer.show(_msg)},this}();