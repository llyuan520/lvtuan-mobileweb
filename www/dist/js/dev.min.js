function authService($window){var self=this;self.parseJwt=function(token){var base64Url=token.split(".")[1],base64=base64Url.replace("-","+").replace("_","/");return JSON.parse($window.atob(base64))},self.saveToken=function(token){localStorage.setItem("jwtToken",token)},self.getToken=function(){return localStorage.getItem("jwtToken")},self.saveUser=function(user){localStorage.setItem("currentUser",JSON.stringify(user))},self.getUser=function(){return JSON.parse(localStorage.getItem("currentUser"))},self.isAuthed=function(){var token=self.getToken();if(token){var params=self.parseJwt(token);return Math.round((new Date).getTime()/1e3)<=params.exp}return!1},self.logout=function(){localStorage.removeItem("jwtToken"),localStorage.removeItem("currentUser")}}function userService($http,$state,HOST,authService){var self=this;self.register=function(username,password,phonecode,account_type){return $http.post("http://"+HOST+"/register",{username:username,password:password,phonecode:phonecode,account_type:account_type}).then(function(res){layer.show("注册成功！"),$scope.user={},$scope.params={};var user=res.data?res.data.data:null;user&&(authService.saveUser(user),console.log("user:",user));var token=res.data?res.data.token:null;token&&(authService.saveToken(token),console.log("token:",token)),$state.go("center"),window.location.reload()})["catch"](function(response){if(console.error("Gists error",response.status,response.data),400===response.status){var errMsg=JSON.stringify(data.error_messages.username);layer.show(errMsg),layer.show("注册失败，请重新登录。")}})},self.login=function(username,password){return $http.post("http://"+HOST+"/login",{username:username,password:password}).then(function(res){var user=res.data?res.data.data:null;user&&(authService.saveUser(user),console.log("user:",user));var token=res.data?res.data.token:null;token&&(authService.saveToken(token),console.log("token:",token)),$state.go("center"),window.location.reload()})["catch"](function(response){console.error("Gists error",response.status,response.data),400===response.status&&layer.show("登录失败，账号或密码错误，请重新登录。")})}}var layer=function(){function strUnicode2Ansi(asContents){for(var len1=asContents.length,temp="",i=0;len1>i;i++){var varasc=asContents.charCodeAt(i);if(0>varasc&&(varasc+=65536),varasc>127&&(varasc=UnicodeToAnsi(varasc)),varasc>255){var varlow=65280&varasc;varlow>>=8;var varhigh=255&varasc;temp+=String.fromCharCode(varlow)+String.fromCharCode(varhigh)}else temp+=String.fromCharCode(varasc)}return temp}return this.show=function(data){if(angular.isObject(data)&&(data=msg(data)),angular.isUndefined($("#hintShow").html())){var div=$("<div id='hintShow' style='width:100%;text-align:center;padding:12px 0px;background:black;opacity:0.7;color:#fff;position: fixed;top:0;left:0;display:none;z-index:9999;'>"+data+"</div>");div.appendTo($("body")).fadeIn("slow"),time=setInterval(function(){clearInterval(time),div.fadeOut("slow",function(){div.remove()})},2500)}},this.confirm=function(_msg,_callback){var warp="width: 60%;height:100px;background:#E8E8E8;color:#32A4E6;position:fixed;z-index:9999;top:30%;left:20%;text-align:center;border-radius:7px;",title="word-break:break-word;height: 36px;overflow:hidden;padding: 5px 5px;background:#fff;border-radius:5px;",canel="margin-top:15px;border-radius:7px;float:left;width:35%;margin-left:10%;background:#C7C7C7;padding: 4px 0px;color:#fff;",queding="margin-top:15px;float:right;width:35%;border-radius:7px;background:#439E35;padding: 4px 0px;color:#fff;margin-right:10%;",height=$(window).height(),shade=$("<div style='width:100%;height:"+height+"px;background:black;position:fixed;opacity:0.5;z-index:9998;top:0;left:0;'></div>"),div=$("<div style='"+warp+"'><div style='"+title+"'>"+_msg+"</div><div style='"+canel+"' id='canel'>取消</div><div style='"+queding+"' id='queding'>确定</div></div>");shade.appendTo($(document.body)),div.appendTo($(document.body)),$("#canel").bind("click",function(){shade.remove(),div.remove()}),$("#queding").bind("click",function(){shade.remove(),div.remove(),_callback()})},this.popup=function(divId){var height=$(window).height(),warp="width: 90%;height:"+(height-80)+"px;background:#fff;color:#32A4E6;position:fixed;z-index:9999;top:0;margin-left:5%;margin-right:5%;margin-top: 40px;border-radius:7px;overflow:scroll;";$("#"+divId).attr("style",warp).fadeIn("slow");var canel=$("<div id='embs_canel' style='font-size:20px;background:#ccc;color:#fff;border-radius:50%;width:30px;height:30px;line-height:30px;text-align:center;position:fixed;z-index:10000;top:20px;left:88%;'>X</div>"),shade=$("<div id='embs_shade' style='width:100%;height:"+height+"px;background:black;position:fixed;opacity:0.5;z-index:9998;top:0;left:0;'></div>");shade.appendTo($(document.body)),canel.appendTo($(document.body)),$("#embs_canel").bind("click",function(){canel.remove(),shade.remove(),$("#"+divId).fadeOut("slow")})},this.closePopup=function(divId){$("#embs_shade").remove(),$("#embs_canel").remove(),$("#"+divId).fadeOut("slow")},this.importPopup=function(_callback){var warp="width: 80%;height:200px;background:#E8E8E8;color:#32A4E6;position:fixed;z-index:9999;top:20%;left:10%;text-align:center;border-radius:7px;",title="word-break:break-word;height: 140px;overflow:hidden;padding: 5px 5px;background:#fff;border-radius:5px;",canel="margin-top:9px;border-radius:7px;float:left;width:35%;margin-left:10%;background:#C7C7C7;padding: 5px 0px;color:#fff;",queding="margin-top:9px;float:right;width:35%;border-radius:7px;background:#439E35;padding: 5px 0px;color:#fff;margin-right:10%;",height=$(window).height(),shade=$("<div style='width:100%;height:"+height+"px;background:black;position:fixed;opacity:0.5;z-index:9998;top:0;left:0;'></div>"),div=$("<div style='"+warp+"'><div style='"+title+"'><textarea style='width:95%;height:135px;border:1px solid #D4D4D4;font-size:16px;' id='import_textarea'></textarea></div><div style='"+canel+"' id='canel'>取消</div><div style='"+queding+"' id='queding'>确定</div></div>");shade.appendTo($(document.body)),div.appendTo($(document.body)),$("#canel").bind("click",function(){shade.remove(),div.remove()}),$("#queding").bind("click",function(){var val=$.trim($("#import_textarea").val());""==val||0==val.length?show("内容不能为空!"):(_callback(val),shade.remove(),div.remove())})},this.progress=function(_code){if(angular.isUndefined(_code)){if(angular.isUndefined($("#progress").html())){var div=$("<div id='progress' style='position: fixed;top:40%;margin-left:20%;margin-right:20%;display:none;z-index:9999;'><img src='images/global/loading.gif' width='100%' /></div>");div.appendTo($("body")).fadeIn("slow")}}else{var div=$("#progress");div.fadeOut("fast",function(){div.remove()})}},this.scroll=function(_callback,_callback2){$(window).bind("scroll",function(){$(window).scrollTop()+$(window).height()>=$(document).height()?_callback():$(window).scrollTop()<=0&&"function"==typeof _callback2&&_callback2()})},this.startIntegral=function(options){function index(obj,current){for(var i=0,length=current.length;length>i;i++)if(current[i]==obj)return i}function changeScreenEndFun(){if(this.page!=thisPage&&(thisPage=this.page,setTimeout(function(){document.querySelector(tab_title_ul+" > li.black").className="",document.querySelector(tab_title_ul+" > li:nth-child("+(thisPage+1)+")").className="black"},100),opacity)){var cpage=this.page,setTaboc=function(){setTimeout(function(){if($(change_screen_ul).children().eq(cpage).css({opacity:citypc}),1>=citypc)citypc+=.1,setTaboc();else for(var i=0;i<$(change_screen_ul).find("li").length;i++)i!=cpage&&(citypc=.5,$(change_screen_ul).children().eq(i).css({opacity:citypc}))},90)};setTaboc()}}function touchClick(obj,fun){function touEnd(e){var endX=e.changedTouches[0].clientX,endY=e.changedTouches[0].clientY;Math.abs(endX-start_x)<5&&Math.abs(endY-start_y)<5&&fun.call(obj,e),document.removeEventListener("touchend",touEnd,!1)}var start_x=0,start_y=0;obj.addEventListener("touchstart",function(e){start_x=e.touches[0].clientX,start_y=e.touches[0].clientY,document.addEventListener("touchend",touEnd,!1)})}var options=options||{},change_screen_div=options.change_screen_div||"#change_screen_div",change_screen_ul_li=options.change_screen_ul_li||".change_screen_ul_li",change_screen_ul=options.change_screen_ul||"#change_screen_ul",tab_title_ul=options.tab_title_ul||"#tab_title_ul",opacity=0!=options.opacity?!0:!1,thisPage=0;if($(change_screen_div).height($(window).height()-60),$(change_screen_ul_li).height($(window).height()-100),$(change_screen_ul).width(2*$(document).width()),opacity)for(var citypc=.5,i=0;i<$(change_screen_ul).find("li").length;i++)0!=i&&$(change_screen_ul).find("li").eq(i).css({opacity:citypc});var change_screen_ul=document.getElementById(change_screen_ul.substring(1)),slipjs=slip("page",change_screen_ul,{num:$(tab_title_ul).children().length,endFun:changeScreenEndFun}),ul=document.querySelector(tab_title_ul),li=document.querySelectorAll(tab_title_ul+"> li");touchClick(ul,function(e){if(ul.webkitMatchesSelector.call(e.target,"ul li")){var that=e.target,num=index(that,li);slipjs.toPage(num,300)}})},this.getUrlParam=function(name){var reg=new RegExp("(^|&)"+name+"=([^&]*)(&|$)"),r=window.location.search.substr(1).match(reg);return null!=r?decodeURI(r[2]):null},this.getParameters=function(locationUrl){var str,url=decodeURI(locationUrl),obj=new Object,index=url.lastIndexOf("?");if(-1!=index)if(url=url.slice(index+1,url.length),-1!=url.indexOf("&")){str=url.split("&");for(var i=0;i<str.length;i++){var str1=str[i].split("=");2==str1.length&&""!=str1[0]&&(obj[str1[0]]=str1[1])}}else str=url.split("="),2==str.length&&""!=str[0]&&(obj[str[0]]=str[1]);return obj},this.getParams=function(form){var params={};return $(form).find("input").each(function(obj){if("disabled"==$(this).attr("disabled"))return!0;if("disabled"==$(this).attr("data-disabled"))return!0;var name="",value="";return"radio"==$(this).attr("type")?(name=$(this).attr("name"),value=$(':radio[name="'+name+'"]:checked').val(),params[name]=value,!0):(name=$(this).attr("name"),value=$.trim($(this).val()),void(name&&(params[name]=value)))}),$(form).find("select").each(function(obj){if("disabled"==$(this).attr("disabled"))return!1;if("disabled"==$(this).attr("data-disabled"))return!0;if(""==$(this).val())return!0;var name=$(this).attr("name"),value=$(this).val();params[name]=value}),$(form).find("textarea").each(function(obj){if("disabled"==$.trim($(this).attr("data-disabled")))return!0;var name=$(this).attr("name"),value=$.trim($(this).val());params[name]=value}),params},this.stopDefault=function(e){return e&&e.preventDefault?e.preventDefault():window.event.returnValue=!1,!1},this.base64code=function(input){var keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";input=strUnicode2Ansi(input);var chr1,chr2,enc1,enc2,enc3,output="",chr3="",enc4="",i=0;do chr1=input.charCodeAt(i++),chr2=input.charCodeAt(i++),chr3=input.charCodeAt(i++),enc1=chr1>>2,enc2=(3&chr1)<<4|chr2>>4,enc3=(15&chr2)<<2|chr3>>6,enc4=63&chr3,isNaN(chr2)?enc3=enc4=64:isNaN(chr3)&&(enc4=64),output=output+keyStr.charAt(enc1)+keyStr.charAt(enc2)+keyStr.charAt(enc3)+keyStr.charAt(enc4),chr1=chr2=chr3="",enc1=enc2=enc3=enc4="";while(i<input.length);return output},this.goBack=function(){window.history.back()},this.refresh=function(){window.location.reload()},this.goHome=function(){window.location.reload(),window.location.href="#/"},this.msg=function(data){if(angular.isUndefined(data))return"服务器故障，请与管理员联系!";var _msg="";switch(data){case 401:_msg="账号过期，请重新登录。";break;default:_msg="错误代码: "+data}return layer.show(_msg)},this}(),lvtuanApp=angular.module("lvtuanApp.Ctrl",["ionic","ngSanitize","ngFileUpload","listModule","authModule"]);lvtuanApp.constant("HOST",AppSettings.baseApiUrl),lvtuanApp.controller("MainController",["$rootScope","$scope","$state","userService","authService",function($rootScope,$scope,$state,userService,authService){var self=this;self.login=function(){userService.login(self.username,self.password)},self.register=function(){},self.logout=function(){authService.logout()},self.isAuthed=function(){return authService.isAuthed?authService.isAuthed():!1},$rootScope.$on("unauthorized",function(){$state.go("login"),window.location.reload()}),$scope.currentUser=authService.getUser()}]),lvtuanApp.controller("HeaderController",["$scope","$location",function($scope,$location){$scope.isActives=function(route){return route===$location.path()}}]),lvtuanApp.directive("hideTabs",["$rootScope",function($rootScope){return{restrict:"A",link:function(scope,element,attributes){scope.$on("$ionicView.beforeEnter",function(){scope.$watch(attributes.hideTabs,function(value){$rootScope.hideTabs=value})}),scope.$on("$ionicView.beforeLeave",function(){$rootScope.hideTabs=!1})}}}]),lvtuanApp.constant("$ionicLoadingConfig",{content:'<ion-spinner icon="android"></ion-spinner>',animation:"fade-in",showBackdrop:!0,maxWidth:200,showDelay:0}),lvtuanApp.controller("ionicNavBarDelegateCtrl",["$state","$timeout","$http","$location",function($state,$timeout,$http,$location){$timeout(function(){location.href="#/index"},2e3,[!1])}]),lvtuanApp.controller("indexCtrl",["$scope","listHelper",function($scope,listHelper){listHelper.bootstrap("/lawyer/list_lawyers?is_recommended=1",$scope),$scope.mylvteam=function(){location.href="#/mylvteam"}}]),lvtuanApp.controller("loginCtrl",["$state","$scope","$rootScope","$http","userService",function($state,$scope,$rootScope,$http,userService){function checkvaldata(user){if(""==user.username)return layer.show("请输入手机号码或者邮箱！"),!1;if(user.username.match(format_mobile)){if(null==user.username.match(format_mobile))return layer.show("请输入正确的手机号码!"),!1}else if(null==user.username.match(format_email))return layer.show("请输入正确邮箱账号!"),!1;return!0}var format_email=/^(([0-9a-zA-Z]+)|([0-9a-zA-Z]+[_.0-9a-zA-Z-]*[0-9a-zA-Z]+))@([a-zA-Z0-9-]+[.])+([a-zA-Z]{2} |net|NET|com|COM|gov|GOV|mil|MIL|org|ORG|edu|EDU|int|INT|cn|CN)$/,format_mobile=/^(0|86|17951)?(13[0-9]|15[012356789]|17[678]|18[0-9]|14[57])[0-9]{8}$/;$scope.submit=function(user){checkvaldata(user)&&userService.login(user.username,user.password)}}]),lvtuanApp.controller("registerCtrl",["$scope","$rootScope","$http","userService","authService",function($scope,$rootScope,$http,userService,authService){$scope.phonecode=function(phone){var param="phone="+phone;$http.post("http://"+$rootScope.hostName+"/send-code?"+param).success(function(data){layer.show("验证码已发送到您的手机！")}).error(function(data,status){401==status&&layer.msg(status);var errMsg=JSON.stringify(data.error_messages.password);layer.show(errMsg)})},$scope.submit=function(user){$scope.params={},user.username&&($scope.params.username=user.username),user.phonecode&&($scope.params.phonecode=user.phonecode),user.password&&($scope.params.password=user.password),$http.post("http://"+$rootScope.hostName+"/register",{username:$scope.params.username,password:$scope.params.password,phonecode:$scope.params.phonecode,account_type:"phone"}).success(function(data){layer.show("注册成功！"),$scope.user={},$scope.params={};var user_data=data?data.data:null;user_data&&(authService.saveUser(user_data),console.log("user:",user_data));var token=data?data.token:null;token&&(authService.saveToken(token),console.log("JWT:",token)),1==user.isCheck?location.href="#/becomelawyer":location.href="#/center"}).error(function(data,status){401==status&&layer.msg(status);var errMsg=JSON.stringify(data.error_messages.username);layer.show(errMsg)})}}]),lvtuanApp.controller("resetpwdCtrl",["$scope","$http","$rootScope",function($scope,$http,$rootScope){$scope.user={},$scope.save=function(user){return user.old_password==user.new_password&&user.old_password==user.new_password_retype&&user.new_password==user.new_password_retype?(layer.show("修改密码不能和初始密码一样！"),!1):user.new_password.length!=user.new_password_retype.length?(layer.show("重置密码的长度不一致！"),!1):user.new_password!=user.new_password_retype?(layer.show("两次输入的密码不一致！"),!1):($http.post("http://"+$rootScope.hostName+"/center/reset_pass",$scope.user).success(function(data){layer.show("修改成功！"),$scope.user={},location.href="#/login",window.location.reload()}).error(function(data,status){401==status&&layer.msg(status);var errMsg=JSON.stringify(data.error_messages);layer.show(errMsg)}),!0)}}]),lvtuanApp.controller("groupCtrl",["$scope","$http","$state","$rootScope",function($scope,$http,$state,$rootScope){$scope.jumplogin=function(){console.info($rootScope.is_lawyer),$state.go("login",{reload:!0})}}]),lvtuanApp.controller("groupListCtrl",["$scope","listHelper",function($scope,listHelper){listHelper.bootstrap("/group/list/mine",$scope)}]),lvtuanApp.controller("groupTeleviseCtrl",["$scope","$http","$rootScope","listHelper",function($scope,$http,$rootScope,listHelper){listHelper.bootstrap("/microblog/list/all",$scope),$scope.likes=function(id,index){$http.post("http://"+$rootScope.hostName+"/like",{item_type:"post",item_id:id}).success(function(data){console.info(data);var itmes=data.data;$scope.televise[index].post_extra.likes_count=itmes.likes_count,layer.show("点赞成功！")}).error(function(data,status){401==status&&layer.msg(status),console.info(data);var errMsg="";JSON.stringify(data.error_messages.item_type)?errMsg=JSON.stringify(data.error_messages.item_type[0]):JSON.stringify(data.error_messages.item_id)&&(errMsg=JSON.stringify(data.error_messages.item_id[0])),layer.show(errMsg)})}}]),lvtuanApp.controller("groupAttentionCtrl",["$scope","$http","$state","$rootScope",function($scope,$http,$state,$rootScope){function getparamq(){var param=layer.getParams("#search_form");getUrlq(param)}function getUrlq(param){var url="";url+=param.q?"http://"+$rootScope.hostName+"/group/recommend?q="+param.q+"&page="+page++:"http://"+$rootScope.hostName+"/group/recommend?page="+page++,$http.get(url).success(function(data){return data&&data.data&&data.data.length>0?(data.data.length>9?$scope.moredata=!0:$scope.moredata=!1,void($scope.recommendeds=$scope.recommendeds.concat(data.data))):(layer.show("暂无数据！"),$scope.moredata=!1,!1)}).error(function(data,status){401==status&&layer.msg(status),console.info(JSON.stringify(data))})["finally"](function(){$scope.$broadcast("scroll.refreshComplete"),$scope.$broadcast("scroll.infiniteScrollComplete")})}var page=1;$scope.moredata=!0,$scope.recommendeds=[],$scope.search=function(){page=1,$scope.recommendeds=[],getparamq()},$scope.doRefresh=function(){page=1,$scope.recommendeds=[],getparamq()},$scope.loadMore=function(){getparamq()},$scope.groupjoin=function(id,index){page=1;var id=id;$http.post("http://"+$rootScope.hostName+"/group/"+id+"/join?page="+page++,{},{cache:!0,headers:{Accept:"application/json",Authorization:"bearer "+$rootScope.token}}).success(function(data){return data&&data.data?($scope.recommendeds.splice(index,1),void layer.show("已关注 加入成功！")):(layer.show("暂无数据！"),$scope.moredata=!1,!1)}).error(function(data,status){401==status&&layer.msg(status);var datacode=JSON.stringify(data);400==datacode.status_code&&layer.show("你已经是该圈子的成员了!"),console.info(JSON.stringify(data)),console.info(JSON.stringify(status))})["finally"](function(){$scope.$broadcast("scroll.refreshComplete"),$scope.$broadcast("scroll.infiniteScrollComplete")})}}]),lvtuanApp.controller("groupviewCtrl",["$scope","$http","$state","$rootScope","$stateParams",function($scope,$http,$state,$rootScope,$stateParams){function getuserpwd(itmes){var name=$("#user_name").val(),pwd=$("#user_password").val();return null==name||null==pwd?!1:name==itmes.user_id&&pwd==itmes.pwd?!0:void 0}console.info("圈子详情"),$scope.user_name="",$scope.user_password="",$("#user_name").val(),$("#user_password").val(),$http.get("http://"+$rootScope.hostName+"/group/"+$stateParams.id+"/chat").success(function(data){if(data&data.data){console.info("圈子详情",data.data);var itmes=data.data;$scope.user_name=itmes.user_id,$scope.user_password=itmes.pwd,$scope.id=itmes.id,localStorage.setItem("goup_id",JSON.stringify($scope.id)),localStorage.setItem("easemob_id",JSON.stringify(itmes.easemob_id));var time=null;time=setInterval(function(){1==getuserpwd(itmes)&&(clearInterval(time),login())},2e3)}}).error(function(data,status){401==status&&layer.msg(status),console.info(JSON.stringify(data))}),$scope.site=function(){location.href="#/group/site/"+$scope.id,window.location.reload()}}]),lvtuanApp.controller("groupsiteCtrl",["$scope","$http","$state","$rootScope","$stateParams","$timeout","$ionicPopup","Upload",function($scope,$http,$state,$rootScope,$stateParams,$timeout,$ionicPopup,Upload){console.info("圈子设置"),$scope.id=JSON.parse(localStorage.getItem("goup_id")),$http.get("http://"+$rootScope.hostName+"/group/"+$scope.id+"/detail").success(function(data){data&&data.data&&(console.info("圈子设置",data.data),$scope.group=data.data,$scope.group_name=$scope.group.group_name,$scope.is_mine=$scope.group.is_mine,$scope.file=$scope.group.group_avatar)}).error(function(data,status){401==status&&layer.msg(status),console.info(JSON.stringify(data))}),$scope.del=function(id,index){$http.get("http://"+$rootScope.hostName+"/group/"+$scope.id+"/removemember/"+id,{cache:!0,headers:{"Content-Type":"application/json",Authorization:"bearer "+$rootScope.token}}).success(function(data){layer.show(data.data),$scope.group.members.splice(index,1)}).error(function(data,status){401==status&&layer.msg(status),console.info(data),console.info(JSON.stringify(data))})},$scope.logoutGroup=function(){var confirmPopup=$ionicPopup.confirm({title:"确定解散该群？",cancelText:"取消",okText:"确认"});confirmPopup.then(function(res){return res?void $http.get("http://"+$rootScope.hostName+"/group/"+$scope.id+"/dissolution",{cache:!0,headers:{"Content-Type":"application/json",Authorization:"bearer "+$rootScope.token}}).success(function(data){layer.show(data.data),location.href="#/group/list",window.location.reload()}).error(function(data,status){401==status&&layer.msg(status),console.info(data),console.info(JSON.stringify(data))}):!1})},$scope.edit=function(id){var params=layer.getParams("#myForm");""==params.group_name?layer.show("圈子名称不能为空！"):$http.post("http://"+$rootScope.hostName+"/group/"+$stateParams.id+"/edit",{group_name:params.group_name,group_avatar:params.group_avatar},{headers:{"Content-Type":"application/json",Authorization:"bearer "+$rootScope.token}}).success(function(data){layer.show("修改成功！")}).error(function(data,status){401==status&&layer.msg(status);var errMsg=JSON.stringify(data.error_messages);layer.show(errMsg)})},$scope.uploadFiles=function(group_avatar){group_avatar&&$scope.upload(group_avatar)},$scope.upload=function(group_avatar){Upload.upload({url:"http://"+$rootScope.hostName+"/group/uploadImage",data:{group_avatar:group_avatar}}).then(function(response){var file_path="http://"+$rootScope.hostName+"/"+response.data.data;$scope.file=file_path,$timeout(function(){$scope.result=response.data})},function(response){if(response.status>0){var errorMsg=response.status+": "+response.data;console.info("errorMsg",errorMsg),layer.show(errorMsg)}},function(evt){var progres=parseInt(100*evt.loaded/evt.total);$scope.progress=progres})},$scope.quitGroup=function(){var confirmPopup=$ionicPopup.confirm({title:"确定退出该群？",cancelText:"取消",okText:"确认"});confirmPopup.then(function(res){return res?void $http.get("http://"+$rootScope.hostName+"/group/"+$scope.id+"/quit").success(function(data){layer.show(data.data),location.href="#/group/list",window.location.reload()}).error(function(data,status){401==status&&layer.msg(status),console.info(data),console.info(JSON.stringify(data))}):!1})}}]),lvtuanApp.controller("groupaddCtrl",["$scope","$http","$state","$rootScope","$stateParams",function($scope,$http,$state,$rootScope,$stateParams){console.info("添加成员"),console.info($stateParams.id);var page=1;$scope.moredata=!0,$scope.items=[],$scope.doRefresh=function(){page=1,$scope.items=[],$scope.loadMore()},$scope.loadMore=function(){$http.get("http://"+$rootScope.hostName+"/group/"+$stateParams.id+"/addmember").success(function(data){return data.data.length>0?(data.data.length>9?$scope.moredata=!0:$scope.moredata=!1,void($scope.items=$scope.items.concat(data.data))):(layer.show("暂无数据！"),$scope.moredata=!1,!1)}).error(function(data,status){401==status&&layer.msg(status),console.info(JSON.stringify(data))})["finally"](function(){$scope.$broadcast("scroll.refreshComplete"),$scope.$broadcast("scroll.infiniteScrollComplete")})},Array.prototype.remove=function(index){if(isNaN(index)||index>this.length)return!1;for(var i=0,n=0;i<this.length;i++)this[i]!=this[index]&&(this[n++]=this[i]);this.length-=1},$scope.selIds=[],$scope.checkItem=function(obj,id){if(0==obj){var index;angular.forEach($scope.selIds,function(val,key){val==id&&(index=key)}),$scope.selIds.remove(index,index)}else $scope.selIds.push(id)},$scope.createSubmit=function(){$http.post("http://"+$rootScope.hostName+"/group/"+$stateParams.id+"/addmember",{members:$scope.selIds}).success(function(data){location.href="#/group/site/"+$stateParams.id,window.location.reload()}).error(function(data,status){401==status&&layer.msg(status);var errMsg=JSON.stringify(data.error_messages);layer.show(errMsg)})}}]),lvtuanApp.controller("groupcreateCtrl",["$scope","$http","$state","$rootScope","$timeout","Upload",function($scope,$http,$state,$rootScope,$timeout,Upload){console.info("创建圈子");var page=1;$scope.moredata=!0,$scope.items=[],$scope.doRefresh=function(){page=1,$scope.items=[],$scope.loadMore()},$scope.loadMore=function(){$http.get("http://"+$rootScope.hostName+"/group/create?page="+page++,{cache:!0,headers:{"Content-Type":"application/json",Authorization:"bearer "+$rootScope.token}}).success(function(data){return data.data.length>0?(data.data.length>9?$scope.moredata=!0:$scope.moredata=!1,void($scope.items=$scope.items.concat(data.data))):(layer.show("暂无数据！"),$scope.moredata=!1,!1)}).error(function(data,status){401==status&&layer.msg(status),console.info(JSON.stringify(data))})["finally"](function(){$scope.$broadcast("scroll.refreshComplete"),$scope.$broadcast("scroll.infiniteScrollComplete")})},Array.prototype.remove=function(index){if(isNaN(index)||index>this.length)return!1;for(var i=0,n=0;i<this.length;i++)this[i]!=this[index]&&(this[n++]=this[i]);this.length-=1},$scope.selIds=[],$scope.checkItem=function(obj,id){if(0==obj){var index;angular.forEach($scope.selIds,function(val,key){val==id&&(index=key)}),$scope.selIds.remove(index,index)}else $scope.selIds.push(id)},$scope.createSubmit=function(){var members=$scope.selIds,params=getParams("#createGroup_form");return""==params.group_name?(layer.show("请输入圈子名称!"),!1):""==params.group_avatar?(layer.show("请上传圈子头像!"),!1):($http.post("http://"+$rootScope.hostName+"/group/store",{group_name:params.group_name,group_avatar:params.group_avatar,members:members}).success(function(data){layer.show("创建成功！"),$scope.selIds={},$scope.file={},$(":input","#questions_form").not("textarea :submit, :reset, :hidden").val(""),location.href="#/group/list",window.location.reload()}).error(function(data,status){if(401==status&&layer.msg(status),400==status){var errMsg=JSON.stringify(data.error_messages.group_name[0]);console.info(errMsg),layer.show(errMsg)}console.info(data),console.info(status);var errMsg=JSON.stringify(data.message);layer.show(errMsg)}),!0)},$scope.uploadFiles=function(group_avatar){group_avatar&&$scope.upload(group_avatar)},$scope.upload=function(group_avatar){Upload.upload({headers:{"Content-Type":"application/json",Authorization:"bearer "+$rootScope.token},url:"http://"+$rootScope.hostName+"/group/uploadImage",data:{group_avatar:group_avatar}}).then(function(response){var file_path="http://"+$rootScope.hostName+"/"+response.data.data;$scope.file=file_path,$timeout(function(){$scope.result=response.data})},function(response){if(response.status>0){var errorMsg=response.status+": "+response.data;console.info("errorMsg",errorMsg),layer.show(errorMsg)}},function(evt){var progres=parseInt(100*evt.loaded/evt.total);$scope.progress=progres})}}]),lvtuanApp.controller("televisecreateCtrl",["$scope","$http","$state","$rootScope","$timeout","Upload",function($scope,$http,$state,$rootScope,$timeout,Upload){console.info("创建广播"),$scope.file=[],$scope.srcfile=[],$scope.uploadFiles=function(files,errFiles){if(console.info(files,errFiles),files){if(files.length>9)return layer.show("最多只能上传9张照片！"),!1;$scope.files=files,$scope.errFiles=errFiles,angular.forEach(files,function(file){file.upload=Upload.upload({headers:{"Content-Type":"application/json",Authorization:"bearer "+$rootScope.token},url:"http://"+$rootScope.hostName+"/microblog/uploadImage",data:{microBlogImage:file}}),file.upload.then(function(response){var src_url=response.data.data.src_url,src=response.data.data.src;src&&($scope.file.push(src_url),$scope.srcfile.push(src)),$timeout(function(){file.result=response.data})},function(response){response.status>0&&($scope.errorMsg=response.status+": "+response.data),layer.show($scope.errorMsg)},function(evt){file.progress=Math.min(100,parseInt(100*evt.loaded/evt.total))})})}},$scope.del=function(index){$scope.file.splice(index,1),$scope.srcfile.splice(index,1)},$scope.createSubmit=function(){var params=getParams("#myForm");return""==params.content?(layer.show("请输入你的广播!"),!1):($http.post("http://"+$rootScope.hostName+"/microblog/create",{content:params.content,file_paths:$scope.srcfile}).success(function(data){console.log(data.data),layer.show("提交成功！"),$(":input","#myForm").not("textarea :submit, :reset, :hidden").val(""),$scope.file=[],$scope.srcfile=[],location.href="#/broadcast/view/"+data.data.id}).error(function(data,status){401==status&&layer.msg(status);var errMsg=JSON.stringify(data.error_messages);layer.show(errMsg)}),!0)}}]),lvtuanApp.controller("broadcastviewCtrl",["$scope","$http","$state","$rootScope","$stateParams","$ionicPopup",function($scope,$http,$state,$rootScope,$stateParams,$ionicPopup){$http.get("http://"+$rootScope.hostName+"/microblog/"+$stateParams.id+"/view").success(function(data){console.info("广播详情",data.data),$scope.items=data.data}).error(function(data,status){401==status&&layer.msg(status),console.info(JSON.stringify(data))}),$scope.likes=function(id){$http.post("http://"+$rootScope.hostName+"/like",{item_type:"post",item_id:id}).success(function(data){var like=data.data;$scope.items.post_extra.likes_count=like.likes_count,layer.show("点赞成功！")}).error(function(data,status){401==status&&layer.msg(status),console.info(data);var errMsg="";JSON.stringify(data.error_messages.item_type)?errMsg=JSON.stringify(data.error_messages.item_type[0]):JSON.stringify(data.error_messages.item_id)&&(errMsg=JSON.stringify(data.error_messages.item_id[0])),layer.show(errMsg)})},$scope.share=function(id){$scope.id=id,$scope.data={};var myPopup=$ionicPopup.show({template:'<textarea ng-model="data.content" name="content" rows="5" placeholder="想说些什么呢？..."></textarea>',title:"分享",scope:$scope,buttons:[{text:"取消"},{text:"<b>确认</b>",type:"button-positive",onTap:function(e){return $scope.data.content}}]});myPopup.then(function(res){$scope.content=res,$http.post("http://"+$rootScope.hostName+"/microblog/forward",{content:$scope.content,parent_id:$scope.id}).success(function(data){console.info(data),layer.show("分享成功！")}).error(function(data,status){401==status&&layer.msg(status),console.info(data);var errMsg="";JSON.stringify(data.error_messages.parent_id)&&(errMsg=JSON.stringify(data.error_messages.parent_id[0])),layer.show(errMsg)})})},$scope.comments=function(id){$scope.id=id,$scope.data={};var myPopup=$ionicPopup.show({template:'<textarea ng-model="data.comments" name="comments" rows="5" placeholder="想说些什么呢？..."></textarea>',title:"评论",scope:$scope,buttons:[{text:"取消"},{text:"<b>确认</b>",type:"button-positive",onTap:function(e){return $scope.data.comments}}]});myPopup.then(function(res){$scope.comments=res,console.info($scope.comments),$http.post("http://"+$rootScope.hostName+"/microblog/"+id+"/comment/create",{content:$scope.comments,post_id:id}).success(function(data){console.info(data),layer.show("评论成功！")}).error(function(data,status){console.info(data),401==status&&layer.msg(status);var errMsg="";
JSON.stringify(data.error_messages.parent_id)&&(errMsg=JSON.stringify(data.error_messages.parent_id[0])),layer.show(errMsg)})})}}]),lvtuanApp.controller("knowledgesCtrl",["$scope","$http","$rootScope",function($scope,$http,$rootScope){function getparamq(){var param=layer.getParams("#search_form");getUrlq(param)}function getUrlq(param){var url="";url+=param.q?"http://"+$rootScope.hostName+"/knowledge/article/list_articles?q="+param.q+"&page="+page++:"http://"+$rootScope.hostName+"/knowledge/article/list_articles?page="+page++,$http.get(url).success(function(data){console.info("法规",data.data),data.data.length>0?(data.data.length>9?$scope.moredata=!0:$scope.moredata=!1,$scope.knowledges=$scope.knowledges.concat(data.data)):($scope.moredata=!1,layer.show("暂无数据！"))}).error(function(data,status){401==status&&layer.msg(status),console.info(JSON.stringify(data))})["finally"](function(){$scope.$broadcast("scroll.refreshComplete"),$scope.$broadcast("scroll.infiniteScrollComplete")})}var page=1;$scope.moredata=!0,$scope.knowledges=[],$scope.search=function(){page=1,$scope.knowledges=[],getparamq()},$scope.doRefresh=function(){page=1,$scope.knowledges=[],getparamq()},$scope.loadMore=function(){getparamq()}}]),lvtuanApp.controller("documentsCtrl",["$scope","$http","$rootScope",function($scope,$http,$rootScope){function getparamq(){var param=layer.getParams("#search_form");getUrlq(param)}function getUrlq(param){var url="";url+=param.q?"http://"+$rootScope.hostName+"/knowledge/document/list_documents?q="+param.q+"&page="+page++:"http://"+$rootScope.hostName+"/knowledge/document/list_documents?page="+page++,$http.get(url).success(function(data){return console.info("文库",data.data),data.data.length>0?(data.data.length>9?$scope.moredata=!0:$scope.moredata=!1,void($scope.documents=$scope.documents.concat(data.data))):(layer.show("暂无数据！"),$scope.moredata=!1,!1)}).error(function(data,status){401==status&&layer.msg(status),console.info(JSON.stringify(data))})["finally"](function(){$scope.$broadcast("scroll.refreshComplete"),$scope.$broadcast("scroll.infiniteScrollComplete")})}var page=1;$scope.moredata=!0,$scope.documents=[],$scope.search=function(){page=1,$scope.documents=[],getparamq()},$scope.doRefresh=function(){page=1,$scope.documents=[],getparamq()},$scope.loadMore=function(){getparamq()}}]),lvtuanApp.controller("casesCtrl",["$scope","$http","$rootScope",function($scope,$http,$rootScope){var page=1;$scope.moredata=!0,$scope.cases=[],$scope.doRefresh=function(){page=1,$scope.cases=[],$scope.loadMoreCases()},$scope.loadMore=function(){$http.get("http://"+$rootScope.hostName+"/case/list_case?page="+page++).success(function(data){return console.info("案列",data.data),data.data.length>0?(data.data.length>9?$scope.moredata=!0:$scope.moredata=!1,void($scope.cases=$scope.cases.concat(data.data))):(layer.show("暂无数据！"),$scope.moredata=!1,!1)}).error(function(data,status){401==status&&layer.msg(status),console.info(JSON.stringify(data)),console.info(JSON.stringify(status))})["finally"](function(){$scope.$broadcast("scroll.refreshComplete"),$scope.$broadcast("scroll.infiniteScrollComplete")})}}]),lvtuanApp.controller("knowKnowledgesCtrl",["$scope","$http","$rootScope","$stateParams","$interval",function($scope,$http,$rootScope,$stateParams,$interval){function init(){var url="http://"+$rootScope.hostName+"/knowledge/article/"+$stateParams.id+"/view";$http.get(url).success(function(data){console.info(data.data),$scope.items=data.data}).error(function(data,status){401==status&&layer.msg(status),console.info(JSON.stringify(data))})}init()}]),lvtuanApp.controller("knowDocumentsCtrl",["$scope","$http","$rootScope","$interval","$stateParams",function($scope,$http,$rootScope,$interval,$stateParams){function init(){var url="http://"+$rootScope.hostName+"/knowledge/document/list_documents";$http.get(url).success(function(data){for(var itmes=data.data,i=0;i<itmes.length;i++)if(id==itmes[i].id){$scope.documen=itmes[i];break}}).error(function(data,status){401==status&&layer.msg(status),console.info(JSON.stringify(data))})}var id=$stateParams.id;init()}]),lvtuanApp.controller("knowCasesCtrl",["$scope","$http","$rootScope","$interval","$stateParams",function($scope,$http,$rootScope,$interval,$stateParams){function init(){var url="http://"+$rootScope.hostName+"/case/"+$stateParams.id+"/view";$http.get(url).success(function(data){console.info(data.data),$scope.items=data.data}).error(function(data,status){401==status&&layer.msg(status),console.info(JSON.stringify(data))})}init()}]),lvtuanApp.controller("knowledgeViewCtrl",["$scope","$http","$rootScope","$stateParams","$interval",function($scope,$http,$rootScope,$stateParams,$interval){function init(){var url="http://"+$rootScope.hostName+"/knowledge/"+$stateParams.id+"/view";$http.get(url).success(function(data){console.info(data.data),$scope.items=data.data}).error(function(data,status){401==status&&layer.msg(status),console.info(JSON.stringify(data))})}init()}]),lvtuanApp.controller("centerCtrl",["$scope","$http","$rootScope","$ionicPopup","$timeout","authService",function($scope,$http,$rootScope,$ionicPopup,$timeout,authService){if(!authService.isAuthed())return void $rootScope.$broadcast("unauthorized");var currentUser=authService.getUser();$scope.currentUser=currentUser,1==currentUser.user_group_id||2==currentUser.user_group_id&&0==currentUser.is_verified?$http.get("http://"+$rootScope.hostName+"/center/customer/info").success(function(data){return data&&data.data?void($scope.items=data.data):(layer.show("暂无数据！"),!1)}).error(function(data,status){401==status&&layer.msg(status),console.info(JSON.stringify(data)),console.info(JSON.stringify(status))}):$http.get("http://"+$rootScope.hostName+"/center/lawyer/info").success(function(data){return data&&data.data?void($scope.items=data.data):(layer.show("暂无数据！"),!1)}).error(function(data,status){401==status&&layer.msg(status),console.info(JSON.stringify(data))}),$scope.invitefriend=function(){$scope.data={};$ionicPopup.show({templateUrl:"popup-invitefriend-template.html",title:"邀请好友",scope:$scope,buttons:[{text:"Cancel"}]})}}]),lvtuanApp.controller("infoCtrl",["$scope","$http","$rootScope","$timeout","Upload","authService",function($scope,$http,$rootScope,$timeout,Upload,authService){if(console.info("个人资料"),!authService.isAuthed())return void $rootScope.$broadcast("unauthorized");var currentUser=authService.getUser();1==currentUser.user_group_id||2==currentUser.user_group_id&&0==currentUser.is_verified?$http.get("http://"+$rootScope.hostName+"/center/customer/info").success(function(data){return data&&data.data?($scope.items=data.data,$scope.file=$scope.items.user.avatar,$scope.user={realname:$scope.items.user.realname,phone:$scope.items.user.phone,email:$scope.items.user.email},void 0):(layer.show("暂无数据！"),!1)}).error(function(data,status){401==status&&layer.msg(status),console.info(JSON.stringify(data)),console.info(JSON.stringify(status))}):$http.get("http://"+$rootScope.hostName+"/center/lawyer/info").success(function(data){return data&&data.data?($scope.items=data.data,$scope.file=$scope.items.user.avatar,$scope.user={realname:$scope.items.user.realname,phone:$scope.items.user.phone,email:$scope.items.user.email},void 0):(layer.show("暂无数据！"),!1)}).error(function(data,status){401==status&&layer.msg(status),console.info(JSON.stringify(data))}),$scope.uploadFiles=function(avatar,id){avatar&&$scope.upload(avatar,id)},$scope.upload=function(avatar,id){Upload.upload({headers:{"Content-Type":"application/json",Authorization:"bearer "+$rootScope.token},url:"http://"+$rootScope.hostName+"/file/upload/user",data:{upload_file:avatar,user_id:id}}).then(function(response){var file_path="http://"+$rootScope.hostName+"/"+response.data.data.file_path;$scope.file=file_path,$timeout(function(){$scope.result=response.data})},function(response){if(response.status>0){var errorMsg=response.status+": "+response.data;console.info("errorMsg",errorMsg),layer.show(errorMsg)}},function(evt){var progres=parseInt(100*evt.loaded/evt.total);$scope.progress=progres})},$scope.submit=function(){var params=layer.getParams("#myForm");console.info(params),$http.post("http://"+$rootScope.hostName+"/center/customer/info",params).success(function(data){data&&data.data&&($scope.items=data.data,layer.show("提交成功！"))}).error(function(data,status){401==status&&layer.msg(status),console.info(data.error_messages);var errMsg=JSON.stringify(data.error_messages.content[0]);layer.show(errMsg)})}}]),lvtuanApp.controller("listscoresCtrl",["$scope","listHelper",function($scope,listHelper){$scope.rows_per_page=20,listHelper.bootstrap("/center/score/list_scores",$scope)}]),lvtuanApp.controller("messagesCtrl",["$scope","listHelper",function($scope,listHelper){listHelper.bootstrap("/letter/sys",$scope)}]),lvtuanApp.controller("viewMessageCtrl",["$scope","$http","$rootScope","$interval","$stateParams",function($scope,$http,$rootScope,$interval,$stateParams){var id=$stateParams.id,url="http://"+$rootScope.hostName+"/letter/sys-letters/"+id;$http.get(url).success(function(data){data&&data.data&&($scope.item=data.data)}).error(function(data,status){401==status&&layer.msg(status),console.info(JSON.stringify(data))})}]),lvtuanApp.controller("collectCtrl",["$scope","listHelper",function($scope,listHelper){listHelper.bootstrap("/center/collect",$scope)}]),lvtuanApp.controller("commentCtrl",["$scope","listHelper",function($scope,listHelper){listHelper.bootstrap("/center/blog/reply",$scope)}]),lvtuanApp.controller("followedCtrl",["$scope","listHelper",function($scope,listHelper){listHelper.bootstrap("/center/mylawyer/followed",$scope)}]),lvtuanApp.controller("becomelawyerCtrl",["$scope","$http","$rootScope","$ionicActionSheet","$timeout","$stateParams","Upload","authService",function($scope,$http,$rootScope,$ionicActionSheet,$timeout,$stateParams,Upload,authService){function getpositionsParm(parm){for(var i=0;i<$scope.positions.length;i++)if(parm==$scope.positions[i].key){$scope.position=$scope.positions[i];break}}function getProvince(){getProvinceParm(null)}function getProvinceParm(parm){$http.get("http://"+$rootScope.hostName+"/area/province").success(function(data){if(console.info(data.data),$scope.provinces=data.data,parm)for(var i=0;i<$scope.provinces.length;i++)if(parm==JSON.stringify($scope.provinces[i].key)){$scope.province=$scope.provinces[i];break}}).error(function(data,status){401==status&&layer.msg(status),console.info(JSON.stringify(data))})}function getCityParm(province,parm){return null==province&&null==parm?!1:void $http.get("http://"+$rootScope.hostName+"/area/"+province+"/city").success(function(data){if($scope.citys=data.data,parm)for(var i=0;i<$scope.citys.length;i++)if(parm==JSON.stringify($scope.citys[i].key)){$scope.city=$scope.citys[i];break}}).error(function(data,status){401==status&&layer.msg(status),console.info(JSON.stringify(data))})}function getDistrictParm(city,parm){return null==city&&null==parm?!1:void $http.get("http://"+$rootScope.hostName+"/area/"+city+"/district").success(function(data){if($scope.districts=data.data,parm)for(var i=0;i<$scope.districts.length;i++)if(parm==JSON.stringify($scope.districts[i].key)){$scope.district=$scope.districts[i];break}}).error(function(data,status){401==status&&layer.msg(status),console.info(JSON.stringify(data))})}function getPractisePeriods(){getPractisePeriodsParm(null)}function getPractisePeriodsParm(parm){$http.get("http://"+$rootScope.hostName+"/lawyer/practiseperiods").success(function(data){if($scope.periods=data.data,parm)for(var i=0;i<$scope.periods.length;i++)if(parm==$scope.periods[i].key){$scope.practice_period=$scope.periods[i];break}}).error(function(data,status){401==status&&layer.msg(status),console.info(JSON.stringify(data))})}function getPractisePeriods(){getPractisePeriodsParm(null)}function getPractisePeriodsParm(parm){$http.get("http://"+$rootScope.hostName+"/lawyer/practiseperiods").success(function(data){if($scope.periods=data.data,parm)for(var i=0;i<$scope.periods.length;i++)if(parm==$scope.periods[i].key){$scope.practice_period=$scope.periods[i];break}}).error(function(data,status){401==status&&layer.msg(status),console.info(JSON.stringify(data))})}function getWorkscopes(){getWorkscopesParm(null)}function getWorkscopesParm(parm){$http.get("http://"+$rootScope.hostName+"/lawyer/workscopes").success(function(data){if($scope.workscopes_one=data.data,localStorage.setItem("workscopes_one",JSON.stringify($scope.workscopes_one)),parm)for(var i=0;i<$scope.workscopes_one.length;i++)if(parm==$scope.workscopes_one[i].key){$scope.workscope_one=$scope.workscopes_one[i];break}}).error(function(data,status){401==status&&layer.msg(status),console.info(JSON.stringify(data))})}function getworkscopes_oneParm(workscope,parm){if($scope.workscopes_two=JSON.parse(localStorage.getItem("workscopes_one")),workscope){for(var index,i=0;i<$scope.workscopes_two.length;i++)workscope.key==$scope.workscopes_two[i].key&&(index=i,$scope.workscopes_two.remove(index));if($scope.workscopes_two=$scope.workscopes_two,localStorage.setItem("workscopes_two",JSON.stringify($scope.workscopes_two)),parm)for(var i=0;i<$scope.workscopes_two.length;i++)if(parm==$scope.workscopes_two[i].key){$scope.workscope_two=$scope.workscopes_two[i];break}}}function getworkscopes_twoParm(workscope,parm){if($scope.workscopes_three=JSON.parse(localStorage.getItem("workscopes_two")),workscope){for(var index,i=0;i<$scope.workscopes_three.length;i++)workscope.key==$scope.workscopes_three[i].key&&(index=i,$scope.workscopes_three.remove(index));if($scope.workscopes_three=$scope.workscopes_three,localStorage.setItem("workscopes_three",JSON.stringify($scope.workscopes_three)),parm)for(var i=0;i<$scope.workscopes_three.length;i++)if(parm==$scope.workscopes_three[i].key){$scope.workscope_three=$scope.workscopes_three[i];break}}}if(getProvince(),getWorkscopes(),getPractisePeriods(),$scope.sexs=[{key:"male",value:"男"},{key:"female",value:"女"}],$scope.positions=[{key:"lawyer",value:"律师"},{key:"senior_lawyer",value:"高级律师"},{key:"partner",value:"合伙人"}],!authService.isAuthed())return void $rootScope.$broadcast("unauthorized");var currentUser=authService.getUser();2==currentUser.user_group_id&&1==currentUser.is_verified&&$http.get("http://"+$rootScope.hostName+"/center/lawyer/info").success(function(data){data&&data.data&&($scope.items=data.data,$scope.file_2=$scope.items.user.avatar,$scope.file_3=$scope.items.user.lawyer.bg_image,$scope.province=$scope.items.user.province,$scope.city=$scope.items.user.city,$scope.district=$scope.items.user.district,getProvinceParm($scope.province),getCityParm($scope.province,$scope.city),getDistrictParm($scope.city,$scope.district),$scope.address=$scope.items.user.address,$scope.practice_period=$scope.items.user.lawyer.practice_period,getPractisePeriodsParm($scope.practice_period),$scope.position=$scope.items.user.lawyer.position,getpositionsParm($scope.position),void 0!=$scope.items.user.lawyer.work_scope[0]&&($scope.workscope_one=$scope.items.user.lawyer.work_scope[0].key),void 0!=$scope.items.user.lawyer.work_scope[1]&&($scope.workscope_two=$scope.items.user.lawyer.work_scope[1].key),void 0!=$scope.items.user.lawyer.work_scope[2]&&($scope.workscope_three=$scope.items.user.lawyer.work_scope[2].key),getWorkscopesParm($scope.workscope_one),getworkscopes_oneParm($scope.workscope_one,$scope.workscope_two),getworkscopes_twoParm($scope.workscope_two,$scope.workscope_three),$scope.phonereplyfee=$scope.items.user.lawyer.phone_reply_fee,$scope.textreplyfee=$scope.items.user.lawyer.text_reply_fee,$scope.introduce=$scope.items.user.lawyer.introduce,$scope.experience=$scope.items.user.lawyer.experience,$scope.law_cases=$scope.items.user.lawyer.law_cases)}).error(function(data,status){401==status&&layer.msg(status),console.info(JSON.stringify(data))}),$scope.getCity=function(province){getCityParm(province,null)},$scope.getDistrict=function(city){getDistrictParm(city,null)},Array.prototype.remove=function(index){if(isNaN(index)||index>this.length)return!1;for(var i=0,n=0;i<this.length;i++)this[i]!=this[index]&&(this[n++]=this[i]);this.length-=1},$scope.getworkscopes_one=function(workscope){getworkscopes_oneParm(workscope,null)},$scope.getworkscopes_two=function(workscope){getworkscopes_twoParm(workscope,null)},$scope.uploadFiles=function(license_file,index){Upload.upload({headers:{"Content-Type":"application/json",Authorization:"bearer "+$rootScope.token},url:"http://"+$rootScope.hostName+"/file/upload/user",data:{upload_file:license_file,user_id:$rootScope.user_id}}).then(function(response){var file_path="http://"+$rootScope.hostName+"/"+response.data.data.file_path;1==index&&($scope.file_1=file_path),2==index&&($scope.file_2=file_path),3==index&&($scope.file_3=file_path),4==index&&($scope.file_4=file_path),$timeout(function(){$scope.result=response.data})},function(response){if(response.status>0){var errorMsg=response.status+": "+response.data;1==index&&(console.info("errorMsg_1",errorMsg),layer.show(errorMsg)),2==index&&(console.info("errorMsg_2",errorMsg),layer.show(errorMsg)),3==index&&(console.info("errorMsg_3",errorMsg),layer.show(errorMsg)),4==index&&(console.info("errorMsg_4",errorMsg),layer.show(errorMsg))}},function(evt){var progres=parseInt(100*evt.loaded/evt.total);1==index&&($scope.progress_1=progres),2==index&&($scope.progress_2=progres),3==index&&($scope.progress_3=progres),4==index&&($scope.progress_4=progres)})},$scope.sever=function(){$scope.user=layer.getParams("#myForm"),$scope.work_scope=[$scope.workscope_one.key,$scope.workscope_two.key,$scope.workscope_three.key],console.info($scope.work_scope),$scope.work_scope&&($scope.user.work_scope=$scope.work_scope),console.info($scope.user),$http.post("http://"+$rootScope.hostName+"/center/lawyer/info",$scope.user).success(function(data){if(data&&data.data){data.data;layer.show("提交成功！"),location.href="#/index",window.location.reload()}}).error(function(data,status){401==status&&layer.msg(status),console.info(data.error_messages),console.info(JSON.stringify(data.message));var errMsg=JSON.stringify(data.error_messages);layer.show(errMsg),console.info(errMsg),layer.show(errMsg)})},$scope.submit=function(){$scope.user=layer.getParams("#myForm"),$scope.work_scope=[];var workscope_one=angular.element("#workscope_one").val(),workscope_two=angular.element("#workscope_two").val(),workscope_three=angular.element("#workscope_three").val();return""!=workscope_one&&$scope.work_scope.push(workscope_one),""!=workscope_two&&$scope.work_scope.push(workscope_two),""!=workscope_three&&$scope.work_scope.push(workscope_three),$scope.work_scope&&($scope.user.work_scope=$scope.work_scope),console.info($scope.work_scope),console.info($scope.user),$scope.user.license_file.length<1?(layer.show("请上传执业证书！"),!1):$scope.user.ID_img.length<1?(layer.show("请上传身份证照！"),!1):$scope.user.avatar.length<1?(layer.show("请上传个人头像图片！"),!1):$scope.user.bg_image.length<1?(layer.show("请上传背景图片！"),!1):void $http.post("http://"+$rootScope.hostName+"/center/become_lawyer",$scope.user).success(function(data){if(data&&data.data){var obj=data.data;currentUser=authService.getUser(),currentUser.user_group_id=obj.user.user_group_id,currentUser.is_verified=obj.user.is_verified,authService.setUser(currentUser),$scope.currentUser=currentUser,$scope.user={},$scope.file_1={},$scope.file_2={},$scope.file_3={},$scope.file_4={},$scope.progress_1={},$scope.progress_2={},$scope.progress_3={},$scope.progress_4={},localStorage.removeItem("workscopes_one"),localStorage.removeItem("workscopes_two"),localStorage.removeItem("get_work_scope"),layer.show("提交成功！"),location.href="#/index",window.location.reload()}}).error(function(data,status){401==status&&layer.msg(status),console.info(data.error_messages),console.info(JSON.stringify(data.message));var errMsg=JSON.stringify(data.error_messages);layer.show(errMsg),console.info(errMsg),layer.show(errMsg)})}}]),lvtuanApp.controller("followedlaywerCtrl",["$scope","listHelper",function($scope,listHelper){listHelper.bootstrap("/center/lawyer/customer/followed",$scope)}]),lvtuanApp.controller("commentlaywerCtrl",["$scope","$http","$rootScope","$stateParams","listHelper",function($scope,$http,$rootScope,$stateParams,listHelper){listHelper.bootstrap("/center/blog/reply",$scope)}]),lvtuanApp.controller("caselaywerCtrl",["$scope","listHelper","$stateParams",function($scope,listHelper,$stateParams){listHelper.bootstrap("/center/lawyer/blog/list?class="+$stateParams["class"],$scope)}]),lvtuanApp.controller("viewarticlelawyerCtrl",["$scope","$http","$rootScope","$stateParams","$ionicLoading","$timeout","$ionicPopup",function($scope,$http,$rootScope,$stateParams,$ionicLoading,$timeout,$ionicPopup){function init(){$ionicLoading.show(),$http.get("http://"+$rootScope.hostName+"/lawyer/article/"+$stateParams.id+"/view").success(function(data){return console.info(data.data),data.data?($timeout(function(){$ionicLoading.hide(),$scope.items=data.data}),!0):(layer.show("暂无数据！"),!1)}).error(function(data,status){401==status&&layer.msg(status),console.info(JSON.stringify(data)),console.info(JSON.stringify(status))})}init()}]),lvtuanApp.controller("aboutCtrl",["$scope","$timeout","$ionicPopup",function($scope,$timeout,$ionicPopup){$scope.showPopup=function(){$scope.data={};var myPopup=$ionicPopup.show({template:'<input type="password" ng-model="data.wifi">',title:"Enter Wi-Fi Password",subTitle:"Please use normal things",scope:$scope,buttons:[{text:"Cancel"},{text:"<b>Save</b>",type:"button-positive",onTap:function(e){return $scope.data.wifi?$scope.data.wifi:void e.preventDefault()}}]});myPopup.then(function(res){console.log("Tapped!",res)}),$timeout(function(){myPopup.close()},3e3)},$scope.showConfirm=function(){var confirmPopup=$ionicPopup.confirm({title:"温馨提示",template:"系统检测到有最新版本，点击确定进行下载。"});confirmPopup.then(function(res){res?console.log("You are sure"):console.log("You are not sure")})},$scope.showAlert=function(){var alertPopup=$ionicPopup.alert({title:"温馨提示",template:"您的软件已经是最新版本！"});alertPopup.then(function(res){console.log("Thank you for not eating my delicious ice cream cone")})}}]),lvtuanApp.controller("siteCtrl",["$scope","$http","$rootScope","authService",function($scope,$http,$rootScope,authService){console.info("设置"),$scope.logout=function(){authService.logout(),location.href="#/login",window.location.reload()}}]),lvtuanApp.controller("lawyerlistCtrl",["$scope","$state","$http","$rootScope",function($scope,$state,$http,$rootScope){function getCities(){$http.get("http://"+$rootScope.hostName+"/lawyer/cities").success(function(data){$scope.cities=data.data}).error(function(data,status){401==status&&layer.msg(status),console.info(JSON.stringify(data))})}function getWorkscopes(){$http.get("http://"+$rootScope.hostName+"/lawyer/workscopes").success(function(data){$scope.workscopes=data.data}).error(function(data,status){401==status&&layer.msg(status),console.info(JSON.stringify(data))})}function getPractisePeriods(){$http.get("http://"+$rootScope.hostName+"/lawyer/practiseperiods").success(function(data){console.info(data.data),$scope.periods=data.data}).error(function(data,status){401==status&&layer.msg(status),console.info(JSON.stringify(data))})}function getParams(){var params=layer.getParams("#searchForm"),param=[];params.q&&param.push("q="+params.q),params.city_id&&param.push("city_id="+params.city_id),params.cat_id&&param.push("cat_id="+params.cat_id),params.experience&&param.push("experience="+params.experience),params.order_by&&param.push("order_by="+params.order_by),param=param.join("&"),console.info(param),geturl(param)}function geturl(param){var url;url=""!=param?"http://"+$rootScope.hostName+"/lawyer/list_lawyers?"+param+"&page="+page:"http://"+$rootScope.hostName+"/lawyer/list_lawyers?page="+page,console.info(url),$http.get(url).success(function(data){return console.info(data.data),data.data.length>0?($scope.moredata=!0,$scope.items=$scope.items.concat(data.data),void page++):(layer.show("暂无数据！"),$scope.moredata=!1,!1)}).error(function(data,status){401==status&&layer.msg(status),console.info(JSON.stringify(data))})["finally"](function(){$scope.$broadcast("scroll.refreshComplete"),$scope.$broadcast("scroll.infiniteScrollComplete")})}$scope.orders=[{key:"",value:"离我最近"},{key:"most_popular",value:"人气最高"},{key:"best_evaluated",value:"评价最好"}],getCities(),getWorkscopes(),getPractisePeriods();var page=1;$scope.moredata=!0,$scope.items=[],$scope.search=function(e){localStorage.removeItem("items"),localStorage.removeItem("q"),page=1,$scope.items=[],getParams(),layer.stopDefault(e)},$scope.searchCity=function(){page=1,$scope.items=[],getParams()},$scope.searchCat=function(){page=1,$scope.items=[],getParams()},$scope.doRefresh=function(){page=1,$scope.items=[],getParams()},$scope.loadMore=function(){getParams()}}]),lvtuanApp.controller("viewCtrl",["$scope","$state","$http","$rootScope","$stateParams","$ionicPopup","$timeout",function($scope,$state,$http,$rootScope,$stateParams,$ionicPopup,$timeout){function init(){var url="http://"+$rootScope.hostName+"/lawyer/"+$stateParams.id;$http.get(url).success(function(data){console.info(data.data),$scope.items=data.data}).error(function(data,status){401==status&&layer.msg(status),console.info(JSON.stringify(data))})}$scope.tabs=[{title:"个人介绍",url:"selfintro.tpl.html"},{title:"评价",url:"evaluate.tpl.html"},{title:"文章",url:"article.tpl.html"},{title:"广播",url:"televise.tpl.html"}],$scope.currentTab="selfintro.tpl.html",$scope.onClickTab=function(tab){$scope.currentTab=tab.url},$scope.isActiveTab=function(tabUrl){return tabUrl==$scope.currentTab},init(),$scope.showConfirm=function(){var confirmPopup=$ionicPopup.confirm({title:"温馨提示",template:"系统检测到有最新版本，点击确定进行下载。"});confirmPopup.then(function(res){res?console.log("You are sure"):console.log("You are not sure")})},$scope.showAlert=function(){var alertPopup=$ionicPopup.alert({title:"温馨提示",template:"您的软件已经是最新版本！"});alertPopup.then(function(res){console.log("Thank you for not eating my delicious ice cream cone")})},$scope.graphic5=function(id,index){sessionStorage.setItem("lawyerId",id),sessionStorage.setItem("index",index),location.href="#/graphic"}}]),lvtuanApp.controller("viewevaluateCtrl",["$scope","$http","$rootScope","$stateParams",function($scope,$http,$rootScope,$stateParams){function getEvaluation(){var url="http://"+$rootScope.hostName+"/lawyer/"+$stateParams.id+"/articles?page="+page;$http.get(url).success(function(data){return data.data.length>0?($scope.moredata=!0,$scope.evaluations=$scope.evaluations.concat(data.data),void page++):(layer.show("暂无数据！"),$scope.moredata=!1,!1)}).error(function(data,status){401==status&&layer.msg(status),console.info(JSON.stringify(data))})["finally"](function(){$scope.$broadcast("scroll.refreshComplete"),$scope.$broadcast("scroll.infiniteScrollComplete")})}console.info("律师评价");var page=1;$scope.moredata=!0,$scope.evaluations=[],$scope.doRefresh=function(){page=1,$scope.evaluations=[],$scope.loadMore()},$scope.loadMore=function(){getEvaluation()},$scope.$on("$stateChangeSuccess",function(){$scope.loadMore()})}]),lvtuanApp.controller("viewarticleCtrl",["$scope","$http","$rootScope","$stateParams",function($scope,$http,$rootScope,$stateParams){function getArticles(){var url="http://"+$rootScope.hostName+"/lawyer/"+$stateParams.id+"/articles?page="+page;$http.get(url).success(function(data){return data.data.length>0?($scope.moredata=!0,$scope.articles=$scope.articles.concat(data.data),void page++):(layer.show("暂无数据！"),$scope.moredata=!1,!1)}).error(function(data,status){401==status&&layer.msg(status),console.info(JSON.stringify(data))})["finally"](function(){$scope.$broadcast("scroll.refreshComplete"),$scope.$broadcast("scroll.infiniteScrollComplete")})}console.info("律师文章");var page=1;$scope.moredata=!0,$scope.articles=[],$scope.doRefresh=function(){page=1,$scope.articles=[],$scope.loadMore()},$scope.loadMore=function(){getArticles()},$scope.$on("$stateChangeSuccess",function(){$scope.loadMore()})}]),lvtuanApp.controller("viewteleviseCtrl",["$scope","listHelper",function($scope,listHelper){console.info("律师广播"),listHelper.bootstrap("/microblog/list/mine",$scope)}]),lvtuanApp.controller("graphicCtrl",["$scope","$http","$rootScope","$timeout","$stateParams","listHelper","httpWrapper","Upload",function($scope,$http,$rootScope,$timeout,$stateParams,listHelper,httpWrapper,Upload){$http.get("http://"+$rootScope.hostName+"/lawyer/workscopes").success(function(data){data.data?$scope.workscopes=data.data:layer.show("暂无数据！")}).error(function(data,status){401==status&&layer.msg(status),console.info(JSON.stringify(data)),console.info(JSON.stringify(status))}),$scope.file=[],$scope.uploadFiles=function(files,errFiles){return files&&files.length>2?(layer.show("最多只能上传2个文件或者图片！"),!1):($scope.files=files,$scope.errFiles=errFiles,angular.forEach(files,function(file){file.upload=Upload.upload({headers:{"Content-Type":"application/json",Authorization:"bearer "+$rootScope.token},url:"http://"+$rootScope.hostName+"/question/upfiles",data:{files:file}}),file.upload.then(function(response){var file_name="http://"+$rootScope.hostName+"/"+response.data.data.file_name;$scope.file.push(file_name),$scope.file=$scope.file,$timeout(function(){file.result=response.data})},function(response){var status=response.status;401==status&&layer.msg(status),response.status>0&&($scope.errorMsg=response.status+": "+response.data)},function(evt){file.progress=Math.min(100,parseInt(100*evt.loaded/evt.total)),$scope.progress=file.progress})}),void 0)},$scope.type=$stateParams.id;var lawyerId=sessionStorage.getItem("lawyerId"),index=sessionStorage.getItem("index");$scope.submit=function(user){$scope.file.length>0&&($scope.user.file_paths=$scope.file),index&&($scope.user.type=index),lawyerId&&($scope.user.lawyer_id=lawyerId),httpWrapper.request("http://"+$rootScope.hostName+"/center/pay/question/create","post",user,function(data){layer.show("提交成功！"),$scope.user={},$scope.files={},$scope.errFiles={}},function(data){console.info(data)})}}]),lvtuanApp.controller("specialCtrl",["$scope","$http","$rootScope",function($scope,$http,$rootScope){console.info("专业咨询")}]),lvtuanApp.controller("questionsCtrl",["$scope","$state","$http","$rootScope",function($scope,$state,$http,$rootScope){function getQuestionList(){$http.get("http://"+$rootScope.hostName+"/question/list_questions?page="+page).success(function(data){return data.data.length>0?($scope.moredata=!0,console.info(data.data),$scope.list_questions=$scope.list_questions.concat(data.data),$scope.$broadcast("scroll.infiniteScrollComplete"),void page++):($scope.moredata=!1,$scope.$broadcast("scroll.infiniteScrollComplete"),layer.show("暂无数据！"),!1)}).error(function(data,status){401==status&&layer.msg(status),console.info(JSON.stringify(data))})}var page=1;$scope.moredata=!0,$scope.list_questions=[],$http.get("http://"+$rootScope.hostName+"/lawyer/workscopes").success(function(data){data.data?$scope.workscopes=data.data:layer.show("暂无数据！")}).error(function(data,status){401==status&&layer.msg(status),console.info(JSON.stringify(data)),console.info(JSON.stringify(status))}),$scope.user={},$scope.submit=function(user){console.info($scope.user),$http.post("http://"+$rootScope.hostName+"/question/create",$scope.user).success(function(data){return console.info(data.data),page=1,$scope.list_questions=[],data.data?($scope.moredata=!0,$scope.list_questions=$scope.list_questions.concat(data.data),$scope.$broadcast("scroll.infiniteScrollComplete"),layer.show("提交成功！"),void($scope.user={})):($scope.moredata=!1,$scope.$broadcast("scroll.infiniteScrollComplete"),layer.show("暂无数据！"),!1)}).error(function(data,status){401==status&&layer.msg(status),console.info(data.error_messages);var errMsg=JSON.stringify(data.error_messages.content[0]);layer.show(errMsg)})},localStorage.removeItem("q"),$scope.search=function(){var q=$.trim($(".search").val());localStorage.setItem("q",JSON.stringify(q)),$state.go("questionslist",{q:q},{reload:!0})},$scope.loadMore=function(){getQuestionList()}}]),lvtuanApp.controller("questionslistCtrl",["$http","$scope","$state","$rootScope","$timeout",function($http,$scope,$state,$rootScope,$timeout){
var q=JSON.parse(localStorage.getItem("q"));console.info(q),angular.element(".searchq").val(q);var page=1;$scope.moredata=!0,$scope.items=[],$scope.search=function(){localStorage.removeItem("q"),page=1,$scope.items=[],q=angular.element(".searchq").val(),$scope.loadMore()},$scope.doRefresh=function(){page=1,$scope.items=[],$scope.loadMore()},$scope.loadMore=function(){var url="";url=""==q||null==q?"http://"+$rootScope.hostName+"/question/list_questions?page="+page:"http://"+$rootScope.hostName+"/question/list_questions?q="+q+"&page="+page,$http.get(url).success(function(data){return data.data.length>0?(data.data.length>9?$scope.moredata=!0:$scope.moredata=!1,$scope.items=$scope.items.concat(data.data),void page++):(layer.show("暂无数据！"),$scope.moredata=!1,!1)}).error(function(data,status){401==status&&layer.msg(status),console.info(JSON.stringify(data))})["finally"](function(){$scope.$broadcast("scroll.refreshComplete"),$scope.$broadcast("scroll.infiniteScrollComplete")})},$scope.$on("$stateChangeSuccess",function(){$scope.loadMore()})}]),lvtuanApp.controller("questionsviewsCtrl",["$http","$scope","$state","$rootScope","$stateParams","$ionicLoading",function($http,$scope,$state,$rootScope,$stateParams,$ionicLoading){function init(){var url="http://"+$rootScope.hostName+"/question/"+$stateParams.id;$scope.show(),$http.get(url).success(function(data){console.info(data.data),$scope.items=data.data}).error(function(data,status){401==status&&layer.msg(status),console.info(JSON.stringify(data))})["finally"](function(data){$scope.hide()})}$scope.show=function(){$ionicLoading.show({template:"Loading..."})},$scope.hide=function(){$ionicLoading.hide()},init()}]),lvtuanApp.controller("legaladviceCtrl",["$http","$scope","$rootScope",function($http,$scope,$rootScope){function getparamq(){var param=layer.getParams("#search_form");getUrlq(param)}function getUrlq(param){var url="";url+=param.q?"http://"+$rootScope.hostName+"/knowledge/article/list_articles?q="+param.q+"&page="+page++:"http://"+$rootScope.hostName+"/knowledge/article/list_articles?page="+page++,$http.get(url).success(function(data){return console.info("法规",data.data),data.data.length>0?(data.data.length>9?$scope.moredata=!0:$scope.moredata=!1,void($scope.knowledges=$scope.knowledges.concat(data.data))):(layer.show("暂无数据！"),$scope.moredata=!1,!1)}).error(function(data,status){401==status&&layer.msg(status),console.info(JSON.stringify(data))})["finally"](function(){$scope.$broadcast("scroll.refreshComplete"),$scope.$broadcast("scroll.infiniteScrollComplete")})}var page=1;$scope.moredata=!0,$scope.knowledges=[],$scope.search=function(){page=1,$scope.knowledges=[],getparamq()},$scope.doRefresh=function(){page=1,$scope.knowledges=[],getparamq()},$scope.loadMore=function(){getparamq()}}]),lvtuanApp.controller("lawlectureCtrl",["$http","$scope","$state","$rootScope",function($http,$scope,$state,$rootScope){console.info("法律讲堂")}]),lvtuanApp.controller("casescommCtrl",["$http","$scope","$state","$rootScope",function($http,$scope,$state,$rootScope){console.info("案件委托")}]),lvtuanApp.controller("lvtuanallianceCtrl",["$http","$scope","$state","$rootScope",function($http,$scope,$state,$rootScope){function init(){var url="http://"+$rootScope.hostName+"/union/list_partners";$http.get(url).success(function(data){$scope.unions=data.data}).error(function(data,status){401==status&&layer.msg(status),console.info(JSON.stringify(data))})}init()}]),lvtuanApp.controller("lvtuanallianceviewCtrl",["$http","$scope","$state","$rootScope","$stateParams",function($http,$scope,$state,$rootScope,$stateParams){function init(){var url="http://"+$rootScope.hostName+"/union/list_partners";$http.get(url).success(function(data){for(var itmes=data.data,i=0;i<itmes.length;i++)if(id==itmes[i].id){$scope.union=itmes[i];break}}).error(function(data,status){401==status&&layer.msg(status),console.info(JSON.stringify(data))})}var id=$stateParams.id;init()}]),lvtuanApp.controller("talentCtrl",["$http","$scope","$state","$rootScope",function($http,$scope,$state,$rootScope){function init(){var url="http://"+$rootScope.hostName+"/hr/list_positions";$http.get(url).success(function(data){$scope.positions=data.data,console.info($scope.positions)}).error(function(data,status){401==status&&layer.msg(status),console.info(JSON.stringify(data))})}init()}]),lvtuanApp.controller("talentviewCtrl",["$http","$scope","$state","$rootScope","$stateParams",function($http,$scope,$state,$rootScope,$stateParams){function init(){var url="http://"+$rootScope.hostName+"/hr/"+$stateParams.id+"/view";$http.get(url).success(function(data){$scope.positions=data.data,console.info($scope.positions)}).error(function(data,status){401==status&&layer.msg(status),console.info(JSON.stringify(data))})}init()}]),lvtuanApp.controller("workbenchLawyerCtrl",["$http","$scope","$state","$rootScope",function($http,$scope,$state,$rootScope){$http.get("http://"+$rootScope.hostName+"/center/lawyer/info").success(function(data){return data&&data.data?void($scope.items=data.data):(layer.show("暂无数据！"),!1)}).error(function(data,status){401==status&&layer.msg(status),console.info(JSON.stringify(data)),console.info(JSON.stringify(status))})}]),lvtuanApp.controller("orderAllCtrl",["$scope","listHelper",function($scope,listHelper){listHelper.bootstrap("/center/pay/lawyer/question/all",$scope)}]),lvtuanApp.controller("orderNewCtrl",["$scope","listHelper",function($scope,listHelper){listHelper.bootstrap("/center/pay/lawyer/question/new",$scope)}]),lvtuanApp.controller("orderRepliedCtrl",["$scope","listHelper",function($scope,listHelper){listHelper.bootstrap("/center/pay/lawyer/question/replied",$scope)}]),lvtuanApp.controller("orderCompleteCtrl",["$scope","listHelper",function($scope,listHelper){listHelper.bootstrap("/center/pay/lawyer/question/complete",$scope)}]),lvtuanApp.controller("lawyerquestionNewCtrl",["$scope","$rootScope","listHelper","httpWrapper",function($scope,$rootScope,listHelper,httpWrapper){listHelper.bootstrap("/center/lawyer/question/new",$scope),$scope.to_take=function(id){httpWrapper.request("http://"+$rootScope.hostName+"/question/"+id+"/to_take","post",null,function(data){layer.show("抢单成功！"),location.href="#/lawyerquestion/replied",window.location.reload()},function(data){console.info(data)})}}]),lvtuanApp.controller("lawyerquestionRepliedCtrl",["$scope","listHelper",function($scope,listHelper){listHelper.bootstrap("/center/lawyer/question/replied",$scope)}]),lvtuanApp.controller("lawyerquestionCompleteCtrl",["$scope","listHelper",function($scope,listHelper){listHelper.bootstrap("/center/lawyer/question/complete",$scope)}]),lvtuanApp.controller("lawyerquestionsviewCtrl",["$http","$scope","$stateParams","$rootScope","httpWrapper",function($http,$scope,$stateParams,$rootScope,httpWrapper){httpWrapper.get("http://"+$rootScope.hostName+"/center/lawyer/question/"+$stateParams.id+"/view",function(data){$scope.items=data.data,console.info($scope.items)})}]),lvtuanApp.controller("userlvtuanCtrl",["$scope","$rootScope",function($scope,$rootScope){console.info("律师的律团")}]),lvtuanApp.controller("questionAllCtrl",["$scope","$rootScope","listHelper","httpWrapper",function($scope,$rootScope,listHelper,httpWrapper){listHelper.bootstrap("/center/question/all",$scope),$scope.remove=function(id,index){httpWrapper.request("http://"+$rootScope.hostName+"/center/question/"+id+"/remove","post",null,function(data){$scope.items.splice(index,1),layer.show("删除成功！")},function(data){console.info(data)})},$scope.cancel=function(id,index){httpWrapper.request("http://"+$rootScope.hostName+"/center/question/"+id+"/cancel","post",null,function(data){$scope.items[index]=data.data.data,layer.show("取消成功！")},function(data){console.info(data)})},$scope.complete=function(id,index){httpWrapper.request("http://"+$rootScope.hostName+"/center/question/"+id+"/to_complete","post",null,function(data){layer.show("确认成功！"),$scope.items.splice(index,1)},function(data){console.info(data)})},$scope.ask=function(id,index){location.href="#/center"},$scope.pay=function(id){location.href="#/pay/"+id},$scope.evaluate=function(id,index){$scope.items.splice(index,1),location.href="#/confirmCompletion/"+id}}]),lvtuanApp.controller("questionNewCtrl",["$scope","listHelper",function($scope,listHelper){listHelper.bootstrap("/center/question/new",$scope)}]),lvtuanApp.controller("questionRepliedCtrl",["$scope","$rootScope","listHelper","httpWrapper",function($scope,$rootScope,listHelper,httpWrapper){listHelper.bootstrap("/center/question/replied",$scope),$scope.complete=function(id,index){httpWrapper.request("http://"+$rootScope.hostName+"/center/question/"+id+"/to_complete","post",null,function(data){layer.show("确认成功！"),$scope.items.splice(index,1),location.href="#/userquestion/waitforconfirmation",window.location.reload()},function(data){console.info(data)})}}]),lvtuanApp.controller("questionWaitforconfirmationCtrl",["$scope","$rootScope","listHelper","httpWrapper",function($scope,$rootScope,listHelper,httpWrapper){listHelper.bootstrap("/center/question/waitforevaluation",$scope),$scope.evaluate=function(id,index){$scope.items.splice(index,1),location.href="#/confirmCompletion/"+id}}]),lvtuanApp.controller("confirmCompletionCtrl",["$scope","$http","$rootScope","$stateParams","listHelper","httpWrapper",function($scope,$http,$rootScope,$stateParams,listHelper,httpWrapper){listHelper.bootstrap("/center/question/waitforevaluation",$scope),$scope.max=5,$scope.ratingVal=5,$scope.readonly=!1,$scope.onHover=function(val){$scope.hoverVal=val},$scope.onLeave=function(){$scope.hoverVal=null},$scope.onChange=function(val){$scope.ratingVal=val,console.info(val)},$scope.user={evaluate_comment:""},$scope.submit=function(){var data={};$scope.ratingVal&&(data.evaluate_score=$scope.ratingVal),$scope.user.evaluate_comment&&(data.evaluate_comment=$scope.user.evaluate_comment),data=data,httpWrapper.request("http://"+$rootScope.hostName+"/center/question/"+$stateParams.id+"/to_evaluate","post",data,function(data){layer.show("评价成功！"),$scope.user={},location.href="#/userquestion/waitforconfirmation"},function(data){console.info(data)})},$scope.cancel=function(){$scope.ratingVal=5,$scope.user={evaluate_comment:""},window.location.reload()}}]),lvtuanApp.controller("userquestionviewCtrl",["$http","$scope","$stateParams","$rootScope","httpWrapper",function($http,$scope,$stateParams,$rootScope,httpWrapper){httpWrapper.get("http://"+$rootScope.hostName+"/center/question/"+$stateParams.id+"/view",function(data){$scope.items=data.data}),$scope.remove=function(id,index){httpWrapper.request("http://"+$rootScope.hostName+"/center/question/"+id+"/remove","post",null,function(data){$scope.items.splice(index,1),layer.show("删除成功！")},function(data){console.info(data)})},$scope.cancel=function(id,index){httpWrapper.request("http://"+$rootScope.hostName+"/center/question/"+id+"/cancel","post",null,function(data){$scope.items[index]=data.data.data,layer.show("取消成功！")},function(data){console.info(data)})},$scope.complete=function(id,index){httpWrapper.request("http://"+$rootScope.hostName+"/center/question/"+id+"/to_complete","post",null,function(data){layer.show("确认成功！"),$scope.items.splice(index,1)},function(data){console.info(data)})},$scope.ask=function(id,index){location.href="#/center"},$scope.pay=function(id){location.href="#/pay/"+id},$scope.evaluate=function(id,index){$scope.items.splice(index,1),location.href="#/confirmCompletion/"+id}}]),lvtuanApp.controller("userorderAllCtrl",["$http","$scope","$rootScope","listHelper","httpWrapper",function($http,$scope,$rootScope,listHelper,httpWrapper){listHelper.bootstrap("/center/pay/question/all",$scope),$scope.remove=function(id,index){httpWrapper.request("http://"+$rootScope.hostName+"/center/question/"+id+"/remove","post",null,function(data){$scope.items.splice(index,1),layer.show("删除成功！")},function(data){console.info(data)})},$scope.cancel=function(id,index){httpWrapper.request("http://"+$rootScope.hostName+"/center/question/"+id+"/cancel","post",null,function(data){$scope.items[index]=data.data.data,layer.show("取消成功！")},function(data){console.info(data)})},$scope.complete=function(id,index){httpWrapper.request("http://"+$rootScope.hostName+"/center/question/"+id+"/to_complete","post",null,function(data){layer.show("确认成功！"),$scope.items.splice(index,1)},function(data){console.info(data)})},$scope.ask=function(id,index){location.href="#/center"},$scope.pay=function(id){location.href="#/pay/"+id},$scope.evaluate=function(id,index){$scope.items.splice(index,1),location.href="#/confirmCompletion/"+id}}]),lvtuanApp.controller("userorderPendingCtrl",["$scope","listHelper",function($scope,listHelper){listHelper.bootstrap("/center/pay/question/waitpay",$scope)}]),lvtuanApp.controller("userorderNewCtrl",["$scope","listHelper",function($scope,listHelper){listHelper.bootstrap("/center/pay/question/new",$scope)}]),lvtuanApp.controller("userorderRepliedCtrl",["$scope","listHelper",function($scope,listHelper){listHelper.bootstrap("/center/pay/question/replied",$scope)}]),lvtuanApp.controller("userorderWaitforevaluationCtrl",["$scope","listHelper",function($scope,listHelper){listHelper.bootstrap("/center/pay/question/waitforevaluation",$scope)}]),lvtuanApp.controller("userOrderDetailCtrl",["$http","$scope","$state","$rootScope","$stateParams","$interval",function($http,$scope,$state,$rootScope,$stateParams,$interval){$http.get("http://"+$rootScope.hostName+"/center/pay/question/"+$stateParams.id+"/view").success(function(data){return data&&data.data?($scope.item=data.data,!0):(layer.show("暂无数据！"),!1)}).error(function(data,status){401==status&&layer.msg(status),console.info(JSON.stringify(data))})}]),lvtuanApp.controller("documentlistCtrl",["$http","$scope","$state","$rootScope","$timeout",function($http,$scope,$state,$rootScope,$timeout){function getParams(){var params=layer.getParams("#search_form");console.info(params);var param=[];params.q&&param.push("q="+params.q),params.cat_id&&param.push("cat_id="+params.cat_id),param=param.join("&"),console.info(param),geturl(param)}function geturl(param){var url="";url+=param?"http://"+$rootScope.hostName+"/knowledge/document/list_documents?"+param+"&page="+page++:"http://"+$rootScope.hostName+"/knowledge/document/list_documents?page="+page++,$http.get(url).success(function(data){return console.info("法律文书",data.data),data.data.length>0?(data.data.length>9?$scope.moredata=!0:$scope.moredata=!1,void($scope.items=$scope.items.concat(data.data))):(layer.show("暂无数据！"),$scope.moredata=!1,!1)}).error(function(data,status){401==status&&layer.msg(status),console.info(JSON.stringify(data))})["finally"](function(){$scope.$broadcast("scroll.refreshComplete"),$scope.$broadcast("scroll.infiniteScrollComplete")})}$http.get("http://"+$rootScope.hostName+"/lawyer/workscopes").success(function(data){data.data?$scope.workscopes=data.data:layer.show("暂无数据！")}).error(function(data,status){401==status&&layer.msg(status),console.info(JSON.stringify(data)),console.info(JSON.stringify(status))});var page=1;$scope.moredata=!0,$scope.items=[],$scope.search=function(){page=1,$scope.items=[],getParams()},$scope.searchCatId=function(){page=1,$scope.items=[],getParams()},$scope.doRefresh=function(){page=1,$scope.items=[],getParams()},$scope.loadMore=function(){getParams()}}]),lvtuanApp.controller("documentownloadlistCtrl",["$http","$scope","$state","$rootScope","$stateParams",function($http,$scope,$state,$rootScope,$stateParams){$http.get("http://"+$rootScope.hostName+"/knowledge/document/"+$stateParams.id+"/view").success(function(data){console.info("法律文书详情",data.data),$scope.itmes=data.data}).error(function(data,status){401==status&&layer.msg(status),console.info(JSON.stringify(data))})}]),lvtuanApp.controller("corporateservicesCtrl",["$http","$scope","$state","$rootScope","$stateParams",function($http,$scope,$state,$rootScope,$stateParams){var page=1;$scope.moredata=!0,$scope.items=[],$scope.doRefresh=function(){page=1,$scope.items=[],$scope.loadMore()},$scope.loadMore=function(){$http.get("http://"+$rootScope.hostName+"/company/product/list?page="+page++).success(function(data){return console.info("待确认",data.data),data.data.length>0?(data.data.length>9?$scope.moredata=!0:$scope.moredata=!1,$scope.items=data.data,!0):($scope.moredata=!1,layer.show("暂无数据！"),!1)}).error(function(data,status){401==status&&layer.msg(status),console.info(JSON.stringify(data))})}}]),lvtuanApp.controller("corporatelistCtrl",["$scope","$state","$http","$rootScope","$stateParams","$ionicPopup","$timeout",function($scope,$state,$http,$rootScope,$stateParams,$ionicPopup,$timeout){$scope.tabs=[{title:"产品详情",url:"list-detail.tpl.html"},{title:"评价",url:"list-evaluate.tpl.html"}],$scope.currentTab="list-detail.tpl.html",$scope.onClickTab=function(tab){$scope.currentTab=tab.url},$scope.isActiveTab=function(tabUrl){return tabUrl==$scope.currentTab},$http.get("http://"+$rootScope.hostName+"/company/product/"+$stateParams.id+"/view").success(function(data){console.info("详情",data.data),$scope.items=data.data}).error(function(data,status){console.info(JSON.stringify(data))})}]),lvtuanApp.controller("corporatelistevaluateCtrl",["$scope","$http","$rootScope","$stateParams",function($scope,$http,$rootScope,$stateParams){console.info("id",$stateParams.id),$http.get("http://"+$rootScope.hostName+"/company/product/"+$stateParams.id+"/comments").success(function(data){console.info("评价详情",data.data),$scope.items=data.data,$scope.ratingVal=[];for(var i=0;i<$scope.items.length;i++)$scope.ratingVal.push($scope.items[i].score)}).error(function(data,status){401==status&&layer.msg(status),console.info(JSON.stringify(data))}),$scope.max=5,$scope.readonly=!0,$scope.onHover=function(val){$scope.hoverVal=val},$scope.onLeave=function(){$scope.hoverVal=null},$scope.onChange=function(val){$scope.ratingVal=val}}]),lvtuanApp.controller("corporatebuynowCtrl",["$scope","$http","$rootScope","$stateParams",function($scope,$http,$rootScope,$stateParams){function getProvince(){$http.get("http://"+$rootScope.hostName+"/area/province").success(function(data){console.info(data.data),$scope.provinces=data.data}).error(function(data,status){401==status&&layer.msg(status),console.info(JSON.stringify(data))})}$http.get("http://"+$rootScope.hostName+"/company/product/"+$stateParams.id+"/view").success(function(data){console.info("详情",data.data),$scope.items=data.data}).error(function(data,status){401==status&&layer.msg(status),console.info(JSON.stringify(data))}),getProvince(),$scope.getCity=function(province){$http.get("http://"+$rootScope.hostName+"/area/"+province+"/city").success(function(data){$scope.citys=data.data}).error(function(data,status){401==status&&layer.msg(status),console.info(JSON.stringify(data))})},$scope.getDistrict=function(city){$http.get("http://"+$rootScope.hostName+"/area/"+city+"/district").success(function(data){$scope.districts=data.data}).error(function(data,status){401==status&&layer.msg(status),console.info(JSON.stringify(data))})},$scope.submit=function(user){$scope.items={},user.contact_phone&&($scope.items.contact_phone=user.contact_phone),user.email&&($scope.items.email=user.email),user.company_name&&($scope.items.company_name=user.company_name),user.contact&&($scope.items.contact=user.contact),user.memo&&($scope.items.memo=user.memo),user.province.key&&($scope.items.province=user.province.key),user.city.key&&($scope.items.city=user.city.key),user.district.key&&($scope.items.district=user.district.key),1==user.invoice?$scope.items.invoice="Y":$scope.items.invoice="N",$stateParams.id&&($scope.items.product_id=$stateParams.id),console.info($scope.items),$http.post("http://"+$rootScope.hostName+"/company/order/submit",$scope.items).success(function(data){console.log(data.data),layer.show("提交成功！"),$scope.user={},$scope.items={},location.href="#/corporate"}).error(function(data,status){var errMsg=JSON.stringify(data.message);console.info(errMsg),layer.show(errMsg)})}}]),lvtuanApp.controller("userwalletCtrl",["$scope","$http","$rootScope","authService",function($scope,$http,$rootScope,authService){if(!authService.isAuthed())return void $rootScope.$broadcast("unauthorized");var currentUser=authService.getUser();1==currentUser.user_group_id||2==currentUser.user_group_id&&0==currentUser.is_verified?$http.get("http://"+$rootScope.hostName+"/center/customer/wallet").success(function(data){data&&data.data&&($scope.items=data.data,localStorage.setItem("summoney",$scope.items.money))}).error(function(data,status){401==status&&layer.msg(status),console.info(JSON.stringify(data))}):$http.get("http://"+$rootScope.hostName+"/center/lawyer/wallet").success(function(data){data&&data.data&&($scope.items=data.data,localStorage.setItem("money",$scope.items.money))}).error(function(data,status){401==status&&layer.msg(status),console.info(JSON.stringify(data))})}]),lvtuanApp.controller("usermoneyinCtrl",["$scope","$http","$rootScope","$stateParams",function($scope,$http,$rootScope,$stateParams){$scope.summoney=localStorage.getItem("summoney"),$scope.submit=function(user){$http.post("http://"+$rootScope.hostName+"/wallet/recharge",{money:user.money}).success(function(data){localStorage.removeItem("summoney"),$scope.money=data.data.money,$scope.summoney=$scope.money,localStorage.setItem("summoney",$scope.summoney),layer.show("提交成功！"),$scope.user={},angular.element("#money").val(""),console.info($scope.user)}).error(function(data,status){401==status&&layer.msg(status);var errMsg=JSON.stringify(data.message);console.info(errMsg),layer.show(errMsg)})}}]),lvtuanApp.controller("userrecordCtrl",["$scope","$http","$rootScope","listHelper",function($scope,$http,$rootScope,listHelper){listHelper.bootstrap("/wallet/record?type=recharge",$scope)}]),lvtuanApp.controller("usermoneyoutCtrl",["$scope","$http","$rootScope",function($scope,$http,$rootScope){$scope.summoney=localStorage.getItem("summoney"),$scope.submit=function(user){$http.post("http://"+$rootScope.hostName+"/wallet/withdraw",user).success(function(data){$scope.items=data.data,console.info($scope.items),localStorage.setItem("summoney",$scope.items.money),$scope.summoney=$scope.items.money,layer.show("提交成功！"),$scope.user={},console.info($scope.user)}).error(function(data,status){401==status&&layer.msg(status);var errMsg=JSON.stringify(data.message);console.info(errMsg),layer.show(errMsg)})}}]),lvtuanApp.controller("userwithdrawCtrl",["$scope","$http","$rootScope","listHelper",function($scope,$http,$rootScope,listHelper){listHelper.bootstrap("/wallet/record?type=withdraw",$scope)}]),lvtuanApp.controller("userpayallCtrl",["$scope","$http","$rootScope","listHelper",function($scope,$http,$rootScope,listHelper){listHelper.bootstrap("/wallet/record",$scope)}]),lvtuanApp.controller("payCtrl",["$scope","$http","$rootScope","$stateParams","$ionicPopup","listHelper",function($scope,$http,$rootScope,$stateParams,$ionicPopup,listHelper){console.info($stateParams.id),$scope.pay=function(){var confirmPopup=$ionicPopup.confirm({title:"是否立即付款？",cancelText:"取消",okText:"确认"});confirmPopup.then(function(res){return res?void $http.post("http://"+$rootScope.hostName+"/center/question/"+$stateParams.id+"/wallet/pay",{headers:{"Content-Type":"application/json",Authorization:"bearer "+$rootScope.token}}).success(function(data){$scope.items=data.data,console.info($scope.items),layer.show("付款成功！")}).error(function(data,status){console.info(data);var errMsg=JSON.stringify(data.message);console.info(errMsg),layer.show(errMsg)}):!1})}}]),lvtuanApp.directive("star",function(){return{template:'<ul class="rating" ng-mouseleave="leave()"><li ng-repeat="star in stars" ng-class="star" ng-click="click($index + 1)" ng-mouseover="over($index + 1)">★</li></ul>',scope:{ratingValue:"=",max:"=",readonly:"@",onHover:"=",onLeave:"="},controller:["$scope",function($scope){$scope.ratingValue=$scope.ratingValue||0,$scope.max=$scope.max||5,$scope.click=function(val){$scope.readonly&&"true"===$scope.readonly||($scope.ratingValue=val)},$scope.over=function(val){$scope.onHover(val)},$scope.leave=function(){$scope.onLeave()}}],link:function(scope,elem,attrs){elem.css("text-align","center");var updateStars=function(){scope.stars=[];for(var i=0;i<scope.max;i++)scope.stars.push({filled:i<scope.ratingValue})};updateStars(),scope.$watch("ratingValue",function(oldVal,newVal){newVal&&updateStars()}),scope.$watch("max",function(oldVal,newVal){newVal&&updateStars()})}}}),angular.module("lvtuanApp",["ionic","lvtuanApp.Ctrl","templates"]).run(["$ionicPlatform",function($ionicPlatform){$ionicPlatform.ready(function(){window.cordova&&window.cordova.plugins.Keyboard&&cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),window.StatusBar&&StatusBar.styleDefault()})}]).run(["$rootScope","$timeout","$location","$ionicLoading",function($rootScope,$timeout,$location,$ionicLoading){$rootScope.token=localStorage.getItem("token"),$rootScope.user_id=localStorage.getItem("user_id"),$rootScope.user_group_id=localStorage.getItem("user_group_id"),$rootScope.is_verified=localStorage.getItem("is_verified"),$rootScope.show=function(){$ionicLoading.show({template:'<ion-spinner icon="circles"></ion-spinner>',noBackdrop:!1})},$rootScope.hide=function(){$ionicLoading.hide()};var hostName=AppSettings.baseApiUrl;localStorage.setItem("hostName",JSON.stringify(hostName)),$rootScope.hostName=JSON.parse(localStorage.getItem("hostName")),$rootScope.goHome=function(){layer.goHome()}}]).config(function($httpProvider){$httpProvider.interceptors.push("APIInterceptor")}).config(function($stateProvider,$urlRouterProvider){$stateProvider.state("home",{url:"/home",cache:"true",templateUrl:"template/home.html",controller:"ionicNavBarDelegateCtrl"}).state("index",{url:"/index",cache:"true",templateUrl:"template/index_tpl.html",controller:"indexCtrl"}).state("mylvteam",{url:"/mylvteam",cache:"true",templateUrl:"template/mylvteam.html"}).state("login",{url:"/login",cache:"true",templateUrl:"template/home/login.html"}).state("register",{url:"/register",cache:"true",templateUrl:"template/home/register.html"}).state("resetpwd",{url:"/resetpwd",cache:"true",templateUrl:"template/home/resetpwd.html"}).state("group",{url:"/group",cache:"true",templateUrl:"template/group/group.html",controller:"groupCtrl"}).state("group.list",{url:"/list",cache:"true",views:{"group-list":{templateUrl:"template/group/group-list.html",controller:"groupListCtrl"}}}).state("group.televise",{url:"/televise",cache:"true",views:{"group-televise":{templateUrl:"template/group/group-televise.html",controller:"groupTeleviseCtrl"}}}).state("group.attention",{url:"/attention",cache:"true",views:{"group-attention":{templateUrl:"template/group/group-attention.html",controller:"groupAttentionCtrl"}}}).state("groupview",{url:"/group/view/:id",templateUrl:"template/group/group_view.html",controller:"groupviewCtrl"}).state("broadcast/view",{url:"/broadcast/view/:id",templateUrl:"template/group/broadcast_view.html",controller:"broadcastviewCtrl"}).state("groupcreate",{url:"/groupcreate",templateUrl:"template/group/create.html",controller:"groupcreateCtrl"}).state("televisecreate",{url:"/televisecreate",templateUrl:"template/group/televisecreate.html",controller:"televisecreateCtrl"}).state("group/site",{url:"/group/site/:id",templateUrl:"template/group/group-site.html",controller:"groupsiteCtrl"}).state("group/add",{url:"/group/add/:id",templateUrl:"template/group/group-add.html",controller:"groupaddCtrl"}).state("knowledge",{url:"/knowledge",templateUrl:"template/knowledge/knowledge.html"}).state("knowledge.knowledges",{url:"/knowledges",cache:"true",views:{"knowledge-knowledges":{templateUrl:"template/knowledge/knowledge-knowledges.html",controller:"knowledgesCtrl"}}}).state("knowledge.documents",{url:"/documents",cache:"true",views:{"knowledge-documents":{templateUrl:"template/knowledge/knowledge-documents.html",controller:"documentsCtrl"}}}).state("knowledge.cases",{url:"/cases",cache:"true",views:{"knowledge-cases":{templateUrl:"template/knowledge/knowledge-cases.html",controller:"casesCtrl"}}}).state("knowledgeview",{url:"/knowledgeview/:id",cache:"true",templateUrl:"template/knowledge/knowledges-view.html",controller:"knowledgeViewCtrl"}).state("knowknowledgesview",{url:"/knowknowledgesview/:id",cache:"true",templateUrl:"template/knowledge/knowledges-view.html",controller:"knowKnowledgesCtrl"}).state("knowdocumentsview",{url:"/knowdocumentsview/:id",cache:"true",templateUrl:"template/knowledge/documents-view.html",controller:"knowDocumentsCtrl"}).state("knowcasesview",{url:"/knowcasesview/:id",cache:"true",templateUrl:"template/knowledge/cases-view.html",controller:"knowCasesCtrl"}).state("center",{url:"/center",cache:"true",templateUrl:"template/center/center.html",controller:"centerCtrl"}).state("info",{url:"/info",cache:"true",templateUrl:"template/center/info.html",controller:"infoCtrl"}).state("comment",{url:"/comment",cache:"true",templateUrl:"template/center/comment.html",controller:"commentCtrl"}).state("followed",{url:"/followed",cache:"true",templateUrl:"template/center/followed.html",controller:"followedCtrl"}).state("becomelawyer",{url:"/becomelawyer",cache:"true",templateUrl:"template/center/become_lawyer.html",controller:"becomelawyerCtrl"}).state("followed_lawyer",{url:"/followed_lawyer",cache:"true",templateUrl:"template/center/lawyer/followed.html",controller:"followedlaywerCtrl"}).state("comment_lawyer",{url:"/comment_lawyer/:id",cache:"false",templateUrl:"template/center/lawyer/comment.html",controller:"commentlaywerCtrl"}).state("article_lawyer",{url:"/article_lawyer",templateUrl:"template/center/lawyer/article.html"}).state("article_lawyer.case",{url:"/case/:class",views:{"article-case":{templateUrl:"template/center/lawyer/article-case.html",controller:"caselaywerCtrl"}}}).state("article_lawyer.advisory",{url:"/advisory/:class",views:{"article-advisory":{templateUrl:"template/center/lawyer/article-advisory.html",controller:"caselaywerCtrl"}}}).state("article_lawyer.lknowledge",{url:"/lknowledge/:class",views:{"article-lknowledge":{templateUrl:"template/center/lawyer/article-lknowledge.html",controller:"caselaywerCtrl"}}}).state("/lawyer/article/view/",{url:"/lawyer/article/view/:id",templateUrl:"template/center/lawyer/view.html",controller:"viewarticlelawyerCtrl"}).state("about",{url:"/about",cache:"true",templateUrl:"template/center/about.html",controller:"aboutCtrl"}).state("site",{url:"/site",cache:"true",templateUrl:"template/center/site.html",controller:"siteCtrl"}).state("listscores",{url:"/listscores",cache:"true",templateUrl:"template/center/list_scores.html",controller:"listscoresCtrl"}).state("collect",{url:"/collect",cache:"true",templateUrl:"template/center/collect.html",controller:"collectCtrl"}).state("messages",{url:"/messages",cache:"true",templateUrl:"template/center/messages.html",controller:"messagesCtrl"}).state("message_details",{url:"/message/:id",cache:"true",templateUrl:"template/center/message_view.html",controller:"viewMessageCtrl"}).state("lawyerlist",{url:"/lawyerlist",cache:"true",templateUrl:"template/lawyer/lawyer_list.html",controller:"lawyerlistCtrl"}).state("lawyer",{url:"/lawyer/:id",cache:"true",templateUrl:"template/lawyer/view.html",controller:"viewCtrl"}).state("graphic",{url:"/graphic",cache:"true",templateUrl:"template/lawyer/graphic.html"}).state("special",{url:"/special",cache:"true",templateUrl:"template/lawyer/special.html",controller:"specialCtrl"}).state("questions",{url:"/questions",cache:"true",templateUrl:"template/questions/questions.html",controller:"questionsCtrl"}).state("questionslist",{cache:"true",url:"/questionslist",templateUrl:"template/questions/questions_list.html",controller:"questionslistCtrl"}).state("questionsview",{cache:"true",url:"/questionsview/:id",templateUrl:"template/questions/view.html",controller:"questionsviewsCtrl"}).state("legaladvice",{url:"/legaladvice",templateUrl:"template/legaladvice.html",controller:"legaladviceCtrl"}).state("workbenchlawyer",{url:"/workbenchlawyer",templateUrl:"template/mylvtuan/lawyer/workbench-lawyer.html",
controller:"workbenchLawyerCtrl"}).state("orderlawyer",{url:"/orderlawyer",templateUrl:"template/mylvtuan/lawyer/order/order-lawyer.html"}).state("orderlawyer.all",{url:"/all",cache:"true",views:{"order-all":{templateUrl:"template/mylvtuan/lawyer/order/order-all.html",controller:"orderAllCtrl"}}}).state("orderlawyer.new",{url:"/new",cache:"true",views:{"order-new":{templateUrl:"template/mylvtuan/lawyer/order/order-new.html",controller:"orderNewCtrl"}}}).state("orderlawyer.replied",{url:"/replied",cache:"true",views:{"order-replied":{templateUrl:"template/mylvtuan/lawyer/order/order-replied.html",controller:"orderRepliedCtrl"}}}).state("orderlawyer.complete",{url:"/complete",cache:"true",views:{"order-complete":{templateUrl:"template/mylvtuan/lawyer/order/order-complete.html",controller:"orderCompleteCtrl"}}}).state("lawyerquestion",{url:"/lawyerquestion",templateUrl:"template/mylvtuan/lawyer/question/question.html"}).state("lawyerquestion.new",{url:"/new",cache:"true",views:{"question-new":{templateUrl:"template/mylvtuan/lawyer/question/new.html",controller:"lawyerquestionNewCtrl"}}}).state("lawyerquestion.replied",{url:"/replied",cache:"true",views:{"question-replied":{templateUrl:"template/mylvtuan/lawyer/question/replied.html",controller:"lawyerquestionRepliedCtrl"}}}).state("lawyerquestion.complete",{url:"/complete",cache:"true",views:{"question-complete":{templateUrl:"template/mylvtuan/lawyer/question/complete.html",controller:"lawyerquestionCompleteCtrl"}}}).state("lawyer/questions/view",{url:"/lawyer/questions/view/:id",cache:"true",templateUrl:"template/mylvtuan/lawyer/question/view.html",controller:"lawyerquestionsviewCtrl"}).state("queryrefer",{url:"/queryrefer",cache:"true",templateUrl:"template/mylvtuan/lawyer/queryrefer.html"}).state("queryreferdetail",{url:"/queryreferdetail",cache:"true",templateUrl:"template/mylvtuan/lawyer/queryrefer-detail.html"}).state("userlvtuan",{url:"/userlvtuan",cache:"true",templateUrl:"template/mylvtuan/user/userlvtuan.html",controller:"userlvtuanCtrl"}).state("userquestion",{url:"/userquestion",templateUrl:"template/mylvtuan/user/question/question.html"}).state("userquestion.new",{url:"/new",cache:"true",views:{"question-new":{templateUrl:"template/mylvtuan/user/question/new.html",controller:"questionNewCtrl"}}}).state("userquestion.all",{url:"/all",cache:"true",views:{"question-all":{templateUrl:"template/mylvtuan/user/question/all.html",controller:"questionAllCtrl"}}}).state("userquestion.replied",{url:"/replied",cache:"true",views:{"question-replied":{templateUrl:"template/mylvtuan/user/question/replied.html",controller:"questionRepliedCtrl"}}}).state("userquestion.waitforconfirmation",{url:"/waitforconfirmation",cache:"true",views:{"question-waitforconfirmation":{templateUrl:"template/mylvtuan/user/question/waitforconfirmation.html",controller:"questionWaitforconfirmationCtrl"}}}).state("user/question/view",{url:"user/question/view/:id",templateUrl:"template/mylvtuan/user/question/view.html",controller:"userquestionviewCtr"}).state("confirmCompletion",{url:"/confirmCompletion/:id",templateUrl:"template/mylvtuan/user/question/confirm-completion.html"}).state("orderuser",{url:"/orderuser",templateUrl:"template/mylvtuan/user/order/order-user.html"}).state("orderuser.all",{url:"/all",cache:"true",views:{"order-all":{templateUrl:"template/mylvtuan/user/order/order-all.html",controller:"userorderAllCtrl"}}}).state("orderuser.pending",{url:"/pending",cache:"true",views:{"order-pending":{templateUrl:"template/mylvtuan/user/order/order-pending.html",controller:"userorderPendingCtrl"}}}).state("orderuser.new",{url:"/new",cache:"true",views:{"order-new":{templateUrl:"template/mylvtuan/user/order/order-new.html",controller:"userorderNewCtrl"}}}).state("orderuser.replied",{url:"/replied",cache:"true",views:{"order-replied":{templateUrl:"template/mylvtuan/user/order/order-replied.html",controller:"userorderRepliedCtrl"}}}).state("orderuser.waitforevaluation",{url:"/waitforevaluation",cache:"true",views:{"order-waitforevaluation":{templateUrl:"template/mylvtuan/user/order/order-waitforevaluation.html",controller:"userorderWaitforevaluationCtrl"}}}).state("orderuser.complete",{url:"/complete",cache:"true",views:{"order-complete":{templateUrl:"template/mylvtuan/user/order/order-complete.html",controller:"userorderCompleteCtrl"}}}).state("send/mind",{url:"/send/mind",templateUrl:"template/mylvtuan/user/question/send-mind.html"}).state("userorderdetail",{url:"/userorderdetail/:id",templateUrl:"template/mylvtuan/user/order/order-detail.html",controller:"userOrderDetailCtrl"}).state("user/wallet",{url:"/user/wallet",templateUrl:"template/mylvtuan/user/wallet/wallet.html",controller:"userwalletCtrl"}).state("user/moneyin",{url:"/user/moneyin",templateUrl:"template/mylvtuan/user/wallet/moneyin.html",controller:"usermoneyinCtrl"}).state("user/record",{url:"/user/record",templateUrl:"template/mylvtuan/user/wallet/record.html",controller:"userrecordCtrl"}).state("user/moneyout",{url:"/user/moneyout",templateUrl:"template/mylvtuan/user/wallet/moneyout.html"}).state("user/withdraw",{url:"/user/withdraw",templateUrl:"template/mylvtuan/user/wallet/withdraw.html",controller:"userwithdrawCtrl"}).state("user/payall",{url:"/user/payall",templateUrl:"template/mylvtuan/user/wallet/payall.html",controller:"userpayallCtrl"}).state("lawlecture",{url:"/lawlecture",templateUrl:"template/lecture/lawlecture.html",controller:"lawlectureCtrl"}).state("casescomm",{url:"/casescomm",templateUrl:"template/casescomm.html",controller:"casescommCtrl"}).state("lvtuanalliance",{url:"/lvtuanalliance",templateUrl:"template/lvtuanalliance.html",controller:"lvtuanallianceCtrl"}).state("lvtuanallianceview",{url:"/lvtuanallianceview/:id",templateUrl:"template/lvtuanalliance_view.html",controller:"lvtuanallianceviewCtrl"}).state("talent",{url:"/talent",templateUrl:"template/talent.html",controller:"talentCtrl"}).state("talentview",{url:"/talentview/:id",templateUrl:"template/talentview.html",controller:"talentviewCtrl"}).state("document/list",{url:"/document/list",templateUrl:"template/document/list.html",controller:"documentlistCtrl"}).state("document/download_list",{url:"/document/download_list/:id",templateUrl:"template/document/download_list.html",controller:"documentownloadlistCtrl"}).state("corporate",{url:"/corporate",templateUrl:"template/corporate/corporateservices.html",controller:"corporateservicesCtrl"}).state("corporate/list",{url:"/corporate/list/:id",templateUrl:"template/corporate/list.html",controller:"corporatelistCtrl"}).state("corporate/buynow",{url:"/corporate/buynow/:id",templateUrl:"template/corporate/buynow.html",controller:"corporatebuynowCtrl"}).state("pay",{url:"/pay/:id",templateUrl:"template/pay.html",controller:"payCtrl"}).state("error",{url:"/error",templateUrl:"template/error.html"}),$urlRouterProvider.otherwise("/index")});var authModule=angular.module("authModule",[]);authModule.constant("HOST",AppSettings.baseApiUrl).service("userService",userService).service("authService",authService);var httpModule=angular.module("httpModule",["authModule"]);httpModule.factory("httpWrapper",["$http","$rootScope",function($http,$rootScope){var httpRequest={};return httpRequest.get=function(url,successCallback){$http.get(url,{cache:!0,headers:{"Content-Type":"application/json",Authorization:"bearer "+$rootScope.token}}).success(successCallback?successCallback:function(data){}).error(function(data,status){layer.msg(status),console.info(JSON.stringify(data))})},httpRequest.request=function(url,method,data,successCallback,failureCallback){$http({method:method,url:url,data:data,cache:!0,headers:{"Content-Type":"application/json",Authorization:"bearer "+$rootScope.token}}).then(successCallback?successCallback:function(response){},failureCallback?failureCallback:function(response){console.info(JSON.stringify(response.data)),console.info(JSON.stringify(response.status))})},httpRequest}]),httpModule.factory("APIInterceptor",["$log","$q","$rootScope","authService","HOST",function($log,$q,$rootScope,authService,HOST){$log.debug("$log is here to show you that this is a regular factory with injection");var myInterceptor={request:function(config){if(config.url.indexOf(HOST)>-1){$rootScope.show();var token=authService.getToken();if(token&&(config.headers.Authorization="Bearer "+token),config.headers.Accept="application/json",config.cache=!0,config.url.indexOf(HOST+"/center")>-1||config.url.indexOf(HOST+"/group")>-1||config.url.indexOf(HOST+"/microblog")>-1){var canceller=$q.defer();authService.isAuthed()?(config.url.indexOf(HOST+"/group")>-1||config.url.indexOf(HOST+"/microblog")>-1)&&(user=authService.getUser(),1!==user.user_group_id&&user.is_verified||$rootScope.$broadcast("unauthorized")):($rootScope.$broadcast("unauthorized"),config.timeout=canceller.promise,canceller.resolve())}}return config},requestError:function(rejection){return canRecover(rejection)?responseOrNewPromise:$q.reject(rejection)},response:function(response){return response.config.url.indexOf(HOST)>-1&&$rootScope.hide(),response},responseError:function(response){return 401==response.status&&$rootScope.$broadcast("unauthorized"),$rootScope.hide(),response}};return myInterceptor}]),httpModule.constant("HOST",AppSettings.baseApiUrl);var listModule=angular.module("listModule",["ionic","ngSanitize","ngFileUpload","httpModule"]);listModule.factory("listHelper",["$http","$rootScope","httpWrapper",function($http,$rootScope,httpWrapper){var listHelper={};return listHelper.bootstrap=function(url,$scope){var page=1,rows_per_page=5;$scope.rows_per_page&&(rows_per_page=$scope.rows_per_page),$scope.moredata=!0,$scope.items=[],$scope.doRefresh=function(){page=1,$scope.items=[],$scope.loadMore(),$scope.$broadcast("scroll.refreshComplete")},$scope.loadMore=function(){var urls=url.split("?"),params="rows_per_page="+rows_per_page+"&page="+page;2==urls.length&&(url=urls[0],params=urls[1]+"&"+params),httpWrapper.get("http://"+$rootScope.hostName+url+"?"+params,function(data){data&&data.data&&data.data.length?($scope.items=$scope.items.concat(data.data),data.data.length<rows_per_page?$scope.moredata=!1:$scope.moredata=!0):(1==page&&layer.show("暂无数据！"),$scope.moredata=!1),page++,$scope.$broadcast("scroll.infiniteScrollComplete")})}},listHelper}]);